-- adm3.sql : complex scenario executed by an emaj_adm role. 
--            Follows adm1.sql and adm2.sql
--
-- set sequence restart value
select public.handle_emaj_sequences(17000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-- define and create the temp file directory to be used by the script
\setenv EMAJTESTTMPDIR '/tmp/emaj_'`echo $PGVER`'/adm3'
\set EMAJTESTTMPDIR `echo $EMAJTESTTMPDIR`
\! mkdir -p $EMAJTESTTMPDIR
set role emaj_regression_tests_adm_user1;
set search_path = public,myschema1,emaj;
-----------------------------
-- Step 15 : export / import configurations
-----------------------------
-- save parameters on a file and reload them
select emaj_export_parameters_configuration(:'EMAJTESTTMPDIR' || '/param_config.json');
 emaj_export_parameters_configuration 
--------------------------------------
                                    3
(1 row)

select emaj_import_parameters_configuration(:'EMAJTESTTMPDIR' || '/param_config.json', true);
 emaj_import_parameters_configuration 
--------------------------------------
                                    3
(1 row)

-- also save the groups configuration on a file
select emaj_export_groups_configuration(:'EMAJTESTTMPDIR' || '/groups_config.json');
 emaj_export_groups_configuration 
----------------------------------
                                3
(1 row)

-----------------------------
-- Checking step 15
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
(0 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17000 order by hist_id;
   hist_function   |     hist_event     |         hist_object          |                                                             regexp_replace                                                             | hist_user 
-------------------+--------------------+------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+-----------
 IMPORT_PARAMETERS | BEGIN              |                              | Input file: '/tmp/emaj_16/adm3/param_config.json'                                                                                      | postgres
                   | DELETED PARAMETER  | dblink_user_password         |                                                                                                                                        | postgres
                   | DELETED PARAMETER  | alter_log_table              |                                                                                                                                        | postgres
                   | DELETED PARAMETER  | fixed_step_rollback_duration |                                                                                                                                        | postgres
                   | INSERTED PARAMETER | dblink_user_password         | <masked data>                                                                                                                          | postgres
                   | INSERTED PARAMETER | alter_log_table              | ADD COLUMN emaj_user_ip INET DEFAULT inet_client_addr(), ADD COLUMN extra_col_appname TEXT DEFAULT current_setting('application_name') | postgres
                   | INSERTED PARAMETER | fixed_step_rollback_duration | @ 0.0025 secs                                                                                                                          | postgres
 IMPORT_PARAMETERS | END                |                              | 3 parameters imported                                                                                                                  | postgres
(8 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17100);
 handle_emaj_sequences 
-----------------------
 
(1 row)

\! rm $EMAJTESTTMPDIR/*
-----------------------------
-- Step 16 : test transactions with several emaj operations
-----------------------------
select emaj_create_group('myGroup4');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj_assign_tables('myschema4','.*',null,'myGroup4');
WARNING:  _assign_tables: Some partitionned tables (mypartp1, mytblp) are not selected.
NOTICE:  table "mytblr2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblr2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblr2" does not exist, skipping
NOTICE:  table "mytblr1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblr1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblr1" does not exist, skipping
NOTICE:  table "mytblm_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblm" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblm" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mytblm" has triggers that will be automatically disabled during E-Maj rollback operations (mytblm_insert_trigger). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblc2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  table "mypartp2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp2" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mypartp2" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblc1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  table "mypartp1a_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp1a" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp1a" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mypartp1a" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mypartp1b_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp1b" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp1b" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mypartp1b" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
 emaj_assign_tables 
--------------------
                  8
(1 row)

-- several similar operations in a single transaction, using different mark names
begin;
  select emaj_start_group('myGroup4','M1');
 emaj_start_group 
------------------
                8
(1 row)

  select emaj_set_mark_group('myGroup4','M2');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

  select emaj_set_mark_group('myGroup4','M3');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

  select emaj_stop_group('myGroup4','M4');
 emaj_stop_group 
-----------------
               8
(1 row)

  select emaj_start_group('myGroup4','M5',false);
 emaj_start_group 
------------------
                8
(1 row)

  select emaj_stop_group('myGroup4','M6');
 emaj_stop_group 
-----------------
               8
(1 row)

commit;
-----------------------------
-- Checking step 16
-----------------------------
-- emaj tables
select * from emaj.emaj_mark where mark_group = 'myGroup4' order by mark_time_id, mark_group;
 mark_group | mark_name | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+-----------+--------------+------------------------+--------------+---------------------------+------------------------------
 myGroup4   | M1        |        17102 | f                      |              |                         0 | 
 myGroup4   | M2        |        17103 | f                      |              |                         0 | 
 myGroup4   | M3        |        17104 | f                      |              |                         0 | 
 myGroup4   | M4        |        17105 | f                      |              |                         0 | 
 myGroup4   | M5        |        17106 | f                      |              |                         0 | 
 myGroup4   | M6        |        17107 | f                      |              |                         0 | 
(6 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17100 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17100 |           17100000 | C
   17101 |           17100000 | A
   17102 |           17100000 | S
   17103 |           17100000 | M
   17104 |           17100000 | M
   17105 |           17100000 | X
   17106 |           17100000 | S
   17107 |           17100000 | X
(8 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17100 order by hist_id;
   hist_function    |     hist_event     |     hist_object     |             regexp_replace              | hist_user 
--------------------+--------------------+---------------------+-----------------------------------------+-----------
 CREATE_GROUP       | BEGIN              | myGroup4            | rollbackable                            | postgres
 CREATE_GROUP       | TIME STAMP SET     | 17100               |                                         | postgres
 CREATE_GROUP       | END                | myGroup4            |                                         | postgres
 ASSIGN_TABLES      | BEGIN              |                     |                                         | postgres
 ASSIGN_TABLES      | TIME STAMP SET     | 17101               |                                         | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED | emaj_myschema4      |                                         | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblr2   | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblr1   | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblm    | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblc2   | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp2  | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblc1   | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp1a | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp1b | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | END                |                     | 8 tables assigned to the group myGroup4 | postgres
 START_GROUP        | BEGIN              | myGroup4            | With log reset                          | postgres
 START_GROUP        | TIME STAMP SET     | 17102               |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | END                | myGroup4            | 8 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4            | M1                                      | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 14707   | set to COMMITTED                        | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 14708   | set to COMMITTED                        | postgres
 SET_MARK_GROUP     | END                | myGroup4            | M1                                      | postgres
 START_GROUP        | END                | myGroup4            | 8 tables/sequences processed            | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | END                | myGroup4            | 8 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | TIME STAMP SET     | 17103               |                                         | postgres
 SET_MARK_GROUP     | END                | myGroup4            | M2                                      | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | END                | myGroup4            | 8 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | TIME STAMP SET     | 17104               |                                         | postgres
 SET_MARK_GROUP     | END                | myGroup4            | M3                                      | postgres
 STOP_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 STOP_GROUP         | TIME STAMP SET     | 17105               |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | END                | myGroup4            | 8 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4            | M4                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4            | M4                                      | postgres
 STOP_GROUP         | END                | myGroup4            | 8 tables/sequences processed            | postgres
 START_GROUP        | BEGIN              | myGroup4            | Without log reset                       | postgres
 START_GROUP        | TIME STAMP SET     | 17106               |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | END                | myGroup4            | 8 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4            | M5                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4            | M5                                      | postgres
 START_GROUP        | END                | myGroup4            | 8 tables/sequences processed            | postgres
 STOP_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 STOP_GROUP         | TIME STAMP SET     | 17107               |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4            |                                         | postgres
 LOCK_GROUP         | END                | myGroup4            | 8 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4            | M6                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4            | M6                                      | postgres
 STOP_GROUP         | END                | myGroup4            | 8 tables/sequences processed            | postgres
(55 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17200);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- Step 17 : test partition attach and detach
-----------------------------
-- Needs postgres 10+
set role emaj_regression_tests_adm_user2;
select emaj_start_group('myGroup4','Start');
 emaj_start_group 
------------------
                8
(1 row)

reset role;
insert into mySchema4.myTblR1 values (-2), (-1), (0), (1), (2), (11);
insert into mySchema4.myTblP values (-2, 'A', 'Stored in partition 1A'), (-1, 'P', 'Stored in partition 1B'),
									(0, 'Q', 'Stored in partition 2'), (1, 'X', 'Stored in partition 2'),
									(2, 'Y', 'Also stored in partition 2');
----insert into mySchema4.myTblP values (-1,'Stored in partition 1'), (1,'Stored in partition 2');
select emaj_set_mark_group('myGroup4','M1');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

----update mySchema4.myTblP set col1 = 2 where col1 = 1;
update myschema4.myTblP set col1 = -2, col3 = 'Moved to partition 1B' where col1 = 2;
-- create a new partition and add it into the group ; in passing also add the sequence linked to the serial column of the mother table
CREATE TABLE mySchema4.myPartP3 PARTITION OF mySchema4.myTblP FOR VALUES FROM (10) TO (19);
-- create the table with PG 9.6- so that next scripts do not abort
CREATE TABLE IF NOT EXISTS mySchema4.myPartP3 () INHERITS (mySchema4.myTblP);
NOTICE:  relation "mypartp3" already exists, skipping
-- add a PK (will fail with PG12+ because of the global PK)
ALTER TABLE mySchema4.myPartP3 ADD PRIMARY KEY (col1);
ERROR:  multiple primary keys for table "mypartp3" are not allowed
grant all on mySchema4.myPartP3 to emaj_regression_tests_adm_user1, emaj_regression_tests_adm_user2;
set role emaj_regression_tests_adm_user1;
select emaj_assign_table('myschema4','mypartp3','myGroup4',null,'Add partition 3');
NOTICE:  table "mypartp3_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp3" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp3" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mypartp3" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
 emaj_assign_table 
-------------------
                 1
(1 row)

select emaj_assign_sequence('myschema4','mytblp_col4_seq','myGroup4','Add partition 3_seq');
 emaj_assign_sequence 
----------------------
                    1
(1 row)

reset role;
insert into mySchema4.myTblP values (11, 'A', 'Stored in partition 3');
-- remove obsolete partitions ; in passing also remove the sequence linked to the serial column of the mother table
set role emaj_regression_tests_adm_user1;
select emaj_remove_tables('myschema4', ARRAY['mypartp1a', 'mypartp1b'], 'Remove partition 1a & 1b');
 emaj_remove_tables 
--------------------
                  2
(1 row)

select emaj_remove_sequence('myschema4','mytblp_col4_seq','Remove partition 1_seq');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

reset role;
drop table mySchema4.myPartP1a, mySchema4.myPartP1b cascade;
NOTICE:  drop cascades to constraint mytblr2_col2_col3_fkey on table myschema4.mytblr2
set role emaj_regression_tests_adm_user2;
-- verify that emaj_adm has the proper grants to delete old marks leading to an old log table drop
begin transaction;
  select emaj_delete_before_mark_group('myGroup4','EMAJ_LAST_MARK');
 emaj_delete_before_mark_group 
-------------------------------
                             5
(1 row)

rollback;
-- look at statistics and log content
select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj_log_stat_group('myGroup4','Start', NULL) order by 1,2,3,4;
 stat_group | stat_schema | stat_table | stat_first_mark |      stat_last_mark      | stat_rows 
------------+-------------+------------+-----------------+--------------------------+-----------
 myGroup4   | myschema4   | mypartp1a  | Start           | Remove partition 1a & 1b |         1
 myGroup4   | myschema4   | mypartp1b  | Start           | Remove partition 1a & 1b |         2
 myGroup4   | myschema4   | mypartp2   | Start           |                          |         4
 myGroup4   | myschema4   | mypartp3   | Add partition 3 |                          |         1
 myGroup4   | myschema4   | mytblc1    | Start           |                          |         0
 myGroup4   | myschema4   | mytblc2    | Start           |                          |         0
 myGroup4   | myschema4   | mytblm     | Start           |                          |         0
 myGroup4   | myschema4   | mytblr1    | Start           |                          |         6
 myGroup4   | myschema4   | mytblr2    | Start           |                          |         0
(9 rows)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table,
       rel_emaj_verb_attnum, rel_has_always_ident_col, rel_log_seq_last_value
  from emaj.emaj_relation where rel_schema = 'myschema4' and rel_tblseq like 'mypar%' order by rel_tblseq, rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema |  rel_log_table  | rel_emaj_verb_attnum | rel_has_always_ident_col | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+-----------------+----------------------+--------------------------+------------------------
 myschema4  | mypartp1a  | [17101,17204)  | myGroup4  | r        | emaj_myschema4 | mypartp1a_log_1 |                    5 | f                        |                      1
 myschema4  | mypartp1b  | [17101,17204)  | myGroup4  | r        | emaj_myschema4 | mypartp1b_log_1 |                    5 | f                        |                      2
 myschema4  | mypartp2   | [17101,)       | myGroup4  | r        | emaj_myschema4 | mypartp2_log    |                    5 | f                        |                       
 myschema4  | mypartp3   | [17202,)       | myGroup4  | r        | emaj_myschema4 | mypartp3_log    |                    5 | f                        |                       
(4 rows)

reset role;
select col1, col2, col3, col4, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartP3_log order by emaj_gid;
 col1 | col2 |         col3          | col4 | emaj_verb | emaj_tuple | emaj_gid 
------+------+-----------------------+------+-----------+------------+----------
   11 | A    | Stored in partition 3 |   11 | INS       | NEW        | 17200014
(1 row)

select col1, col2, col3, col4, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartP1a_log_1 order by emaj_gid;
 col1 | col2 |          col3          | col4 | emaj_verb | emaj_tuple | emaj_gid 
------+------+------------------------+------+-----------+------------+----------
   -2 | A    | Stored in partition 1A |    6 | INS       | NEW        | 17200007
(1 row)

-- rollback to a mark set before the first changes
set role emaj_regression_tests_adm_user2;
select * from emaj_rollback_group('myGroup4','Start');
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function _rlbk_check(text[],text,boolean,boolean) line 59 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function _rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function _rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj_rollback_group('myGroup4','Start',true);
 rlbk_severity |                                             regexp_replace                                              
---------------+---------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 17200.
 Notice        | 3 / 7 tables effectively processed.
 Warning       | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mypartp1a has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema4.mypartp1b has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The sequence myschema4.mytblp_col4_seq has been left unchanged (not in group anymore since <timestamp>)
(6 rows)

select emaj_stop_group('myGroup4');
 emaj_stop_group 
-----------------
               7
(1 row)

select emaj_drop_group('myGroup4');
 emaj_drop_group 
-----------------
               7
(1 row)

-----------------------------
-- Checking step 17
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17200 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17200 |           17200000 | S
   17201 |           17200011 | M
   17202 |           17200013 | A
   17203 |           17200013 | A
   17204 |           17200014 | A
   17205 |           17200014 | A
   17206 |           17200014 | R
   17207 |           17200014 | X
   17208 |           17200014 | D
(9 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17200 order by hist_id;
   hist_function    |     hist_event     |        hist_object        |                                             regexp_replace                                              | hist_user 
--------------------+--------------------+---------------------------+---------------------------------------------------------------------------------------------------------+-----------
 START_GROUP        | BEGIN              | myGroup4                  | With log reset                                                                                          | postgres
 START_GROUP        | TIME STAMP SET     | 17200                     |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 8 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Start                                                                                                   | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Start                                                                                                   | postgres
 START_GROUP        | END                | myGroup4                  | 8 tables/sequences processed                                                                            | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 8 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | TIME STAMP SET     | 17201                     |                                                                                                         | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | M1                                                                                                      | postgres
 ASSIGN_TABLE       | BEGIN              |                           |                                                                                                         | postgres
 ASSIGN_TABLE       | TIME STAMP SET     | 17202                     |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 8 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Add partition 3                                                                                         | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Add partition 3                                                                                         | postgres
 ASSIGN_TABLE       | TABLE ADDED        | myschema4.mypartp3        | To the logging group myGroup4                                                                           | postgres
 ASSIGN_TABLE       | END                |                           | 1 tables assigned to the group myGroup4                                                                 | postgres
 ASSIGN_SEQUENCE    | BEGIN              |                           |                                                                                                         | postgres
 ASSIGN_SEQUENCE    | TIME STAMP SET     | 17203                     |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 9 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Add partition 3_seq                                                                                     | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Add partition 3_seq                                                                                     | postgres
 ASSIGN_SEQUENCE    | SEQUENCE ADDED     | myschema4.mytblp_col4_seq | To the logging group myGroup4                                                                           | postgres
 ASSIGN_SEQUENCE    | END                |                           | 1 sequences assigned to the group myGroup4                                                              | postgres
 REMOVE_TABLES      | BEGIN              |                           |                                                                                                         | postgres
 REMOVE_TABLES      | TIME STAMP SET     | 17204                     |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 9 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Remove partition 1a & 1b                                                                                | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Remove partition 1a & 1b                                                                                | postgres
 REMOVE_TABLES      | TABLE REMOVED      | myschema4.mypartp1a       | From the logging group myGroup4                                                                         | postgres
 REMOVE_TABLES      | TABLE REMOVED      | myschema4.mypartp1b       | From the logging group myGroup4                                                                         | postgres
 REMOVE_TABLES      | END                |                           | 2 tables removed from their groups                                                                      | postgres
 REMOVE_SEQUENCE    | BEGIN              |                           |                                                                                                         | postgres
 REMOVE_SEQUENCE    | TIME STAMP SET     | 17205                     |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 7 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Remove partition 1_seq                                                                                  | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Remove partition 1_seq                                                                                  | postgres
 REMOVE_SEQUENCE    | SEQUENCE REMOVED   | myschema4.mytblp_col4_seq | From the logging group myGroup4                                                                         | postgres
 REMOVE_SEQUENCE    | END                |                           | 1 sequences removed from their groups                                                                   | postgres
 ROLLBACK_GROUP     | BEGIN              | myGroup4                  | Unlogged rollback to mark Start (timestamp)                                                             | postgres
 DBLINK_OPEN_CNX    |                    | rlbk#1                    | Status = 1                                                                                              | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  | Rollback session #1                                                                                     | postgres
 LOCK_GROUP         | END                | myGroup4                  | Rollback session #1: 7 tables locked, 0 deadlock(s)                                                     | postgres
 ROLLBACK_GROUP     | TIME STAMP SET     | 17206                     |                                                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp2        | All log rows where emaj_gid > 17200000 and <= 17200014, in session_replication_role = replica mode      | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp2        | 3 rolled back primary keys                                                                              | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp3        | All log rows where emaj_gid > 17200013 and <= 17200014                                                  | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp3        | 1 rolled back primary keys                                                                              | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mytblr1         | All log rows where emaj_gid > 17200000 and <= 17200014                                                  | postgres
 ROLLBACK_TABLE     | END                | myschema4.mytblr1         | 6 rolled back primary keys                                                                              | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark M1 is deleted                                                                                      | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Add partition 3 is deleted                                                                         | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Add partition 3_seq is deleted                                                                     | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Remove partition 1a & 1b is deleted                                                                | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Remove partition 1_seq is deleted                                                                  | postgres
 ROLLBACK_GROUP     | NOTICE             | Rollback id 17200         | Rollback id = 17200.                                                                                    | postgres
 ROLLBACK_GROUP     | NOTICE             | Rollback id 17200         | 3 / 7 tables effectively processed.                                                                     | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)     | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The table myschema4.mypartp1a has been left unchanged (not in group anymore since <timestamp>)          | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The table myschema4.mypartp1b has been left unchanged (not in group anymore since <timestamp>)          | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The sequence myschema4.mytblp_col4_seq has been left unchanged (not in group anymore since <timestamp>) | postgres
 DBLINK_CLOSE_CNX   |                    | rlbk#1                    |                                                                                                         | postgres
 ROLLBACK_GROUP     | END                | myGroup4                  | Rollback_id 17200                                                                                       | postgres
 STOP_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 STOP_GROUP         | TIME STAMP SET     | 17207                     |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 7 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | STOP_%                                                                                                  | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 17200         | set to COMMITTED                                                                                        | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | STOP_%                                                                                                  | postgres
 STOP_GROUP         | END                | myGroup4                  | 7 tables/sequences processed                                                                            | postgres
 DROP_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 DROP_GROUP         | TIME STAMP SET     | 17208                     |                                                                                                         | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED | emaj_myschema4            |                                                                                                         | postgres
 DROP_GROUP         | END                | myGroup4                  | 7 tables/sequences processed                                                                            | postgres
(81 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17400);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- Step 18 : test defect with application table or sequence
--           also test some changes on the unlogged and the with oids tables
-----------------------------
select emaj_create_group('phil''s group#3",',false);
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj_assign_tables('phil''s schema"3','.*',null,'phil''s group#3",');
NOTICE:  table "my"tbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  table "myTbl2\_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.myTbl2\" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.myTbl2\" does not exist, skipping
NOTICE:  table "phil's tbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.phil's tbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.phil's tbl1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  3
(1 row)

select emaj_assign_sequences('phil''s schema"3','.*',null,'phil''s group#3",');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

select emaj_assign_tables('myschema5','.*',null,'phil''s group#3",');
NOTICE:  table "myunloggedtbl_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema5.myunloggedtbl" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema5.myunloggedtbl" does not exist, skipping
 emaj_assign_tables 
--------------------
                  1
(1 row)

select emaj_start_group('phil''s group#3",','start');
 emaj_start_group 
------------------
                6
(1 row)

-----------------------------
-- test changes on the unlogged table
-----------------------------
reset role;
insert into myschema5.myUnloggedTbl values (10),(11),(12);
update myschema5.myUnloggedTbl set col1 = 13 where col1 = 12;
delete from myschema5.myUnloggedTbl where col1 = 10;
set role emaj_regression_tests_adm_user2;
select col1, emaj_verb, emaj_tuple, emaj_gid, emaj_user from emaj_myschema5.myUnloggedTbl_log order by emaj_gid;
 col1 | emaj_verb | emaj_tuple | emaj_gid | emaj_user 
------+-----------+------------+----------+-----------
   10 | INS       | NEW        | 17400001 | postgres
   11 | INS       | NEW        | 17400002 | postgres
   12 | INS       | NEW        | 17400003 | postgres
   12 | UPD       | OLD        | 17400004 | postgres
   13 | UPD       | NEW        | 17400004 | postgres
   10 | DEL       | OLD        | 17400005 | postgres
(6 rows)

-- disable event triggers for this step and change an application table structure
select emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

-----------------------------
-- test remove_and_add operations to repair an application table
-----------------------------
reset role;
alter table "phil's schema""3"."my""tbl4" alter column col45 type char(11);
set role emaj_regression_tests_adm_user1;
select * from emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                                           msg                                                                                            
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Error: In tables group "phil's group#3",", the structure of the application table "phil's schema"3"."my"tbl4" is not coherent with its log table ("emaj_phil's schema"3"."my"tbl4_log").
 Warning: Some E-Maj event triggers are disabled. You may enable them using the emaj_enable_protection_by_event_triggers() function.
(2 rows)

select emaj_remove_table('phil''s schema"3','my"tbl4','remove_the_damaged_table');
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj_assign_table('phil''s schema"3', 'my"tbl4', 'phil''s group#3",', null, 're_add_the_table');
NOTICE:  table "my"tbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select * from emaj.emaj_relation where rel_schema = 'phil''s schema"3' and rel_tblseq = 'my"tbl4' order by rel_time_range;
   rel_schema    | rel_tblseq | rel_time_range |    rel_group     | rel_kind | rel_priority |    rel_log_schema    | rel_log_table | rel_log_dat_tsp |   rel_log_index   | rel_log_idx_tsp | rel_log_sequence | rel_log_function | rel_ignored_triggers | rel_pk_cols | rel_gen_expr_cols | rel_emaj_verb_attnum | rel_has_always_ident_col |               rel_sql_rlbk_columns                | rel_sql_gen_ins_col |                                                                                        rel_sql_gen_ins_val                                                                                         |                                                                                                              rel_sql_gen_upd_set                                                                                                              | rel_sql_gen_pk_conditions | rel_log_seq_last_value 
-----------------+------------+----------------+------------------+----------+--------------+----------------------+---------------+-----------------+-------------------+-----------------+------------------+------------------+----------------------+-------------+-------------------+----------------------+--------------------------+---------------------------------------------------+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------------------
 phil's schema"3 | my"tbl4    | [17401,17405)  | phil's group#3", | r        |              | emaj_phil's schema"3 | my"tbl4_log_1 |                 | my"tbl4_log_idx_1 |                 | my"tbl4_log_seq  |                  |                      | {col41}     |                   |                    6 | f                        |                                                   |                     | ' || coalesce(o.col41::TEXT,'NULL') || ', ' || quote_nullable(o.col42) || ', ' || coalesce(o.col43::TEXT,'NULL') || ', ' || coalesce(o.col44::TEXT,'NULL') || ', ' || quote_nullable(o.col45) || ' | col41 = ' || coalesce(n.col41 ::TEXT,'NULL') || ', col42 = ' || quote_nullable(n.col42) || ', col43 = ' || coalesce(n.col43 ::TEXT,'NULL') || ', col44 = ' || coalesce(n.col44 ::TEXT,'NULL') || ', col45 = ' || quote_nullable(n.col45) || ' | col41 = ' || o.col41 || ' |                      0
 phil's schema"3 | my"tbl4    | [17406,)       | phil's group#3", | r        |              | emaj_phil's schema"3 | my"tbl4_log   |                 | my"tbl4_log_idx   |                 | my"tbl4_log_seq  | my"tbl4_log_fnct |                      | {col41}     |                   |                    6 | f                        | tbl.col41,tbl.col42,tbl.col43,tbl.col44,tbl.col45 |                     | ' || coalesce(o.col41::TEXT,'NULL') || ', ' || quote_nullable(o.col42) || ', ' || coalesce(o.col43::TEXT,'NULL') || ', ' || coalesce(o.col44::TEXT,'NULL') || ', ' || quote_nullable(o.col45) || ' | col41 = ' || coalesce(n.col41 ::TEXT,'NULL') || ', col42 = ' || quote_nullable(n.col42) || ', col43 = ' || coalesce(n.col43 ::TEXT,'NULL') || ', col44 = ' || coalesce(n.col44 ::TEXT,'NULL') || ', col45 = ' || quote_nullable(n.col45) || ' | col41 = ' || o.col41 || ' |                       
(2 rows)

-----------------------------
-- test a remove operation to fix the case of a dropped log table, log sequence or log function
-----------------------------
reset role;
drop table "emaj_phil's schema""3"."my""tbl4_log";
set role emaj_regression_tests_adm_user1;
select * from emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                 msg                                                                 
-------------------------------------------------------------------------------------------------------------------------------------
 Error: In tables group "phil's group#3",", the log table "emaj_phil's schema"3"."my"tbl4_log" is not found.
 Warning: Some E-Maj event triggers are disabled. You may enable them using the emaj_enable_protection_by_event_triggers() function.
(2 rows)

select emaj_remove_table('phil''s schema"3','my"tbl4','remove_the_damaged_table_2');
NOTICE:  relation "my"tbl4_log" does not exist, skipping
NOTICE:  relation "my"tbl4_log_idx" does not exist, skipping
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj_assign_table('phil''s schema"3', 'my"tbl4', 'phil''s group#3",', null, 're_add_the_table_2');
NOTICE:  table "my"tbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
  from emaj.emaj_relation where rel_schema = 'phil''s schema"3' and rel_tblseq = 'my"tbl4' order by rel_time_range;
   rel_schema    | rel_tblseq | rel_time_range |    rel_group     | rel_kind 
-----------------+------------+----------------+------------------+----------
 phil's schema"3 | my"tbl4    | [17401,17405)  | phil's group#3", | r
 phil's schema"3 | my"tbl4    | [17406,17407)  | phil's group#3", | r
 phil's schema"3 | my"tbl4    | [17408,)       | phil's group#3", | r
(3 rows)

-----------------------------
-- test a remove operation to fix the case of a dropped application table or sequence
-----------------------------
-- in fact just rename the table and the sequence
reset role;
alter table "phil's schema""3"."my""tbl4" rename to mytbl4_sav;
alter sequence "phil's schema""3"."phil's""seq\1" rename to "phil's""seq\1_sav";
set role emaj_regression_tests_adm_user2;
-- try to set a mark
begin;
  select emaj_set_mark_group('phil''s group#3",','should fails');
ERROR:  _verify_groups (1): In group "phil's group#3",", the table "phil's schema"3"."my"tbl4" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 39 at RAISE
SQL statement "SELECT 0
      FROM emaj._verify_groups(array[p_groupName], TRUE)"
PL/pgSQL function emaj_set_mark_group(text,text,text) line 18 at PERFORM
rollback;
select emaj_remove_table('phil''s schema"3','my"tbl4','remove_the_dropped_table');
WARNING:  _check_tblseqs_array: In schema "phil's schema"3", some tables ("my""tbl4") do not exist.
NOTICE:  drop cascades to trigger emaj_log_trg on table "phil's schema""3".mytbl4_sav
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj_remove_sequence('phil''s schema"3','phil''s"seq\1','remove_the_dropped_seq');
WARNING:  _check_tblseqs_array: In schema "phil's schema"3", some sequences ("phil's""seq\1") do not exist.
 emaj_remove_sequence 
----------------------
                    1
(1 row)

-- check that the log table does not exist anymore
select count(*) from "emaj_phil's schema3"."my""tbl4_log";
ERROR:  relation "emaj_phil's schema3.my"tbl4_log" does not exist
LINE 1: select count(*) from "emaj_phil's schema3"."my""tbl4_log";
                             ^
-- revert the changes
reset role;
alter table "phil's schema""3".mytbl4_sav rename to "my""tbl4";
alter table "phil's schema""3"."my""tbl4" alter column col45 type char(10);
alter sequence "phil's schema""3"."phil's""seq\1_sav" rename to "phil's""seq\1";
set role emaj_regression_tests_adm_user1;
select emaj_assign_table('phil''s schema"3','my"tbl4','phil''s group#3",',null,'revert_last_changes_tbl');
NOTICE:  table "my"tbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select emaj_assign_sequence('phil''s schema"3','phil''s"seq\1','phil''s group#3",','revert_last_changes_seq');
 emaj_assign_sequence 
----------------------
                    1
(1 row)

-- ree-nable the event triggers and drop the group
select emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

select emaj_stop_group('phil''s group#3",');
 emaj_stop_group 
-----------------
               6
(1 row)

select emaj_drop_group('phil''s group#3",');
NOTICE:  table "my"tbl4_log_2" does not exist, skipping
 emaj_drop_group 
-----------------
               6
(1 row)

-----------------------------
-- Checking step 18
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17400 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17400 |           17400000 | C
   17401 |           17400000 | A
   17402 |           17400000 | A
   17403 |           17400000 | A
   17404 |           17400000 | S
   17405 |           17400005 | A
   17406 |           17400005 | A
   17407 |           17400005 | A
   17408 |           17400005 | A
   17409 |           17400005 | A
   17410 |           17400005 | A
   17411 |           17400005 | A
   17412 |           17400005 | A
   17413 |           17400005 | X
   17414 |           17400005 | D
(15 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17400 order by hist_id;
   hist_function    |       hist_event        |              hist_object               |                         regexp_replace                         | hist_user 
--------------------+-------------------------+----------------------------------------+----------------------------------------------------------------+-----------
 CREATE_GROUP       | BEGIN                   | phil's group#3",                       | audit_only                                                     | postgres
 CREATE_GROUP       | TIME STAMP SET          | 17400                                  |                                                                | postgres
 CREATE_GROUP       | END                     | phil's group#3",                       |                                                                | postgres
 ASSIGN_TABLES      | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_TABLES      | TIME STAMP SET          | 17401                                  |                                                                | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED      | "emaj_phil's schema""3"                |                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED             | "phil's schema""3"."my""tbl4"          | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | TABLE ADDED             | "phil's schema""3"."myTbl2\"           | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | TABLE ADDED             | "phil's schema""3"."phil's tbl1"       | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | END                     |                                        | 3 tables assigned to the group phil's group#3",                | postgres
 ASSIGN_SEQUENCES   | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_SEQUENCES   | TIME STAMP SET          | 17402                                  |                                                                | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED          | "phil's schema""3"."myTbl2\_col21_seq" | To the idle group phil's group#3",                             | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED          | "phil's schema""3"."phil's""seq\1"     | To the idle group phil's group#3",                             | postgres
 ASSIGN_SEQUENCES   | END                     |                                        | 2 sequences assigned to the group phil's group#3",             | postgres
 ASSIGN_TABLES      | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_TABLES      | TIME STAMP SET          | 17403                                  |                                                                | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED      | emaj_myschema5                         |                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED             | myschema5.myunloggedtbl                | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | END                     |                                        | 1 tables assigned to the group phil's group#3",                | postgres
 START_GROUP        | BEGIN                   | phil's group#3",                       | With log reset                                                 | postgres
 START_GROUP        | TIME STAMP SET          | 17404                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | start                                                          | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | start                                                          | postgres
 START_GROUP        | END                     | phil's group#3",                       | 6 tables/sequences processed                                   | postgres
 DISABLE_PROTECTION | EVENT TRIGGERS DISABLED |                                        | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg | postgres
 REMOVE_TABLE       | BEGIN                   |                                        |                                                                | postgres
 REMOVE_TABLE       | TIME STAMP SET          | 17405                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | remove_the_damaged_table                                       | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | remove_the_damaged_table                                       | postgres
 REMOVE_TABLE       | TABLE REMOVED           | "phil's schema""3"."my""tbl4"          | From the logging group phil's group#3",                        | postgres
 REMOVE_TABLE       | END                     |                                        | 1 tables removed from their groups                             | postgres
 ASSIGN_TABLE       | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_TABLE       | TIME STAMP SET          | 17406                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 3 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | re_add_the_table                                               | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | re_add_the_table                                               | postgres
 ASSIGN_TABLE       | TABLE ADDED             | "phil's schema""3"."my""tbl4"          | To the logging group phil's group#3",                          | postgres
 ASSIGN_TABLE       | END                     |                                        | 1 tables assigned to the group phil's group#3",                | postgres
 REMOVE_TABLE       | BEGIN                   |                                        |                                                                | postgres
 REMOVE_TABLE       | TIME STAMP SET          | 17407                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | remove_the_damaged_table_2                                     | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | remove_the_damaged_table_2                                     | postgres
 REMOVE_TABLE       | TABLE REMOVED           | "phil's schema""3"."my""tbl4"          | From the logging group phil's group#3",                        | postgres
 REMOVE_TABLE       | END                     |                                        | 1 tables removed from their groups                             | postgres
 ASSIGN_TABLE       | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_TABLE       | TIME STAMP SET          | 17408                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 3 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | re_add_the_table_2                                             | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | re_add_the_table_2                                             | postgres
 ASSIGN_TABLE       | TABLE ADDED             | "phil's schema""3"."my""tbl4"          | To the logging group phil's group#3",                          | postgres
 ASSIGN_TABLE       | END                     |                                        | 1 tables assigned to the group phil's group#3",                | postgres
 REMOVE_TABLE       | BEGIN                   |                                        |                                                                | postgres
 REMOVE_TABLE       | TIME STAMP SET          | 17409                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 3 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | remove_the_dropped_table                                       | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | remove_the_dropped_table                                       | postgres
 REMOVE_TABLE       | TABLE REMOVED           | "phil's schema""3"."my""tbl4"          | From the logging group phil's group#3",                        | postgres
 REMOVE_TABLE       | END                     |                                        | 1 tables removed from their groups                             | postgres
 REMOVE_SEQUENCE    | BEGIN                   |                                        |                                                                | postgres
 REMOVE_SEQUENCE    | TIME STAMP SET          | 17410                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 3 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | remove_the_dropped_seq                                         | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | remove_the_dropped_seq                                         | postgres
 REMOVE_SEQUENCE    | SEQUENCE REMOVED        | "phil's schema""3"."phil's""seq\1"     | From the logging group phil's group#3",                        | postgres
 REMOVE_SEQUENCE    | END                     |                                        | 1 sequences removed from their groups                          | postgres
 ASSIGN_TABLE       | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_TABLE       | TIME STAMP SET          | 17411                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 3 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | revert_last_changes_tbl                                        | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | revert_last_changes_tbl                                        | postgres
 ASSIGN_TABLE       | TABLE ADDED             | "phil's schema""3"."my""tbl4"          | To the logging group phil's group#3",                          | postgres
 ASSIGN_TABLE       | END                     |                                        | 1 tables assigned to the group phil's group#3",                | postgres
 ASSIGN_SEQUENCE    | BEGIN                   |                                        |                                                                | postgres
 ASSIGN_SEQUENCE    | TIME STAMP SET          | 17412                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | revert_last_changes_seq                                        | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | revert_last_changes_seq                                        | postgres
 ASSIGN_SEQUENCE    | SEQUENCE ADDED          | "phil's schema""3"."phil's""seq\1"     | To the logging group phil's group#3",                          | postgres
 ASSIGN_SEQUENCE    | END                     |                                        | 1 sequences assigned to the group phil's group#3",             | postgres
 ENABLE_PROTECTION  | EVENT TRIGGERS ENABLED  |                                        | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg | postgres
 STOP_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 STOP_GROUP         | TIME STAMP SET          | 17413                                  |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                       | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                       | STOP_%                                                         | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                       | STOP_%                                                         | postgres
 STOP_GROUP         | END                     | phil's group#3",                       | 6 tables/sequences processed                                   | postgres
 DROP_GROUP         | BEGIN                   | phil's group#3",                       |                                                                | postgres
 DROP_GROUP         | TIME STAMP SET          | 17414                                  |                                                                | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED      | emaj_myschema5                         |                                                                | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED      | "emaj_phil's schema""3"                |                                                                | postgres
 DROP_GROUP         | END                     | phil's group#3",                       | 6 tables/sequences processed                                   | postgres
(105 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17600);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- Step 19 : test use of dynamic tables group management (assign, move, remove, change)
-----------------------------
-- create, start and populate groups
-- grp_tmp is empty, grp_tmp_3 and grp_tmp_4 contains tables and sequences frop respectively phil''s schema3 and myschema4
-- grp_tmp_4 is started before being populated
select emaj_create_group('grp_tmp');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj_create_group('grp_tmp_3');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj_create_group('grp_tmp_4');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj_start_groups('{"grp_tmp","grp_tmp_4"}','Start');
 emaj_start_groups 
-------------------
                 0
(1 row)

begin;
  select emaj_assign_tables('phil''s schema"3','.*','','grp_tmp_3');
NOTICE:  table "my"tbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  table "myTbl2\_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.myTbl2\" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.myTbl2\" does not exist, skipping
NOTICE:  table "phil's tbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.phil's tbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.phil's tbl1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  3
(1 row)

  select emaj_assign_sequences('phil''s schema"3','.*','','grp_tmp_3');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

  select emaj_assign_tables('myschema4','.*','','grp_tmp_4');
WARNING:  _assign_tables: Some partitionned tables (mypartp1, mytblp) are not selected.
NOTICE:  table "mytblr2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblr2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblr2" does not exist, skipping
NOTICE:  table "mypartp3_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp3" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp3" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mypartp3" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblr1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblr1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblr1" does not exist, skipping
NOTICE:  table "mytblm_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblm" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblm" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mytblm" has triggers that will be automatically disabled during E-Maj rollback operations (mytblm_insert_trigger). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblc2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  table "mypartp2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp2" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mypartp2" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblc1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  7
(1 row)

  select emaj_assign_sequences('myschema4','.*','','grp_tmp_4');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

  select emaj_modify_table('myschema4','mytblm','{"ignored_triggers": "mytblm_insert_trigger"}'::jsonb);
 emaj_modify_table 
-------------------
                 1
(1 row)

commit;
select emaj_start_group('grp_tmp_3','Start');
 emaj_start_group 
------------------
                5
(1 row)

select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

-- export the initial groups configuration
select emaj_export_groups_configuration(:'EMAJTESTTMPDIR' || '/groups_config.json', array['grp_tmp','grp_tmp_3','grp_tmp_4']);
 emaj_export_groups_configuration 
----------------------------------
                                3
(1 row)

-- perform some changes and set marks
reset role;
insert into "phil's schema""3"."my""tbl4" (col41)
  select i from generate_series(3,8) i;
delete from "phil's schema""3"."myTbl2\";
insert into "phil's schema""3"."myTbl2\" (col22,col23)
  select 'After Mk1','12-31-2020' from generate_series(1,3);
set role emaj_regression_tests_adm_user1;
select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk2');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

reset role;
insert into "phil's schema""3"."myTbl2\" (col22,col23)
  select 'After Mk2','12-31-2030' from generate_series(1,3);
select nextval(E'"phil''s schema""3"."phil''s""seq\\1"');
 nextval 
---------
    1002
(1 row)

insert into myschema4.mytblm
  select '2006-06-30'::date + ('1 year'::interval) * i, i, 'After Mk2'
    from generate_series(0,9) i;
set role emaj_regression_tests_adm_user1;
select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

reset role;
delete from myschema4.mytblm
  where col1 = '2006-06-30';
update myschema4.mytblm set col3 = 'After Mk2 and updated after Mk3'
  where col1 > '2013-01-01';
-- rollback to the previous mark
set role emaj_regression_tests_adm_user1;
select * from emaj_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 17600.
 Notice        | 2 / 10 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

-- change some priority and log tablespaces
select emaj_modify_tables('phil''s schema"3','.*tbl1','','{"priority":-1,"log_data_tablespace":"tsp log''2"}'::jsonb,'Modify 1 table');
 emaj_modify_tables 
--------------------
                  1
(1 row)

-- move all tables and sequences into grp_tmp and set a common mark
select emaj_move_tables('phil''s schema"3','.*','','grp_tmp','Move_tbl_3_to_tmp');
 emaj_move_tables 
------------------
                3
(1 row)

select * from emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                                                  msg                                                                                                  
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Warning: In tables group "grp_tmp_4", the sequence "myschema4"."mytblp_col4_seq" is linked to the table "myschema4"."mytblp" but this table does not belong to any tables group.
 Warning: In tables group "grp_tmp_3", the sequence "phil's schema"3"."myTbl2\_col21_seq" is linked to the table "phil's schema"3"."myTbl2\" but this table belongs to another tables group (grp_tmp).
 No error detected
(3 rows)

select emaj_move_sequences('phil''s schema"3','.*','','grp_tmp','Move_seq_3_to_tmp');
 emaj_move_sequences 
---------------------
                   2
(1 row)

select emaj_move_tables('myschema4','.*','','grp_tmp','Move_tbl_4_to_tmp');
 emaj_move_tables 
------------------
                7
(1 row)

select emaj_move_sequences('myschema4','.*','','grp_tmp','Move_seq_4_to_tmp');
 emaj_move_sequences 
---------------------
                   2
(1 row)

select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk4');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

-- perform some other changes and set marks
reset role;
update "phil's schema""3"."my""tbl4" set col42 = 'Updated after Mk4'
  where col41 > 5;
delete from "phil's schema""3"."myTbl2\"
  where col21 = 4;
delete from "phil's schema""3"."my""tbl4"
  where col41 = 4;
set role emaj_regression_tests_adm_user1;
select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk5');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

reset role;
insert into myschema4.mytblm
  select '2017-06-30'::date + ('1 year'::interval) * i, 5, 'After Mk5'
    from generate_series(0,3) i;
select nextval(E'"phil''s schema""3"."phil''s""seq\\1"');
 nextval 
---------
    1003
(1 row)

set role emaj_regression_tests_adm_user1;
select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk6');
 emaj_set_mark_groups 
----------------------
                   14
(1 row)

reset role;
update myschema4.mytblm set col3 = 'After Mk5 and updated after Mk6'
  where col1 > '2017-01-01';
-- remove the table mytblm and the sequence phil's seq\1
set role emaj_regression_tests_adm_user1;
select emaj_remove_table('myschema4','mytblc1','Remove_mytblc1');
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj_remove_sequence('phil''s schema"3','phil''s"seq\1','Remove_myseq1');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

-- logged rollback to Mk5
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj_logged_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk5', true);
 rlbk_severity |                                                  regexp_replace                                                  
---------------+------------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 17601.
 Notice        | 2 / 9 tables effectively processed.
 Notice        | 0 / 3 sequences effectively processed.
 Warning       | The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The sequence "phil's schema""3"."phil's""seq\1" has been left unchanged (not in group anymore since <timestamp>)
(5 rows)

select emaj_rename_mark_group(group_name,'EMAJ_LAST_MARK','End_logged_rollback')
  from (values ('grp_tmp_3'),('grp_tmp_4'),('grp_tmp')) as t(group_name);
 emaj_rename_mark_group 
------------------------
 
 
 
(3 rows)

-- perform some other changes and set marks
reset role;
delete from myschema4.mytblm
  where col1 = '2018-06-30';
set role emaj_regression_tests_adm_user1;
select emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk7');
 emaj_set_mark_groups 
----------------------
                   12
(1 row)

reset role;
delete from mySchema4.mytblm;
-- consolidate the logged rollback
set role emaj_regression_tests_adm_user1;
select * from emaj_get_consolidable_rollbacks() order by 1,2;
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 grp_tmp    | Mk5                        |                         17620 | End_logged_rollback     |                      17625 |        12 |          4
 grp_tmp_3  | Mk5                        |                         17620 | End_logged_rollback     |                      17625 |         0 |          2
 grp_tmp_4  | Mk5                        |                         17620 | End_logged_rollback     |                      17625 |         0 |          2
(3 rows)

select emaj_consolidate_rollback_group('grp_tmp','End_logged_rollback');
 emaj_consolidate_rollback_group 
---------------------------------
                               5
(1 row)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj_log_stat_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1',null)
  order by stat_first_mark_datetime, stat_schema, stat_table;
 stat_group |   stat_schema   | stat_table  |  stat_first_mark  |  stat_last_mark   | stat_rows 
------------+-----------------+-------------+-------------------+-------------------+-----------
 grp_tmp_4  | myschema4       | mypartp2    | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4       | mypartp3    | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4       | mytblc1     | Mk1               | Move_tbl_4_to_tmp |         4
 grp_tmp_4  | myschema4       | mytblc2     | Mk1               | Move_tbl_4_to_tmp |         6
 grp_tmp_4  | myschema4       | mytblm      | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4       | mytblr1     | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4       | mytblr2     | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_3  | phil's schema"3 | my"tbl4     | Mk1               | Move_tbl_3_to_tmp |         6
 grp_tmp_3  | phil's schema"3 | myTbl2\     | Mk1               | Move_tbl_3_to_tmp |         8
 grp_tmp_3  | phil's schema"3 | phil's tbl1 | Mk1               | Move_tbl_3_to_tmp |         0
 grp_tmp    | phil's schema"3 | my"tbl4     | Move_tbl_3_to_tmp |                   |         4
 grp_tmp    | phil's schema"3 | myTbl2\     | Move_tbl_3_to_tmp |                   |         1
 grp_tmp    | phil's schema"3 | phil's tbl1 | Move_tbl_3_to_tmp |                   |         0
 grp_tmp    | myschema4       | mypartp2    | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4       | mypartp3    | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4       | mytblc1     | Move_tbl_4_to_tmp | [deleted mark]    |         0
 grp_tmp    | myschema4       | mytblc2     | Move_tbl_4_to_tmp |                   |         6
 grp_tmp    | myschema4       | mytblm      | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4       | mytblr1     | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4       | mytblr2     | Move_tbl_4_to_tmp |                   |         0
(20 rows)

select mark_time_id, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_group,
       mark_log_rows_before_next
  from emaj.emaj_mark where mark_group in ('grp_tmp_3','grp_tmp_4','grp_tmp')
  order by 1,2,3;
 mark_time_id |   regexp_replace    | mark_group | mark_log_rows_before_next 
--------------+---------------------+------------+---------------------------
        17603 | Start               | grp_tmp    |                         0
        17603 | Start               | grp_tmp_4  |                         0
        17606 | ASSIGN_%            | grp_tmp_4  |                         0
        17607 | ASSIGN_%            | grp_tmp_4  |                         0
        17608 | MODIFY_%            | grp_tmp_4  |                         0
        17609 | Start               | grp_tmp_3  |                         0
        17610 | Mk1                 | grp_tmp    |                         0
        17610 | Mk1                 | grp_tmp_3  |                        11
        17610 | Mk1                 | grp_tmp_4  |                         0
        17611 | Mk2                 | grp_tmp    |                         0
        17611 | Mk2                 | grp_tmp_3  |                         3
        17611 | Mk2                 | grp_tmp_4  |                        10
        17612 | Mk3                 | grp_tmp    |                         0
        17612 | Mk3                 | grp_tmp_3  |                         0
        17612 | Mk3                 | grp_tmp_4  |                         0
        17614 | Modify 1 table      | grp_tmp_3  |                         0
        17615 | Move_tbl_3_to_tmp   | grp_tmp    |                         0
        17615 | Move_tbl_3_to_tmp   | grp_tmp_3  |                         0
        17616 | Move_seq_3_to_tmp   | grp_tmp    |                         0
        17616 | Move_seq_3_to_tmp   | grp_tmp_3  |                         0
        17617 | Move_tbl_4_to_tmp   | grp_tmp    |                         0
        17617 | Move_tbl_4_to_tmp   | grp_tmp_4  |                         0
        17618 | Move_seq_4_to_tmp   | grp_tmp    |                         0
        17618 | Move_seq_4_to_tmp   | grp_tmp_4  |                         0
        17619 | Mk4                 | grp_tmp    |                         5
        17619 | Mk4                 | grp_tmp_3  |                         0
        17619 | Mk4                 | grp_tmp_4  |                         0
        17620 | Mk5                 | grp_tmp    |                         0
        17620 | Mk5                 | grp_tmp_3  |                         0
        17620 | Mk5                 | grp_tmp_4  |                         0
        17621 | Mk6                 | grp_tmp_3  |                         0
        17621 | Mk6                 | grp_tmp_4  |                         0
        17624 | RLBK_17601_START    | grp_tmp_3  |                         0
        17624 | RLBK_17601_START    | grp_tmp_4  |                         0
        17625 | End_logged_rollback | grp_tmp    |                         0
        17625 | End_logged_rollback | grp_tmp_3  |                         0
        17625 | End_logged_rollback | grp_tmp_4  |                         0
        17626 | Mk7                 | grp_tmp    |                          
        17626 | Mk7                 | grp_tmp_3  |                          
        17626 | Mk7                 | grp_tmp_4  |                          
(40 rows)

-- generate sql script
select emaj_gen_sql_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1',null,:'EMAJTESTTMPDIR' || '/allGroups.sql');
NOTICE:  table "emaj_temp_script" does not exist, skipping
 emaj_gen_sql_groups 
---------------------
                  26
(1 row)

--  \! grep -iP '(insert|update|delete|alter)' $EMAJTESTTMPDIR/allGroups.sql
-- revert the priority and log tablespaces changes
select emaj_modify_tables('phil''s schema"3','.*tbl1','','{"priority":null,"log_data_tablespace":null}'::jsonb,'revert changes for 1 table');
 emaj_modify_tables 
--------------------
                  1
(1 row)

-- rollback to a mark set before the tables and sequences move
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3', false);
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function _rlbk_check(text[],text,boolean,boolean) line 59 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function _rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function _rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3',true);
 rlbk_severity |                                                          regexp_replace                                                          
---------------+----------------------------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 17602.
 Notice        | 3 / 9 tables effectively processed.
 Notice        | 0 / 3 sequences effectively processed.
 Warning       | The table "phil's schema""3"."my""tbl4" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table "phil's schema""3"."myTbl2\" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table "phil's schema""3"."phil's tbl1" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The sequence "phil's schema""3"."myTbl2\_col21_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The table myschema4.mypartp2 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblc2 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblm has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblr1 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblr2 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The sequence myschema4.mytblp_col4_seq has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The sequence myschema4.mytblr2_col1_seq has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The sequence "phil's schema""3"."phil's""seq\1" has been left unchanged (not in group anymore since <timestamp>)
 Warning       | Tables group change not rolled back: log data tablespace for "phil's schema""3"."phil's tbl1"
 Warning       | Tables group change not rolled back: E-Maj priority for "phil's schema""3"."phil's tbl1"
(19 rows)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj_log_stat_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1',null)
  order by stat_first_mark_datetime, stat_schema, stat_table;
 stat_group |   stat_schema   | stat_table  | stat_first_mark | stat_last_mark | stat_rows 
------------+-----------------+-------------+-----------------+----------------+-----------
 grp_tmp_4  | myschema4       | mypartp2    | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4       | mypartp3    | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4       | mytblc1     | Mk1             | [deleted mark] |         4
 grp_tmp_4  | myschema4       | mytblc2     | Mk1             | [deleted mark] |         6
 grp_tmp_4  | myschema4       | mytblm      | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4       | mytblr1     | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4       | mytblr2     | Mk1             | [deleted mark] |         0
 grp_tmp_3  | phil's schema"3 | my"tbl4     | Mk1             | [deleted mark] |         6
 grp_tmp_3  | phil's schema"3 | myTbl2\     | Mk1             | [deleted mark] |         8
 grp_tmp_3  | phil's schema"3 | phil's tbl1 | Mk1             | [deleted mark] |         0
 grp_tmp    | phil's schema"3 | my"tbl4     | [deleted mark]  |                |         0
 grp_tmp    | phil's schema"3 | myTbl2\     | [deleted mark]  |                |         0
 grp_tmp    | phil's schema"3 | phil's tbl1 | [deleted mark]  |                |         0
 grp_tmp    | myschema4       | mypartp2    | [deleted mark]  |                |         0
 grp_tmp    | myschema4       | mypartp3    | [deleted mark]  |                |         0
 grp_tmp    | myschema4       | mytblc1     | [deleted mark]  | [deleted mark] |         0
 grp_tmp    | myschema4       | mytblc2     | [deleted mark]  |                |         0
 grp_tmp    | myschema4       | mytblm      | [deleted mark]  |                |         0
 grp_tmp    | myschema4       | mytblr1     | [deleted mark]  |                |         0
 grp_tmp    | myschema4       | mytblr2     | [deleted mark]  |                |         0
(20 rows)

-- delete all marks before Mk3
select emaj_delete_before_mark_group(group_name,'Mk3')
  from (values ('grp_tmp_3'),('grp_tmp_4'),('grp_tmp')) as t(group_name);
 emaj_delete_before_mark_group 
-------------------------------
                             3
                             6
                             3
(3 rows)

-- test a remove_table following log sequence deletion
reset role;
select emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

drop sequence "emaj_phil's schema""3"."my""tbl4_log_seq";
select emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

set role emaj_regression_tests_adm_user2;
-- note that the warning about the mytblp_col3_seq sequence is normal
select * from emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                                      msg                                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Error: In tables group "grp_tmp", the log sequence "emaj_phil's schema"3"."my"tbl4_log_seq" is not found.
 Warning: In tables group "grp_tmp", the sequence "myschema4"."mytblp_col4_seq" is linked to the table "myschema4"."mytblp" but this table does not belong to any tables group.
(2 rows)

--     a removal while the group is LOGGING fails
select emaj_remove_table('phil''s schema"3','my"tbl4');
ERROR:  relation "emaj_phil's schema"3.my"tbl4_log_seq" does not exist
CONTEXT:  SQL statement "SELECT pg_sequence_last_value((quote_ident(p_schema) || '.' || quote_ident(p_sequence))::regclass)"
PL/pgSQL function emaj._get_log_sequence_last_value(text,text) line 12 at SQL statement
SQL expression "(SELECT emaj._get_log_sequence_last_value(r_rel.rel_log_schema, r_rel.rel_log_sequence))
           -- the log sequence last value at begin time id
        - (SELECT tbl_log_seq_last_val
             FROM emaj.emaj_table
             WHERE tbl_schema = r_rel.rel_schema
               AND tbl_name = r_rel.rel_tblseq
               AND tbl_time_id = p_beginTimeId)
           -- sum of hole from the begin time to now
        - (SELECT coalesce(sum(sqhl_hole_size),0)
             FROM emaj.emaj_seq_hole
             WHERE sqhl_schema = r_rel.rel_schema
               AND sqhl_table = r_rel.rel_tblseq
               AND sqhl_begin_time_id >= p_beginTimeId)"
PL/pgSQL function emaj._log_stat_tbl(emaj.emaj_relation,bigint,bigint) line 13 at RETURN
SQL statement "SELECT coalesce(sum(emaj._log_stat_tbl(emaj_relation, greatest(v_latestMarkTimeId, lower(rel_time_range)),NULL)), 0)
                                     FROM emaj.emaj_relation
          WHERE rel_group = v_group
            AND rel_kind = 'r'
            AND upper_inf(rel_time_range)"
PL/pgSQL function emaj._set_mark_groups(text[],text,text,boolean,boolean,text,bigint,text) line 83 at SQL statement
SQL statement "SELECT emaj._set_mark_groups(v_loggingGroups, v_markName, NULL, FALSE, TRUE, NULL, v_timeId)"
PL/pgSQL function _remove_tables(text,text[],text,boolean,boolean) line 47 at PERFORM
PL/pgSQL function emaj_remove_table(text,text,text) line 6 at RETURN
select emaj_force_stop_group('grp_tmp');
 emaj_force_stop_group 
-----------------------
                    12
(1 row)

select emaj_remove_table('phil''s schema"3','my"tbl4');
NOTICE:  sequence "my"tbl4_log_seq" does not exist, skipping
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj_assign_table('phil''s schema"3','my"tbl4','grp_tmp');
NOTICE:  table "my"tbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema"3.my"tbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select * from emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                                      msg                                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Warning: In tables group "grp_tmp", the sequence "myschema4"."mytblp_col4_seq" is linked to the table "myschema4"."mytblp" but this table does not belong to any tables group.
 No error detected
(2 rows)

select emaj_start_group('grp_tmp','Group restart');
 emaj_start_group 
------------------
               12
(1 row)

-- import the groups configuration
select emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/groups_config.json', null, true, 'REVERT_CHANGES');
NOTICE:  table "tmp_app_table" does not exist, skipping
NOTICE:  table "tmp_app_sequence" does not exist, skipping
NOTICE:  table "mytblc1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc1" does not exist, skipping
 emaj_import_groups_configuration 
----------------------------------
                                3
(1 row)

-- reset groups at their initial state
select emaj_stop_group('grp_tmp_3');
 emaj_stop_group 
-----------------
               5
(1 row)

select emaj_drop_group('grp_tmp_3');
 emaj_drop_group 
-----------------
               5
(1 row)

select emaj_set_mark_group('grp_tmp_4','Last_mark');
 emaj_set_mark_group 
---------------------
                   9
(1 row)

select emaj_force_drop_group('grp_tmp_4');
 emaj_force_drop_group 
-----------------------
                     9
(1 row)

select emaj_stop_group('grp_tmp');
 emaj_stop_group 
-----------------
               0
(1 row)

select emaj_drop_group('grp_tmp');
 emaj_drop_group 
-----------------
               0
(1 row)

select * from emaj.emaj_rel_hist order by 1,2,3;
   relh_schema   |                           relh_tblseq                           | relh_time_range |    relh_group    | relh_kind 
-----------------+-----------------------------------------------------------------+-----------------+------------------+-----------
 myschema4       | mypartp1a                                                       | [17101,17204)   | myGroup4         | r
 myschema4       | mypartp1b                                                       | [17101,17204)   | myGroup4         | r
 myschema4       | mypartp2                                                        | [17101,17208)   | myGroup4         | r
 myschema4       | mypartp2                                                        | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mypartp2                                                        | [17617,17634)   | grp_tmp          | r
 myschema4       | mypartp2                                                        | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mypartp3                                                        | [17202,17208)   | myGroup4         | r
 myschema4       | mypartp3                                                        | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mypartp3                                                        | [17617,17634)   | grp_tmp          | r
 myschema4       | mypartp3                                                        | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mytblc1                                                         | [17101,17208)   | myGroup4         | r
 myschema4       | mytblc1                                                         | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mytblc1                                                         | [17617,17622)   | grp_tmp          | r
 myschema4       | mytblc1                                                         | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mytblc2                                                         | [17101,17208)   | myGroup4         | r
 myschema4       | mytblc2                                                         | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mytblc2                                                         | [17617,17634)   | grp_tmp          | r
 myschema4       | mytblc2                                                         | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mytblm                                                          | [17101,17208)   | myGroup4         | r
 myschema4       | mytblm                                                          | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mytblm                                                          | [17617,17634)   | grp_tmp          | r
 myschema4       | mytblm                                                          | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mytblp_col4_seq                                                 | [17203,17205)   | myGroup4         | S
 myschema4       | mytblp_col4_seq                                                 | [17607,17618)   | grp_tmp_4        | S
 myschema4       | mytblp_col4_seq                                                 | [17618,17634)   | grp_tmp          | S
 myschema4       | mytblp_col4_seq                                                 | [17634,17638)   | grp_tmp_4        | S
 myschema4       | mytblr1                                                         | [17101,17208)   | myGroup4         | r
 myschema4       | mytblr1                                                         | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mytblr1                                                         | [17617,17634)   | grp_tmp          | r
 myschema4       | mytblr1                                                         | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mytblr2                                                         | [17101,17208)   | myGroup4         | r
 myschema4       | mytblr2                                                         | [17606,17617)   | grp_tmp_4        | r
 myschema4       | mytblr2                                                         | [17617,17634)   | grp_tmp          | r
 myschema4       | mytblr2                                                         | [17634,17638)   | grp_tmp_4        | r
 myschema4       | mytblr2_col1_seq                                                | [17607,17618)   | grp_tmp_4        | S
 myschema4       | mytblr2_col1_seq                                                | [17618,17634)   | grp_tmp          | S
 myschema4       | mytblr2_col1_seq                                                | [17634,17638)   | grp_tmp_4        | S
 myschema5       | myunloggedtbl                                                   | [17403,17414)   | phil's group#3", | r
 phil's schema"3 | my"tbl4                                                         | [17401,17405)   | phil's group#3", | r
 phil's schema"3 | my"tbl4                                                         | [17406,17407)   | phil's group#3", | r
 phil's schema"3 | my"tbl4                                                         | [17408,17409)   | phil's group#3", | r
 phil's schema"3 | my"tbl4                                                         | [17411,17414)   | phil's group#3", | r
 phil's schema"3 | my"tbl4                                                         | [17604,17615)   | grp_tmp_3        | r
 phil's schema"3 | my"tbl4                                                         | [17615,17631)   | grp_tmp          | r
 phil's schema"3 | my"tbl4                                                         | [17632,17634)   | grp_tmp          | r
 phil's schema"3 | my"tbl4                                                         | [17634,17636)   | grp_tmp_3        | r
 phil's schema"3 | myTbl2\                                                         | [14201,14507)   | phil's group#3", | r
 phil's schema"3 | myTbl2\                                                         | [17401,17414)   | phil's group#3", | r
 phil's schema"3 | myTbl2\                                                         | [17604,17615)   | grp_tmp_3        | r
 phil's schema"3 | myTbl2\                                                         | [17615,17634)   | grp_tmp          | r
 phil's schema"3 | myTbl2\                                                         | [17634,17636)   | grp_tmp_3        | r
 phil's schema"3 | myTbl2\_col21_seq                                               | [14202,14507)   | phil's group#3", | S
 phil's schema"3 | myTbl2\_col21_seq                                               | [17402,17414)   | phil's group#3", | S
 phil's schema"3 | myTbl2\_col21_seq                                               | [17605,17616)   | grp_tmp_3        | S
 phil's schema"3 | myTbl2\_col21_seq                                               | [17616,17634)   | grp_tmp          | S
 phil's schema"3 | myTbl2\_col21_seq                                               | [17634,17636)   | grp_tmp_3        | S
 phil's schema"3 | phil's tbl1                                                     | [14201,14501)   | phil's group#3", | r
 phil's schema"3 | phil's tbl1                                                     | [17401,17414)   | phil's group#3", | r
 phil's schema"3 | phil's tbl1                                                     | [17604,17615)   | grp_tmp_3        | r
 phil's schema"3 | phil's tbl1                                                     | [17615,17634)   | grp_tmp          | r
 phil's schema"3 | phil's tbl1                                                     | [17634,17636)   | grp_tmp_3        | r
 phil's schema"3 | phil's"seq\1                                                    | [14202,14507)   | phil's group#3", | S
 phil's schema"3 | phil's"seq\1                                                    | [17402,17410)   | phil's group#3", | S
 phil's schema"3 | phil's"seq\1                                                    | [17412,17414)   | phil's group#3", | S
 phil's schema"3 | phil's"seq\1                                                    | [17605,17616)   | grp_tmp_3        | S
 phil's schema"3 | phil's"seq\1                                                    | [17616,17623)   | grp_tmp          | S
 phil's schema"3 | phil's"seq\1                                                    | [17634,17636)   | grp_tmp_3        | S
 phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name | [14502,14507)   | phil's group#3", | r
(68 rows)

select count(*) from emaj.emaj_relation where rel_schema in ('phil''s schema"3','myschema4');
 count 
-------
     0
(1 row)

-----------------------------
-- Checking step 19
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17600 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17600 |           17600000 | C
   17601 |           17600000 | C
   17602 |           17600000 | C
   17603 |           17600000 | S
   17604 |           17600000 | A
   17605 |           17600000 | A
   17606 |           17600000 | A
   17607 |           17600000 | A
   17608 |           17600000 | A
   17609 |           17600000 | S
   17610 |           17600000 | M
   17611 |           17600011 | M
   17612 |           17600024 | M
   17613 |           17600028 | R
   17614 |           17600028 | A
   17615 |           17600028 | A
   17616 |           17600028 | A
   17617 |           17600028 | A
   17618 |           17600028 | A
   17619 |           17600028 | M
   17620 |           17600033 | M
   17621 |           17600037 | M
   17622 |           17600041 | A
   17623 |           17600041 | A
   17624 |           17600041 | R
   17625 |           17600045 | M
   17626 |           17600045 | M
   17627 |           17600051 | A
   17628 |           17600051 | R
   17630 |           17600051 | X
   17631 |           17600051 | A
   17632 |           17600051 | A
   17633 |           17600051 | S
   17634 |           17600051 | I
   17635 |           17600051 | X
   17636 |           17600051 | D
   17637 |           17600051 | M
   17638 |           17600051 | D
   17639 |           17600051 | X
   17640 |           17600051 | D
(40 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17600 order by hist_id;
      hist_function       |         hist_event          |              hist_object               |                                                          regexp_replace                                                          | hist_user 
--------------------------+-----------------------------+----------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+-----------
 CREATE_GROUP             | BEGIN                       | grp_tmp                                | rollbackable                                                                                                                     | postgres
 CREATE_GROUP             | TIME STAMP SET              | 17600                                  |                                                                                                                                  | postgres
 CREATE_GROUP             | END                         | grp_tmp                                |                                                                                                                                  | postgres
 CREATE_GROUP             | BEGIN                       | grp_tmp_3                              | rollbackable                                                                                                                     | postgres
 CREATE_GROUP             | TIME STAMP SET              | 17601                                  |                                                                                                                                  | postgres
 CREATE_GROUP             | END                         | grp_tmp_3                              |                                                                                                                                  | postgres
 CREATE_GROUP             | BEGIN                       | grp_tmp_4                              | rollbackable                                                                                                                     | postgres
 CREATE_GROUP             | TIME STAMP SET              | 17602                                  |                                                                                                                                  | postgres
 CREATE_GROUP             | END                         | grp_tmp_4                              |                                                                                                                                  | postgres
 START_GROUPS             | BEGIN                       | grp_tmp,grp_tmp_4                      | With log reset                                                                                                                   | postgres
 START_GROUPS             | TIME STAMP SET              | 17603                                  |                                                                                                                                  | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_4                      |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_4                      | 0 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_4                      | Start                                                                                                                            | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_4                      | Start                                                                                                                            | postgres
 START_GROUPS             | END                         | grp_tmp,grp_tmp_4                      | 0 tables/sequences processed                                                                                                     | postgres
 ASSIGN_TABLES            | BEGIN                       |                                        |                                                                                                                                  | postgres
 ASSIGN_TABLES            | TIME STAMP SET              | 17604                                  |                                                                                                                                  | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED          | "emaj_phil's schema""3"                |                                                                                                                                  | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | "phil's schema""3"."my""tbl4"          | To the idle group grp_tmp_3                                                                                                      | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | "phil's schema""3"."myTbl2\"           | To the idle group grp_tmp_3                                                                                                      | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | "phil's schema""3"."phil's tbl1"       | To the idle group grp_tmp_3                                                                                                      | postgres
 ASSIGN_TABLES            | END                         |                                        | 3 tables assigned to the group grp_tmp_3                                                                                         | postgres
 ASSIGN_SEQUENCES         | BEGIN                       |                                        |                                                                                                                                  | postgres
 ASSIGN_SEQUENCES         | TIME STAMP SET              | 17605                                  |                                                                                                                                  | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | "phil's schema""3"."myTbl2\_col21_seq" | To the idle group grp_tmp_3                                                                                                      | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | "phil's schema""3"."phil's""seq\1"     | To the idle group grp_tmp_3                                                                                                      | postgres
 ASSIGN_SEQUENCES         | END                         |                                        | 2 sequences assigned to the group grp_tmp_3                                                                                      | postgres
 ASSIGN_TABLES            | BEGIN                       |                                        |                                                                                                                                  | postgres
 ASSIGN_TABLES            | TIME STAMP SET              | 17606                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                              | 0 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_4                              | ASSIGN_%                                                                                                                         | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_4                              | ASSIGN_%                                                                                                                         | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED          | emaj_myschema4                         |                                                                                                                                  | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblr2                      | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mypartp3                     | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblr1                      | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblm                       | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblc2                      | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mypartp2                     | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblc1                      | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_TABLES            | END                         |                                        | 7 tables assigned to the group grp_tmp_4                                                                                         | postgres
 ASSIGN_SEQUENCES         | BEGIN                       |                                        |                                                                                                                                  | postgres
 ASSIGN_SEQUENCES         | TIME STAMP SET              | 17607                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                              | 7 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_4                              | ASSIGN_%                                                                                                                         | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_4                              | ASSIGN_%                                                                                                                         | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | myschema4.mytblp_col4_seq              | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | myschema4.mytblr2_col1_seq             | To the logging group grp_tmp_4                                                                                                   | postgres
 ASSIGN_SEQUENCES         | END                         |                                        | 2 sequences assigned to the group grp_tmp_4                                                                                      | postgres
 MODIFY_TABLE             | BEGIN                       |                                        |                                                                                                                                  | postgres
 MODIFY_TABLE             | TIME STAMP SET              | 17608                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                              | 7 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_4                              | MODIFY_%                                                                                                                         | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp_4                              | MODIFY_%                                                                                                                         | postgres
 MODIFY_TABLE             | TRIGGERS TO IGNORE CHANGED  | myschema4.mytblm                       | none => {mytblm_insert_trigger}                                                                                                  | postgres
 MODIFY_TABLE             | END                         |                                        | 1 tables effectively modified                                                                                                    | postgres
 START_GROUP              | BEGIN                       | grp_tmp_3                              | With log reset                                                                                                                   | postgres
 START_GROUP              | TIME STAMP SET              | 17609                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_3                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_3                              | 3 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_3                              | Start                                                                                                                            | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_3                              | Start                                                                                                                            | postgres
 START_GROUP              | END                         | grp_tmp_3                              | 5 tables/sequences processed                                                                                                     | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk1                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17610                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk1                                                                                                                              | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk2                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17611                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk2                                                                                                                              | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk3                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17612                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk3                                                                                                                              | postgres
 ROLLBACK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | Unlogged rollback to mark Mk3 (timestamp)                                                                                        | postgres
 DBLINK_OPEN_CNX          |                             | rlbk#1                                 | Status = 1                                                                                                                       | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback session #1                                                                                                              | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback session #1: 10 tables locked, 0 deadlock(s)                                                                             | postgres
 ROLLBACK_GROUPS          | TIME STAMP SET              | 17613                                  |                                                                                                                                  | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc2                      | All log rows where emaj_gid > 17600024 and <= 17600028                                                                           | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc2                      | 3 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc1                      | All log rows where emaj_gid > 17600024 and <= 17600028                                                                           | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc1                      | 1 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17600                      | Rollback id = 17600.                                                                                                             | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17600                      | 2 / 10 tables effectively processed.                                                                                             | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17600                      | 0 / 4 sequences effectively processed.                                                                                           | postgres
 DBLINK_CLOSE_CNX         |                             | rlbk#1                                 |                                                                                                                                  | postgres
 ROLLBACK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback_id 17600                                                                                                                | postgres
 MODIFY_TABLES            | BEGIN                       |                                        |                                                                                                                                  | postgres
 MODIFY_TABLES            | TIME STAMP SET              | 17614                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_3                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_3                              | 3 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3                              | Modify 1 table                                                                                                                   | postgres
 CLEANUP_RLBK_STATE       |                             | Rollback id 17600                      | set to COMMITTED                                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp_3                              | Modify 1 table                                                                                                                   | postgres
 MODIFY_TABLES            | PRIORITY CHANGED            | "phil's schema""3"."phil's tbl1"       | NULL => -1                                                                                                                       | postgres
 MODIFY_TABLES            | LOG DATA TABLESPACE CHANGED | "phil's schema""3"."phil's tbl1"       | Default tablespace => tsp log'2                                                                                                  | postgres
 MODIFY_TABLES            | END                         |                                        | 1 tables effectively modified                                                                                                    | postgres
 MOVE_TABLES              | BEGIN                       |                                        |                                                                                                                                  | postgres
 MOVE_TABLES              | TIME STAMP SET              | 17615                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3                      |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3                      | 3 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3                      | Move_tbl_3_to_tmp                                                                                                                | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3                      | Move_tbl_3_to_tmp                                                                                                                | postgres
 MOVE_TABLES              | TABLE MOVED                 | "phil's schema""3"."my""tbl4"          | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | "phil's schema""3"."myTbl2\"           | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | "phil's schema""3"."phil's tbl1"       | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | END                         |                                        | 3 tables moved to the tables group grp_tmp                                                                                       | postgres
 MOVE_SEQUENCES           | BEGIN                       |                                        |                                                                                                                                  | postgres
 MOVE_SEQUENCES           | TIME STAMP SET              | 17616                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3                      |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3                      | 3 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3                      | Move_seq_3_to_tmp                                                                                                                | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3                      | Move_seq_3_to_tmp                                                                                                                | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | "phil's schema""3"."myTbl2\_col21_seq" | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                    | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | "phil's schema""3"."phil's""seq\1"     | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                    | postgres
 MOVE_SEQUENCES           | END                         |                                        | 2 sequences moved to the tables group grp_tmp                                                                                    | postgres
 MOVE_TABLES              | BEGIN                       |                                        |                                                                                                                                  | postgres
 MOVE_TABLES              | TIME STAMP SET              | 17617                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_4                      |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_4                      | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_4                      | Move_tbl_4_to_tmp                                                                                                                | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_4                      | Move_tbl_4_to_tmp                                                                                                                | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mypartp2                     | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mypartp3                     | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblc1                      | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblc2                      | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblm                       | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblr1                      | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblr2                      | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_TABLES              | END                         |                                        | 7 tables moved to the tables group grp_tmp                                                                                       | postgres
 MOVE_SEQUENCES           | BEGIN                       |                                        |                                                                                                                                  | postgres
 MOVE_SEQUENCES           | TIME STAMP SET              | 17618                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_4                      |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_4                      | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_4                      | Move_seq_4_to_tmp                                                                                                                | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_4                      | Move_seq_4_to_tmp                                                                                                                | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | myschema4.mytblp_col4_seq              | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | myschema4.mytblr2_col1_seq             | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                    | postgres
 MOVE_SEQUENCES           | END                         |                                        | 2 sequences moved to the tables group grp_tmp                                                                                    | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk4                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17619                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk4                                                                                                                              | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk5                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17620                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk5                                                                                                                              | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk6                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17621                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk6                                                                                                                              | postgres
 REMOVE_TABLE             | BEGIN                       |                                        |                                                                                                                                  | postgres
 REMOVE_TABLE             | TIME STAMP SET              | 17622                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp                                | 10 tables locked, 0 deadlock(s)                                                                                                  | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                                | Remove_mytblc1                                                                                                                   | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                                | Remove_mytblc1                                                                                                                   | postgres
 REMOVE_TABLE             | TABLE REMOVED               | myschema4.mytblc1                      | From the logging group grp_tmp                                                                                                   | postgres
 REMOVE_TABLE             | END                         |                                        | 1 tables removed from their groups                                                                                               | postgres
 REMOVE_SEQUENCE          | BEGIN                       |                                        |                                                                                                                                  | postgres
 REMOVE_SEQUENCE          | TIME STAMP SET              | 17623                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp                                | 9 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                                | Remove_myseq1                                                                                                                    | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                                | Remove_myseq1                                                                                                                    | postgres
 REMOVE_SEQUENCE          | SEQUENCE REMOVED            | "phil's schema""3"."phil's""seq\1"     | From the logging group grp_tmp                                                                                                   | postgres
 REMOVE_SEQUENCE          | END                         |                                        | 1 sequences removed from their groups                                                                                            | postgres
 ROLLBACK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | Logged rollback to mark Mk5 (timestamp)                                                                                          | postgres
 DBLINK_OPEN_CNX          |                             | rlbk#1                                 | Status = 1                                                                                                                       | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback session #1                                                                                                              | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback session #1: 9 tables locked, 0 deadlock(s)                                                                              | postgres
 ROLLBACK_GROUPS          | TIME STAMP SET              | 17624                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | RLBK_17601_START                                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | RLBK_17601_START                                                                                                                 | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc2                      | All log rows where emaj_gid > 17600033 and <= 17600041                                                                           | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc2                      | 3 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblm                       | All log rows where emaj_gid > 17600033 and <= 17600041                                                                           | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblm                       | 1 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_GROUPS          | TIME STAMP SET              | 17625                                  |                                                                                                                                  | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | RLBK_17601_DONE                                                                                                                  | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | RLBK_17601_DONE                                                                                                                  | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17601                      | Rollback id = 17601.                                                                                                             | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17601                      | 2 / 9 tables effectively processed.                                                                                              | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17601                      | 0 / 3 sequences effectively processed.                                                                                           | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17601                      | The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)                                     | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17601                      | The sequence "phil's schema""3"."phil's""seq\1" has been left unchanged (not in group anymore since <timestamp>)                 | postgres
 DBLINK_CLOSE_CNX         |                             | rlbk#1                                 |                                                                                                                                  | postgres
 ROLLBACK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback_id 17601                                                                                                                | postgres
 RENAME_MARK_GROUP        | BEGIN                       | grp_tmp_3                              | EMAJ_LAST_MARK                                                                                                                   | postgres
 RENAME_MARK_GROUP        | END                         | grp_tmp_3                              | RLBK_17601_DONE renamed End_logged_rollback                                                                                      | postgres
 RENAME_MARK_GROUP        | BEGIN                       | grp_tmp_4                              | EMAJ_LAST_MARK                                                                                                                   | postgres
 RENAME_MARK_GROUP        | END                         | grp_tmp_4                              | RLBK_17601_DONE renamed End_logged_rollback                                                                                      | postgres
 RENAME_MARK_GROUP        | BEGIN                       | grp_tmp                                | EMAJ_LAST_MARK                                                                                                                   | postgres
 RENAME_MARK_GROUP        | END                         | grp_tmp                                | RLBK_17601_DONE renamed End_logged_rollback                                                                                      | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | Mk7                                                                                                                              | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 9 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | TIME STAMP SET              | 17626                                  |                                                                                                                                  | postgres
 CLEANUP_RLBK_STATE       |                             | Rollback id 17601                      | set to COMMITTED                                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Mk7                                                                                                                              | postgres
 CONSOLIDATE_RLBK_GROUP   | BEGIN                       | grp_tmp                                | Erase all between marks Mk5 and End_logged_rollback                                                                              | postgres
 CONSOLIDATE_RLBK_GROUP   | END                         | grp_tmp                                | 2 tables and 3 sequences processed ; 4 marks deleted                                                                             | postgres
 GEN_SQL_GROUPS           | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp            | From mark Mk1 to current state                                                                                                   | postgres
 GEN_SQL_GROUPS           | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 26 generated statements - script exported into /tmp/emaj_16/adm3/allGroups.sql                                                   | postgres
 MODIFY_TABLES            | BEGIN                       |                                        |                                                                                                                                  | postgres
 MODIFY_TABLES            | TIME STAMP SET              | 17627                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp                                | 9 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp                                | revert changes for 1 table                                                                                                       | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp                                | revert changes for 1 table                                                                                                       | postgres
 MODIFY_TABLES            | PRIORITY CHANGED            | "phil's schema""3"."phil's tbl1"       | -1 => NULL                                                                                                                       | postgres
 MODIFY_TABLES            | LOG DATA TABLESPACE CHANGED | "phil's schema""3"."phil's tbl1"       | tsp log'2 => Default tablespace                                                                                                  | postgres
 MODIFY_TABLES            | END                         |                                        | 1 tables effectively modified                                                                                                    | postgres
 ROLLBACK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | Unlogged rollback to mark Mk3 (timestamp)                                                                                        | postgres
 DBLINK_OPEN_CNX          |                             | rlbk#1                                 | Status = 1                                                                                                                       | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback session #1                                                                                                              | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback session #1: 9 tables locked, 0 deadlock(s)                                                                              | postgres
 ROLLBACK_GROUPS          | TIME STAMP SET              | 17628                                  |                                                                                                                                  | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc2                      | All log rows where emaj_gid > 17600028 and <= 17600051                                                                           | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc2                      | 6 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_TABLE           | BEGIN                       | "phil's schema""3"."my""tbl4"          | All log rows where emaj_gid > 17600028 and <= 17600051, in session_replication_role = replica mode                               | postgres
 ROLLBACK_TABLE           | END                         | "phil's schema""3"."my""tbl4"          | 4 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_TABLE           | BEGIN                       | "phil's schema""3"."myTbl2\"           | All log rows where emaj_gid > 17600028 and <= 17600051, in session_replication_role = replica mode                               | postgres
 ROLLBACK_TABLE           | END                         | "phil's schema""3"."myTbl2\"           | 1 rolled back primary keys                                                                                                       | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Modify 1 table is deleted                                                                                                   | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Move_tbl_3_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Move_tbl_3_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Move_seq_3_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Move_seq_3_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Move_tbl_4_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark Move_tbl_4_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Move_seq_4_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark Move_seq_4_to_tmp is deleted                                                                                                | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Mk4 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Mk4 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark Mk4 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Mk5 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Mk5 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark Mk5 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Mk6 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark Mk6 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark RLBK_17601_START is deleted                                                                                                 | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark RLBK_17601_START is deleted                                                                                                 | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark End_logged_rollback is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark End_logged_rollback is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark End_logged_rollback is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark Mk7 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                              | mark Mk7 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                              | mark Mk7 is deleted                                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                                | mark revert changes for 1 table is deleted                                                                                       | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17602                      | Rollback id = 17602.                                                                                                             | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17602                      | 3 / 9 tables effectively processed.                                                                                              | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17602                      | 0 / 3 sequences effectively processed.                                                                                           | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table "phil's schema""3"."my""tbl4" has only been rolled back to its latest group attachment (<timestamp>)                   | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table "phil's schema""3"."myTbl2\" has only been rolled back to its latest group attachment (<timestamp>)                    | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table "phil's schema""3"."phil's tbl1" has only been rolled back to its latest group attachment (<timestamp>)                | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The sequence "phil's schema""3"."myTbl2\_col21_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mypartp2 has only been rolled back to its latest group attachment (<timestamp>)                              | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)                              | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mytblc2 has only been rolled back to its latest group attachment (<timestamp>)                               | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mytblm has only been rolled back to its latest group attachment (<timestamp>)                                | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mytblr1 has only been rolled back to its latest group attachment (<timestamp>)                               | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mytblr2 has only been rolled back to its latest group attachment (<timestamp>)                               | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The sequence myschema4.mytblp_col4_seq has only been rolled back to its latest group attachment state (<timestamp>)              | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The sequence myschema4.mytblr2_col1_seq has only been rolled back to its latest group attachment state (<timestamp>)             | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)                                     | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | The sequence "phil's schema""3"."phil's""seq\1" has been left unchanged (not in group anymore since <timestamp>)                 | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | Tables group change not rolled back: log data tablespace for "phil's schema""3"."phil's tbl1"                                    | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                      | Tables group change not rolled back: E-Maj priority for "phil's schema""3"."phil's tbl1"                                         | postgres
 DBLINK_CLOSE_CNX         |                             | rlbk#1                                 |                                                                                                                                  | postgres
 ROLLBACK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | Rollback_id 17602                                                                                                                | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN                       | grp_tmp_3                              | Mk3                                                                                                                              | postgres
 DELETE_BEFORE_MARK_GROUP | END                         | grp_tmp_3                              | 3 marks deleted ; Mk3 is now the initial mark                                                                                    | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN                       | grp_tmp_4                              | Mk3                                                                                                                              | postgres
 DELETE_BEFORE_MARK_GROUP | END                         | grp_tmp_4                              | 6 marks deleted ; Mk3 is now the initial mark                                                                                    | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN                       | grp_tmp                                | Mk3                                                                                                                              | postgres
 DELETE_BEFORE_MARK_GROUP | END                         | grp_tmp                                | 3 marks deleted ; Mk3 is now the initial mark                                                                                    | postgres
 DISABLE_PROTECTION       | EVENT TRIGGERS DISABLED     |                                        | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                                                   | postgres
 ENABLE_PROTECTION        | EVENT TRIGGERS ENABLED      |                                        | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                                                   | postgres
 FORCE_STOP_GROUP         | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 FORCE_STOP_GROUP         | TIME STAMP SET              | 17630                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp                                | 9 tables locked, 0 deadlock(s)                                                                                                   | postgres
 FORCE_STOP_GROUP         | END                         | grp_tmp                                | 12 tables/sequences processed                                                                                                    | postgres
 REMOVE_TABLE             | BEGIN                       |                                        |                                                                                                                                  | postgres
 REMOVE_TABLE             | TIME STAMP SET              | 17631                                  |                                                                                                                                  | postgres
 REMOVE_TABLE             | TABLE REMOVED               | "phil's schema""3"."my""tbl4"          | From the idle group grp_tmp                                                                                                      | postgres
 REMOVE_TABLE             | END                         |                                        | 1 tables removed from their groups                                                                                               | postgres
 ASSIGN_TABLE             | BEGIN                       |                                        |                                                                                                                                  | postgres
 ASSIGN_TABLE             | TIME STAMP SET              | 17632                                  |                                                                                                                                  | postgres
 ASSIGN_TABLE             | TABLE ADDED                 | "phil's schema""3"."my""tbl4"          | To the idle group grp_tmp                                                                                                        | postgres
 ASSIGN_TABLE             | END                         |                                        | 1 tables assigned to the group grp_tmp                                                                                           | postgres
 START_GROUP              | BEGIN                       | grp_tmp                                | With log reset                                                                                                                   | postgres
 START_GROUP              | TIME STAMP SET              | 17633                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp                                | 9 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                                | Group restart                                                                                                                    | postgres
 CLEANUP_RLBK_STATE       |                             | Rollback id 17602                      | set to COMMITTED                                                                                                                 | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                                | Group restart                                                                                                                    | postgres
 START_GROUP              | END                         | grp_tmp                                | 12 tables/sequences processed                                                                                                    | postgres
 IMPORT_GROUPS            | BEGIN                       | grp_tmp, grp_tmp_3, grp_tmp_4          | Input file: '/tmp/emaj_16/adm3/groups_config.json'                                                                               | postgres
 IMPORT_GROUPS            | TIME STAMP SET              | 17634                                  |                                                                                                                                  | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            |                                                                                                                                  | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | 9 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4            | REVERT_CHANGES                                                                                                                   | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4            | REVERT_CHANGES                                                                                                                   | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mypartp2                     | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mypartp3                     | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblc2                      | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblm                       | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblr1                      | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblr2                      | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | "phil's schema""3"."my""tbl4"          | From the logging group grp_tmp to the logging group grp_tmp_3                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | "phil's schema""3"."myTbl2\"           | From the logging group grp_tmp to the logging group grp_tmp_3                                                                    | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | "phil's schema""3"."phil's tbl1"       | From the logging group grp_tmp to the logging group grp_tmp_3                                                                    | postgres
 IMPORT_GROUPS            | SEQUENCE MOVED              | myschema4.mytblp_col4_seq              | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | SEQUENCE MOVED              | myschema4.mytblr2_col1_seq             | From the logging group grp_tmp to the logging group grp_tmp_4                                                                    | postgres
 IMPORT_GROUPS            | SEQUENCE MOVED              | "phil's schema""3"."myTbl2\_col21_seq" | From the logging group grp_tmp to the logging group grp_tmp_3                                                                    | postgres
 IMPORT_GROUPS            | TABLE ADDED                 | myschema4.mytblc1                      | To the logging group grp_tmp_4                                                                                                   | postgres
 IMPORT_GROUPS            | SEQUENCE ADDED              | "phil's schema""3"."phil's""seq\1"     | To the logging group grp_tmp_3                                                                                                   | postgres
 IMPORT_GROUPS            | END                         |                                        | 3 created or altered tables groups                                                                                               | postgres
 STOP_GROUP               | BEGIN                       | grp_tmp_3                              |                                                                                                                                  | postgres
 STOP_GROUP               | TIME STAMP SET              | 17635                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_3                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_3                              | 3 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_3                              | STOP_%                                                                                                                           | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_3                              | STOP_%                                                                                                                           | postgres
 STOP_GROUP               | END                         | grp_tmp_3                              | 5 tables/sequences processed                                                                                                     | postgres
 DROP_GROUP               | BEGIN                       | grp_tmp_3                              |                                                                                                                                  | postgres
 DROP_GROUP               | TIME STAMP SET              | 17636                                  |                                                                                                                                  | postgres
 DROP_GROUP               | END                         | grp_tmp_3                              | 5 tables/sequences processed                                                                                                     | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_4                              |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                              |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                              | 7 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | TIME STAMP SET              | 17637                                  |                                                                                                                                  | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_4                              | Last_mark                                                                                                                        | postgres
 FORCE_DROP_GROUP         | BEGIN                       | grp_tmp_4                              |                                                                                                                                  | postgres
 FORCE_DROP_GROUP         | TIME STAMP SET              | 17638                                  |                                                                                                                                  | postgres
 FORCE_DROP_GROUP         | END                         | grp_tmp_4                              | 9 tables/sequences processed                                                                                                     | postgres
 STOP_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 STOP_GROUP               | TIME STAMP SET              | 17639                                  |                                                                                                                                  | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 LOCK_GROUP               | END                         | grp_tmp                                | 0 tables locked, 0 deadlock(s)                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                                | STOP_%                                                                                                                           | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                                | STOP_%                                                                                                                           | postgres
 STOP_GROUP               | END                         | grp_tmp                                | 0 tables/sequences processed                                                                                                     | postgres
 DROP_GROUP               | BEGIN                       | grp_tmp                                |                                                                                                                                  | postgres
 DROP_GROUP               | TIME STAMP SET              | 17640                                  |                                                                                                                                  | postgres
 DROP_GROUP               | LOG_SCHEMA DROPPED          | emaj_myschema4                         |                                                                                                                                  | postgres
 DROP_GROUP               | LOG_SCHEMA DROPPED          | "emaj_phil's schema""3"                |                                                                                                                                  | postgres
 DROP_GROUP               | END                         | grp_tmp                                | 0 tables/sequences processed                                                                                                     | postgres
(363 rows)

-- set sequence restart value
select public.handle_emaj_sequences(18000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

\! rm $EMAJTESTTMPDIR/*
-----------------------------
-- Step 20 : test emaj_gen_sql_dump_changes_group() and emaj_dump_changes_group()
-----------------------------
select emaj_gen_sql_dump_changes_group('myGroup1','M4','M5','Consolidation=FULL',NULL,:'EMAJTESTTMPDIR' || '/dump_changes.sql');
NOTICE:  table "emaj_temp_sql" does not exist, skipping
                            emaj_gen_sql_dump_changes_group                            
---------------------------------------------------------------------------------------
 9 SQL statements have been written into the "/tmp/emaj_16/adm3/dump_changes.sql" file
(1 row)

\! wc -l $EMAJTESTTMPDIR/dump_changes.sql
17 /tmp/emaj_16/adm3/dump_changes.sql
select emaj_dump_changes_group('myGroup1','M4','M5',NULL,'{"myschema1.myTbl3"}',:'EMAJTESTTMPDIR');
NOTICE:  table "emaj_temp_sql" does not exist, skipping
            emaj_dump_changes_group             
------------------------------------------------
 2 files have been created in /tmp/emaj_16/adm3
(1 row)

\! wc -l $EMAJTESTTMPDIR/myschema1_myTbl3.changes $EMAJTESTTMPDIR/_INFO
  20 /tmp/emaj_16/adm3/myschema1_myTbl3.changes
   4 /tmp/emaj_16/adm3/_INFO
  24 total
-- Build the table/sequence names array using the emaj_log_stat_group() function result
SELECT emaj_gen_sql_dump_changes_group('myGroup1','M4','M5',
                                            'EMAJ_COLUMNS=(emaj_tuple, emaj_gid, emaj_verb), CONSOLIDATION=FULL, ORDER_BY=TIME',
                                            (SELECT array_agg(distinct stat_schema || '.' || stat_table) FROM emaj_log_stat_group('myGroup1','M4','M5'))
                                           );
NOTICE:  table "emaj_temp_sql" does not exist, skipping
                    emaj_gen_sql_dump_changes_group                    
-----------------------------------------------------------------------
 7 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

SELECT sql_text FROM emaj_temp_sql ORDER BY sql_stmt_number, sql_line_number;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    sql_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup1" (subset) between marks "M4" and "M5" using options: EMAJ_COLUMNS=(emaj_tuple, emaj_gid, emaj_verb), CONSOLIDATION=FULL, ORDER_BY=TIME
 SET enable_nestloop = FALSE;
 -- Dump changes for table myschema1.myTbl3 between marks "M4" and "M5" (10 changes)
 WITH keys AS ( SELECT col31, min(emaj_gid) AS min_gid, max(emaj_gid) AS max_gid FROM emaj_myschema1."myTbl3_log" WHERE emaj_gid > 12400014 AND emaj_gid <= 12400024 AND emaj_tuple IN ('OLD','NEW') GROUP BY col31 ), consolidated AS ( SELECT tbl.* FROM emaj_myschema1."myTbl3_log" tbl JOIN keys ON (tbl.col31 = keys.col31) WHERE (tbl.emaj_tuple = 'OLD' AND tbl.emaj_gid = keys.min_gid) OR (tbl.emaj_tuple = 'NEW' AND tbl.emaj_gid = keys.max_gid) ), unchanged_keys AS ( SELECT r1.col31 FROM consolidated r1 JOIN consolidated r2 ON (r1.col31=r2.col31) WHERE r1.emaj_tuple = 'OLD' AND r2.emaj_tuple = 'NEW' AND (r1.col32=r2.col32 OR (r1.col32 IS NULL AND r2.col32 IS NULL)) AND (r1.col33=r2.col33 OR (r1.col33 IS NULL AND r2.col33 IS NULL)) ) SELECT tbl.col31,emaj_gid,emaj_tuple,tbl.col32,tbl.col33,emaj_verb FROM consolidated tbl WHERE NOT EXISTS (SELECT 0 FROM unchanged_keys keys WHERE tbl.col31 = keys.col31) ORDER BY emaj_gid, emaj_tuple DESC;
 -- Dump changes for table myschema1.mytbl1 between marks "M4" and "M5" (0 changes)
 WITH keys AS ( SELECT col11,col12, min(emaj_gid) AS min_gid, max(emaj_gid) AS max_gid FROM emaj_myschema1.mytbl1_log WHERE emaj_gid > 12400014 AND emaj_gid <= 12400024 AND emaj_tuple IN ('OLD','NEW') GROUP BY col11,col12 ), consolidated AS ( SELECT tbl.* FROM emaj_myschema1.mytbl1_log tbl JOIN keys ON (tbl.col11 = keys.col11 AND tbl.col12 = keys.col12) WHERE (tbl.emaj_tuple = 'OLD' AND tbl.emaj_gid = keys.min_gid) OR (tbl.emaj_tuple = 'NEW' AND tbl.emaj_gid = keys.max_gid) ), unchanged_keys AS ( SELECT r1.col11,r1.col12 FROM consolidated r1 JOIN consolidated r2 ON (r1.col11=r2.col11 AND r1.col12=r2.col12) WHERE r1.emaj_tuple = 'OLD' AND r2.emaj_tuple = 'NEW' AND (r1.col13=r2.col13 OR (r1.col13 IS NULL AND r2.col13 IS NULL)) ) SELECT tbl.col11,tbl.col12,emaj_gid,emaj_tuple,tbl.col13,emaj_verb FROM consolidated tbl WHERE NOT EXISTS (SELECT 0 FROM unchanged_keys keys WHERE tbl.col11 = keys.col11 AND tbl.col12 = keys.col12) ORDER BY emaj_gid, emaj_tuple DESC;
 -- Dump changes for table myschema1.mytbl2 between marks "M4" and "M5" (0 changes)
 WITH keys AS ( SELECT col21, min(emaj_gid) AS min_gid, max(emaj_gid) AS max_gid FROM emaj_myschema1.mytbl2_log WHERE emaj_gid > 12400014 AND emaj_gid <= 12400024 AND emaj_tuple IN ('OLD','NEW') GROUP BY col21 ), consolidated AS ( SELECT tbl.* FROM emaj_myschema1.mytbl2_log tbl JOIN keys ON (tbl.col21 = keys.col21) WHERE (tbl.emaj_tuple = 'OLD' AND tbl.emaj_gid = keys.min_gid) OR (tbl.emaj_tuple = 'NEW' AND tbl.emaj_gid = keys.max_gid) ), unchanged_keys AS ( SELECT r1.col21 FROM consolidated r1 JOIN consolidated r2 ON (r1.col21=r2.col21) WHERE r1.emaj_tuple = 'OLD' AND r2.emaj_tuple = 'NEW' AND (r1.col22=r2.col22 OR (r1.col22 IS NULL AND r2.col22 IS NULL)) AND (r1.col23=r2.col23 OR (r1.col23 IS NULL AND r2.col23 IS NULL)) ) SELECT tbl.col21,emaj_gid,emaj_tuple,tbl.col22,tbl.col23,emaj_verb FROM consolidated tbl WHERE NOT EXISTS (SELECT 0 FROM unchanged_keys keys WHERE tbl.col21 = keys.col21) ORDER BY emaj_gid, emaj_tuple DESC;
 -- Dump changes for table myschema1.mytbl2b between marks "M4" and "M5" (0 changes)
 WITH keys AS ( SELECT col20, min(emaj_gid) AS min_gid, max(emaj_gid) AS max_gid FROM emaj_myschema1.mytbl2b_log WHERE emaj_gid > 12400014 AND emaj_gid <= 12400024 AND emaj_tuple IN ('OLD','NEW') GROUP BY col20 ), consolidated AS ( SELECT tbl.* FROM emaj_myschema1.mytbl2b_log tbl JOIN keys ON (tbl.col20 = keys.col20) WHERE (tbl.emaj_tuple = 'OLD' AND tbl.emaj_gid = keys.min_gid) OR (tbl.emaj_tuple = 'NEW' AND tbl.emaj_gid = keys.max_gid) ), unchanged_keys AS ( SELECT r1.col20 FROM consolidated r1 JOIN consolidated r2 ON (r1.col20=r2.col20) WHERE r1.emaj_tuple = 'OLD' AND r2.emaj_tuple = 'NEW' AND (r1.col21=r2.col21 OR (r1.col21 IS NULL AND r2.col21 IS NULL)) AND (r1.col22=r2.col22 OR (r1.col22 IS NULL AND r2.col22 IS NULL)) AND (r1.col23=r2.col23 OR (r1.col23 IS NULL AND r2.col23 IS NULL)) AND (r1.col24=r2.col24 OR (r1.col24 IS NULL AND r2.col24 IS NULL)) ) SELECT tbl.col20,emaj_gid,emaj_tuple,tbl.col21,tbl.col22,tbl.col23,tbl.col24,emaj_verb FROM consolidated tbl WHERE NOT EXISTS (SELECT 0 FROM unchanged_keys keys WHERE tbl.col20 = keys.col20) ORDER BY emaj_gid, emaj_tuple DESC;
 -- Dump changes for table myschema1.mytbl4 between marks "M4" and "M5" (0 changes)
 WITH keys AS ( SELECT col41,col43, min(emaj_gid) AS min_gid, max(emaj_gid) AS max_gid FROM emaj_myschema1.mytbl4_log WHERE emaj_gid > 12400014 AND emaj_gid <= 12400024 AND emaj_tuple IN ('OLD','NEW') GROUP BY col41,col43 ), consolidated AS ( SELECT tbl.* FROM emaj_myschema1.mytbl4_log tbl JOIN keys ON (tbl.col41 = keys.col41 AND tbl.col43 = keys.col43) WHERE (tbl.emaj_tuple = 'OLD' AND tbl.emaj_gid = keys.min_gid) OR (tbl.emaj_tuple = 'NEW' AND tbl.emaj_gid = keys.max_gid) ), unchanged_keys AS ( SELECT r1.col41,r1.col43 FROM consolidated r1 JOIN consolidated r2 ON (r1.col41=r2.col41 AND r1.col43=r2.col43) WHERE r1.emaj_tuple = 'OLD' AND r2.emaj_tuple = 'NEW' AND (r1.col42=r2.col42 OR (r1.col42 IS NULL AND r2.col42 IS NULL)) AND (r1.col44=r2.col44 OR (r1.col44 IS NULL AND r2.col44 IS NULL)) AND (r1.col45::text=r2.col45::text OR (r1.col45 IS NULL AND r2.col45 IS NULL)) ) SELECT tbl.col41,tbl.col43,emaj_gid,emaj_tuple,tbl.col42,tbl.col44,tbl.col45,emaj_verb FROM consolidated tbl WHERE NOT EXISTS (SELECT 0 FROM unchanged_keys keys WHERE tbl.col41 = keys.col41 AND tbl.col43 = keys.col43) ORDER BY emaj_gid, emaj_tuple DESC;
 RESET enable_nestloop;
(13 rows)

-- Create a table and a view from a consolidated vision of a log table
DO $$
DECLARE
  v_stmt TEXT;
BEGIN
  PERFORM emaj_gen_sql_dump_changes_group('myGroup1','M4','M5', 'CONSOLIDATION=FULL, EMAJ_COLUMNS=MIN', ARRAY['myschema1.myTbl3']);
  SELECT sql_text INTO v_stmt FROM emaj_temp_sql WHERE sql_schema = 'myschema1' and sql_tblseq = 'myTbl3' AND sql_line_number = 1;
  EXECUTE 'CREATE TABLE public.myTbl3_cons_log_table_M4_M5 AS ' || v_stmt;
  EXECUTE 'CREATE VIEW public.myTbl3_cons_log_view_M4_M5 AS ' || v_stmt;
END;
$$;
ERROR:  permission denied for schema public
CONTEXT:  SQL statement "CREATE TABLE public.myTbl3_cons_log_table_M4_M5 AS WITH keys AS ( SELECT col31, min(emaj_gid) AS min_gid, max(emaj_gid) AS max_gid FROM emaj_myschema1."myTbl3_log" WHERE emaj_gid > 12400014 AND emaj_gid <= 12400024 AND emaj_tuple IN ('OLD','NEW') GROUP BY col31 ), consolidated AS ( SELECT tbl.* FROM emaj_myschema1."myTbl3_log" tbl JOIN keys ON (tbl.col31 = keys.col31) WHERE (tbl.emaj_tuple = 'OLD' AND tbl.emaj_gid = keys.min_gid) OR (tbl.emaj_tuple = 'NEW' AND tbl.emaj_gid = keys.max_gid) ), unchanged_keys AS ( SELECT r1.col31 FROM consolidated r1 JOIN consolidated r2 ON (r1.col31=r2.col31) WHERE r1.emaj_tuple = 'OLD' AND r2.emaj_tuple = 'NEW' AND (r1.col32=r2.col32 OR (r1.col32 IS NULL AND r2.col32 IS NULL)) AND (r1.col33=r2.col33 OR (r1.col33 IS NULL AND r2.col33 IS NULL)) ) SELECT tbl.col31,emaj_tuple,tbl.col32,tbl.col33 FROM consolidated tbl WHERE NOT EXISTS (SELECT 0 FROM unchanged_keys keys WHERE tbl.col31 = keys.col31) ORDER BY tbl.col31, emaj_gid, emaj_tuple DESC;"
PL/pgSQL function inline_code_block line 7 at EXECUTE
SELECT emaj_tuple, col33 FROM public.myTbl3_cons_log_table_M4_M5 WHERE col31 = 13 ORDER BY emaj_tuple DESC;
ERROR:  relation "public.mytbl3_cons_log_table_m4_m5" does not exist
LINE 1: SELECT emaj_tuple, col33 FROM public.myTbl3_cons_log_table_M...
                                      ^
SELECT emaj_tuple, col33 FROM public.myTbl3_cons_log_view_M4_M5 WHERE col31 = 13;   -- already sorted
ERROR:  relation "public.mytbl3_cons_log_view_m4_m5" does not exist
LINE 1: SELECT emaj_tuple, col33 FROM public.myTbl3_cons_log_view_M4...
                                      ^
DROP TABLE IF EXISTS public.myTbl3_cons_log_table_M4_M5;
NOTICE:  table "mytbl3_cons_log_table_m4_m5" does not exist, skipping
DROP VIEW IF EXISTS public.myTbl3_cons_log_view_M4_M5;
NOTICE:  view "mytbl3_cons_log_view_m4_m5" does not exist, skipping
\! rm $EMAJTESTTMPDIR/*
-----------------------------
-- Step 21 : test TRUNCATE (log, statistics, rollback, sql generation and replay)
-----------------------------
SET client_min_messages TO WARNING;
select emaj_create_group('truncateTestGroup');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj_assign_tables('phil''s schema"3','.*','','truncateTestGroup');
 emaj_assign_tables 
--------------------
                  3
(1 row)

select emaj_assign_tables('myschema4','.*','','truncateTestGroup');
WARNING:  _assign_tables: Some partitionned tables (mypartp1, mytblp) are not selected.
WARNING:  _create_tbl: The table "myschema4.mypartp3" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
WARNING:  _create_tbl: The table "myschema4.mytblm" has triggers that will be automatically disabled during E-Maj rollback operations (mytblm_insert_trigger). Use the emaj_modify_table() function to change this behaviour.
WARNING:  _create_tbl: The table "myschema4.mypartp2" has triggers that will be automatically disabled during E-Maj rollback operations (z_min_update). Use the emaj_modify_table() function to change this behaviour.
 emaj_assign_tables 
--------------------
                  7
(1 row)

RESET client_min_messages;
select emaj_start_group('truncateTestGroup','M1');
 emaj_start_group 
------------------
               10
(1 row)

reset role;
truncate "phil's schema""3"."phil's tbl1" cascade;
NOTICE:  truncate cascades to table "my"tbl4"
NOTICE:  truncate cascades to table "myTbl2\"
truncate myschema4.myTblC2;
truncate myschema4.myPartP3;
select count(*) from "phil's schema""3"."phil's tbl1";
 count 
-------
     0
(1 row)

set role emaj_regression_tests_adm_user2;
select count(*) from "emaj_phil's schema""3"."phil's tbl1_log";
 count 
-------
    20
(1 row)

select is_called, last_value from "emaj_phil's schema""3"."phil's tbl1_log_seq";
 is_called | last_value 
-----------+------------
 t         |         19
(1 row)

select emaj_set_mark_group('truncateTestGroup','M2');
 emaj_set_mark_group 
---------------------
                  10
(1 row)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_role, stat_verb, stat_rows
  from emaj_detailed_log_stat_group('truncateTestGroup','M1',null);
    stat_group     |   stat_schema   | stat_table  | stat_first_mark | stat_last_mark | stat_role | stat_verb | stat_rows 
-------------------+-----------------+-------------+-----------------+----------------+-----------+-----------+-----------
 truncateTestGroup | myschema4       | mytblc2     | M1              |                | postgres  | TRUNCATE  |         6
 truncateTestGroup | phil's schema"3 | my"tbl4     | M1              |                | postgres  | TRUNCATE  |         8
 truncateTestGroup | phil's schema"3 | myTbl2\     | M1              |                | postgres  | TRUNCATE  |         6
 truncateTestGroup | phil's schema"3 | phil's tbl1 | M1              |                | postgres  | TRUNCATE  |        19
(4 rows)

SELECT emaj_dump_changes_group('truncateTestGroup', 'M1', 'M2', 'CONSOLIDATION=NONE, EMAJ_COLUMNS=MIN', '{"myschema4.mypartp3"}', :'EMAJTESTTMPDIR');
            emaj_dump_changes_group             
------------------------------------------------
 2 files have been created in /tmp/emaj_16/adm3
(1 row)

\! cat $EMAJTESTTMPDIR/myschema4_mypartp3.changes
SELECT emaj_dump_changes_group('truncateTestGroup', 'M1', 'M2', 'CONSOLIDATION=PARTIAL', '{"myschema4.mypartp3"}', :'EMAJTESTTMPDIR');
NOTICE:  table "emaj_temp_sql" does not exist, skipping
            emaj_dump_changes_group             
------------------------------------------------
 2 files have been created in /tmp/emaj_16/adm3
(1 row)

\! cat $EMAJTESTTMPDIR/myschema4_mypartp3.changes
\! rm $EMAJTESTTMPDIR/*
select * from emaj_logged_rollback_group('truncateTestGroup','M1', false);
 rlbk_severity |             rlbk_message             
---------------+--------------------------------------
 Notice        | Rollback id = 18000.
 Notice        | 4 / 10 tables effectively processed.
(2 rows)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_role, stat_verb, stat_rows
  from emaj_detailed_log_stat_group('truncateTestGroup','M1',null);
    stat_group     |   stat_schema   | stat_table  | stat_first_mark | stat_last_mark | stat_role | stat_verb | stat_rows 
-------------------+-----------------+-------------+-----------------+----------------+-----------+-----------+-----------
 truncateTestGroup | myschema4       | mytblc2     | M1              |                | postgres  | INSERT    |         6
 truncateTestGroup | myschema4       | mytblc2     | M1              |                | postgres  | TRUNCATE  |         6
 truncateTestGroup | phil's schema"3 | my"tbl4     | M1              |                | postgres  | INSERT    |         8
 truncateTestGroup | phil's schema"3 | my"tbl4     | M1              |                | postgres  | TRUNCATE  |         8
 truncateTestGroup | phil's schema"3 | myTbl2\     | M1              |                | postgres  | INSERT    |         6
 truncateTestGroup | phil's schema"3 | myTbl2\     | M1              |                | postgres  | TRUNCATE  |         6
 truncateTestGroup | phil's schema"3 | phil's tbl1 | M1              |                | postgres  | INSERT    |        19
 truncateTestGroup | phil's schema"3 | phil's tbl1 | M1              |                | postgres  | TRUNCATE  |        19
(8 rows)

select emaj_gen_sql_group('truncateTestGroup','M1','M2',:'EMAJTESTTMPDIR' || '/gensql.sql');
NOTICE:  table "emaj_temp_script" does not exist, skipping
 emaj_gen_sql_group 
--------------------
                  4
(1 row)

-- TODO: replace the previous statement by the next one, once the issue with the emaj_logged_rollback_group() and emaj_gen_sql_groups() functions will be fixed
--select emaj_gen_sql_group('truncateTestGroup','M1',null,:'EMAJTESTTMPDIR' || '/gensql.sql');
select * from emaj_rollback_group('truncateTestGroup','M1', false);
 rlbk_severity |             rlbk_message             
---------------+--------------------------------------
 Notice        | Rollback id = 18001.
 Notice        | 4 / 10 tables effectively processed.
(2 rows)

\! sed -i -s 's/at .*$/at [ts]$/' $EMAJTESTTMPDIR/gensql.sql
\! sed -i -s 's/\\\\/\\/g' $EMAJTESTTMPDIR/gensql.sql
\! sed -i -s 's/^COMMIT/ROLLBACK/' $EMAJTESTTMPDIR/gensql.sql
\set FILE1 :EMAJTESTTMPDIR '/gensql.sql'
reset role;
\i :FILE1
-- SQL script generated by E-Maj at [ts]$
--    for tables group(s): truncateTestGroup
--    processing logs between mark M1 and mark M2
SET standard_conforming_strings = OFF;
SET escape_string_warning = OFF;
SET datestyle = 'ISO, YMD';
BEGIN TRANSACTION;
TRUNCATE ONLY "phil's schema""3"."phil's tbl1" CASCADE;
psql:/tmp/emaj_16/adm3/gensql.sql:8: NOTICE:  truncate cascades to table "my"tbl4"
psql:/tmp/emaj_16/adm3/gensql.sql:8: NOTICE:  truncate cascades to table "myTbl2\"
TRUNCATE ONLY "phil's schema""3"."my""tbl4" CASCADE;
psql:/tmp/emaj_16/adm3/gensql.sql:9: NOTICE:  truncate cascades to table "myTbl2\"
TRUNCATE ONLY "phil's schema""3"."myTbl2\" CASCADE;
TRUNCATE ONLY myschema4.mytblc2 CASCADE;
ROLLBACK;
RESET standard_conforming_strings;
RESET escape_string_warning;
RESET datestyle;
\! rm $EMAJTESTTMPDIR/*
set role emaj_regression_tests_adm_user2;
select emaj_stop_group('truncateTestGroup');
 emaj_stop_group 
-----------------
              10
(1 row)

select emaj_drop_group('truncateTestGroup');
 emaj_drop_group 
-----------------
              10
(1 row)

-- first set all rollback events state
select emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           0
(1 row)

-----------------------------
-- Checking step 21
-----------------------------
-- emaj tables
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, rlbk_nb_session, rlbk_nb_table,
       rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_status, rlbk_begin_hist_id, rlbk_dblink_schema, rlbk_is_dblink_used,
       case when rlbk_end_datetime is null then 'null' else '[ts]' end as "end_datetime",
       regexp_replace(array_to_string(rlbk_messages,'#'),E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rlbk where rlbk_id >= 10000 order by rlbk_id;
 rlbk_id |          rlbk_groups          |       rlbk_mark       | rlbk_time_id | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_eff_nb_sequence | rlbk_status | rlbk_begin_hist_id | rlbk_dblink_schema | rlbk_is_dblink_used | end_datetime |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      regexp_replace                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
---------+-------------------------------+-----------------------+--------------+----------------+-----------------------------+-----------------+---------------+------------------+-------------------+----------------------+-------------+--------------------+--------------------+---------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   10000 | {myGroup1}                    | before move           |        10007 | f              | t                           |               1 |             6 |                3 |                 0 |                    0 | ABORTED     |              10057 | public             | t                   | [ts]         | Notice: Rollback id = 10000.#Notice: 0 / 6 tables effectively processed.#Notice: 0 / 3 sequences effectively processed.#Warning: The table myschema2."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence myschema2."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
   10001 | {myGroup2}                    | before move           |        10008 | f              | t                           |               1 |             5 |                1 |                 0 |                    0 | ABORTED     |              10071 | public             | t                   | [ts]         | Notice: Rollback id = 10001.#Notice: 0 / 5 tables effectively processed.#Notice: 0 / 1 sequences effectively processed.#Warning: The table myschema2."myTbl3" has been left unchanged (not in group anymore since <timestamp>)#Warning: The sequence myschema2."myTbl3_col31_seq" has been left unchanged (not in group anymore since <timestamp>)
   10002 | {myGroup1,myGroup2}           | after move            |        10011 | t              | f                           |               1 |            11 |                4 |                 1 |                    0 | COMMITTED   |              10104 | public             | t                   | [ts]         | Notice: Rollback id = 10002.#Notice: 1 / 11 tables effectively processed.#Notice: 0 / 4 sequences effectively processed.
   10003 | {myGroup1,myGroup2}           | before move           |        10013 | f              | t                           |               1 |            11 |                4 |                 1 |                    0 | COMMITTED   |              10121 | public             | t                   | [ts]         | Notice: Rollback id = 10003.#Notice: 1 / 11 tables effectively processed.#Notice: 0 / 4 sequences effectively processed.#Warning: The table myschema2."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence myschema2."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)#Warning: Tables group change not rolled back: log data tablespace for myschema2."myTbl3"#Warning: Tables group change not rolled back: log index tablespace for myschema2."myTbl3"#Warning: Tables group change not rolled back: E-Maj priority for myschema2."myTbl3"
   10005 | {myGroup1}                    | Assign_mytbl4         |        10032 | f              | f                           |               1 |             5 |                2 |                 3 |                    1 | COMMITTED   |              10317 | public             | t                   | [ts]         | Notice: Rollback id = 10005.#Notice: 3 / 5 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   12300 | {myGroup2}                    | M2                    |        12300 | t              | f                           |               1 |             6 |                2 |                 3 |                    1 | COMMITTED   |              12300 |                    | f                   | [ts]         | Notice: Rollback id = 12300.#Notice: 3 / 6 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   12301 | {myGroup2}                    | M3                    |        12302 | t              | f                           |               1 |             6 |                2 |                 3 |                    1 | COMMITTED   |              12321 |                    | f                   | [ts]         | Notice: Rollback id = 12301.#Notice: 3 / 6 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   12400 | {myGroup1}                    | M2                    |        12400 | f              | f                           |               1 |             5 |                2 |                 2 |                    0 | COMMITTED   |              12400 | public             | t                   | [ts]         | Notice: Rollback id = 12400.#Notice: 2 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   12500 | {myGroup2}                    | M2                    |        12500 | t              | f                           |               1 |             6 |                2 |                 3 |                    1 | COMMITTED   |              12500 | public             | t                   | [ts]         | Notice: Rollback id = 12500.#Notice: 3 / 6 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   12501 | {myGroup2}                    | M3                    |        12502 | f              | f                           |               1 |             6 |                2 |                 3 |                    1 | COMMITTED   |              12522 | public             | t                   | [ts]         | Notice: Rollback id = 12501.#Notice: 3 / 6 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   12600 | {myGroup1}                    | M5                    |        12600 | f              | f                           |               1 |             5 |                2 |                 2 |                    0 | COMMITTED   |              12600 | public             | t                   | [ts]         | Notice: Rollback id = 12600.#Notice: 2 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   12601 | {myGroup1}                    | M4                    |        12601 | t              | t                           |               1 |             5 |                2 |                 3 |                    0 | COMMITTED   |              12615 | public             | t                   | [ts]         | Notice: Rollback id = 12601.#Notice: 3 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14000 | {myGroup1,myGroup2}           | Multi-1               |        14003 | t              | f                           |               1 |            11 |                4 |                 0 |                    0 | COMMITTED   |              14025 | public             | t                   | [ts]         | Notice: Rollback id = 14000.#Notice: 0 / 11 tables effectively processed.#Notice: 0 / 4 sequences effectively processed.
   14001 | {myGroup1,myGroup2}           | Multi-2               |        14005 | f              | f                           |               1 |            11 |                4 |                 0 |                    0 | COMMITTED   |              14040 | public             | t                   | [ts]         | Notice: Rollback id = 14001.#Notice: 0 / 11 tables effectively processed.#Notice: 0 / 4 sequences effectively processed.
   14002 | {myGroup1,myGroup2}           | Multi-1               |        14006 | f              | f                           |               1 |            11 |                4 |                 0 |                    0 | COMMITTED   |              14054 | public             | t                   | [ts]         | Notice: Rollback id = 14002.#Notice: 0 / 11 tables effectively processed.#Notice: 0 / 4 sequences effectively processed.
   14003 | {myGroup2}                    | Multi-2               |        14011 | f              | f                           |               1 |             6 |                2 |                 0 |                    0 | COMMITTED   |              14092 | public             | t                   | [ts]         | Notice: Rollback id = 14003.#Notice: 0 / 6 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14200 | {"phil's group#3\","}         | phil's mark #3        |        14207 | t              | f                           |               1 |             2 |                2 |                 0 |                    0 | COMMITTED   |              14241 | public             | t                   | [ts]         | Notice: Rollback id = 14200.#Notice: 0 / 2 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14201 | {"phil's group#3\","}         | phil's mark #3        |        14209 | f              | f                           |               1 |             2 |                2 |                 0 |                    0 | COMMITTED   |              14256 | public             | t                   | [ts]         | Notice: Rollback id = 14201.#Notice: 0 / 2 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14300 | {myGroup1}                    | Multi-1               |        14300 | f              | f                           |               1 |             5 |                2 |                 1 |                    0 | COMMITTED   |              14300 | public             | t                   | [ts]         | Notice: Rollback id = 14300.#Notice: 1 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14400 | {myGroup1}                    | Multi-1               |        14400 | f              | f                           |               1 |             5 |                2 |                 1 |                    1 | ABORTED     |              14414 | public             | t                   | [ts]         | Notice: Rollback id = 14400.#Notice: 1 / 5 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14401 | {myGroup2}                    | Multi-1               |        14401 | f              | f                           |               1 |             6 |                2 |                 4 |                    1 | ABORTED     |              14427 | public             | t                   | [ts]         | Notice: Rollback id = 14401.#Notice: 4 / 6 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14402 | {"phil's group#3\","}         | M1_rollbackable       |        14402 | f              | f                           |               1 |             2 |                2 |                 2 |                    1 | ABORTED     |              14446 | public             | t                   | [ts]         | Notice: Rollback id = 14402.#Notice: 2 / 2 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14500 | {"phil's group#3\","}         | M1_after_table_rename |        14505 | f              | f                           |               1 |             2 |                2 |                 1 |                    0 | COMMITTED   |              14533 | public             | t                   | [ts]         | Notice: Rollback id = 14500.#Notice: 1 / 2 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14700 | {myGroup1}                    | MC1                   |        14703 | t              | f                           |               1 |             5 |                2 |                 3 |                    1 | COMMITTED   |              14718 | public             | t                   | [ts]         | Notice: Rollback id = 14700.#Notice: 3 / 5 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14701 | {myGroup1}                    | MC3                   |        14708 | t              | f                           |               1 |             5 |                2 |                 2 |                    1 | COMMITTED   |              14758 | public             | t                   | [ts]         | Notice: Rollback id = 14701.#Notice: 2 / 5 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14702 | {myGroup1}                    | MC8                   |        14713 | t              | f                           |               1 |             5 |                2 |                 2 |                    1 | COMMITTED   |              14798 | public             | t                   | [ts]         | Notice: Rollback id = 14702.#Notice: 2 / 5 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14703 | {myGroup1}                    | MC6                   |        14716 | t              | f                           |               1 |             5 |                2 |                 5 |                    2 | COMMITTED   |              14826 | public             | t                   | [ts]         | Notice: Rollback id = 14703.#Notice: 5 / 5 tables effectively processed.#Notice: 2 / 2 sequences effectively processed.
   14704 | {myGroup1}                    | MC10                  |        14719 | t              | f                           |               1 |             5 |                2 |                 1 |                    0 | COMMITTED   |              14861 | public             | t                   | [ts]         | Notice: Rollback id = 14704.#Notice: 1 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14705 | {myGroup1}                    | MC10                  |        14722 | t              | f                           |               1 |             5 |                2 |                 2 |                    0 | COMMITTED   |              14884 | public             | t                   | [ts]         | Notice: Rollback id = 14705.#Notice: 2 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14706 | {myGroup1}                    | MC15                  |        14726 | t              | f                           |               1 |             5 |                2 |                 3 |                    1 | COMMITTED   |              14916 | public             | t                   | [ts]         | Notice: Rollback id = 14706.#Notice: 3 / 5 tables effectively processed.#Notice: 1 / 2 sequences effectively processed.
   14707 | {myGroup1}                    | MC16                  |        14729 | t              | f                           |               1 |             5 |                2 |                 3 |                    0 | COMMITTED   |              14946 | public             | t                   | [ts]         | Notice: Rollback id = 14707.#Notice: 3 / 5 tables effectively processed.#Notice: 0 / 2 sequences effectively processed.
   14708 | {myGroup1}                    | Multi-1               |        14731 | f              | t                           |               1 |             5 |                2 |                 3 |                    2 | COMMITTED   |              14969 | public             | t                   | [ts]         | Notice: Rollback id = 14708.#Notice: 3 / 5 tables effectively processed.#Notice: 2 / 2 sequences effectively processed.#Warning: Tables group change not rolled back: ignored triggers list for myschema1.mytbl2
   17200 | {myGroup4}                    | Start                 |        17206 | f              | t                           |               1 |             7 |                0 |                 3 |                    0 | COMMITTED   |              17247 | public             | t                   | [ts]         | Notice: Rollback id = 17200.#Notice: 3 / 7 tables effectively processed.#Warning: The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mypartp1a has been left unchanged (not in group anymore since <timestamp>)#Warning: The table myschema4.mypartp1b has been left unchanged (not in group anymore since <timestamp>)#Warning: The sequence myschema4.mytblp_col4_seq has been left unchanged (not in group anymore since <timestamp>)
   17600 | {grp_tmp,grp_tmp_3,grp_tmp_4} | Mk3                   |        17613 | f              | f                           |               1 |            10 |                4 |                 2 |                    0 | COMMITTED   |              17682 | public             | t                   | [ts]         | Notice: Rollback id = 17600.#Notice: 2 / 10 tables effectively processed.#Notice: 0 / 4 sequences effectively processed.
   17601 | {grp_tmp,grp_tmp_3,grp_tmp_4} | Mk5                   |        17624 | t              | t                           |               1 |             9 |                3 |                 2 |                    0 | COMMITTED   |              17779 | public             | t                   | [ts]         | Notice: Rollback id = 17601.#Notice: 2 / 9 tables effectively processed.#Notice: 0 / 3 sequences effectively processed.#Warning: The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)#Warning: The sequence "phil's schema""3"."phil's""seq\1" has been left unchanged (not in group anymore since <timestamp>)
   17602 | {grp_tmp,grp_tmp_3,grp_tmp_4} | Mk3                   |        17628 | f              | t                           |               1 |             9 |                3 |                 3 |                    0 | COMMITTED   |              17825 | public             | t                   | [ts]         | Notice: Rollback id = 17602.#Notice: 3 / 9 tables effectively processed.#Notice: 0 / 3 sequences effectively processed.#Warning: The table "phil's schema""3"."my""tbl4" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table "phil's schema""3"."myTbl2\" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table "phil's schema""3"."phil's tbl1" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence "phil's schema""3"."myTbl2\_col21_seq" has only been rolled back to its latest group attachment state (<timestamp>)#Warning: The table myschema4.mypartp2 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblc2 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblm has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblr1 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblr2 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence myschema4.mytblp_col4_seq has only been rolled back to its latest group attachment state (<timestamp>)#Warning: The sequence myschema4.mytblr2_col1_seq has only been rolled back to its latest group attachment state (<timestamp>)#Warning: The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)#Warning: The sequence "phil's schema""3"."phil's""seq\1" has been left unchanged (not in group anymore since <timestamp>)#Warning: Tables group change not rolled back: log data tablespace for "phil's schema""3"."phil's tbl1"#Warning: Tables group change not rolled back: E-Maj priority for "phil's schema""3"."phil's tbl1"
   18000 | {truncateTestGroup}           | M1                    |        18005 | t              | f                           |               1 |            10 |                0 |                 4 |                    0 | COMMITTED   |              18041 | public             | t                   | [ts]         | Notice: Rollback id = 18000.#Notice: 4 / 10 tables effectively processed.
   18001 | {truncateTestGroup}           | M1                    |        18007 | f              | f                           |               1 |            10 |                0 |                 4 |                    0 | COMMITTED   |              18065 | public             | t                   | [ts]         | Notice: Rollback id = 18001.#Notice: 4 / 10 tables effectively processed.
(38 rows)

select rlbs_rlbk_id, rlbs_session, 
       case when rlbs_end_datetime is null then 'null' else '[ts]' end as "end_datetime"
  from emaj.emaj_rlbk_session where rlbs_rlbk_id >= 10000  order by rlbs_rlbk_id, rlbs_session;
 rlbs_rlbk_id | rlbs_session | end_datetime 
--------------+--------------+--------------
        12300 |            1 | [ts]
        12301 |            1 | [ts]
        12400 |            1 | [ts]
        12500 |            1 | [ts]
        12501 |            1 | [ts]
        12600 |            1 | [ts]
        12601 |            1 | [ts]
        14000 |            1 | [ts]
        14001 |            1 | [ts]
        14002 |            1 | [ts]
        14003 |            1 | [ts]
        14200 |            1 | [ts]
        14201 |            1 | [ts]
        14300 |            1 | [ts]
        14400 |            1 | [ts]
        14401 |            1 | [ts]
        14402 |            1 | [ts]
        14500 |            1 | [ts]
        14700 |            1 | [ts]
        14701 |            1 | [ts]
        14702 |            1 | [ts]
        14703 |            1 | [ts]
        14704 |            1 | [ts]
        14705 |            1 | [ts]
        14706 |            1 | [ts]
        14707 |            1 | [ts]
        14708 |            1 | [ts]
        17200 |            1 | [ts]
        17600 |            1 | [ts]
        17601 |            1 | [ts]
        17602 |            1 | [ts]
        18000 |            1 | [ts]
        18001 |            1 | [ts]
(33 rows)

select rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object, rlbp_target_time_id, rlbp_batch_number, rlbp_session,
       rlbp_object_def, rlbp_app_trg_type, rlbp_is_repl_role_replica, rlbp_estimated_quantity, rlbp_estimate_method, rlbp_quantity
  from emaj.emaj_rlbk_plan where rlbp_rlbk_id >= 10000  order by rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object;
 rlbp_rlbk_id |     rlbp_step      |   rlbp_schema   |                           rlbp_table                            |    rlbp_object     | rlbp_target_time_id | rlbp_batch_number | rlbp_session |                                                                                        rlbp_object_def                                                                                        | rlbp_app_trg_type | rlbp_is_repl_role_replica | rlbp_estimated_quantity | rlbp_estimate_method | rlbp_quantity 
--------------+--------------------+-----------------+-----------------------------------------------------------------+--------------------+---------------------+-------------------+--------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------+---------------------------+-------------------------+----------------------+---------------
        12300 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    3 |             2
        12300 | SET_FK_DEF         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        12300 | SET_FK_DEF         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        12300 | RLBK_TABLE         | myschema2       | mytbl4                                                          |                    |               12200 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                       4 |                    3 |             2
        12300 | RLBK_TABLE         | myschema2       | mytbl5                                                          |                    |               12200 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       1 |                    3 |             1
        12300 | RLBK_TABLE         | myschema2       | mytbl6                                                          |                    |               12200 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                       3 |                    3 |             3
        12300 | SET_FK_IMM         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |              
        12300 | SET_FK_IMM         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |              
        12300 | CTRL-DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       8 |                    3 |              
        12301 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        12301 | SET_FK_DEF         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12301 | SET_FK_DEF         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12301 | RLBK_TABLE         | myschema2       | mytbl4                                                          |                    |               12201 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             2
        12301 | RLBK_TABLE         | myschema2       | mytbl5                                                          |                    |               12201 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       1 |                    1 |             1
        12301 | RLBK_TABLE         | myschema2       | mytbl6                                                          |                    |               12201 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       3 |                    1 |             3
        12301 | SET_FK_IMM         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |              
        12301 | SET_FK_IMM         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |              
        12301 | CTRL-DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       8 |                    2 |              
        12400 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        12400 | DIS_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        12400 | DIS_LOG_TRG        | myschema1       | mytbl4                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        12400 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               12100 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       3 |                    3 |             5
        12400 | RLBK_TABLE         | myschema1       | mytbl4                                                          |                    |               12100 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                       8 |                    3 |             5
        12400 | DELETE_LOG         | myschema1       | mytbl1                                                          |                    |               12100 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |             5
        12400 | DELETE_LOG         | myschema1       | mytbl4                                                          |                    |               12100 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       8 |                    3 |            12
        12400 | ENA_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        12400 | ENA_LOG_TRG        | myschema1       | mytbl4                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        12400 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       9 |                    3 |              
        12500 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        12500 | SET_FK_DEF         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12500 | SET_FK_DEF         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12500 | RLBK_TABLE         | myschema2       | mytbl4                                                          |                    |               12200 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       8 |                    1 |             2
        12500 | RLBK_TABLE         | myschema2       | mytbl5                                                          |                    |               12200 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       3 |                    1 |             1
        12500 | RLBK_TABLE         | myschema2       | mytbl6                                                          |                    |               12200 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       9 |                    1 |             3
        12500 | SET_FK_IMM         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       9 |                    3 |              
        12500 | SET_FK_IMM         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       9 |                    3 |              
        12500 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       8 |                    2 |              
        12501 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        12501 | DIS_LOG_TRG        | myschema2       | mytbl4                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | DIS_LOG_TRG        | myschema2       | mytbl5                                                          |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | DIS_LOG_TRG        | myschema2       | mytbl6                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | SET_FK_DEF         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | SET_FK_DEF         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | RLBK_TABLE         | myschema2       | mytbl4                                                          |                    |               12201 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       6 |                    1 |             2
        12501 | RLBK_TABLE         | myschema2       | mytbl5                                                          |                    |               12201 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       3 |                    1 |             1
        12501 | RLBK_TABLE         | myschema2       | mytbl6                                                          |                    |               12201 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       9 |                    1 |             3
        12501 | DELETE_LOG         | myschema2       | mytbl4                                                          |                    |               12201 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       6 |                    3 |             6
        12501 | DELETE_LOG         | myschema2       | mytbl5                                                          |                    |               12201 |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |             3
        12501 | DELETE_LOG         | myschema2       | mytbl6                                                          |                    |               12201 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       9 |                    3 |             9
        12501 | SET_FK_IMM         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       9 |                    2 |              
        12501 | SET_FK_IMM         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       9 |                    3 |              
        12501 | ENA_LOG_TRG        | myschema2       | mytbl4                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | ENA_LOG_TRG        | myschema2       | mytbl5                                                          |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | ENA_LOG_TRG        | myschema2       | mytbl6                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12501 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      17 |                    2 |              
        12600 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        12600 | DIS_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12600 | DIS_LOG_TRG        | myschema1       | mytbl4                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12600 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               12402 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       1 |                    1 |             1
        12600 | RLBK_TABLE         | myschema1       | mytbl4                                                          |                    |               12402 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             2
        12600 | DELETE_LOG         | myschema1       | mytbl1                                                          |                    |               12402 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       1 |                    1 |             1
        12600 | DELETE_LOG         | myschema1       | mytbl4                                                          |                    |               12402 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    1 |             2
        12600 | ENA_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12600 | ENA_LOG_TRG        | myschema1       | mytbl4                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        12600 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       9 |                    2 |              
        12601 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        12601 | RLBK_TABLE         | myschema1       | myTbl3                                                          |                    |               12401 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                      10 |                    3 |            10
        12601 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               12401 |                 4 |            1 |                                                                                                                                                                                               |                   | t                         |                       1 |                    1 |             1
        12601 | RLBK_TABLE         | myschema1       | mytbl4                                                          |                    |               12401 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             2
        12601 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       4 |                    2 |              
        14000 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    2 |             4
        14000 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       1 |                    2 |              
        14001 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    2 |             4
        14001 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       1 |                    2 |              
        14002 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    2 |             4
        14002 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       1 |                    2 |              
        14003 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14003 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       1 |                    2 |              
        14200 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14200 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       1 |                    2 |              
        14201 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14201 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       1 |                    2 |              
        14300 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14300 | DIS_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14300 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      20 |                    1 |             0
        14300 | DELETE_LOG         | myschema1       | mytbl1                                                          |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      20 |                    1 |             0
        14300 | ENA_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14300 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       5 |                    2 |              
        14400 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14400 | DIS_LOG_TRG        | myschema1       | mytbl2b                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14400 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       5 |                    3 |             2
        14400 | DELETE_LOG         | myschema1       | mytbl2b                                                         |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       5 |                    3 |             6
        14400 | ENA_LOG_TRG        | myschema1       | mytbl2b                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14400 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       5 |                    2 |              
        14401 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14401 | DIS_LOG_TRG        | myschema2       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2       | mytbl2                                                          |                    |                     |                 5 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2       | mytbl5                                                          |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2       | mytbl6                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | SET_FK_DEF         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | SET_FK_DEF         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | RLBK_TABLE         | myschema2       | mytbl1                                                          |                    |               14009 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       3 |                    3 |             2
        14401 | RLBK_TABLE         | myschema2       | mytbl2                                                          |                    |               14009 |                 5 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    3 |             2
        14401 | RLBK_TABLE         | myschema2       | mytbl5                                                          |                    |               14009 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       3 |                    1 |             2
        14401 | RLBK_TABLE         | myschema2       | mytbl6                                                          |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                      17 |                    1 |            14
        14401 | DELETE_LOG         | myschema2       | mytbl1                                                          |                    |               14009 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |             4
        14401 | DELETE_LOG         | myschema2       | mytbl2                                                          |                    |               14009 |                 5 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    3 |             2
        14401 | DELETE_LOG         | myschema2       | mytbl5                                                          |                    |               14009 |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    1 |             4
        14401 | DELETE_LOG         | myschema2       | mytbl6                                                          |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      17 |                    1 |            26
        14401 | SET_FK_IMM         | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      17 |                    2 |              
        14401 | SET_FK_IMM         | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      17 |                    3 |              
        14401 | ENA_LOG_TRG        | myschema2       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | ENA_LOG_TRG        | myschema2       | mytbl2                                                          |                    |                     |                 5 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | ENA_LOG_TRG        | myschema2       | mytbl5                                                          |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | ENA_LOG_TRG        | myschema2       | mytbl6                                                          |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14401 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      21 |                    2 |              
        14402 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14402 | DIS_LOG_TRG        | phil's schema"3 | myTbl2\                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14402 | DIS_LOG_TRG        | phil's schema"3 | phil's tbl1                                                     |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14402 | DROP_FK            | phil's schema"3 | my"tbl4                                                         | my"tbl4_col44_fkey |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14402 | DROP_FK            | phil's schema"3 | myTbl2\                                                         | mytbl2_col21_fkey  |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14402 | RLBK_TABLE         | phil's schema"3 | myTbl2\                                                         |                    |               14203 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                       2 |                    3 |             2
        14402 | RLBK_TABLE         | phil's schema"3 | phil's tbl1                                                     |                    |               14203 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                      53 |                    3 |            33
        14402 | DELETE_LOG         | phil's schema"3 | myTbl2\                                                         |                    |               14203 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    3 |             2
        14402 | DELETE_LOG         | phil's schema"3 | phil's tbl1                                                     |                    |               14203 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      53 |                    3 |            63
        14402 | ADD_FK             | phil's schema"3 | my"tbl4                                                         | my"tbl4_col44_fkey |                     |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES "phil's schema""3"."phil's tbl1"("phil's col11", "phil's col12") ON UPDATE SET NULL ON DELETE CASCADE                                                   |                   |                           |                       0 |                    3 |              
        14402 | ADD_FK             | phil's schema"3 | myTbl2\                                                         | mytbl2_col21_fkey  |                     |                 3 |            1 | FOREIGN KEY (col21) REFERENCES "phil's schema""3"."my""tbl4"(col41)                                                                                                                           |                   |                           |                       0 |                    3 |              
        14402 | ENA_LOG_TRG        | phil's schema"3 | myTbl2\                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14402 | ENA_LOG_TRG        | phil's schema"3 | phil's tbl1                                                     |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14402 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      13 |                    2 |              
        14500 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14500 | DIS_LOG_TRG        | phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14500 | DROP_FK            | phil's schema"3 | my"tbl4                                                         | my"tbl4_col44_fkey |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14500 | RLBK_TABLE         | phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                    |               14503 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       6 |                    3 |            10
        14500 | DELETE_LOG         | phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                    |               14503 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       6 |                    3 |            10
        14500 | ADD_FK             | phil's schema"3 | my"tbl4                                                         | my"tbl4_col44_fkey |                     |                 2 |            1 | FOREIGN KEY (col44, col45) REFERENCES "phil's schema""3".table_with_very_looooooooooooooooooooooooooooooooooooooong_name("phil's col11", "phil's col12") ON UPDATE SET NULL ON DELETE CASCADE |                   |                           |                       0 |                    3 |              
        14500 | ENA_LOG_TRG        | phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14500 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       7 |                    2 |              
        14700 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14700 | SET_ALWAYS_APP_TRG | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14700 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14701 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      15 |                    1 |            13
        14700 | RLBK_TABLE         | myschema1       | mytbl2                                                          |                    |               14701 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    3 |             1
        14700 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14701 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       2 |                    1 |             2
        14700 | SET_LOCAL_APP_TRG  | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14700 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       6 |                    2 |              
        14701 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14701 | RLBK_TABLE         | myschema1       | myTbl3                                                          |                    |               14705 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                      10 |                    1 |            10
        14701 | RLBK_TABLE         | myschema1       | mytbl4                                                          |                    |               14705 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             1
        14701 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       3 |                    2 |              
        14702 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14702 | SET_ALWAYS_APP_TRG | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14702 | RLBK_TABLE         | myschema1       | mytbl2                                                          |                    |               14712 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                       1 |                    1 |             1
        14702 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14712 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                       1 |                    1 |             1
        14702 | SET_LOCAL_APP_TRG  | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14702 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       5 |                    2 |              
        14703 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14703 | SET_ALWAYS_APP_TRG | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14703 | RLBK_TABLE         | myschema1       | myTbl3                                                          |                    |               14710 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                      10 |                    1 |            10
        14703 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14710 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      15 |                    1 |            13
        14703 | RLBK_TABLE         | myschema1       | mytbl2                                                          |                    |               14710 |                 4 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             1
        14703 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14710 |                 5 |            1 |                                                                                                                                                                                               |                   | f                         |                       2 |                    1 |             2
        14703 | RLBK_TABLE         | myschema1       | mytbl4                                                          |                    |               14710 |                 6 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             1
        14703 | SET_LOCAL_APP_TRG  | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14703 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       8 |                    2 |              
        14704 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14704 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14718 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      16 |                    1 |            11
        14704 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |              
        14705 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14705 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14718 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      22 |                    1 |            11
        14705 | RLBK_TABLE         | myschema1       | mytbl4                                                          |                    |               14718 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             1
        14705 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       3 |                    2 |              
        14706 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14706 | SET_ALWAYS_APP_TRG | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14706 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14724 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      15 |                    1 |            13
        14706 | RLBK_TABLE         | myschema1       | mytbl2                                                          |                    |               14724 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       2 |                    1 |             1
        14706 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14724 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       2 |                    1 |             2
        14706 | SET_LOCAL_APP_TRG  | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14706 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       6 |                    2 |              
        14707 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14707 | SET_ALWAYS_APP_TRG | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14707 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14725 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      11 |                    1 |            11
        14707 | RLBK_TABLE         | myschema1       | mytbl2                                                          |                    |               14725 |                 4 |            1 |                                                                                                                                                                                               |                   | t                         |                       3 |                    1 |             2
        14707 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14725 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                       4 |                    1 |             2
        14707 | SET_LOCAL_APP_TRG  | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14707 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       6 |                    2 |              
        14708 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       2 |                    2 |             2
        14708 | SET_ALWAYS_APP_TRG | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14708 | DIS_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14708 | DIS_LOG_TRG        | myschema1       | mytbl2                                                          |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14708 | DIS_LOG_TRG        | myschema1       | mytbl2b                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14708 | RLBK_TABLE         | myschema1       | mytbl1                                                          |                    |               14009 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                      11 |                    1 |            11
        14708 | RLBK_TABLE         | myschema1       | mytbl2                                                          |                    |               14009 |                 4 |            1 |                                                                                                                                                                                               |                   | t                         |                       4 |                    1 |             3
        14708 | RLBK_TABLE         | myschema1       | mytbl2b                                                         |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                      14 |                    1 |             4
        14708 | DELETE_LOG         | myschema1       | mytbl1                                                          |                    |               14009 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                      11 |                    1 |            11
        14708 | DELETE_LOG         | myschema1       | mytbl2                                                          |                    |               14009 |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    3 |             4
        14708 | DELETE_LOG         | myschema1       | mytbl2b                                                         |                    |               14009 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      14 |                    1 |            10
        14708 | SET_LOCAL_APP_TRG  | myschema1       | mytbl2                                                          | mytbl2trg2         |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        14708 | ENA_LOG_TRG        | myschema1       | mytbl1                                                          |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14708 | ENA_LOG_TRG        | myschema1       | mytbl2                                                          |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14708 | ENA_LOG_TRG        | myschema1       | mytbl2b                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        14708 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      15 |                    2 |              
        17200 | DIS_APP_TRG        | myschema4       | mypartp3                                                        | z_min_update       |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        17200 | DIS_LOG_TRG        | myschema4       | mypartp2                                                        |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | DIS_LOG_TRG        | myschema4       | mypartp3                                                        |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | DIS_LOG_TRG        | myschema4       | mytblr1                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | SET_FK_DEF         | myschema4       | mypartp1                                                        | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | SET_FK_DEF         | myschema4       | mypartp2                                                        | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | SET_FK_DEF         | myschema4       | mypartp3                                                        | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | SET_FK_DEF         | myschema4       | mytblp                                                          | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | RLBK_TABLE         | myschema4       | mypartp2                                                        |                    |               17200 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                       4 |                    3 |             3
        17200 | RLBK_TABLE         | myschema4       | mypartp3                                                        |                    |               17202 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       1 |                    3 |             1
        17200 | RLBK_TABLE         | myschema4       | mytblr1                                                         |                    |               17200 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       6 |                    3 |             6
        17200 | DELETE_LOG         | myschema4       | mypartp2                                                        |                    |               17200 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    3 |             4
        17200 | DELETE_LOG         | myschema4       | mypartp3                                                        |                    |               17202 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       1 |                    3 |             1
        17200 | DELETE_LOG         | myschema4       | mytblr1                                                         |                    |               17200 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       6 |                    3 |             6
        17200 | SET_FK_IMM         | myschema4       | mypartp1                                                        | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       6 |                    3 |              
        17200 | SET_FK_IMM         | myschema4       | mypartp2                                                        | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      10 |                    3 |              
        17200 | SET_FK_IMM         | myschema4       | mypartp3                                                        | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       7 |                    3 |              
        17200 | SET_FK_IMM         | myschema4       | mytblp                                                          | mytblp_col1_fkey   |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       6 |                    3 |              
        17200 | ENA_APP_TRG        | myschema4       | mypartp3                                                        | z_min_update       |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    3 |              
        17200 | ENA_LOG_TRG        | myschema4       | mypartp2                                                        |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | ENA_LOG_TRG        | myschema4       | mypartp3                                                        |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | ENA_LOG_TRG        | myschema4       | mytblr1                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17200 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      22 |                    2 |              
        17600 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    2 |             4
        17600 | DIS_LOG_TRG        | myschema4       | mytblc1                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17600 | DIS_LOG_TRG        | myschema4       | mytblc2                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17600 | RLBK_TABLE         | myschema4       | mytblc1                                                         |                    |               17612 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                       1 |                    3 |             1
        17600 | RLBK_TABLE         | myschema4       | mytblc2                                                         |                    |               17612 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       3 |                    3 |             3
        17600 | DELETE_LOG         | myschema4       | mytblc1                                                         |                    |               17612 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       1 |                    3 |             1
        17600 | DELETE_LOG         | myschema4       | mytblc2                                                         |                    |               17612 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    3 |             6
        17600 | ENA_LOG_TRG        | myschema4       | mytblc1                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17600 | ENA_LOG_TRG        | myschema4       | mytblc2                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17600 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       9 |                    2 |              
        17601 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    2 |             3
        17601 | RLBK_TABLE         | myschema4       | mytblc2                                                         |                    |               17620 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       6 |                    1 |             3
        17601 | RLBK_TABLE         | myschema4       | mytblm                                                          |                    |               17620 |                 3 |            1 |                                                                                                                                                                                               |                   | f                         |                       2 |                    3 |             1
        17601 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       3 |                    2 |              
        17602 | RLBK_SEQUENCES     |                 |                                                                 |                    |                     |                 1 |            1 |                                                                                                                                                                                               |                   |                           |                       3 |                    2 |             3
        17602 | DIS_LOG_TRG        | myschema4       | mytblc2                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17602 | DIS_LOG_TRG        | phil's schema"3 | my"tbl4                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17602 | DIS_LOG_TRG        | phil's schema"3 | myTbl2\                                                         |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17602 | RLBK_TABLE         | myschema4       | mytblc2                                                         |                    |               17617 |                 2 |            1 |                                                                                                                                                                                               |                   | f                         |                       6 |                    1 |             6
        17602 | RLBK_TABLE         | phil's schema"3 | my"tbl4                                                         |                    |               17615 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       4 |                    3 |             4
        17602 | RLBK_TABLE         | phil's schema"3 | myTbl2\                                                         |                    |               17615 |                 4 |            1 |                                                                                                                                                                                               |                   | t                         |                       1 |                    1 |             1
        17602 | DELETE_LOG         | myschema4       | mytblc2                                                         |                    |               17617 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                       6 |                    1 |             6
        17602 | DELETE_LOG         | phil's schema"3 | my"tbl4                                                         |                    |               17615 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                       4 |                    3 |             7
        17602 | DELETE_LOG         | phil's schema"3 | myTbl2\                                                         |                    |               17615 |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                       1 |                    1 |             1
        17602 | ENA_LOG_TRG        | myschema4       | mytblc2                                                         |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17602 | ENA_LOG_TRG        | phil's schema"3 | my"tbl4                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17602 | ENA_LOG_TRG        | phil's schema"3 | myTbl2\                                                         |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        17602 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      13 |                    2 |              
        18000 | RLBK_TABLE         | myschema4       | mytblc2                                                         |                    |               18003 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                       6 |                    1 |             7
        18000 | RLBK_TABLE         | phil's schema"3 | my"tbl4                                                         |                    |               18003 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                       8 |                    1 |             9
        18000 | RLBK_TABLE         | phil's schema"3 | myTbl2\                                                         |                    |               18003 |                 5 |            1 |                                                                                                                                                                                               |                   | t                         |                       6 |                    1 |             7
        18000 | RLBK_TABLE         | phil's schema"3 | phil's tbl1                                                     |                    |               18003 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      19 |                    1 |            20
        18000 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                       4 |                    2 |              
        18001 | DIS_LOG_TRG        | myschema4       | mytblc2                                                         |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | phil's schema"3 | my"tbl4                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | phil's schema"3 | myTbl2\                                                         |                    |                     |                 5 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | phil's schema"3 | phil's tbl1                                                     |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | RLBK_TABLE         | myschema4       | mytblc2                                                         |                    |               18003 |                 4 |            1 |                                                                                                                                                                                               |                   | f                         |                      12 |                    1 |             7
        18001 | RLBK_TABLE         | phil's schema"3 | my"tbl4                                                         |                    |               18003 |                 3 |            1 |                                                                                                                                                                                               |                   | t                         |                      16 |                    1 |             9
        18001 | RLBK_TABLE         | phil's schema"3 | myTbl2\                                                         |                    |               18003 |                 5 |            1 |                                                                                                                                                                                               |                   | t                         |                      12 |                    1 |             7
        18001 | RLBK_TABLE         | phil's schema"3 | phil's tbl1                                                     |                    |               18003 |                 2 |            1 |                                                                                                                                                                                               |                   | t                         |                      38 |                    1 |            20
        18001 | DELETE_LOG         | myschema4       | mytblc2                                                         |                    |               18003 |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                      12 |                    1 |            13
        18001 | DELETE_LOG         | phil's schema"3 | my"tbl4                                                         |                    |               18003 |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                      16 |                    1 |            17
        18001 | DELETE_LOG         | phil's schema"3 | myTbl2\                                                         |                    |               18003 |                 5 |            1 |                                                                                                                                                                                               |                   |                           |                      12 |                    1 |            13
        18001 | DELETE_LOG         | phil's schema"3 | phil's tbl1                                                     |                    |               18003 |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                      38 |                    1 |            39
        18001 | ENA_LOG_TRG        | myschema4       | mytblc2                                                         |                    |                     |                 4 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | phil's schema"3 | my"tbl4                                                         |                    |                     |                 3 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | phil's schema"3 | myTbl2\                                                         |                    |                     |                 5 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | phil's schema"3 | phil's tbl1                                                     |                    |                     |                 2 |            1 |                                                                                                                                                                                               |                   |                           |                         |                    2 |              
        18001 | CTRL+DBLINK        |                 |                                                                 |                    |                     |                   |              |                                                                                                                                                                                               |                   |                           |                      16 |                    2 |              
(274 rows)

select rlbt_step, rlbt_schema, rlbt_table, rlbt_object, rlbt_rlbk_id, rlbt_quantity
  from emaj.emaj_rlbk_stat where rlbt_rlbk_id >= 10000 order by rlbt_rlbk_id, rlbt_step, rlbt_schema, rlbt_table, rlbt_object;
   rlbt_step    |   rlbt_schema   |                           rlbt_table                            |    rlbt_object     | rlbt_rlbk_id | rlbt_quantity 
----------------+-----------------+-----------------------------------------------------------------+--------------------+--------------+---------------
 RLBK_SEQUENCES |                 |                                                                 |                    |        12300 |             2
 SET_FK_DEF     |                 |                                                                 |                    |        12300 |             2
 RLBK_TABLE     | myschema2       | mytbl4                                                          |                    |        12300 |             4
 RLBK_TABLE     | myschema2       | mytbl5                                                          |                    |        12300 |             1
 RLBK_TABLE     | myschema2       | mytbl6                                                          |                    |        12300 |             3
 SET_FK_IMM     | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |        12300 |             3
 SET_FK_IMM     | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |        12300 |             3
 CTRL-DBLINK    |                 |                                                                 |                    |        12300 |             8
 RLBK_SEQUENCES |                 |                                                                 |                    |        12301 |             2
 SET_FK_DEF     |                 |                                                                 |                    |        12301 |             2
 RLBK_TABLE     | myschema2       | mytbl4                                                          |                    |        12301 |             2
 RLBK_TABLE     | myschema2       | mytbl5                                                          |                    |        12301 |             1
 RLBK_TABLE     | myschema2       | mytbl6                                                          |                    |        12301 |             3
 SET_FK_IMM     | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |        12301 |             3
 SET_FK_IMM     | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |        12301 |             3
 CTRL-DBLINK    |                 |                                                                 |                    |        12301 |             8
 RLBK_SEQUENCES |                 |                                                                 |                    |        12400 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        12400 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        12400 |             3
 RLBK_TABLE     | myschema1       | mytbl4                                                          |                    |        12400 |             8
 DELETE_LOG     | myschema1       | mytbl1                                                          |                    |        12400 |             3
 DELETE_LOG     | myschema1       | mytbl4                                                          |                    |        12400 |             8
 ENA_LOG_TRG    |                 |                                                                 |                    |        12400 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        12400 |             9
 RLBK_SEQUENCES |                 |                                                                 |                    |        12500 |             2
 SET_FK_DEF     |                 |                                                                 |                    |        12500 |             2
 RLBK_TABLE     | myschema2       | mytbl4                                                          |                    |        12500 |             8
 RLBK_TABLE     | myschema2       | mytbl5                                                          |                    |        12500 |             3
 RLBK_TABLE     | myschema2       | mytbl6                                                          |                    |        12500 |             9
 SET_FK_IMM     | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |        12500 |             9
 SET_FK_IMM     | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |        12500 |             9
 CTRL+DBLINK    |                 |                                                                 |                    |        12500 |             8
 RLBK_SEQUENCES |                 |                                                                 |                    |        12501 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        12501 |             3
 SET_FK_DEF     |                 |                                                                 |                    |        12501 |             2
 RLBK_TABLE     | myschema2       | mytbl4                                                          |                    |        12501 |             6
 RLBK_TABLE     | myschema2       | mytbl5                                                          |                    |        12501 |             3
 RLBK_TABLE     | myschema2       | mytbl6                                                          |                    |        12501 |             9
 DELETE_LOG     | myschema2       | mytbl4                                                          |                    |        12501 |             6
 DELETE_LOG     | myschema2       | mytbl5                                                          |                    |        12501 |             3
 DELETE_LOG     | myschema2       | mytbl6                                                          |                    |        12501 |             9
 SET_FK_IMM     | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |        12501 |             9
 SET_FK_IMM     | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |        12501 |             9
 ENA_LOG_TRG    |                 |                                                                 |                    |        12501 |             3
 CTRL+DBLINK    |                 |                                                                 |                    |        12501 |            17
 RLBK_SEQUENCES |                 |                                                                 |                    |        12600 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        12600 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        12600 |             1
 RLBK_TABLE     | myschema1       | mytbl4                                                          |                    |        12600 |             2
 DELETE_LOG     | myschema1       | mytbl1                                                          |                    |        12600 |             1
 DELETE_LOG     | myschema1       | mytbl4                                                          |                    |        12600 |             2
 ENA_LOG_TRG    |                 |                                                                 |                    |        12600 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        12600 |             9
 RLBK_SEQUENCES |                 |                                                                 |                    |        12601 |             2
 RLBK_TABLE     | myschema1       | myTbl3                                                          |                    |        12601 |            10
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        12601 |             1
 RLBK_TABLE     | myschema1       | mytbl4                                                          |                    |        12601 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        12601 |             4
 RLBK_SEQUENCES |                 |                                                                 |                    |        14000 |             4
 CTRL+DBLINK    |                 |                                                                 |                    |        14000 |             1
 RLBK_SEQUENCES |                 |                                                                 |                    |        14001 |             4
 CTRL+DBLINK    |                 |                                                                 |                    |        14001 |             1
 RLBK_SEQUENCES |                 |                                                                 |                    |        14002 |             4
 CTRL+DBLINK    |                 |                                                                 |                    |        14002 |             1
 RLBK_SEQUENCES |                 |                                                                 |                    |        14003 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14003 |             1
 RLBK_SEQUENCES |                 |                                                                 |                    |        14200 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14200 |             1
 RLBK_SEQUENCES |                 |                                                                 |                    |        14201 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14201 |             1
 RLBK_SEQUENCES |                 |                                                                 |                    |        14300 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        14300 |             1
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14300 |            20
 DELETE_LOG     | myschema1       | mytbl1                                                          |                    |        14300 |            20
 ENA_LOG_TRG    |                 |                                                                 |                    |        14300 |             1
 CTRL+DBLINK    |                 |                                                                 |                    |        14300 |             5
 RLBK_SEQUENCES |                 |                                                                 |                    |        14400 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        14400 |             1
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14400 |             5
 DELETE_LOG     | myschema1       | mytbl2b                                                         |                    |        14400 |             5
 ENA_LOG_TRG    |                 |                                                                 |                    |        14400 |             1
 CTRL+DBLINK    |                 |                                                                 |                    |        14400 |             5
 RLBK_SEQUENCES |                 |                                                                 |                    |        14401 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        14401 |             4
 SET_FK_DEF     |                 |                                                                 |                    |        14401 |             2
 RLBK_TABLE     | myschema2       | mytbl1                                                          |                    |        14401 |             3
 RLBK_TABLE     | myschema2       | mytbl2                                                          |                    |        14401 |             2
 RLBK_TABLE     | myschema2       | mytbl5                                                          |                    |        14401 |             3
 RLBK_TABLE     | myschema2       | mytbl6                                                          |                    |        14401 |            17
 DELETE_LOG     | myschema2       | mytbl1                                                          |                    |        14401 |             3
 DELETE_LOG     | myschema2       | mytbl2                                                          |                    |        14401 |             2
 DELETE_LOG     | myschema2       | mytbl5                                                          |                    |        14401 |             3
 DELETE_LOG     | myschema2       | mytbl6                                                          |                    |        14401 |            17
 SET_FK_IMM     | myschema2       | mytbl6                                                          | mytbl6_col61_fkey  |        14401 |            17
 SET_FK_IMM     | myschema2       | mytbl8                                                          | mytbl8_col81_fkey  |        14401 |            17
 ENA_LOG_TRG    |                 |                                                                 |                    |        14401 |             4
 CTRL+DBLINK    |                 |                                                                 |                    |        14401 |            21
 RLBK_SEQUENCES |                 |                                                                 |                    |        14402 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        14402 |             2
 DROP_FK        |                 |                                                                 |                    |        14402 |             2
 RLBK_TABLE     | phil's schema"3 | myTbl2\                                                         |                    |        14402 |             2
 RLBK_TABLE     | phil's schema"3 | phil's tbl1                                                     |                    |        14402 |            53
 DELETE_LOG     | phil's schema"3 | myTbl2\                                                         |                    |        14402 |             2
 DELETE_LOG     | phil's schema"3 | phil's tbl1                                                     |                    |        14402 |            53
 ADD_FK         | phil's schema"3 | my"tbl4                                                         | my"tbl4_col44_fkey |        14402 |             0
 ADD_FK         | phil's schema"3 | myTbl2\                                                         | mytbl2_col21_fkey  |        14402 |             0
 ENA_LOG_TRG    |                 |                                                                 |                    |        14402 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14402 |            13
 RLBK_SEQUENCES |                 |                                                                 |                    |        14500 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        14500 |             1
 DROP_FK        |                 |                                                                 |                    |        14500 |             1
 RLBK_TABLE     | phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                    |        14500 |             6
 DELETE_LOG     | phil's schema"3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                    |        14500 |             6
 ADD_FK         | phil's schema"3 | my"tbl4                                                         | my"tbl4_col44_fkey |        14500 |             0
 ENA_LOG_TRG    |                 |                                                                 |                    |        14500 |             1
 CTRL+DBLINK    |                 |                                                                 |                    |        14500 |             7
 RLBK_SEQUENCES |                 |                                                                 |                    |        14700 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14700 |            15
 RLBK_TABLE     | myschema1       | mytbl2                                                          |                    |        14700 |             2
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14700 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14700 |             6
 RLBK_SEQUENCES |                 |                                                                 |                    |        14701 |             2
 RLBK_TABLE     | myschema1       | myTbl3                                                          |                    |        14701 |            10
 RLBK_TABLE     | myschema1       | mytbl4                                                          |                    |        14701 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14701 |             3
 RLBK_SEQUENCES |                 |                                                                 |                    |        14702 |             2
 RLBK_TABLE     | myschema1       | mytbl2                                                          |                    |        14702 |             1
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14702 |             1
 CTRL+DBLINK    |                 |                                                                 |                    |        14702 |             5
 RLBK_SEQUENCES |                 |                                                                 |                    |        14703 |             2
 RLBK_TABLE     | myschema1       | myTbl3                                                          |                    |        14703 |            10
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14703 |            15
 RLBK_TABLE     | myschema1       | mytbl2                                                          |                    |        14703 |             2
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14703 |             2
 RLBK_TABLE     | myschema1       | mytbl4                                                          |                    |        14703 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14703 |             8
 RLBK_SEQUENCES |                 |                                                                 |                    |        14704 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14704 |            16
 CTRL+DBLINK    |                 |                                                                 |                    |        14704 |             2
 RLBK_SEQUENCES |                 |                                                                 |                    |        14705 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14705 |            22
 RLBK_TABLE     | myschema1       | mytbl4                                                          |                    |        14705 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14705 |             3
 RLBK_SEQUENCES |                 |                                                                 |                    |        14706 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14706 |            15
 RLBK_TABLE     | myschema1       | mytbl2                                                          |                    |        14706 |             2
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14706 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        14706 |             6
 RLBK_SEQUENCES |                 |                                                                 |                    |        14707 |             2
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14707 |            11
 RLBK_TABLE     | myschema1       | mytbl2                                                          |                    |        14707 |             3
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14707 |             4
 CTRL+DBLINK    |                 |                                                                 |                    |        14707 |             6
 RLBK_SEQUENCES |                 |                                                                 |                    |        14708 |             2
 DIS_LOG_TRG    |                 |                                                                 |                    |        14708 |             3
 RLBK_TABLE     | myschema1       | mytbl1                                                          |                    |        14708 |            11
 RLBK_TABLE     | myschema1       | mytbl2                                                          |                    |        14708 |             4
 RLBK_TABLE     | myschema1       | mytbl2b                                                         |                    |        14708 |            14
 DELETE_LOG     | myschema1       | mytbl1                                                          |                    |        14708 |            11
 DELETE_LOG     | myschema1       | mytbl2                                                          |                    |        14708 |             4
 DELETE_LOG     | myschema1       | mytbl2b                                                         |                    |        14708 |            14
 ENA_LOG_TRG    |                 |                                                                 |                    |        14708 |             3
 CTRL+DBLINK    |                 |                                                                 |                    |        14708 |            15
 DIS_APP_TRG    |                 |                                                                 |                    |        17200 |             1
 DIS_LOG_TRG    |                 |                                                                 |                    |        17200 |             3
 SET_FK_DEF     |                 |                                                                 |                    |        17200 |             4
 RLBK_TABLE     | myschema4       | mypartp2                                                        |                    |        17200 |             4
 RLBK_TABLE     | myschema4       | mypartp3                                                        |                    |        17200 |             1
 RLBK_TABLE     | myschema4       | mytblr1                                                         |                    |        17200 |             6
 DELETE_LOG     | myschema4       | mypartp2                                                        |                    |        17200 |             4
 DELETE_LOG     | myschema4       | mypartp3                                                        |                    |        17200 |             1
 DELETE_LOG     | myschema4       | mytblr1                                                         |                    |        17200 |             6
 SET_FK_IMM     | myschema4       | mypartp1                                                        | mytblp_col1_fkey   |        17200 |             6
 SET_FK_IMM     | myschema4       | mypartp2                                                        | mytblp_col1_fkey   |        17200 |            10
 SET_FK_IMM     | myschema4       | mypartp3                                                        | mytblp_col1_fkey   |        17200 |             7
 SET_FK_IMM     | myschema4       | mytblp                                                          | mytblp_col1_fkey   |        17200 |             6
 ENA_APP_TRG    |                 |                                                                 |                    |        17200 |             1
 ENA_LOG_TRG    |                 |                                                                 |                    |        17200 |             3
 CTRL+DBLINK    |                 |                                                                 |                    |        17200 |            22
 RLBK_SEQUENCES |                 |                                                                 |                    |        17600 |             4
 DIS_LOG_TRG    |                 |                                                                 |                    |        17600 |             2
 RLBK_TABLE     | myschema4       | mytblc1                                                         |                    |        17600 |             1
 RLBK_TABLE     | myschema4       | mytblc2                                                         |                    |        17600 |             3
 DELETE_LOG     | myschema4       | mytblc1                                                         |                    |        17600 |             1
 DELETE_LOG     | myschema4       | mytblc2                                                         |                    |        17600 |             3
 ENA_LOG_TRG    |                 |                                                                 |                    |        17600 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        17600 |             9
 RLBK_SEQUENCES |                 |                                                                 |                    |        17601 |             3
 RLBK_TABLE     | myschema4       | mytblc2                                                         |                    |        17601 |             6
 RLBK_TABLE     | myschema4       | mytblm                                                          |                    |        17601 |             2
 CTRL+DBLINK    |                 |                                                                 |                    |        17601 |             3
 RLBK_SEQUENCES |                 |                                                                 |                    |        17602 |             3
 DIS_LOG_TRG    |                 |                                                                 |                    |        17602 |             3
 RLBK_TABLE     | myschema4       | mytblc2                                                         |                    |        17602 |             6
 RLBK_TABLE     | phil's schema"3 | my"tbl4                                                         |                    |        17602 |             4
 RLBK_TABLE     | phil's schema"3 | myTbl2\                                                         |                    |        17602 |             1
 DELETE_LOG     | myschema4       | mytblc2                                                         |                    |        17602 |             6
 DELETE_LOG     | phil's schema"3 | my"tbl4                                                         |                    |        17602 |             4
 DELETE_LOG     | phil's schema"3 | myTbl2\                                                         |                    |        17602 |             1
 ENA_LOG_TRG    |                 |                                                                 |                    |        17602 |             3
 CTRL+DBLINK    |                 |                                                                 |                    |        17602 |            13
 RLBK_TABLE     | myschema4       | mytblc2                                                         |                    |        18000 |             6
 RLBK_TABLE     | phil's schema"3 | my"tbl4                                                         |                    |        18000 |             8
 RLBK_TABLE     | phil's schema"3 | myTbl2\                                                         |                    |        18000 |             6
 RLBK_TABLE     | phil's schema"3 | phil's tbl1                                                     |                    |        18000 |            19
 CTRL+DBLINK    |                 |                                                                 |                    |        18000 |             4
 DIS_LOG_TRG    |                 |                                                                 |                    |        18001 |             4
 RLBK_TABLE     | myschema4       | mytblc2                                                         |                    |        18001 |            12
 RLBK_TABLE     | phil's schema"3 | my"tbl4                                                         |                    |        18001 |            16
 RLBK_TABLE     | phil's schema"3 | myTbl2\                                                         |                    |        18001 |            12
 RLBK_TABLE     | phil's schema"3 | phil's tbl1                                                     |                    |        18001 |            38
 DELETE_LOG     | myschema4       | mytblc2                                                         |                    |        18001 |            12
 DELETE_LOG     | phil's schema"3 | my"tbl4                                                         |                    |        18001 |            16
 DELETE_LOG     | phil's schema"3 | myTbl2\                                                         |                    |        18001 |            12
 DELETE_LOG     | phil's schema"3 | phil's tbl1                                                     |                    |        18001 |            38
 ENA_LOG_TRG    |                 |                                                                 |                    |        18001 |             4
 CTRL+DBLINK    |                 |                                                                 |                    |        18001 |            16
(217 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 18000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   18000 |           18000000 | C
   18001 |           18000000 | A
   18002 |           18000000 | A
   18003 |           18000000 | S
   18004 |           18000044 | M
   18005 |           18000044 | R
   18006 |           18000083 | M
   18007 |           18000083 | R
   18008 |           18000129 | X
   18009 |           18000129 | D
(10 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 18000 order by hist_id;
       hist_function        |     hist_event     |           hist_object            |                                           regexp_replace                                           | hist_user 
----------------------------+--------------------+----------------------------------+----------------------------------------------------------------------------------------------------+-----------
 GEN_SQL_DUMP_CHANGES_GROUP | BEGIN              | myGroup1                         | From mark M4 to M5 towards /tmp/emaj_16/adm3/dump_changes.sql                                      | postgres
 GEN_SQL_DUMP_CHANGES_GROUP | END                | myGroup1                         | 9 generated SQL statements                                                                         | postgres
 DUMP_CHANGES_GROUP         | BEGIN              | myGroup1                         | From mark M4 to M5 towards /tmp/emaj_16/adm3                                                       | postgres
 DUMP_CHANGES_GROUP         | END                | myGroup1                         | 2 generated files                                                                                  | postgres
 CREATE_GROUP               | BEGIN              | truncateTestGroup                | rollbackable                                                                                       | postgres
 CREATE_GROUP               | TIME STAMP SET     | 18000                            |                                                                                                    | postgres
 CREATE_GROUP               | END                | truncateTestGroup                |                                                                                                    | postgres
 ASSIGN_TABLES              | BEGIN              |                                  |                                                                                                    | postgres
 ASSIGN_TABLES              | TIME STAMP SET     | 18001                            |                                                                                                    | postgres
 ASSIGN_TABLES              | LOG_SCHEMA CREATED | "emaj_phil's schema""3"          |                                                                                                    | postgres
 ASSIGN_TABLES              | TABLE ADDED        | "phil's schema""3"."my""tbl4"    | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | "phil's schema""3"."myTbl2\"     | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | "phil's schema""3"."phil's tbl1" | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | END                |                                  | 3 tables assigned to the group truncateTestGroup                                                   | postgres
 ASSIGN_TABLES              | BEGIN              |                                  |                                                                                                    | postgres
 ASSIGN_TABLES              | TIME STAMP SET     | 18002                            |                                                                                                    | postgres
 ASSIGN_TABLES              | LOG_SCHEMA CREATED | emaj_myschema4                   |                                                                                                    | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mytblr2                | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mypartp3               | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mytblr1                | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mytblm                 | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mytblc2                | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mypartp2               | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | TABLE ADDED        | myschema4.mytblc1                | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES              | END                |                                  | 7 tables assigned to the group truncateTestGroup                                                   | postgres
 START_GROUP                | BEGIN              | truncateTestGroup                | With log reset                                                                                     | postgres
 START_GROUP                | TIME STAMP SET     | 18003                            |                                                                                                    | postgres
 LOCK_GROUP                 | BEGIN              | truncateTestGroup                |                                                                                                    | postgres
 LOCK_GROUP                 | END                | truncateTestGroup                | 10 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP             | BEGIN              | truncateTestGroup                | M1                                                                                                 | postgres
 SET_MARK_GROUP             | END                | truncateTestGroup                | M1                                                                                                 | postgres
 START_GROUP                | END                | truncateTestGroup                | 10 tables/sequences processed                                                                      | postgres
 SET_MARK_GROUP             | BEGIN              | truncateTestGroup                |                                                                                                    | postgres
 LOCK_GROUP                 | BEGIN              | truncateTestGroup                |                                                                                                    | postgres
 LOCK_GROUP                 | END                | truncateTestGroup                | 10 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP             | TIME STAMP SET     | 18004                            |                                                                                                    | postgres
 SET_MARK_GROUP             | END                | truncateTestGroup                | M2                                                                                                 | postgres
 DUMP_CHANGES_GROUP         | BEGIN              | truncateTestGroup                | From mark M1 to M2 towards /tmp/emaj_16/adm3                                                       | postgres
 DUMP_CHANGES_GROUP         | END                | truncateTestGroup                | 2 generated files                                                                                  | postgres
 DUMP_CHANGES_GROUP         | BEGIN              | truncateTestGroup                | From mark M1 to M2 towards /tmp/emaj_16/adm3                                                       | postgres
 DUMP_CHANGES_GROUP         | END                | truncateTestGroup                | 2 generated files                                                                                  | postgres
 ROLLBACK_GROUP             | BEGIN              | truncateTestGroup                | Logged rollback to mark M1 (timestamp)                                                             | postgres
 DBLINK_OPEN_CNX            |                    | rlbk#1                           | Status = 1                                                                                         | postgres
 LOCK_GROUP                 | BEGIN              | truncateTestGroup                | Rollback session #1                                                                                | postgres
 LOCK_GROUP                 | END                | truncateTestGroup                | Rollback session #1: 10 tables locked, 0 deadlock(s)                                               | postgres
 ROLLBACK_GROUP             | TIME STAMP SET     | 18005                            |                                                                                                    | postgres
 SET_MARK_GROUP             | BEGIN              | truncateTestGroup                | RLBK_18000_START                                                                                   | postgres
 SET_MARK_GROUP             | END                | truncateTestGroup                | RLBK_18000_START                                                                                   | postgres
 ROLLBACK_TABLE             | BEGIN              | "phil's schema""3"."phil's tbl1" | All log rows where emaj_gid > 18000000 and <= 18000044, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE             | END                | "phil's schema""3"."phil's tbl1" | 20 rolled back primary keys                                                                        | postgres
 ROLLBACK_TABLE             | BEGIN              | "phil's schema""3"."my""tbl4"    | All log rows where emaj_gid > 18000000 and <= 18000044, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE             | END                | "phil's schema""3"."my""tbl4"    | 9 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE             | BEGIN              | myschema4.mytblc2                | All log rows where emaj_gid > 18000000 and <= 18000044                                             | postgres
 ROLLBACK_TABLE             | END                | myschema4.mytblc2                | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE             | BEGIN              | "phil's schema""3"."myTbl2\"     | All log rows where emaj_gid > 18000000 and <= 18000044, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE             | END                | "phil's schema""3"."myTbl2\"     | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_GROUP             | TIME STAMP SET     | 18006                            |                                                                                                    | postgres
 SET_MARK_GROUP             | BEGIN              | truncateTestGroup                | RLBK_18000_DONE                                                                                    | postgres
 SET_MARK_GROUP             | END                | truncateTestGroup                | RLBK_18000_DONE                                                                                    | postgres
 ROLLBACK_GROUP             | NOTICE             | Rollback id 18000                | Rollback id = 18000.                                                                               | postgres
 ROLLBACK_GROUP             | NOTICE             | Rollback id 18000                | 4 / 10 tables effectively processed.                                                               | postgres
 DBLINK_CLOSE_CNX           |                    | rlbk#1                           |                                                                                                    | postgres
 ROLLBACK_GROUP             | END                | truncateTestGroup                | Rollback_id 18000                                                                                  | postgres
 GEN_SQL_GROUP              | BEGIN              | truncateTestGroup                | From mark M1 to mark M2                                                                            | postgres
 GEN_SQL_GROUP              | END                | truncateTestGroup                | 4 generated statements - script exported into /tmp/emaj_16/adm3/gensql.sql                         | postgres
 ROLLBACK_GROUP             | BEGIN              | truncateTestGroup                | Unlogged rollback to mark M1 (timestamp)                                                           | postgres
 DBLINK_OPEN_CNX            |                    | rlbk#1                           | Status = 1                                                                                         | postgres
 LOCK_GROUP                 | BEGIN              | truncateTestGroup                | Rollback session #1                                                                                | postgres
 LOCK_GROUP                 | END                | truncateTestGroup                | Rollback session #1: 10 tables locked, 0 deadlock(s)                                               | postgres
 ROLLBACK_GROUP             | TIME STAMP SET     | 18007                            |                                                                                                    | postgres
 ROLLBACK_TABLE             | BEGIN              | "phil's schema""3"."phil's tbl1" | All log rows where emaj_gid > 18000000 and <= 18000083, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE             | END                | "phil's schema""3"."phil's tbl1" | 20 rolled back primary keys                                                                        | postgres
 ROLLBACK_TABLE             | BEGIN              | "phil's schema""3"."my""tbl4"    | All log rows where emaj_gid > 18000000 and <= 18000083, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE             | END                | "phil's schema""3"."my""tbl4"    | 9 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE             | BEGIN              | myschema4.mytblc2                | All log rows where emaj_gid > 18000000 and <= 18000083                                             | postgres
 ROLLBACK_TABLE             | END                | myschema4.mytblc2                | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE             | BEGIN              | "phil's schema""3"."myTbl2\"     | All log rows where emaj_gid > 18000000 and <= 18000083, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE             | END                | "phil's schema""3"."myTbl2\"     | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_GROUP             | MARK DELETED       | truncateTestGroup                | mark M2 is deleted                                                                                 | postgres
 ROLLBACK_GROUP             | MARK DELETED       | truncateTestGroup                | mark RLBK_18000_START is deleted                                                                   | postgres
 ROLLBACK_GROUP             | MARK DELETED       | truncateTestGroup                | mark RLBK_18000_DONE is deleted                                                                    | postgres
 ROLLBACK_GROUP             | NOTICE             | Rollback id 18001                | Rollback id = 18001.                                                                               | postgres
 ROLLBACK_GROUP             | NOTICE             | Rollback id 18001                | 4 / 10 tables effectively processed.                                                               | postgres
 DBLINK_CLOSE_CNX           |                    | rlbk#1                           |                                                                                                    | postgres
 ROLLBACK_GROUP             | END                | truncateTestGroup                | Rollback_id 18001                                                                                  | postgres
 STOP_GROUP                 | BEGIN              | truncateTestGroup                |                                                                                                    | postgres
 STOP_GROUP                 | TIME STAMP SET     | 18008                            |                                                                                                    | postgres
 LOCK_GROUP                 | BEGIN              | truncateTestGroup                |                                                                                                    | postgres
 LOCK_GROUP                 | END                | truncateTestGroup                | 10 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP             | BEGIN              | truncateTestGroup                | STOP_%                                                                                             | postgres
 CLEANUP_RLBK_STATE         |                    | Rollback id 18000                | set to COMMITTED                                                                                   | postgres
 CLEANUP_RLBK_STATE         |                    | Rollback id 18001                | set to COMMITTED                                                                                   | postgres
 SET_MARK_GROUP             | END                | truncateTestGroup                | STOP_%                                                                                             | postgres
 STOP_GROUP                 | END                | truncateTestGroup                | 10 tables/sequences processed                                                                      | postgres
 DROP_GROUP                 | BEGIN              | truncateTestGroup                |                                                                                                    | postgres
 DROP_GROUP                 | TIME STAMP SET     | 18009                            |                                                                                                    | postgres
 DROP_GROUP                 | LOG_SCHEMA DROPPED | emaj_myschema4                   |                                                                                                    | postgres
 DROP_GROUP                 | LOG_SCHEMA DROPPED | "emaj_phil's schema""3"          |                                                                                                    | postgres
 DROP_GROUP                 | END                | truncateTestGroup                | 10 tables/sequences processed                                                                      | postgres
(99 rows)

select * from emaj.emaj_log_session where lower(lses_time_range) >= 12000 order by lses_group, lses_time_range;
    lses_group     | lses_time_range | lses_marks | lses_log_rows 
-------------------+-----------------+------------+---------------
 grp_tmp           | [17603,17631)   |         17 |            23
 grp_tmp           | [17633,17640)   |          3 |             0
 grp_tmp_3         | [17609,17636)   |         15 |            14
 grp_tmp_4         | [17603,17639)   |         17 |            10
 myGroup1          | [12016,14001)   |          9 |           118
 myGroup1          | [14001,14008)   |          5 |             0
 myGroup1          | [14009,)        |         34 |           213
 myGroup2          | [12017,14001)   |         10 |            67
 myGroup2          | [14001,14008)   |          5 |             0
 myGroup2          | [14009,)        |          2 |             0
 myGroup4          | [17102,17106)   |          4 |             0
 myGroup4          | [17106,17108)   |          2 |             0
 myGroup4          | [17200,17208)   |          7 |            14
 phil's group#3",  | [14203,14501)   |          7 |           110
 phil's group#3",  | [14503,14507)   |          3 |             4
 phil's group#3",  | [17404,17414)   |         10 |             5
 truncateTestGroup | [18003,18009)   |          5 |           117
(17 rows)

select * from emaj.emaj_group_hist order by grph_group, grph_time_range;
    grph_group     | grph_time_range | grph_is_rollbackable | grph_log_sessions 
-------------------+-----------------+----------------------+-------------------
 emptyGroup        | [12015,)        | t                    |                 0
 grp_tmp           | [17600,17641)   | t                    |                 2
 grp_tmp_3         | [17601,17637)   | t                    |                 1
 grp_tmp_4         | [17602,17639)   | t                    |                 1
 myGroup1          | [12005,)        | t                    |                 3
 myGroup2          | [12012,)        | t                    |                 3
 myGroup4          | [17100,17209)   | t                    |                 3
 phil's group#3",  | [14200,14508)   | t                    |                 2
 phil's group#3",  | [17400,17415)   | f                    |                 1
 truncateTestGroup | [18000,18010)   | t                    |                 1
(10 rows)

-----------------------------
-- check grants on other functions to emaj_adm role
-----------------------------
select emaj_get_previous_mark_group('dummyGroup', 'EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "dummyGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := ARRAY[p_groupName], p_mayBeNull := FALSE, p_lockGroups := FALSE)"
PL/pgSQL function emaj_get_previous_mark_group(text,text) line 9 at PERFORM
select emaj_estimate_rollback_groups(array['dummyGroup'], 'dummyMark', FALSE);
ERROR:  _check_group_names: The group "dummyGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 42 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._estimate_rollback_groups(text[],boolean,text,boolean) line 18 at SQL statement
PL/pgSQL function emaj_estimate_rollback_groups(text[],text,boolean) line 7 at RETURN
select * from emaj_rollback_activity();
 rlbk_id | rlbk_groups | rlbk_mark | rlbk_mark_datetime | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_comment | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_eff_nb_sequence | rlbk_status | rlbk_start_datetime | rlbk_planning_duration | rlbk_locking_duration | rlbk_elapse | rlbk_remaining | rlbk_completion_pct 
---------+-------------+-----------+--------------------+----------------+-----------------------------+--------------+-----------------+---------------+------------------+-------------------+----------------------+-------------+---------------------+------------------------+-----------------------+-------------+----------------+---------------------
(0 rows)

select substr(pg_size_pretty(pg_database_size(current_database())),1,0);
 substr 
--------
 
(1 row)

select emaj_forget_group('dummyGroup');
WARNING:  emaj_forget_group: the tables group "dummyGroup" has not been found in history tables
 emaj_forget_group 
-------------------
                 0
(1 row)

--
reset role;
-- the groups are left in their current state for the parallel rollback test.
select count(*) from mySchema1.myTbl4;
 count 
-------
     0
(1 row)

select count(*) from mySchema1.myTbl1;
 count 
-------
    20
(1 row)

select count(*) from mySchema1.myTbl2; 
 count 
-------
     3
(1 row)

select count(*) from mySchema1."myTbl3";
 count 
-------
     5
(1 row)

select count(*) from mySchema1.myTbl2b;
 count 
-------
     3
(1 row)

select count(*) from mySchema2.myTbl4;
 count 
-------
     2
(1 row)

select count(*) from mySchema2.myTbl1;
 count 
-------
    10
(1 row)

select count(*) from mySchema2.myTbl2; 
 count 
-------
     4
(1 row)

select count(*) from mySchema2."myTbl3";
 count 
-------
    10
(1 row)

select count(*) from mySchema2.myTbl5;
 count 
-------
     3
(1 row)

select count(*) from mySchema2.myTbl6;
 count 
-------
    14
(1 row)

-- remove the temp directory
\! rm -R $EMAJTESTTMPDIR
