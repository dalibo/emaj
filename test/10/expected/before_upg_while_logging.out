-- before_upg_while_logging.sql : complex scenario executed by an emaj_adm role
-- The E-Maj version is changed while groups are in logging state
-- This script is the part of operations performed before the upgrade
--
SET datestyle TO ymd;
-----------------------------
-- grant emaj_adm role 
-----------------------------
grant emaj_adm to emaj_regression_tests_adm_user;
set role emaj_regression_tests_adm_user;
-----------------------------
-- prepare groups
-----------------------------
delete from emaj.emaj_group_def;
insert into emaj.emaj_group_def values ('myGroup1','myschema1','mytbl1',20);
insert into emaj.emaj_group_def values ('myGroup1','myschema1','mytbl2',NULL);
insert into emaj.emaj_group_def values ('myGroup1','myschema1','mytbl2b',NULL);
insert into emaj.emaj_group_def values ('myGroup1','myschema1','myTbl3_col31_seq',1);
insert into emaj.emaj_group_def values ('myGroup1','myschema1','myTbl3',10);
insert into emaj.emaj_group_def values ('myGroup1','myschema1','mytbl4',20);
insert into emaj.emaj_group_def values ('myGroup2','myschema2','mytbl1');
insert into emaj.emaj_group_def values ('myGroup2','myschema2','mytbl2');
insert into emaj.emaj_group_def values ('myGroup2','myschema2','myTbl3_col31_seq');
insert into emaj.emaj_group_def values ('myGroup2','myschema2','myTbl3');
insert into emaj.emaj_group_def values ('myGroup2','myschema2','mytbl4');
insert into emaj.emaj_group_def values ('myGroup2','myschema2','myseq1');
-- The third group name contains space, comma # and '
insert into emaj.emaj_group_def values ('phil''s group#3",','phil''s schema3','phil''s tbl1');
insert into emaj.emaj_group_def values ('phil''s group#3",','phil''s schema3',E'myTbl2\\');
insert into emaj.emaj_group_def values ('phil''s group#3",','phil''s schema3',E'phil''s seq\\1');
insert into emaj.emaj_group_def values ('dummyGrp1','dummySchema','mytbl4');
insert into emaj.emaj_group_def values ('dummyGrp2','myschema1','dummyTable');
insert into emaj.emaj_group_def values ('dummyGrp3','myschema1','mytbl1');
insert into emaj.emaj_group_def values ('dummyGrp3','myschema2','mytbl2');
-----------------------------
-- set the default_tablespace parameter to tspemaj to log tables and indexes into this tablespace
-----------------------------
SET default_tablespace TO tspemaj;
-----------------------------
-- create and start groups
-----------------------------
select emaj.emaj_create_group('myGroup1');
NOTICE:  table "myschema1_myTbl3_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema1.myTbl3" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema1.myTbl3" does not exist, skipping
NOTICE:  table "myschema1_mytbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema1.mytbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema1.mytbl1" does not exist, skipping
NOTICE:  table "myschema1_mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema1.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema1.mytbl4" does not exist, skipping
NOTICE:  table "myschema1_mytbl2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema1.mytbl2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema1.mytbl2" does not exist, skipping
WARNING:  _create_tbl: The table "myschema1.mytbl2" has triggers (mytbl2trg). Verify the compatibility with emaj rollback operations (in particular if triggers update one or several other tables). Triggers may have to be manualy disabled before rollback.
NOTICE:  table "myschema1_mytbl2b_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema1.mytbl2b" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema1.mytbl2b" does not exist, skipping
 emaj_create_group 
-------------------
                 6
(1 row)

select emaj.emaj_create_group('myGroup2',true);
NOTICE:  table "myschema2_myTbl3_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema2.myTbl3" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema2.myTbl3" does not exist, skipping
NOTICE:  table "myschema2_mytbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema2.mytbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema2.mytbl1" does not exist, skipping
NOTICE:  table "myschema2_mytbl2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema2.mytbl2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema2.mytbl2" does not exist, skipping
NOTICE:  table "myschema2_mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema2.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema2.mytbl4" does not exist, skipping
 emaj_create_group 
-------------------
                 6
(1 row)

select emaj.emaj_create_group('phil''s group#3",',false);
NOTICE:  table "phil's schema3_myTbl2\_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.myTbl2\" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.myTbl2\" does not exist, skipping
NOTICE:  table "phil's schema3_phil's tbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.phil's tbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.phil's tbl1" does not exist, skipping
 emaj_create_group 
-------------------
                 3
(1 row)

select emaj.emaj_start_group('myGroup1','M1');
 emaj_start_group 
------------------
                6
(1 row)

select emaj.emaj_start_group('myGroup2','M1');
 emaj_start_group 
------------------
                6
(1 row)

select emaj.emaj_start_group('phil''s group#3",','M1');
 emaj_start_group 
------------------
                3
(1 row)

-----------------------------
-- Step 1 : for myGroup1, update tables, set 2 marks, perform 2 unlogged rollbacks and protect the group and its last mark
-----------------------------
-- 
set search_path=myschema1;
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
insert into myTbl2 values (1,'ABC','2010-12-31');
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
--
select emaj.emaj_set_mark_group('myGroup1','M2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
insert into myTbl4 values (1,'FK...',1,1,'ABC');
insert into myTbl4 values (2,'FK...',1,1,'ABC');
update myTbl4 set col43 = 2;
insert into myTbl4 values (3,'FK...',1,10,'ABC');
delete from myTbl1 where col11 = 10;
update myTbl1 set col12='DEF' where col11 <= 2;
--
select emaj.emaj_set_mark_group('myGroup1','M3');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select emaj.emaj_comment_mark_group('myGroup1','M3','Third mark set');
 emaj_comment_mark_group 
-------------------------
 
(1 row)

--
delete from myTbl1 where col11 > 3;
select emaj.emaj_rollback_group('myGroup1','M3');
 emaj_rollback_group 
---------------------
                   2
(1 row)

insert into myTbl2 values (3,'GHI',NULL);
update myTbl4 set col43 = 3 where col41 = 2;
select emaj.emaj_rollback_group('myGroup1','M3');
 emaj_rollback_group 
---------------------
                   4
(1 row)

--
select emaj.emaj_protect_mark_group('myGroup1','M3');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

select emaj.emaj_protect_group('myGroup1');
 emaj_protect_group 
--------------------
                  1
(1 row)

-----------------------------
-- Step 2 : for myGroup2, start, update tables and set 2 marks 
-----------------------------
set search_path=myschema2;
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
insert into myTbl2 values (1,'ABC','2010-01-01');
delete from myTbl1 where col11 > 10;
select nextval('myschema2.myseq1');
 nextval 
---------
    1000
(1 row)

insert into myTbl2 values (2,'DEF',NULL);
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
--
select emaj.emaj_set_mark_group('myGroup2','M2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

--
set search_path=myschema2;
select nextval('myschema2.myseq1');
 nextval 
---------
    1001
(1 row)

select nextval('myschema2.myseq1');
 nextval 
---------
    1002
(1 row)

select nextval('myschema2.myseq1');
 nextval 
---------
    1003
(1 row)

--
reset role;
alter sequence mySeq1 NO MAXVALUE NO CYCLE;
set role emaj_regression_tests_adm_user;
--
insert into myTbl4 values (1,'FK...',1,1,'ABC');
insert into myTbl4 values (2,'FK...',1,1,'ABC');
update myTbl4 set col43 = 2;
--
select emaj.emaj_set_mark_group('myGroup2','M3');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

-----------------------------
-- Step 3 : for myGroup2, double logged rollback
-----------------------------
select emaj.emaj_logged_rollback_group('myGroup2','M2');
 emaj_logged_rollback_group 
----------------------------
                          3
(1 row)

select emaj.emaj_logged_rollback_group('myGroup2','M3');
 emaj_logged_rollback_group 
----------------------------
                          3
(1 row)

-----------------------------
-- Step 4 : for both myGroup1 and myGroup2, set a common mark
-----------------------------
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Common');
 emaj_set_mark_groups 
----------------------
                   12
(1 row)

-----------------------------
-- Step 5 : alter group myGroup1 by changing a log schema and removing a table
-----------------------------
update emaj.emaj_group_def set grpdef_log_schema_suffix = 'b' where grpdef_schema = 'myschema1' and grpdef_tblseq = 'mytbl2b';
delete from emaj.emaj_group_def where grpdef_schema = 'myschema1' and grpdef_tblseq = 'myTbl3';
reset role;
select emaj.emaj_alter_group('myGroup1');
 emaj_alter_group 
------------------
                5
(1 row)

set role emaj_regression_tests_adm_user;
-----------------------------
-- Checking steps 1 to 5
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
       1 |                  0 | C
       2 |                  0 | C
       3 |                  0 | C
       4 |                  0 | M
       5 |                  0 | M
       6 |                  0 | M
       7 |                 29 | M
       8 |                 40 | M
       9 |                 46 | R
      10 |                 49 | R
      11 |                 77 | M
      12 |                 81 | M
      13 |                 81 | R
      14 |                 83 | M
      15 |                 83 | R
      16 |                 85 | M
      17 |                 85 | M
      18 |                 85 | A
(18 rows)

select group_name, group_is_logging, group_is_rlbk_protected, group_nb_table, group_nb_sequence, group_is_rollbackable, 
       group_creation_time_id, group_last_alter_time_id, group_comment
  from emaj.emaj_group order by group_name;
    group_name    | group_is_logging | group_is_rlbk_protected | group_nb_table | group_nb_sequence | group_is_rollbackable | group_creation_time_id | group_last_alter_time_id | group_comment 
------------------+------------------+-------------------------+----------------+-------------------+-----------------------+------------------------+--------------------------+---------------
 myGroup1         | t                | t                       |              4 |                 1 | t                     |                      1 |                       18 | 
 myGroup2         | t                | f                       |              4 |                 2 | t                     |                      2 |                          | 
 phil's group#3", | t                | t                       |              2 |                 1 | f                     |                      3 |                          | 
(3 rows)

select mark_id, mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'), mark_time_id, 
       mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark 
  from emaj.emaj_mark order by mark_id;
 mark_id |    mark_group    | regexp_replace  | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |  mark_comment  | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
---------+------------------+-----------------+--------------+-----------------+------------------------+----------------+---------------------------+------------------------------
       1 | myGroup1         | M1              |            4 | f               | f                      |                |                        29 | 
       2 | myGroup2         | M1              |            5 | f               | f                      |                |                        27 | 
       3 | phil's group#3", | M1              |            6 | f               | f                      |                |                           | 
       4 | myGroup1         | M2              |            7 | f               | f                      |                |                        11 | 
       5 | myGroup1         | M3              |            8 | f               | t                      | Third mark set |                         0 | 
       6 | myGroup2         | M2              |           11 | f               | f                      |                |                         4 | 
       7 | myGroup2         | M3              |           12 | f               | f                      |                |                         0 | 
       8 | myGroup2         | RLBK_M2_%_START |           13 | f               | f                      |                |                         2 | 
       9 | myGroup2         | RLBK_M2_%_DONE  |           14 | f               | f                      |                |                         0 | M2
      10 | myGroup2         | RLBK_M3_%_START |           15 | f               | f                      |                |                         2 | 
      11 | myGroup2         | RLBK_M3_%_DONE  |           16 | f               | f                      |                |                         0 | M3
      12 | myGroup1         | Common          |           17 | f               | f                      |                |                         0 | 
      13 | myGroup2         | Common          |           17 | f               | f                      |                |                           | 
      14 | myGroup1         | ALTER_%         |           18 | f               | f                      |                |                           | 
(14 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called
  from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
  sequ_schema   |             sequ_name              | sequ_time_id | sequ_last_val | sequ_is_called 
----------------+------------------------------------+--------------+---------------+----------------
 emaj           | myschema1_myTbl3_log_seq           |            4 |             1 | f
 emaj           | myschema1_mytbl1_log_seq           |            4 |             1 | f
 emaj           | myschema1_mytbl2_log_seq           |            4 |             1 | f
 emaj           | myschema1_mytbl4_log_seq           |            4 |             1 | f
 emajb          | myschema1_mytbl2b_log_seq          |            4 |             1 | f
 myschema1      | myTbl3_col31_seq                   |            4 |             1 | f
 emaj           | myschema2_myTbl3_log_seq           |            5 |             1 | f
 emaj           | myschema2_mytbl1_log_seq           |            5 |             1 | f
 emaj           | myschema2_mytbl2_log_seq           |            5 |             1 | f
 emaj           | myschema2_mytbl4_log_seq           |            5 |             1 | f
 myschema2      | myTbl3_col31_seq                   |            5 |             1 | f
 myschema2      | myseq1                             |            5 |          1000 | f
 emaj           | phil's schema3_myTbl2\_log_seq     |            6 |             1 | f
 emaj           | phil's schema3_phil's tbl1_log_seq |            6 |             1 | f
 phil's schema3 | phil's seq\1                       |            6 |          1000 | f
 emaj           | myschema1_myTbl3_log_seq           |            7 |            10 | t
 emaj           | myschema1_mytbl1_log_seq           |            7 |            15 | t
 emaj           | myschema1_mytbl2_log_seq           |            7 |             2 | t
 emaj           | myschema1_mytbl4_log_seq           |            7 |             1 | f
 emajb          | myschema1_mytbl2b_log_seq          |            7 |             2 | t
 myschema1      | myTbl3_col31_seq                   |            7 |            10 | t
 emaj           | myschema1_myTbl3_log_seq           |            8 |            10 | t
 emaj           | myschema1_mytbl1_log_seq           |            8 |            18 | t
 emaj           | myschema1_mytbl2_log_seq           |            8 |             2 | t
 emaj           | myschema1_mytbl4_log_seq           |            8 |             8 | t
 emajb          | myschema1_mytbl2b_log_seq          |            8 |             2 | t
 myschema1      | myTbl3_col31_seq                   |            8 |            10 | t
 emaj           | myschema2_myTbl3_log_seq           |           11 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           11 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           11 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           11 |             1 | f
 myschema2      | myTbl3_col31_seq                   |           11 |            10 | t
 myschema2      | myseq1                             |           11 |          1000 | t
 emaj           | myschema2_myTbl3_log_seq           |           12 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           12 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           12 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           12 |             4 | t
 myschema2      | myTbl3_col31_seq                   |           12 |            10 | t
 myschema2      | myseq1                             |           12 |          1003 | t
 emaj           | myschema2_myTbl3_log_seq           |           13 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           13 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           13 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           13 |             4 | t
 myschema2      | myTbl3_col31_seq                   |           13 |            10 | t
 myschema2      | myseq1                             |           13 |          1003 | t
 emaj           | myschema2_myTbl3_log_seq           |           14 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           14 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           14 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           14 |             6 | t
 myschema2      | myTbl3_col31_seq                   |           14 |            10 | t
 myschema2      | myseq1                             |           14 |          1001 | f
 emaj           | myschema2_myTbl3_log_seq           |           15 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           15 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           15 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           15 |             6 | t
 myschema2      | myTbl3_col31_seq                   |           15 |            10 | t
 myschema2      | myseq1                             |           15 |          1001 | f
 emaj           | myschema2_myTbl3_log_seq           |           16 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           16 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           16 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           16 |             8 | t
 myschema2      | myTbl3_col31_seq                   |           16 |            10 | t
 myschema2      | myseq1                             |           16 |          1004 | f
 emaj           | myschema1_myTbl3_log_seq           |           17 |            10 | t
 emaj           | myschema1_mytbl1_log_seq           |           17 |            24 | t
 emaj           | myschema1_mytbl2_log_seq           |           17 |             3 | t
 emaj           | myschema1_mytbl4_log_seq           |           17 |             9 | t
 emaj           | myschema2_myTbl3_log_seq           |           17 |            10 | t
 emaj           | myschema2_mytbl1_log_seq           |           17 |            15 | t
 emaj           | myschema2_mytbl2_log_seq           |           17 |             2 | t
 emaj           | myschema2_mytbl4_log_seq           |           17 |             8 | t
 emajb          | myschema1_mytbl2b_log_seq          |           17 |             4 | t
 myschema1      | myTbl3_col31_seq                   |           17 |            10 | t
 myschema2      | myTbl3_col31_seq                   |           17 |            10 | t
 myschema2      | myseq1                             |           17 |          1004 | f
 emaj           | myschema1_myTbl3_log_seq           |           18 |            10 | t
 emaj           | myschema1_mytbl1_log_seq           |           18 |            24 | t
 emaj           | myschema1_mytbl2_log_seq           |           18 |             3 | t
 emaj           | myschema1_mytbl4_log_seq           |           18 |             9 | t
 emajb          | myschema1_mytbl2b_log_seq          |           18 |             4 | t
 myschema1      | myTbl3_col31_seq                   |           18 |            10 | t
(81 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size
  from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | mytbl1     |                  8 |                9 |              6
 myschema1   | mytbl2     |                  8 |               10 |              1
 myschema1   | mytbl2b    |                  8 |               10 |              2
 myschema1   | mytbl4     |                  8 |               10 |              1
(4 rows)

select * from emaj.emaj_alter_plan order by 1,2,3,4,5;
 altr_time_id |       altr_step       | altr_schema | altr_tblseq | altr_group | altr_priority | altr_group_is_logging | altr_new_group | altr_new_priority | altr_new_group_is_logging | altr_rlbk_id 
--------------+-----------------------+-------------+-------------+------------+---------------+-----------------------+----------------+-------------------+---------------------------+--------------
           18 | REMOVE_TBL            | myschema1   | myTbl3      | myGroup1   |            10 | t                     |                |                   |                           |             
           18 | CHANGE_TBL_LOG_SCHEMA | myschema1   | mytbl2b     | myGroup1   |               | t                     |                |                   |                           |             
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |        1
     2 | ABC        | \x0c  | INS       | NEW        |        2
     3 | ABC        | \x0c  | INS       | NEW        |        3
     4 | ABC        | \x0c  | INS       | NEW        |        4
     5 | ABC        | \x0c  | INS       | NEW        |        5
     6 | ABC        | \x0c  | INS       | NEW        |        6
     7 | ABC        | \x0c  | INS       | NEW        |        7
     8 | ABC        | \x0c  | INS       | NEW        |        8
     9 | ABC        | \x0c  | INS       | NEW        |        9
    10 | ABC        | \x0c  | INS       | NEW        |       10
    11 | ABC        | \x0c  | INS       | NEW        |       11
     1 | ABC        | \x0c  | UPD       | OLD        |       12
     1 | ABC        | \x1c  | UPD       | NEW        |       12
     2 | ABC        | \x0c  | UPD       | OLD        |       13
     2 | ABC        | \x1c  | UPD       | NEW        |       13
     3 | ABC        | \x0c  | UPD       | OLD        |       14
     3 | ABC        | \x1c  | UPD       | NEW        |       14
    11 | ABC        | \x0c  | DEL       | OLD        |       17
    10 | ABC        | \x0c  | DEL       | OLD        |       35
     1 | ABC        | \x1c  | UPD       | OLD        |       37
     1 | DEF        | \x1c  | UPD       | NEW        |       37
     2 | ABC        | \x1c  | UPD       | OLD        |       38
     2 | DEF        | \x1c  | UPD       | NEW        |       38
(23 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 12-31-2010 | INS       | NEW        |       15
     2 | DEF   |            | INS       | NEW        |       18
(2 rows)

select col20, col21, emaj_verb, emaj_tuple, emaj_gid from emajb.mySchema1_myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 |     1 | INS       | NEW        |       16
     2 |     2 | INS       | NEW        |       19
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj."myschema1_myTbl3_log_1" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       20
     2 | 10.00 | INS       | NEW        |       21
     3 | 10.00 | INS       | NEW        |       22
     4 | 10.00 | INS       | NEW        |       23
     5 | 10.00 | INS       | NEW        |       24
     6 | 10.00 | INS       | NEW        |       25
     7 | 10.00 | INS       | NEW        |       26
     8 | 10.00 | INS       | NEW        |       27
     9 | 10.00 | INS       | NEW        |       28
    10 | 10.00 | INS       | NEW        |       29
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema1_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       30
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |       31
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       32
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       32
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       33
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       33
     3 | FK... |     1 |    10 | ABC        | INS       | NEW        |       34
     3 | FK... |     1 |    10 | ABC        | DEL       | OLD        |       36
     1 | FK... |     2 |     1 | ABC        | UPD       | OLD        |       39
     1 | FK... |     2 |       |            | UPD       | NEW        |       39
     2 | FK... |     2 |     1 | ABC        | UPD       | OLD        |       40
     2 | FK... |     2 |       |            | UPD       | NEW        |       40
(12 rows)

--
select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |       51
     2 | ABC        | \x0c  | INS       | NEW        |       52
     3 | ABC        | \x0c  | INS       | NEW        |       53
     4 | ABC        | \x0c  | INS       | NEW        |       54
     5 | ABC        | \x0c  | INS       | NEW        |       55
     6 | ABC        | \x0c  | INS       | NEW        |       56
     7 | ABC        | \x0c  | INS       | NEW        |       57
     8 | ABC        | \x0c  | INS       | NEW        |       58
     9 | ABC        | \x0c  | INS       | NEW        |       59
    10 | ABC        | \x0c  | INS       | NEW        |       60
    11 | ABC        | \x0c  | INS       | NEW        |       61
     1 | ABC        | \x0c  | UPD       | OLD        |       62
     1 | ABC        | \x1c  | UPD       | NEW        |       62
     2 | ABC        | \x0c  | UPD       | OLD        |       63
     2 | ABC        | \x1c  | UPD       | NEW        |       63
     3 | ABC        | \x0c  | UPD       | OLD        |       64
     3 | ABC        | \x1c  | UPD       | NEW        |       64
    11 | ABC        | \x0c  | DEL       | OLD        |       66
(18 rows)

select col21, col22, col23, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 |   col23    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+------------+-----------+------------+----------
     1 | ABC   | 01-01-2010 | INS       | NEW        |       65
     2 | DEF   |            | INS       | NEW        |       67
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj."myschema2_myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |       68
     2 | 10.00 | INS       | NEW        |       69
     3 | 10.00 | INS       | NEW        |       70
     4 | 10.00 | INS       | NEW        |       71
     5 | 10.00 | INS       | NEW        |       72
     6 | 10.00 | INS       | NEW        |       73
     7 | 10.00 | INS       | NEW        |       74
     8 | 10.00 | INS       | NEW        |       75
     9 | 10.00 | INS       | NEW        |       76
    10 | 10.00 | INS       | NEW        |       77
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj.mySchema2_myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |       78
     2 | FK... |     1 |     1 | ABC        | INS       | NEW        |       79
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       80
     1 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       80
     2 | FK... |     1 |     1 | ABC        | UPD       | OLD        |       81
     2 | FK... |     2 |     1 | ABC        | UPD       | NEW        |       81
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD        |       82
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD        |       83
     1 | FK... |     2 |     1 | ABC        | INS       | NEW        |       84
     2 | FK... |     2 |     1 | ABC        | INS       | NEW        |       85
(10 rows)

