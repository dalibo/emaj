-- after_restore.sql: test the emaj environment restored from a dump taken at the end of schedule reg tests
-- All operations are executed by a super-user
--
-----------------------------
-- Checking restore
-----------------------------
DO LANGUAGE plpgsql $$
DECLARE
  r             RECORD;
  keepTable     BOOLEAN = false;
  delta         SMALLINT;
  expected_val  BIGINT;
  returned_val  BIGINT;
BEGIN
-- Comparing the number of rows in each table
  FOR r IN
    SELECT nspname, relname
      FROM pg_catalog.pg_class, pg_catalog.pg_namespace
     WHERE relnamespace = pg_namespace.oid
       AND relkind = 'r' AND nspname ~ '^emaj' AND relname !~ '^emaj_regtest'
     ORDER BY 1,2
  LOOP
    SELECT tbl_tuple INTO expected_val FROM emaj.emaj_regtest_dump_tbl WHERE tbl_schema = r.nspname AND tbl_name = r.relname;
    EXECUTE 'SELECT count(*) FROM '||quote_ident(r.nspname)||'.'||quote_ident(r.relname) INTO returned_val;
    IF NOT (expected_val = returned_val OR (r.nspname || '.' || r.relname = 'emaj.emaj_hist' AND expected_val = returned_val - 1)) THEN
-- the emaj_hist table may contain 1 more row created at extension creation
      RAISE WARNING 'Error, the table %.% contains % rows instead of %', quote_ident(r.nspname), quote_ident(r.relname), returned_val, expected_val;
      keepTable = true;
    END IF;
  END LOOP;
-- Comparing the properties of each sequence
  FOR r IN
    SELECT nspname, relname
      FROM pg_catalog.pg_class, pg_catalog.pg_namespace
     WHERE relnamespace = pg_namespace.oid
       AND relkind = 'S' AND nspname ~ '^emaj' AND relname !~ '^emaj_regtest' AND relname ~ '_seq$'
     ORDER BY 1,2
  LOOP
    EXECUTE 'SELECT * FROM emaj.emaj_regtest_dump_seq WHERE sequ_schema = ' || quote_literal(r.nspname) || ' AND sequ_name = ' || quote_literal(r.relname)
         || ' EXCEPT SELECT * FROM emaj._get_current_sequence_state(' || quote_literal(r.nspname) || ',' || quote_literal(r.relname) || ',0)';
    GET DIAGNOSTICS delta = ROW_COUNT;
    IF delta > 0 THEN
      SELECT sequ_last_val INTO expected_val FROM emaj.emaj_regtest_dump_seq WHERE sequ_schema = r.nspname AND sequ_name = r.relname;
      EXECUTE 'SELECT sequ_last_val FROM emaj._get_current_sequence_state(' || quote_literal(r.nspname) || ',' || quote_literal(r.relname) || ',0)'
        INTO returned_val;
      IF expected_val <> returned_val THEN
        RAISE WARNING 'Error, the sequence %.% has last_val equal to % instead of %', quote_ident(r.nspname), quote_ident(r.relname), returned_val, expected_val;
      ELSE
        RAISE WARNING 'Error, the properties of the sequence %.% are not the expected ones', quote_ident(r.nspname), quote_ident(r.relname);
      END IF;
      keepTable = true;
    END IF;
  END LOOP;
-- if everything is OK, drop both control tables created just before the database dump
  IF NOT keepTable THEN
    DROP TABLE emaj.emaj_regtest_dump_tbl, emaj.emaj_regtest_dump_seq;
  END IF;
END $$;
DO
-----------------------------
-- Let's use the E-Maj environment
-----------------------------
-----------------------------
-- Step 1 : for myGroup2, update tables and set a mark 
-----------------------------
set search_path=myschema2;
SET
insert into myTbl1 select 100+i, 'KLM', E'\\000\\014'::bytea from generate_series (1,11) as i;
INSERT 0 11
update myTbl1 set col13=E'\\000\\034'::bytea where col11 >105;
UPDATE 6
insert into myTbl2 values (100,'KLM','2012-12-31');
INSERT 0 1
delete from myTbl1 where col11 > 110;
DELETE 1
select nextval('myschema2.myseq1');
 nextval 
---------
    1004
(1 row)

--
select emaj.emaj_set_mark_group('myGroup2','After restore mark');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

--
-----------------------------
-- Checking step 1
-----------------------------
-- emaj tables
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
 mark_group |        regexp_replace        | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |     mark_comment     | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+------------------------------+--------------+-----------------+------------------------+----------------------+---------------------------+------------------------------
 myGroup2   | M3                           |        12201 | t               | f                      | This mark is deleted |                         0 | 
 myGroup1   | M4                           |        12401 | t               | f                      |                      |                        10 | 
 myGroup1   | M5                           |        12402 | t               | f                      |                      |                         3 | 
 myGroup1   | Before logged rollback to M4 |        12601 | t               | f                      |                      |                        28 | 
 myGroup1   | STOP_%                       |        14000 | t               | f                      |                      |                         0 | 
 myGroup2   | STOP_%                       |        14000 | t               | f                      |                      |                         0 | 
 myGroup1   | Stop after rollback          |        14007 | t               | f                      |                      |                         0 | 
 myGroup2   | Stop after rollback          |        14007 | t               | f                      |                      |                         0 | 
 myGroup1   | Multi-1                      |        14008 | f               | f                      |                      |                         0 | 
 myGroup2   | Multi-1                      |        14008 | f               | f                      |                      |                        92 | 
 myGroup2   | RLBK_Multi-1_%_START         |        20001 | f               | f                      |                      |                        32 | 
 myGroup2   | RLBK_Multi-1_%_DONE          |        20002 | f               | f                      |                      |                        30 | Multi-1
 myGroup2   | RLBK_Multi-1_%_START         |        20201 | f               | f                      |                      |                        32 | 
 myGroup2   | RLBK_Multi-1_%_DONE          |        20202 | f               | f                      |                      |                        19 | Multi-1
 myGroup2   | After restore mark           |        20204 | f               | f                      |                      |                           | 
(15 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-------------------+--------------+---------------+----------------
 myschema2   | myseq1            |        12201 |          1003 | t
 myschema2   | myTbl3_col31_seq  |        12201 |            20 | t
 myschema1   | mytbl2b_col20_seq |        12401 |             5 | t
 myschema1   | myTbl3_col31_seq  |        12401 |            20 | t
 myschema1   | mytbl2b_col20_seq |        12402 |             5 | t
 myschema1   | myTbl3_col31_seq  |        12402 |            20 | t
 myschema1   | mytbl2b_col20_seq |        12601 |             5 | t
 myschema1   | myTbl3_col31_seq  |        12601 |            20 | t
 myschema1   | mytbl2b_col20_seq |        14000 |             5 | t
 myschema1   | myTbl3_col31_seq  |        14000 |            20 | t
 myschema2   | myseq1            |        14000 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        14000 |            20 | t
 myschema1   | mytbl2b_col20_seq |        14007 |             5 | t
 myschema1   | myTbl3_col31_seq  |        14007 |            20 | t
 myschema2   | myseq1            |        14007 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        14007 |            20 | t
 myschema1   | mytbl2b_col20_seq |        14008 |             5 | t
 myschema1   | myTbl3_col31_seq  |        14008 |            20 | t
 myschema2   | myseq1            |        14008 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        14008 |            20 | t
 myschema2   | myseq1            |        20001 |          9999 | f
 myschema2   | myTbl3_col31_seq  |        20001 |            20 | t
 myschema2   | myseq1            |        20002 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        20002 |            20 | t
 myschema2   | myseq1            |        20201 |          9999 | f
 myschema2   | myTbl3_col31_seq  |        20201 |            20 | t
 myschema2   | myseq1            |        20202 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        20202 |            20 | t
 myschema2   | myseq1            |        20204 |          1004 | t
 myschema2   | myTbl3_col31_seq  |        20204 |            20 | t
(30 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl1   |       12201 |                   15
 myschema2  | mytbl2   |       12201 |                    2
 myschema2  | myTbl3   |       12201 |                   10
 myschema2  | mytbl4   |       12201 |                    4
 myschema2  | mytbl5   |       12201 |                    4
 myschema2  | mytbl6   |       12201 |                   14
 myschema1  | mytbl1   |       12401 |                   30
 myschema1  | mytbl2   |       12401 |                    3
 myschema1  | mytbl2b  |       12401 |                    3
 myschema1  | myTbl3   |       12401 |                   10
 myschema1  | mytbl4   |       12401 |                    8
 myschema1  | mytbl1   |       12402 |                   30
 myschema1  | mytbl2   |       12402 |                    3
 myschema1  | mytbl2b  |       12402 |                    3
 myschema1  | myTbl3   |       12402 |                   20
 myschema1  | mytbl4   |       12402 |                    8
 myschema1  | mytbl1   |       12601 |                   32
 myschema1  | mytbl2   |       12601 |                    3
 myschema1  | mytbl2b  |       12601 |                    3
 myschema1  | myTbl3   |       12601 |                   20
 myschema1  | mytbl4   |       12601 |                   12
 myschema1  | mytbl1   |       14000 |                   33
 myschema1  | mytbl2   |       14000 |                    3
 myschema1  | mytbl2b  |       14000 |                    3
 myschema1  | myTbl3   |       14000 |                   45
 myschema1  | mytbl4   |       14000 |                   14
 myschema2  | mytbl1   |       14000 |                   15
 myschema2  | mytbl2   |       14000 |                    2
 myschema2  | myTbl3   |       14000 |                   10
 myschema2  | mytbl4   |       14000 |                   10
 myschema2  | mytbl5   |       14000 |                    7
 myschema2  | mytbl6   |       14000 |                   23
 myschema1  | mytbl1   |       14007 |                   33
 myschema1  | mytbl2   |       14007 |                    3
 myschema1  | mytbl2b  |       14007 |                    3
 myschema1  | myTbl3   |       14007 |                   45
 myschema1  | mytbl4   |       14007 |                   14
 myschema2  | mytbl1   |       14007 |                   15
 myschema2  | mytbl2   |       14007 |                    2
 myschema2  | myTbl3   |       14007 |                   10
 myschema2  | mytbl4   |       14007 |                   10
 myschema2  | mytbl5   |       14007 |                    7
 myschema2  | mytbl6   |       14007 |                   23
 myschema1  | mytbl1   |       14008 |                   33
 myschema1  | mytbl2   |       14008 |                    3
 myschema1  | mytbl2b  |       14008 |                    3
 myschema1  | myTbl3   |       14008 |                   45
 myschema1  | mytbl4   |       14008 |                   14
 myschema2  | mytbl1   |       14008 |                   15
 myschema2  | mytbl2   |       14008 |                    2
 myschema2  | myTbl3   |       14008 |                   10
 myschema2  | mytbl4   |       14008 |                   10
 myschema2  | mytbl5   |       14008 |                    7
 myschema2  | mytbl6   |       14008 |                   23
 myschema2  | mytbl1   |       20001 |                   31
 myschema2  | mytbl2   |       20001 |                   10
 myschema2  | myTbl3   |       20001 |                   20
 myschema2  | mytbl4   |       20001 |                   12
 myschema2  | mytbl5   |       20001 |                   16
 myschema2  | mytbl6   |       20001 |                   70
 myschema2  | mytbl1   |       20002 |                   41
 myschema2  | mytbl2   |       20002 |                   12
 myschema2  | myTbl3   |       20002 |                   30
 myschema2  | mytbl4   |       20002 |                   14
 myschema2  | mytbl5   |       20002 |                   17
 myschema2  | mytbl6   |       20002 |                   77
 myschema2  | mytbl1   |       20201 |                   51
 myschema2  | mytbl2   |       20201 |                   14
 myschema2  | myTbl3   |       20201 |                   40
 myschema2  | mytbl4   |       20201 |                   16
 myschema2  | mytbl5   |       20201 |                   18
 myschema2  | mytbl6   |       20201 |                   82
 myschema2  | mytbl1   |       20202 |                   61
 myschema2  | mytbl2   |       20202 |                   16
 myschema2  | myTbl3   |       20202 |                   50
 myschema2  | mytbl4   |       20202 |                   18
 myschema2  | mytbl5   |       20202 |                   19
 myschema2  | mytbl6   |       20202 |                   89
 myschema2  | mytbl1   |       20204 |                   79
 myschema2  | mytbl2   |       20204 |                   17
 myschema2  | myTbl3   |       20204 |                   50
 myschema2  | mytbl4   |       20204 |                   18
 myschema2  | mytbl5   |       20204 |                   19
 myschema2  | mytbl6   |       20204 |                   89
(84 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13  
-------+------------+--------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
   101 | KLM        | \x000c
   102 | KLM        | \x000c
   103 | KLM        | \x000c
   104 | KLM        | \x000c
   105 | KLM        | \x000c
   106 | KLM        | \x001c
   107 | KLM        | \x001c
   108 | KLM        | \x001c
   109 | KLM        | \x001c
   110 | KLM        | \x001c
(20 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
   100 | KLM   | 2012-12-31
(3 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple from emaj_myschema2.mytbl1_log order by col11, col12, emaj_gid, emaj_tuple desc;
 col11 |    col12     |  col13   | emaj_verb | emaj_tuple 
-------+--------------+----------+-----------+------------
     1 | ABC          | \x1c     | DEL       | OLD
     1 | ABC          | \x1c     | INS       | NEW
     1 | ABC          | \x1c     | DEL       | OLD
     1 | ABC          | \x1c     | INS       | NEW
     2 | ABC          | \x1c     | DEL       | OLD
     2 | ABC          | \x1c     | INS       | NEW
     2 | ABC          | \x1c     | DEL       | OLD
     2 | ABC          | \x1c     | INS       | NEW
     3 | ABC          | \x1c     | DEL       | OLD
     3 | ABC          | \x1c     | INS       | NEW
     3 | ABC          | \x1c     | DEL       | OLD
     3 | ABC          | \x1c     | INS       | NEW
     4 | ABC          | \x0c     | DEL       | OLD
     4 | ABC          | \x0c     | INS       | NEW
     4 | ABC          | \x0c     | DEL       | OLD
     4 | ABC          | \x0c     | INS       | NEW
     5 | ABC          | \x0c     | DEL       | OLD
     5 | ABC          | \x0c     | INS       | NEW
     5 | ABC          | \x0c     | DEL       | OLD
     5 | ABC          | \x0c     | INS       | NEW
     6 | ABC          | \x0c     | DEL       | OLD
     6 | ABC          | \x0c     | INS       | NEW
     6 | ABC          | \x0c     | DEL       | OLD
     6 | ABC          | \x0c     | INS       | NEW
     7 | ABC          | \x0c     | DEL       | OLD
     7 | ABC          | \x0c     | INS       | NEW
     7 | ABC          | \x0c     | DEL       | OLD
     7 | ABC          | \x0c     | INS       | NEW
     8 | ABC          | \x0c     | DEL       | OLD
     8 | ABC          | \x0c     | INS       | NEW
     8 | ABC          | \x0c     | DEL       | OLD
     8 | ABC          | \x0c     | INS       | NEW
     9 | ABC          | \x0c     | DEL       | OLD
     9 | ABC          | \x0c     | INS       | NEW
     9 | ABC          | \x0c     | DEL       | OLD
     9 | ABC          | \x0c     | INS       | NEW
    10 | ABC          | \x0c     | DEL       | OLD
    10 | ABC          | \x0c     | INS       | NEW
    10 | ABC          | \x0c     | DEL       | OLD
    10 | ABC          | \x0c     | INS       | NEW
   101 | KLM          | \x000c   | INS       | NEW
   102 | KLM          | \x000c   | INS       | NEW
   103 | KLM          | \x000c   | INS       | NEW
   104 | KLM          | \x000c   | INS       | NEW
   105 | KLM          | \x000c   | INS       | NEW
   106 | KLM          | \x000c   | INS       | NEW
   106 | KLM          | \x000c   | UPD       | OLD
   106 | KLM          | \x001c   | UPD       | NEW
   107 | KLM          | \x000c   | INS       | NEW
   107 | KLM          | \x000c   | UPD       | OLD
   107 | KLM          | \x001c   | UPD       | NEW
   108 | KLM          | \x000c   | INS       | NEW
   108 | KLM          | \x000c   | UPD       | OLD
   108 | KLM          | \x001c   | UPD       | NEW
   109 | KLM          | \x000c   | INS       | NEW
   109 | KLM          | \x000c   | UPD       | OLD
   109 | KLM          | \x001c   | UPD       | NEW
   110 | KLM          | \x000c   | INS       | NEW
   110 | KLM          | \x000c   | UPD       | OLD
   110 | KLM          | \x001c   | UPD       | NEW
   111 | KLM          | \x000c   | INS       | NEW
   111 | KLM          | \x000c   | UPD       | OLD
   111 | KLM          | \x001c   | UPD       | NEW
   111 | KLM          | \x001c   | DEL       | OLD
   200 |  Start  End  | \x410042 | UPD       | NEW
   200 |  Start  End  | \x410042 | DEL       | OLD
   200 | Start   End  | \x410042 | INS       | NEW
   200 | Start   End  | \x410042 | UPD       | OLD
(68 rows)

select col21, col22, col23, emaj_verb, emaj_tuple from emaj_myschema2.mytbl2_log order by col21, emaj_gid, emaj_tuple desc;
 col21 |                                          col22                                           |   col23    | emaj_verb | emaj_tuple 
-------+------------------------------------------------------------------------------------------+------------+-----------+------------
     1 | ABC                                                                                      | 2010-01-01 | DEL       | OLD
     1 | ABC                                                                                      | 2010-01-01 | INS       | NEW
     1 | ABC                                                                                      | 2010-01-01 | DEL       | OLD
     1 | ABC                                                                                      | 2010-01-01 | INS       | NEW
     2 | DEF                                                                                      |            | DEL       | OLD
     2 | DEF                                                                                      |            | INS       | NEW
     2 | DEF                                                                                      |            | DEL       | OLD
     2 | DEF                                                                                      |            | INS       | NEW
    10 | row 1 \r... and row 2 with a ' (quote) character                                         |            | INS       | NEW
    10 | row 1 \r... and row 2 with a ' (quote) character                                         |            | DEL       | OLD
    11 | row 1 with a true \ character\r... and row 2 with two \n true and a ' (quote) characters |            | INS       | NEW
    11 | row 1 with a true \ character\r... and row 2 with two \n true and a ' (quote) characters |            | DEL       | OLD
   100 | KLM                                                                                      | 2012-12-31 | INS       | NEW
(13 rows)

select col31, col33, emaj_verb, emaj_tuple from emaj_myschema2."myTbl3_log" order by col31, emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple 
-------+-------+-----------+------------
    11 | 10.00 | DEL       | OLD
    11 | 10.00 | INS       | NEW
    11 | 10.00 | DEL       | OLD
    11 | 10.00 | INS       | NEW
    12 | 10.00 | DEL       | OLD
    12 | 10.00 | INS       | NEW
    12 | 10.00 | DEL       | OLD
    12 | 10.00 | INS       | NEW
    13 | 10.00 | DEL       | OLD
    13 | 10.00 | INS       | NEW
    13 | 10.00 | DEL       | OLD
    13 | 10.00 | INS       | NEW
    14 | 10.00 | DEL       | OLD
    14 | 10.00 | INS       | NEW
    14 | 10.00 | DEL       | OLD
    14 | 10.00 | INS       | NEW
    15 | 10.00 | DEL       | OLD
    15 | 10.00 | INS       | NEW
    15 | 10.00 | DEL       | OLD
    15 | 10.00 | INS       | NEW
    16 | 10.00 | DEL       | OLD
    16 | 10.00 | INS       | NEW
    16 | 10.00 | DEL       | OLD
    16 | 10.00 | INS       | NEW
    17 | 10.00 | DEL       | OLD
    17 | 10.00 | INS       | NEW
    17 | 10.00 | DEL       | OLD
    17 | 10.00 | INS       | NEW
    18 | 10.00 | DEL       | OLD
    18 | 10.00 | INS       | NEW
    18 | 10.00 | DEL       | OLD
    18 | 10.00 | INS       | NEW
    19 | 10.00 | DEL       | OLD
    19 | 10.00 | INS       | NEW
    19 | 10.00 | DEL       | OLD
    19 | 10.00 | INS       | NEW
    20 | 10.00 | DEL       | OLD
    20 | 10.00 | INS       | NEW
    20 | 10.00 | DEL       | OLD
    20 | 10.00 | INS       | NEW
(40 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple from emaj_myschema2.mytbl4_log order by col41, emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple 
-------+-------+-------+-------+------------+-----------+------------
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD
     1 | FK... |     2 |     1 | ABC        | INS       | NEW
     1 | FK... |     2 |     1 | ABC        | DEL       | OLD
     1 | FK... |     2 |     1 | ABC        | INS       | NEW
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD
     2 | FK... |     2 |     1 | ABC        | INS       | NEW
     2 | FK... |     2 |     1 | ABC        | DEL       | OLD
     2 | FK... |     2 |     1 | ABC        | INS       | NEW
(8 rows)

--
-----------------------------
-- Step 2 : for myGroup2, rollback to mark Multi-1 (set before dump/restore) 
-----------------------------
select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows from emaj.emaj_log_stat_group('myGroup2','Multi-1',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_last_mark | stat_rows 
------------+-------------+------------+-----------------+----------------+-----------
 myGroup2   | myschema2   | mytbl1     | Multi-1         |                |        64
 myGroup2   | myschema2   | mytbl2     | Multi-1         |                |        15
 myGroup2   | myschema2   | myTbl3     | Multi-1         |                |        40
 myGroup2   | myschema2   | mytbl4     | Multi-1         |                |         8
 myGroup2   | myschema2   | mytbl5     | Multi-1         |                |        12
 myGroup2   | myschema2   | mytbl6     | Multi-1         |                |        66
(6 rows)

select * from emaj.emaj_rollback_group('myGroup2','Multi-1');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 20202.
 Notice        | 6 / 6 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

--
-----------------------------
-- Checking step 2
-----------------------------
-- emaj tables
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_deleted, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
 mark_group |        regexp_replace        | mark_time_id | mark_is_deleted | mark_is_rlbk_protected |     mark_comment     | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+------------------------------+--------------+-----------------+------------------------+----------------------+---------------------------+------------------------------
 myGroup2   | M3                           |        12201 | t               | f                      | This mark is deleted |                         0 | 
 myGroup1   | M4                           |        12401 | t               | f                      |                      |                        10 | 
 myGroup1   | M5                           |        12402 | t               | f                      |                      |                         3 | 
 myGroup1   | Before logged rollback to M4 |        12601 | t               | f                      |                      |                        28 | 
 myGroup1   | STOP_%                       |        14000 | t               | f                      |                      |                         0 | 
 myGroup2   | STOP_%                       |        14000 | t               | f                      |                      |                         0 | 
 myGroup1   | Stop after rollback          |        14007 | t               | f                      |                      |                         0 | 
 myGroup2   | Stop after rollback          |        14007 | t               | f                      |                      |                         0 | 
 myGroup1   | Multi-1                      |        14008 | f               | f                      |                      |                         0 | 
 myGroup2   | Multi-1                      |        14008 | f               | f                      |                      |                           | 
(10 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
      -4 |                    | 
      -3 |                    | 
      -2 |                    | 
      -1 |                    | 
    1000 |            1000000 | C
    1001 |            1000000 | C
    1002 |            1000000 | C
    1003 |            1000000 | C
    1004 |            1000000 | C
    1005 |            1000000 | C
    1006 |            1000000 | C
    1014 |            1000000 | A
    1015 |            1000000 | A
    1016 |            1000000 | A
    1017 |            1000000 | A
    1018 |            1000000 | A
    1019 |            1000000 | A
    1020 |            1000000 | A
    1021 |            1000000 | A
    1022 |            1000000 | A
    1023 |            1000000 | A
    1024 |            1000000 | A
    1025 |            1000000 | A
    1026 |            1000000 | A
    1027 |            1000000 | A
    1028 |            1000000 | A
    1029 |            1000000 | A
    1030 |            1000000 | I
    1031 |            1000000 | I
    1032 |            1000000 | I
    1033 |            1000000 | D
    1034 |            1000000 | I
    1035 |            1000000 | I
    1036 |            1000000 | I
    1037 |            1000000 | I
    1038 |            1000000 | I
    1039 |            1000000 | D
    1041 |            1000000 | I
    1042 |            1000000 | I
    1043 |            1000000 | A
    1044 |            1000000 | M
    1045 |            1000000 | M
    1047 |            1000000 | D
    1048 |            1000000 | D
    1049 |            1000000 | D
    1050 |            1000000 | D
    1051 |            1000000 | D
    1052 |            1000000 | C
    1053 |            1000000 | A
    1054 |            1000000 | M
    1055 |            1000000 | D
    1056 |            1000000 | C
    1057 |            1000000 | A
    1058 |            1000000 | M
    1059 |            1000000 | D
    2000 |            2000000 | I
    2001 |            2000000 | M
    2002 |            2000000 | M
    2003 |            2000000 | M
    2004 |            2000000 | M
    2005 |            2000000 | M
    2006 |            2000000 | M
    2008 |            2000000 | M
    2009 |            2000000 | M
    2200 |            2200000 | M
    2201 |            2200000 | M
    2202 |            2200000 | M
    2203 |            2200000 | M
    2204 |            2200000 | M
    2205 |            2200000 | M
    2206 |            2200000 | M
    2400 |            2400000 | M
    2401 |            2400000 | M
    2403 |            2400000 | M
    2500 |            2500000 | M
    2501 |            2500000 | M
    2600 |            2600000 | M
    2601 |            2600000 | M
    2602 |            2600000 | M
    2603 |            2600000 | M
    3000 |            3000000 | M
    3001 |            3000000 | M
    3002 |            3000000 | M
    3003 |            3000000 | M
    3004 |            3000000 | M
    3005 |            3000000 | M
    3006 |            3000000 | M
    3007 |            3000000 | M
    3008 |            3000000 | M
    3009 |            3000000 | M
    3010 |            3000000 | M
    3011 |            3000000 | M
    3012 |            3000000 | M
    3013 |            3000000 | M
    3014 |            3000000 | M
    3015 |            3000000 | M
    3400 |            3400000 | M
    3401 |            3400000 | M
    3402 |            3400000 | M
    3600 |            3600000 | M
    3601 |            3600000 | M
    4000 |            4000000 | A
    4003 |            4000000 | M
    4004 |            4000000 | M
    4005 |            4000000 | M
    4006 |            4000000 | M
    4007 |            4000000 | R
    4008 |            4000000 | C
    4009 |            4000000 | D
    4018 |            4000000 | R
    4019 |            4000000 | R
    4020 |            4000000 | M
    4021 |            4000000 | R
    4022 |            4000000 | R
    4023 |            4000000 | R
    4024 |            4000000 | M
    4025 |            4000000 | R
    4026 |            4000000 | M
    4027 |            4000000 | M
    4028 |            4000000 | M
    4029 |            4000000 | M
    4030 |            4000027 | M
    4031 |            4000039 | M
    4032 |            4000039 | R
    4033 |            4000039 | R
    4034 |            4000039 | M
    4035 |            4000039 | M
    4036 |            4000058 | M
    4037 |            4000069 | M
    4038 |            4000069 | R
    4039 |            4000080 | M
    4040 |            4000080 | R
    4041 |            4000094 | M
    4042 |            4000094 | R
    4043 |            4000094 | R
    4044 |            4000094 | R
    4045 |            4000094 | M
    4046 |            4000094 | A
    4047 |            4000094 | M
    4048 |            4000101 | M
    4049 |            4000111 | R
    4050 |            4000119 | M
    4051 |            4000119 | R
    4052 |            4000119 | M
    4053 |            4000119 | R
    4054 |            4000119 | M
    4055 |            4000119 | M
    4056 |            4000134 | M
    4057 |            4000136 | R
    4058 |            4000150 | M
    4059 |            4000152 | R
    4060 |            4000152 | A
    4064 |            4000152 | R
    5000 |            5000000 | M
    5002 |            5000000 | M
    5003 |            5000000 | M
    5004 |            5011600 | M
    5005 |            5011600 | M
    5006 |            5011710 | M
    5007 |            5011710 | M
    5300 |            5300000 | S
    5301 |            5300000 | M
    8000 |            8000000 | M
    8001 |            8000000 | D
    8002 |            8000000 | D
    8003 |            8000000 | M
    8004 |            8000000 | D
    8005 |            8000000 | D
    8006 |            8000000 | D
    8007 |            8000000 | C
    8008 |            8000000 | I
    8009 |            8000000 | A
    8010 |            8000000 | A
    8011 |            8000000 | A
    8012 |            8000000 | A
    8013 |            8000000 | A
    8014 |            8000000 | A
    8015 |            8000000 | A
    8016 |            8000000 | A
    8017 |            8000000 | I
    8200 |            8200000 | A
    8201 |            8200000 | A
    8202 |            8200000 | A
    8203 |            8200000 | A
    8204 |            8200000 | A
    8205 |            8200000 | A
    8206 |            8200000 | A
    8207 |            8200000 | A
    8400 |            8400000 | A
    8401 |            8400000 | A
    8402 |            8400000 | A
    8403 |            8400000 | A
    8404 |            8400000 | A
    8405 |            8400000 | A
    8406 |            8400000 | A
    8407 |            8400000 | A
    8408 |            8400000 | A
    8409 |            8400000 | A
    8410 |            8400000 | A
    9000 |            9000000 | A
    9001 |            9000000 | M
    9002 |            9000000 | A
    9003 |            9000000 | A
    9004 |            9000000 | A
    9005 |            9000000 | A
    9006 |            9000000 | M
    9007 |            9000002 | R
    9008 |            9000002 | I
    9100 |            9100000 | M
    9101 |            9100000 | M
    9102 |            9100000 | A
    9103 |            9100000 | M
    9105 |            9100000 | R
    9106 |            9100000 | M
    9107 |            9100000 | A
    9108 |            9100000 | A
    9109 |            9100000 | A
    9110 |            9100000 | R
    9300 |            9300000 | M
    9301 |            9300000 | M
    9302 |            9300000 | A
    9303 |            9300000 | S
    9304 |            9300000 | M
    9305 |            9300000 | R
    9307 |            9300000 | R
    9310 |            9300000 | I
    9500 |            9500000 | M
    9501 |            9500000 | M
    9502 |            9500000 | A
    9504 |            9500002 | M
    9505 |            9500003 | M
    9507 |            9500003 | R
    9508 |            9500007 | M
    9509 |            9500010 | A
    9510 |            9500010 | A
    9511 |            9500011 | S
    9512 |            9500011 | I
    9513 |            9500011 | R
    9700 |            9700001 | M
    9701 |            9700002 | A
    9703 |            9700002 | S
    9705 |            9700003 | R
    9706 |            9700004 | M
    9707 |            9700004 | A
    9708 |            9700004 | R
    9713 |            9700004 | I
    9714 |            9700004 | M
    9715 |            9700004 | R
    9716 |            9700004 | R
    9717 |            9700004 | M
    9718 |            9700004 | R
    9719 |            9700004 | R
    9720 |            9700004 | R
    9721 |            9700004 | M
    9722 |            9700004 | R
   10004 |           10000000 | M
   10005 |           10000003 | A
   10006 |           10000003 | A
   10007 |           10000003 | A
   10008 |           10000003 | M
   10009 |           10000005 | R
   10010 |           10000009 | M
   10011 |           10000009 | R
   10012 |           10000009 | M
   10013 |           10000009 | I
   10014 |           10000009 | M
   10015 |           10000010 | A
   10016 |           10000010 | A
   10017 |           10000010 | A
   10018 |           10000010 | A
   10019 |           10000011 | A
   10020 |           10000011 | A
   10021 |           10000011 | A
   10022 |           10000011 | A
   10023 |           10000011 | A
   10024 |           10000011 | A
   10025 |           10000011 | A
   10026 |           10000011 | A
   10030 |           10000014 | R
   10031 |           10000014 | A
   10032 |           10000014 | A
   10033 |           10000014 | A
   10034 |           10000014 | A
   10035 |           10000014 | A
   10036 |           10000014 | A
   10037 |           10000014 | A
   10038 |           10000014 | A
   10039 |           10000014 | A
   10040 |           10000014 | A
   10041 |           10000014 | A
   10042 |           10000014 | A
   10043 |           10000014 | A
   10044 |           10000014 | A
   10045 |           10000014 | M
   10046 |           10000014 | D
   10047 |           10000014 | M
   10048 |           10000014 | D
   10049 |           10000014 | D
   10050 |           10000014 | D
   11000 |           11000000 | C
   11001 |           11000000 | A
   11002 |           11000000 | A
   11003 |           11000000 | M
   11004 |           11000000 | C
   11005 |           11000000 | A
   11006 |           11000000 | A
   11007 |           11000000 | M
   12000 |           12000000 | M
   12001 |           12000000 | D
   12002 |           12000000 | D
   12003 |           12000000 | D
   12004 |           12000000 | C
   12005 |           12000000 | A
   12006 |           12000000 | A
   12007 |           12000000 | A
   12008 |           12000000 | A
   12009 |           12000000 | A
   12010 |           12000000 | A
   12011 |           12000000 | C
   12012 |           12000000 | A
   12013 |           12000000 | A
   12014 |           12000000 | C
   12015 |           12000000 | M
   12016 |           12000000 | M
   12100 |           12100029 | M
   12101 |           12100040 | M
   12200 |           12200041 | M
   12201 |           12200049 | M
   12300 |           12300000 | R
   12301 |           12300006 | M
   12302 |           12300006 | R
   12303 |           12300012 | M
   12400 |           12400000 | R
   12401 |           12400014 | M
   12402 |           12400024 | M
   12403 |           12400024 | M
   12500 |           12500000 | R
   12501 |           12500006 | M
   12502 |           12500006 | R
   12600 |           12600003 | R
   12601 |           12600006 | R
   12602 |           12600029 | M
   14000 |           14000000 | M
   14001 |           14000000 | M
   14002 |           14000000 | M
   14003 |           14000000 | R
   14004 |           14000000 | M
   14005 |           14000000 | R
   14006 |           14000000 | R
   14007 |           14000000 | M
   14008 |           14000000 | M
   14009 |           14000000 | M
   14010 |           14000000 | R
   14200 |           14200000 | C
   14201 |           14200000 | A
   14202 |           14200000 | A
   14203 |           14200000 | M
   14204 |           14200052 | M
   14205 |           14200052 | M
   14206 |           14200055 | M
   14207 |           14200055 | R
   14208 |           14200055 | M
   14209 |           14200055 | R
   14300 |           14300020 | R
   14400 |           14400030 | R
   14401 |           14400030 | R
   14402 |           14400030 | R
   14500 |           14500000 | M
   14501 |           14500000 | A
   14502 |           14500000 | A
   14503 |           14500000 | M
   14504 |           14500004 | M
   14505 |           14500006 | R
   14506 |           14500006 | M
   14507 |           14500006 | D
   14600 |           14600000 | M
   14700 |           14700000 | A
   14701 |           14700000 | M
   14702 |           14700017 | M
   14703 |           14700019 | R
   14704 |           14700033 | M
   14705 |           14700035 | M
   14706 |           14700047 | M
   14707 |           14700047 | M
   14708 |           14700047 | R
   14709 |           14700058 | M
   14710 |           14700058 | M
   14711 |           14700075 | M
   14712 |           14700077 | M
   14713 |           14700079 | R
   14714 |           14700081 | M
   14715 |           14700081 | M
   14716 |           14700093 | R
   14717 |           14700118 | M
   14718 |           14700118 | M
   14719 |           14700134 | R
   14720 |           14700140 | M
   14721 |           14700140 | M
   14722 |           14700142 | R
   14723 |           14700143 | M
   14724 |           14700143 | M
   14725 |           14700160 | M
   14726 |           14700162 | R
   14727 |           14700176 | M
   14728 |           14700176 | M
   14729 |           14700178 | R
   14730 |           14700193 | M
   14731 |           14700193 | R
   17100 |           17100000 | C
   17101 |           17100000 | A
   17102 |           17100000 | M
   17103 |           17100000 | M
   17104 |           17100000 | M
   17105 |           17100000 | M
   17106 |           17100000 | M
   17107 |           17100000 | M
   17200 |           17200000 | M
   17201 |           17200002 | M
   17202 |           17200003 | A
   17203 |           17200003 | A
   17204 |           17200004 | A
   17205 |           17200004 | A
   17206 |           17200004 | R
   17207 |           17200006 | M
   17208 |           17200008 | R
   17209 |           17200010 | M
   17210 |           17200010 | M
   17211 |           17200010 | D
   17400 |           17400000 | C
   17401 |           17400000 | A
   17402 |           17400000 | A
   17403 |           17400000 | A
   17404 |           17400000 | M
   17405 |           17400010 | A
   17406 |           17400010 | A
   17407 |           17400010 | A
   17408 |           17400010 | A
   17409 |           17400010 | A
   17410 |           17400010 | A
   17411 |           17400010 | A
   17412 |           17400010 | A
   17413 |           17400010 | M
   17414 |           17400010 | D
   17600 |           17600000 | C
   17601 |           17600000 | C
   17602 |           17600000 | C
   17603 |           17600000 | M
   17604 |           17600000 | A
   17605 |           17600000 | A
   17606 |           17600000 | A
   17607 |           17600000 | A
   17608 |           17600000 | A
   17609 |           17600000 | M
   17610 |           17600000 | M
   17611 |           17600011 | M
   17612 |           17600024 | M
   17613 |           17600028 | R
   17614 |           17600028 | A
   17615 |           17600028 | A
   17616 |           17600028 | A
   17617 |           17600028 | A
   17618 |           17600028 | A
   17619 |           17600028 | M
   17620 |           17600033 | M
   17621 |           17600037 | M
   17622 |           17600041 | A
   17623 |           17600041 | A
   17624 |           17600041 | R
   17625 |           17600045 | M
   17626 |           17600045 | M
   17627 |           17600051 | A
   17628 |           17600051 | R
   17630 |           17600051 | A
   17631 |           17600051 | A
   17632 |           17600051 | M
   17633 |           17600051 | I
   17634 |           17600051 | M
   17635 |           17600051 | D
   17636 |           17600051 | M
   17637 |           17600051 | D
   17638 |           17600051 | M
   17639 |           17600051 | D
   18000 |           18000000 | C
   18001 |           18000000 | A
   18002 |           18000000 | A
   18003 |           18000000 | M
   18004 |           18000045 | M
   18005 |           18000045 | R
   18006 |           18000085 | M
   18007 |           18000085 | R
   18008 |           18000133 | M
   18009 |           18000133 | D
   20000 |           20000079 | A
   20001 |           20000079 | R
   20002 |           20000142 | M
   20003 |           20000142 | R
   20200 |           20000209 | A
   20201 |           20000209 | R
   20202 |           20000272 | M
   20203 |           20000272 | R
   20204 |           20000291 | M
   20205 |           20000291 | R
(502 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-------------------+--------------+---------------+----------------
 myschema2   | myseq1            |        12201 |          1003 | t
 myschema2   | myTbl3_col31_seq  |        12201 |            20 | t
 myschema1   | mytbl2b_col20_seq |        12401 |             5 | t
 myschema1   | myTbl3_col31_seq  |        12401 |            20 | t
 myschema1   | mytbl2b_col20_seq |        12402 |             5 | t
 myschema1   | myTbl3_col31_seq  |        12402 |            20 | t
 myschema1   | mytbl2b_col20_seq |        12601 |             5 | t
 myschema1   | myTbl3_col31_seq  |        12601 |            20 | t
 myschema1   | mytbl2b_col20_seq |        14000 |             5 | t
 myschema1   | myTbl3_col31_seq  |        14000 |            20 | t
 myschema2   | myseq1            |        14000 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        14000 |            20 | t
 myschema1   | mytbl2b_col20_seq |        14007 |             5 | t
 myschema1   | myTbl3_col31_seq  |        14007 |            20 | t
 myschema2   | myseq1            |        14007 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        14007 |            20 | t
 myschema1   | mytbl2b_col20_seq |        14008 |             5 | t
 myschema1   | myTbl3_col31_seq  |        14008 |            20 | t
 myschema2   | myseq1            |        14008 |          1004 | f
 myschema2   | myTbl3_col31_seq  |        14008 |            20 | t
(20 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl1   |       12201 |                   15
 myschema2  | mytbl2   |       12201 |                    2
 myschema2  | myTbl3   |       12201 |                   10
 myschema2  | mytbl4   |       12201 |                    4
 myschema2  | mytbl5   |       12201 |                    4
 myschema2  | mytbl6   |       12201 |                   14
 myschema1  | mytbl1   |       12401 |                   30
 myschema1  | mytbl2   |       12401 |                    3
 myschema1  | mytbl2b  |       12401 |                    3
 myschema1  | myTbl3   |       12401 |                   10
 myschema1  | mytbl4   |       12401 |                    8
 myschema1  | mytbl1   |       12402 |                   30
 myschema1  | mytbl2   |       12402 |                    3
 myschema1  | mytbl2b  |       12402 |                    3
 myschema1  | myTbl3   |       12402 |                   20
 myschema1  | mytbl4   |       12402 |                    8
 myschema1  | mytbl1   |       12601 |                   32
 myschema1  | mytbl2   |       12601 |                    3
 myschema1  | mytbl2b  |       12601 |                    3
 myschema1  | myTbl3   |       12601 |                   20
 myschema1  | mytbl4   |       12601 |                   12
 myschema1  | mytbl1   |       14000 |                   33
 myschema1  | mytbl2   |       14000 |                    3
 myschema1  | mytbl2b  |       14000 |                    3
 myschema1  | myTbl3   |       14000 |                   45
 myschema1  | mytbl4   |       14000 |                   14
 myschema2  | mytbl1   |       14000 |                   15
 myschema2  | mytbl2   |       14000 |                    2
 myschema2  | myTbl3   |       14000 |                   10
 myschema2  | mytbl4   |       14000 |                   10
 myschema2  | mytbl5   |       14000 |                    7
 myschema2  | mytbl6   |       14000 |                   23
 myschema1  | mytbl1   |       14007 |                   33
 myschema1  | mytbl2   |       14007 |                    3
 myschema1  | mytbl2b  |       14007 |                    3
 myschema1  | myTbl3   |       14007 |                   45
 myschema1  | mytbl4   |       14007 |                   14
 myschema2  | mytbl1   |       14007 |                   15
 myschema2  | mytbl2   |       14007 |                    2
 myschema2  | myTbl3   |       14007 |                   10
 myschema2  | mytbl4   |       14007 |                   10
 myschema2  | mytbl5   |       14007 |                    7
 myschema2  | mytbl6   |       14007 |                   23
 myschema1  | mytbl1   |       14008 |                   33
 myschema1  | mytbl2   |       14008 |                    3
 myschema1  | mytbl2b  |       14008 |                    3
 myschema1  | myTbl3   |       14008 |                   45
 myschema1  | mytbl4   |       14008 |                   14
 myschema2  | mytbl1   |       14008 |                   15
 myschema2  | mytbl2   |       14008 |                    2
 myschema2  | myTbl3   |       14008 |                   10
 myschema2  | mytbl4   |       14008 |                   10
 myschema2  | mytbl5   |       14008 |                    7
 myschema2  | mytbl6   |       14008 |                   23
(54 rows)

-- user tables
select * from mySchema2.myTbl1 order by col11,col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select * from mySchema2.myTbl2 order by col21;
 col21 | col22 |   col23    
-------+-------+------------
     1 | ABC   | 2010-01-01
     2 | DEF   | 
(2 rows)

select col31,col33 from mySchema2."myTbl3" order by col31;
 col31 | col33 
-------+-------
    11 | 10.00
    12 | 10.00
    13 | 10.00
    14 | 10.00
    15 | 10.00
    16 | 10.00
    17 | 10.00
    18 | 10.00
    19 | 10.00
    20 | 10.00
(10 rows)

select * from mySchema2.myTbl4 order by col41;
 col41 | col42 | col43 | col44 |   col45    
-------+-------+-------+-------+------------
     1 | FK... |     2 |     1 | ABC       
     2 | FK... |     2 |     1 | ABC       
(2 rows)

-- log tables
select col11, col12, col13, emaj_verb, emaj_tuple from emaj_myschema2.mytbl1_log order by col11, col12, emaj_gid, emaj_tuple desc;
 col11 | col12 | col13 | emaj_verb | emaj_tuple 
-------+-------+-------+-----------+------------
(0 rows)

select col21, col22, col23, emaj_verb, emaj_tuple from emaj_myschema2.mytbl2_log order by col21, emaj_gid, emaj_tuple desc;
 col21 | col22 | col23 | emaj_verb | emaj_tuple 
-------+-------+-------+-----------+------------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple from emaj_myschema2."myTbl3_log" order by col31, emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple 
-------+-------+-----------+------------
(0 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple from emaj_myschema2.mytbl4_log order by col41, emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple 
-------+-------+-------+-------+-------+-----------+------------
(0 rows)

--
-----------------------------
-- Step 3 : stop myGroup2
-----------------------------
select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               8
(1 row)

--
-----------------------------
-- test end: check and reset history
-----------------------------
select count(*) from emaj.emaj_hist;
 count 
-------
   117
(1 row)

--select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
--  (select * from emaj.emaj_hist order by hist_id) as t;
--
truncate emaj.emaj_hist;
TRUNCATE TABLE
alter sequence emaj.emaj_hist_hist_id_seq restart 30000;
ALTER SEQUENCE
