-- after_upg_while_logging.sql : complex scenario executed by an emaj_adm role
-- The E-Maj version is changed while groups are in logging state
-- This script is the part of operations performed after the upgrade
--
-----------------------------
-- Step 1 : check the E-Maj installation
-----------------------------
select * from emaj.emaj_verify_all();
                                                                                emaj_verify_all                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Warning: In the group "myGroup1", the sequence "myschema1"."myTbl3_col31_seq" is linked to the table "myschema1"."myTbl3" but this table does not belong to any tables group.
 No error detected
(2 rows)

select group_name, group_is_rollbackable, group_creation_time_id,
       group_last_alter_time_id, group_is_logging, 
       group_is_rlbk_protected, group_nb_table, group_nb_sequence, group_comment
  from emaj.emaj_group order by group_name;
    group_name    | group_is_rollbackable | group_creation_time_id | group_last_alter_time_id | group_is_logging | group_is_rlbk_protected | group_nb_table | group_nb_sequence | group_comment 
------------------+-----------------------+------------------------+--------------------------+------------------+-------------------------+----------------+-------------------+---------------
 myGroup1         | t                     |                      1 |                       29 | t                | t                       |              4 |                 1 | 
 myGroup2         | t                     |                      2 |                       11 | t                | f                       |              4 |                 2 | 
 myGroup6         | t                     |                      4 |                       31 | f                | f                       |              3 |                 0 | 
 phil's group#3", | f                     |                      3 |                       13 | t                | t                       |              2 |                 1 | 
(4 rows)

select * from emaj.emaj_relation_change order by 1,2,3,4;
 rlchg_time_id |  rlchg_schema  |                      rlchg_tblseq                       | rlchg_change_kind |   rlchg_group    | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers | rlchg_new_ignored_triggers | rlchg_rlbk_id 
---------------+----------------+---------------------------------------------------------+-------------------+------------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+------------------------+----------------------------+---------------
             5 | myschema1      | myTbl3                                                  | ADD_TABLE         | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
             5 | myschema1      | mytbl1                                                  | ADD_TABLE         | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
             5 | myschema1      | mytbl2                                                  | ADD_TABLE         | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
             5 | myschema1      | mytbl2b                                                 | ADD_TABLE         | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
             5 | myschema1      | mytbl4                                                  | ADD_TABLE         | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
             6 | myschema1      | mytbl1                                                  | CHANGE_PRIORITY   | myGroup1         |                  |                  |                 |                |                 20 |                    |                        |                     |                         |                        |                            |              
             7 | myschema1      | myTbl3                                                  | CHANGE_PRIORITY   | myGroup1         |                  |                  |                 |                |                 10 |                    |                        |                     |                         |                        |                            |              
             8 | myschema1      | mytbl4                                                  | CHANGE_PRIORITY   | myGroup1         |                  |                  |                 |                |                 20 |                    |                        |                     |                         |                        |                            |              
             9 | myschema1      | myTbl3_col31_seq                                        | ADD_SEQUENCE      | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            10 | myschema2      | myTbl3                                                  | ADD_TABLE         | myGroup2         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            10 | myschema2      | mytbl1                                                  | ADD_TABLE         | myGroup2         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            10 | myschema2      | mytbl2                                                  | ADD_TABLE         | myGroup2         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            10 | myschema2      | mytbl4                                                  | ADD_TABLE         | myGroup2         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            11 | myschema2      | myTbl3_col31_seq                                        | ADD_SEQUENCE      | myGroup2         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            11 | myschema2      | myseq1                                                  | ADD_SEQUENCE      | myGroup2         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            12 | phil's schema3 | myTbl2\                                                 | ADD_TABLE         | phil's group#3", |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            12 | phil's schema3 | phil's tbl1                                             | ADD_TABLE         | phil's group#3", |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            13 | phil's schema3 | phil's seq\1                                            | ADD_SEQUENCE      | phil's group#3", |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            14 | myschema6      | table_with_50_characters_long_name_____0_________0      | ADD_TABLE         | myGroup6         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            14 | myschema6      | table_with_51_characters_long_name_____0_________0a     | ADD_TABLE         | myGroup6         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            14 | myschema6      | table_with_55_characters_long_name_____0_________0abcde | ADD_TABLE         | myGroup6         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            14 | myschema6      | table_with_55_characters_long_name_____0_________0fghij | ADD_TABLE         | myGroup6         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            29 | myschema1      | myTbl3                                                  | REMOVE_TABLE      | myGroup1         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
            31 | myschema6      | table_with_55_characters_long_name_____0_________0abcde | REMOVE_TABLE      | myGroup6         |                  |                  |                 |                |                    |                    |                        |                     |                         |                        |                            |              
(24 rows)

-----------------------------
-- Step 2 : for both groups, rollback to the common mark just set before the upgrade, after having unprotected the first group
-----------------------------
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Common',false) order by 1,2;
ERROR:  _check_group_names: The group "myGroup1" is currently protected against rollback operations.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,text) line 100 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkList := 'LOGGING,ROLLBACKABLE,UNPROTECTED')"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE))"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select emaj.emaj_unprotect_group('myGroup1');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Common',true) order by 1,2;
 rlbk_severity |                                        regexp_replace                                         
---------------+-----------------------------------------------------------------------------------------------
 Notice        | 0 / 3 sequences effectively processed.
 Notice        | 0 / 8 tables effectively processed.
 Warning       | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>)
(3 rows)

-----------------------------
-- Step 3 : for myGroup1, update tables, then unprotect, logged_rollback, rename the end rollback mark and consolidate the rollback
-----------------------------
set search_path=myschema1;
--
update "myTbl3" set col33 = col33 / 2;
--
select * from emaj.emaj_rollback_group('myGroup1','M2',false) order by 1,2;
ERROR:  _rlbk_check: Protected marks (M3) for the group "myGroup1" block the rollback to the mark "M2".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE))"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select emaj.emaj_unprotect_mark_group('myGroup1','M3');
 emaj_unprotect_mark_group 
---------------------------
                         1
(1 row)

select * from emaj.emaj_logged_rollback_group('myGroup1','M2',true) order by 1,2;
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | 0 / 1 sequences effectively processed.
 Notice        | 2 / 4 tables effectively processed.
(2 rows)

--
select emaj.emaj_rename_mark_group('myGroup1','EMAJ_LAST_MARK','End_rollback_to_M2');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select emaj.emaj_consolidate_rollback_group('myGroup1','End_rollback_to_M2');
 emaj_consolidate_rollback_group 
---------------------------------
                               3
(1 row)

-----------------------------
-- Step 4 : for myGroup1, update tables again then set 3 marks
-----------------------------
insert into myTbl1 select i, 'DEF', E'\\000'::bytea from generate_series (100,110) as i;
insert into myTbl2 values (3,'GHI','2010-01-02');
delete from myTbl1 where col11 = 1;
--
select emaj.emaj_set_mark_group('myGroup1','M4');
 emaj_set_mark_group 
---------------------
                   5
(1 row)

--
update "myTbl3" set col33 = col33 / 2;
--
select emaj.emaj_set_mark_group('myGroup1','M5');
 emaj_set_mark_group 
---------------------
                   5
(1 row)

--
update myTbl1 set col11 = 99 where col11 = 1;
--
select emaj.emaj_set_mark_group('myGroup1','M6');
 emaj_set_mark_group 
---------------------
                   5
(1 row)

-----------------------------
-- Step 5 : for myGroup2, logged rollback again then unlogged rollback 
-----------------------------
select * from emaj.emaj_logged_rollback_group('myGroup2','M2',false) order by 1,2;
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | 1 / 2 sequences effectively processed.
 Notice        | 1 / 4 tables effectively processed.
(2 rows)

--
select * from emaj.emaj_rollback_group('myGroup2','M3',false) order by 1,2;
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | 1 / 2 sequences effectively processed.
 Notice        | 1 / 4 tables effectively processed.
(2 rows)

-----------------------------
-- Step 6 : for myGroup1, update tables, rollback, other updates, then logged rollback
-----------------------------
set search_path=myschema1;
--
insert into myTbl1 values (1, 'Step 6', E'\\000'::bytea);
insert into myTbl4 values (11,'FK...',1,1,'Step 6');
insert into myTbl4 values (12,'FK...',1,1,'Step 6');
truncate myTbl2 cascade;
NOTICE:  truncate cascades to table "mytbl4"
--
select * from emaj.emaj_rollback_group('myGroup1','M5',false) order by 1,2;
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | 0 / 1 sequences effectively processed.
 Notice        | 3 / 4 tables effectively processed.
(2 rows)

--
insert into myTbl1 values (1, 'Step 6', E'\\001'::bytea);
copy myTbl4 from stdin;
--
select * from emaj.emaj_logged_rollback_group('myGroup1','M4',false) order by 1,2;
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | 0 / 1 sequences effectively processed.
 Notice        | 2 / 4 tables effectively processed.
(2 rows)

-----------------------------
-- Step 7 : for myGroup1, generate a sql script on the whole time frame
-----------------------------
select emaj.emaj_gen_sql_group('myGroup1','M1',NULL,'/dev/null',array['myschema1.mytbl1','myschema1.mytbl2','myschema1.mytbl4']);
NOTICE:  table "emaj_temp_script" does not exist, skipping
 emaj_gen_sql_group 
--------------------
                 36
(1 row)

select emaj.emaj_gen_sql_group('myGroup1','M1',NULL,'/dev/null',array['myschema1.myTbl3']);
NOTICE:  table "emaj_temp_script" does not exist, skipping
 emaj_gen_sql_group 
--------------------
                 10
(1 row)

-----------------------------
-- Step 8 : for myGroup1, update tables, rename a mark, then delete 2 marks then delete all before a mark 
-----------------------------
set search_path=myschema1;
--
delete from "myTbl3" where col31 between 14 and 18;
--
select emaj.emaj_rename_mark_group('myGroup1',mark_name,'Before logged rollback to M4') from emaj.emaj_mark where mark_name like 'RLBK_M4_%_START';
 emaj_rename_mark_group 
------------------------
 
(1 row)

-- 
select emaj.emaj_delete_mark_group('myGroup1',mark_name) from emaj.emaj_mark where mark_name like 'RLBK_M4_%_DONE';
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

select emaj.emaj_delete_mark_group('myGroup1','M1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

--
select emaj.emaj_delete_before_mark_group('myGroup1','M4');
 emaj_delete_before_mark_group 
-------------------------------
                             2
(1 row)

-----------------------------
-- Step 9 : for myGroup6, perform a table change and verify that no log trigger has been called
--          and finaly drop the group
-----------------------------
insert into mySchema6.table_with_51_characters_long_name_____0_________0a values (1),(2);
select count(*) from emaj_myschema6."table_with_51_characters_long_name_____0_________0#1_log";
 count 
-------
     0
(1 row)

select emaj.emaj_start_group('myGroup6', 'Start G6');
 emaj_start_group 
------------------
                3
(1 row)

insert into mySchema6.table_with_51_characters_long_name_____0_________0a values (3),(4);
delete from mySchema6.table_with_51_characters_long_name_____0_________0a;
select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj.emaj_log_stat_group('myGroup6','Start G6',NULL) order by 1,2,3,4;
 stat_group | stat_schema |                       stat_table                        | stat_first_mark | stat_last_mark | stat_rows 
------------+-------------+---------------------------------------------------------+-----------------+----------------+-----------
 myGroup6   | myschema6   | table_with_50_characters_long_name_____0_________0      | Start G6        |                |         0
 myGroup6   | myschema6   | table_with_51_characters_long_name_____0_________0a     | Start G6        |                |         6
 myGroup6   | myschema6   | table_with_55_characters_long_name_____0_________0fghij | Start G6        |                |         0
(3 rows)

select * from emaj.emaj_rollback_group('myGroup6', 'Start G6');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 1 / 3 tables effectively processed.
(1 row)

select emaj.emaj_stop_group('myGroup6');
 emaj_stop_group 
-----------------
               3
(1 row)

select emaj.emaj_drop_group('myGroup6');
 emaj_drop_group 
-----------------
               3
(1 row)

-----------------------------
-- test end: check and reset history
-----------------------------
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
       1 |                  0 | C
       2 |                  0 | C
       3 |                  0 | C
       4 |                  0 | C
       5 |                  0 | A
       6 |                  0 | A
       7 |                  0 | A
       8 |                  0 | A
       9 |                  0 | A
      10 |                  0 | A
      11 |                  0 | A
      12 |                  0 | A
      13 |                  0 | A
      14 |                  0 | A
      15 |                  0 | M
      16 |                  0 | M
      17 |                  0 | M
      18 |                 29 | M
      19 |                 40 | M
      20 |                 46 | R
      21 |                 49 | R
      22 |                 76 | M
      23 |                 80 | M
      24 |                 80 | R
      25 |                 82 | M
      26 |                 82 | R
      27 |                 84 | M
      28 |                 84 | M
      29 |                 84 | A
      30 |                 84 | M
      31 |                 84 | A
      32 |                 84 | M
      33 |                 84 | R
      34 |                 84 | R
      35 |                 91 | M
      36 |                105 | M
      37 |                105 | M
      38 |                105 | M
      39 |                105 | R
      40 |                107 | M
      41 |                107 | R
      42 |                117 | R
      43 |                120 | R
      44 |                123 | M
      45 |                123 | M
      46 |                129 | R
      47 |                129 | M
      48 |                129 | D
(48 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d(\\d?)','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist 
  order by hist_id;
      hist_function       |     hist_event     |                            hist_object                            |                                        regexp_replace                                         | hist_user 
--------------------------+--------------------+-------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+-----------
 EMAJ_INSTALL             |                    | E-Maj 4.1.0                                                       | Initialisation completed                                                                      | postgres
 CREATE_GROUP             | BEGIN              | myGroup1                                                          | rollbackable                                                                                  | postgres
 CREATE_GROUP             | END                | myGroup1                                                          |                                                                                               | postgres
 CREATE_GROUP             | BEGIN              | myGroup2                                                          | rollbackable                                                                                  | postgres
 CREATE_GROUP             | END                | myGroup2                                                          |                                                                                               | postgres
 CREATE_GROUP             | BEGIN              | phil's group#3",                                                  | audit_only                                                                                    | postgres
 CREATE_GROUP             | END                | phil's group#3",                                                  |                                                                                               | postgres
 CREATE_GROUP             | BEGIN              | myGroup6                                                          | rollbackable                                                                                  | postgres
 CREATE_GROUP             | END                | myGroup6                                                          |                                                                                               | postgres
 ASSIGN_TABLES            | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED | emaj_myschema1                                                    |                                                                                               | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema1."myTbl3"                                                | To the idle group myGroup1                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema1.mytbl1                                                  | To the idle group myGroup1                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema1.mytbl2                                                  | To the idle group myGroup1                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema1.mytbl2b                                                 | To the idle group myGroup1                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema1.mytbl4                                                  | To the idle group myGroup1                                                                    | postgres
 ASSIGN_TABLES            | END                |                                                                   | 5 tables assigned to the group myGroup1                                                       | postgres
 MODIFY_TABLE             | BEGIN              |                                                                   |                                                                                               | postgres
 MODIFY_TABLE             | PRIORITY CHANGED   | myschema1.mytbl1                                                  | NULL => 20                                                                                    | postgres
 MODIFY_TABLE             | END                |                                                                   | 1 tables effectively modified                                                                 | postgres
 MODIFY_TABLE             | BEGIN              |                                                                   |                                                                                               | postgres
 MODIFY_TABLE             | PRIORITY CHANGED   | myschema1."myTbl3"                                                | NULL => 10                                                                                    | postgres
 MODIFY_TABLE             | END                |                                                                   | 1 tables effectively modified                                                                 | postgres
 MODIFY_TABLE             | BEGIN              |                                                                   |                                                                                               | postgres
 MODIFY_TABLE             | PRIORITY CHANGED   | myschema1.mytbl4                                                  | NULL => 20                                                                                    | postgres
 MODIFY_TABLE             | END                |                                                                   | 1 tables effectively modified                                                                 | postgres
 ASSIGN_SEQUENCE          | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_SEQUENCE          | SEQUENCE ADDED     | myschema1."myTbl3_col31_seq"                                      | To the idle group myGroup1                                                                    | postgres
 ASSIGN_SEQUENCE          | END                |                                                                   | 1 sequences assigned to the group myGroup1                                                    | postgres
 ASSIGN_TABLES            | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED | emaj_myschema2                                                    |                                                                                               | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema2."myTbl3"                                                | To the idle group myGroup2                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema2.mytbl1                                                  | To the idle group myGroup2                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema2.mytbl2                                                  | To the idle group myGroup2                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema2.mytbl4                                                  | To the idle group myGroup2                                                                    | postgres
 ASSIGN_TABLES            | END                |                                                                   | 4 tables assigned to the group myGroup2                                                       | postgres
 ASSIGN_SEQUENCES         | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED     | myschema2."myTbl3_col31_seq"                                      | To the idle group myGroup2                                                                    | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED     | myschema2.myseq1                                                  | To the idle group myGroup2                                                                    | postgres
 ASSIGN_SEQUENCES         | END                |                                                                   | 2 sequences assigned to the group myGroup2                                                    | postgres
 ASSIGN_TABLES            | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED | "emaj_phil's schema3"                                             |                                                                                               | postgres
 ASSIGN_TABLES            | TABLE ADDED        | "phil's schema3"."myTbl2\"                                        | To the idle group phil's group#3",                                                            | postgres
 ASSIGN_TABLES            | TABLE ADDED        | "phil's schema3"."phil's tbl1"                                    | To the idle group phil's group#3",                                                            | postgres
 ASSIGN_TABLES            | END                |                                                                   | 2 tables assigned to the group phil's group#3",                                               | postgres
 ASSIGN_SEQUENCE          | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_SEQUENCE          | SEQUENCE ADDED     | "phil's schema3"."phil's seq\1"                                   | To the idle group phil's group#3",                                                            | postgres
 ASSIGN_SEQUENCE          | END                |                                                                   | 1 sequences assigned to the group phil's group#3",                                            | postgres
 ASSIGN_TABLES            | BEGIN              |                                                                   |                                                                                               | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED | emaj_myschema6                                                    |                                                                                               | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema6.table_with_50_characters_long_name_____0_________0      | To the idle group myGroup6                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema6.table_with_51_characters_long_name_____0_________0a     | To the idle group myGroup6                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema6.table_with_55_characters_long_name_____0_________0abcde | To the idle group myGroup6                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED        | myschema6.table_with_55_characters_long_name_____0_________0fghij | To the idle group myGroup6                                                                    | postgres
 ASSIGN_TABLES            | END                |                                                                   | 4 tables assigned to the group myGroup6                                                       | postgres
 START_GROUP              | BEGIN              | myGroup1                                                          | With log reset                                                                                | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 5 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          | M1                                                                                            | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | M1                                                                                            | postgres
 START_GROUP              | END                | myGroup1                                                          | 6 tables/sequences processed                                                                  | postgres
 START_GROUP              | BEGIN              | myGroup2                                                          | With log reset                                                                                | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | M1                                                                                            | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | M1                                                                                            | postgres
 START_GROUP              | END                | myGroup2                                                          | 6 tables/sequences processed                                                                  | postgres
 START_GROUP              | BEGIN              | phil's group#3",                                                  | With log reset                                                                                | postgres
 LOCK_GROUP               | BEGIN              | phil's group#3",                                                  |                                                                                               | postgres
 LOCK_GROUP               | END                | phil's group#3",                                                  | 2 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | phil's group#3",                                                  | M1                                                                                            | postgres
 SET_MARK_GROUP           | END                | phil's group#3",                                                  | M1                                                                                            | postgres
 START_GROUP              | END                | phil's group#3",                                                  | 3 tables/sequences processed                                                                  | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 5 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | M2                                                                                            | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 5 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | M3                                                                                            | postgres
 COMMENT_MARK_GROUP       |                    | myGroup1                                                          | Mark M3                                                                                       | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup1                                                          | Unlogged rollback to mark M3 (timestamp)                                                      | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -3                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | Rollback session #1: 5 tables locked, 0 deadlock(s)                                           | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl1                                                  | All log rows where emaj_gid > 40 and <= 46, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl1                                                  | 6 rolled back primary keys                                                                    | postgres
 ROLLBACK_SEQUENCE        |                    | myschema1."myTbl3_col31_seq"                                      |                                                                                               | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 1                                                     | 1 / 5 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 1                                                     | 1 sequences processed.                                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup1                                                          | Rollback_id 1, 1 tables and 1 sequences effectively processed                                 | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup1                                                          | Unlogged rollback to mark M3 (timestamp)                                                      | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -3                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | Rollback session #1: 5 tables locked, 0 deadlock(s)                                           | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl2                                                  | All log rows where emaj_gid > 40 and <= 49, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl2                                                  | 1 rolled back primary keys                                                                    | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl2b                                                 | All log rows where emaj_gid > 40 and <= 49                                                    | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl2b                                                 | 1 rolled back primary keys                                                                    | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl4                                                  | All log rows where emaj_gid > 40 and <= 49, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl4                                                  | 1 rolled back primary keys                                                                    | postgres
 ROLLBACK_SEQUENCE        |                    | myschema1."myTbl3_col31_seq"                                      |                                                                                               | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 2                                                     | 3 / 5 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 2                                                     | 1 sequences processed.                                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup1                                                          | Rollback_id 2, 3 tables and 1 sequences effectively processed                                 | postgres
 PROTECT_MARK_GROUP       |                    | myGroup1                                                          | Mark M3 ; status 1                                                                            | postgres
 PROTECT_GROUP            |                    | myGroup1                                                          | Status 1                                                                                      | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | M2                                                                                            | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | M3                                                                                            | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup2                                                          | Logged rollback to mark M2 (timestamp)                                                        | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -3                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | RLBK_M2_%_START                                                                               | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | RLBK_M2_%_START                                                                               | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema2.mytbl4                                                  | All log rows where emaj_gid > 76 and <= 80, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema2.mytbl4                                                  | 2 rolled back primary keys                                                                    | postgres
 ROLLBACK_SEQUENCE        |                    | myschema2."myTbl3_col31_seq"                                      |                                                                                               | postgres
 ROLLBACK_SEQUENCE        |                    | myschema2.myseq1                                                  | RESTART 1001 MAXVALUE 2000 CYCLE                                                              | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | RLBK_M2_%_DONE                                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | RLBK_M2_%_DONE                                                                                | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 3                                                     | 1 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 3                                                     | 2 sequences processed.                                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup2                                                          | Rollback_id 3, 1 tables and 2 sequences effectively processed                                 | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup2                                                          | Logged rollback to mark M3 (timestamp)                                                        | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -3                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | RLBK_M3_%_START                                                                               | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | RLBK_M3_%_START                                                                               | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema2.mytbl4                                                  | All log rows where emaj_gid > 80 and <= 82, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema2.mytbl4                                                  | 2 rolled back primary keys                                                                    | postgres
 ROLLBACK_SEQUENCE        |                    | myschema2."myTbl3_col31_seq"                                      |                                                                                               | postgres
 ROLLBACK_SEQUENCE        |                    | myschema2.myseq1                                                  | RESTART 1004 MAXVALUE 9223372036854775807 NO  CYCLE                                           | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | RLBK_M3_%_DONE                                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | RLBK_M3_%_DONE                                                                                | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 4                                                     | 1 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 4                                                     | 2 sequences processed.                                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup2                                                          | Rollback_id 4, 1 tables and 2 sequences effectively processed                                 | postgres
 SET_MARK_GROUPS          | BEGIN              | myGroup1,myGroup2                                                 | Common                                                                                        | postgres
 LOCK_GROUPS              | BEGIN              | myGroup1,myGroup2                                                 |                                                                                               | postgres
 LOCK_GROUPS              | END                | myGroup1,myGroup2                                                 | 9 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUPS          | END                | myGroup1,myGroup2                                                 | Common                                                                                        | postgres
 REMOVE_TABLE             | BEGIN              |                                                                   |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 5 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          | REMOVE_%                                                                                      | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | REMOVE_%                                                                                      | postgres
 REMOVE_TABLE             | TABLE REMOVED      | myschema1."myTbl3"                                                | From the logging group myGroup1                                                               | postgres
 REMOVE_TABLE             | END                |                                                                   | 1 tables removed from their groups                                                            | postgres
 START_GROUP              | BEGIN              | myGroup6                                                          | With log reset                                                                                | postgres
 LOCK_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup6                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup6                                                          | Start G6                                                                                      | postgres
 SET_MARK_GROUP           | END                | myGroup6                                                          | Start G6                                                                                      | postgres
 START_GROUP              | END                | myGroup6                                                          | 4 tables/sequences processed                                                                  | postgres
 REMOVE_TABLE             | BEGIN              |                                                                   |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup6                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup6                                                          | REMOVE_%                                                                                      | postgres
 SET_MARK_GROUP           | END                | myGroup6                                                          | REMOVE_%                                                                                      | postgres
 REMOVE_TABLE             | TABLE REMOVED      | myschema6.table_with_55_characters_long_name_____0_________0abcde | From the logging group myGroup6                                                               | postgres
 REMOVE_TABLE             | END                |                                                                   | 1 tables removed from their groups                                                            | postgres
 STOP_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup6                                                          | 3 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup6                                                          | STOP_%                                                                                        | postgres
 SET_MARK_GROUP           | END                | myGroup6                                                          | STOP_%                                                                                        | postgres
 STOP_GROUP               | END                | myGroup6                                                          | 3 tables/sequences processed                                                                  | postgres
 EMAJ_INSTALL             | BEGIN              | E-Maj <devel>                                                     | Upgrade from 4.1.0 started                                                                    | postgres
 EMAJ_INSTALL             | END                | E-Maj <devel>                                                     | Upgrade from 4.1.0 completed                                                                  | postgres
 UNPROTECT_GROUP          |                    | myGroup1                                                          | Status 1                                                                                      | postgres
 ROLLBACK_GROUPS          | BEGIN              | myGroup1,myGroup2                                                 | Unlogged rollback to mark Common (timestamp)                                                  | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup1,myGroup2                                                 | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup1,myGroup2                                                 | Rollback session #1: 8 tables locked, 0 deadlock(s)                                           | postgres
 ROLLBACK_GROUPS          | MARK DELETED       | myGroup1                                                          | mark REMOVE_% is deleted                                                                      | postgres
 ROLLBACK_GROUPS          | NOTICE             | Rollback id 5                                                     | 0 / 8 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUPS          | NOTICE             | Rollback id 5                                                     | 0 / 3 sequences effectively processed.                                                        | postgres
 ROLLBACK_GROUPS          | WARNING            | Rollback id 5                                                     | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>) | postgres
 ROLLBACK_GROUPS          | END                | myGroup1,myGroup2                                                 | Rollback_id 5                                                                                 | postgres
 UNPROTECT_MARK_GROUP     |                    | myGroup1                                                          | Mark M3 ; status 1                                                                            | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup1                                                          | Logged rollback to mark M2 (timestamp)                                                        | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          | RLBK_M2_%_START                                                                               | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | RLBK_M2_%_START                                                                               | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl4                                                  | All log rows where emaj_gid > 29 and <= 84, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl4                                                  | 3 rolled back primary keys                                                                    | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl1                                                  | All log rows where emaj_gid > 29 and <= 84, in session_replication_role = replica mode        | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl1                                                  | 5 rolled back primary keys                                                                    | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          | RLBK_M2_%_DONE                                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | RLBK_M2_%_DONE                                                                                | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 6                                                     | 2 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 6                                                     | 0 / 1 sequences effectively processed.                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup1                                                          | Rollback_id 6                                                                                 | postgres
 RENAME_MARK_GROUP        | BEGIN              | myGroup1                                                          | EMAJ_LAST_MARK                                                                                | postgres
 RENAME_MARK_GROUP        | END                | myGroup1                                                          | RLBK_M2_%_DONE renamed End_rollback_to_M2                                                     | postgres
 CONSOLIDATE_RLBK_GROUP   | BEGIN              | myGroup1                                                          | Erase all between marks M2 and End_rollback_to_M2                                             | postgres
 CONSOLIDATE_RLBK_GROUP   | END                | myGroup1                                                          | 2 tables and 1 sequences processed ; 3 marks deleted                                          | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | M4                                                                                            | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | M5                                                                                            | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | 4 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | M6                                                                                            | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup2                                                          | Logged rollback to mark M2 (timestamp)                                                        | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | RLBK_M2_%_START                                                                               | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | RLBK_M2_%_START                                                                               | postgres
 ROLLBACK_SEQUENCE        |                    | myschema2.myseq1                                                  | RESTART 1001 MAXVALUE 2000 CYCLE                                                              | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema2.mytbl4                                                  | All log rows where emaj_gid > 76 and <= 105, in session_replication_role = replica mode       | postgres
 ROLLBACK_TABLE           | END                | myschema2.mytbl4                                                  | 2 rolled back primary keys                                                                    | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup2                                                          | RLBK_M2_%_DONE                                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup2                                                          | RLBK_M2_%_DONE                                                                                | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 7                                                     | 1 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 7                                                     | 1 / 2 sequences effectively processed.                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup2                                                          | Rollback_id 7                                                                                 | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup2                                                          | Unlogged rollback to mark M3 (timestamp)                                                      | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup2                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup2                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 ROLLBACK_SEQUENCE        |                    | myschema2.myseq1                                                  | RESTART 1004 MAXVALUE 9223372036854775807 NO  CYCLE                                           | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema2.mytbl4                                                  | All log rows where emaj_gid > 80 and <= 107, in session_replication_role = replica mode       | postgres
 ROLLBACK_TABLE           | END                | myschema2.mytbl4                                                  | 2 rolled back primary keys                                                                    | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark RLBK_M2_%_START is deleted                                                               | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark RLBK_M2_%_DONE is deleted                                                                | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark RLBK_M3_%_START is deleted                                                               | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark RLBK_M3_%_DONE is deleted                                                                | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark Common is deleted                                                                        | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark RLBK_M2_%_START is deleted                                                               | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup2                                                          | mark RLBK_M2_%_DONE is deleted                                                                | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 8                                                     | 1 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 8                                                     | 1 / 2 sequences effectively processed.                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup2                                                          | Rollback_id 8                                                                                 | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup1                                                          | Unlogged rollback to mark M5 (timestamp)                                                      | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl4                                                  | All log rows where emaj_gid > 105 and <= 117, in session_replication_role = replica mode      | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl4                                                  | 3 rolled back primary keys                                                                    | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl2                                                  | All log rows where emaj_gid > 105 and <= 117, in session_replication_role = replica mode      | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl2                                                  | 4 rolled back primary keys                                                                    | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl1                                                  | All log rows where emaj_gid > 105 and <= 117, in session_replication_role = replica mode      | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl1                                                  | 1 rolled back primary keys                                                                    | postgres
 ROLLBACK_GROUP           | MARK DELETED       | myGroup1                                                          | mark M6 is deleted                                                                            | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 9                                                     | 3 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 9                                                     | 0 / 1 sequences effectively processed.                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup1                                                          | Rollback_id 9                                                                                 | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup1                                                          | Logged rollback to mark M4 (timestamp)                                                        | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup1                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup1                                                          | Rollback session #1: 4 tables locked, 0 deadlock(s)                                           | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          | RLBK_M4_%_START                                                                               | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | RLBK_M4_%_START                                                                               | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl4                                                  | All log rows where emaj_gid > 105 and <= 120, in session_replication_role = replica mode      | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl4                                                  | 2 rolled back primary keys                                                                    | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema1.mytbl1                                                  | All log rows where emaj_gid > 105 and <= 120, in session_replication_role = replica mode      | postgres
 ROLLBACK_TABLE           | END                | myschema1.mytbl1                                                  | 1 rolled back primary keys                                                                    | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup1                                                          | RLBK_M4_%_DONE                                                                                | postgres
 SET_MARK_GROUP           | END                | myGroup1                                                          | RLBK_M4_%_DONE                                                                                | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 10                                                    | 2 / 4 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 10                                                    | 0 / 1 sequences effectively processed.                                                        | postgres
 ROLLBACK_GROUP           | END                | myGroup1                                                          | Rollback_id 10                                                                                | postgres
 GEN_SQL_GROUP            | BEGIN              | myGroup1                                                          | From mark M1 to current situation with tables/sequences filtering                             | postgres
 GEN_SQL_GROUP            | END                | myGroup1                                                          | 36 generated statements - script exported into /dev/null                                      | postgres
 GEN_SQL_GROUP            | BEGIN              | myGroup1                                                          | From mark M1 to current situation with tables/sequences filtering                             | postgres
 GEN_SQL_GROUP            | END                | myGroup1                                                          | 10 generated statements - script exported into /dev/null                                      | postgres
 RENAME_MARK_GROUP        | BEGIN              | myGroup1                                                          | RLBK_M4_%_START                                                                               | postgres
 RENAME_MARK_GROUP        | END                | myGroup1                                                          | RLBK_M4_%_START renamed Before logged rollback to M4                                          | postgres
 DELETE_MARK_GROUP        | BEGIN              | myGroup1                                                          | RLBK_M4_%_DONE                                                                                | postgres
 DELETE_MARK_GROUP        | END                | myGroup1                                                          | RLBK_M4_%_DONE                                                                                | postgres
 DELETE_MARK_GROUP        | BEGIN              | myGroup1                                                          | M1                                                                                            | postgres
 DELETE_MARK_GROUP        | END                | myGroup1                                                          | M1                                                                                            | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN              | myGroup1                                                          | M4                                                                                            | postgres
 DELETE_BEFORE_MARK_GROUP | END                | myGroup1                                                          | 2 marks deleted ; M4 is now the initial mark                                                  | postgres
 START_GROUP              | BEGIN              | myGroup6                                                          | With log reset                                                                                | postgres
 LOCK_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup6                                                          | 3 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup6                                                          | Start G6                                                                                      | postgres
 SET_MARK_GROUP           | END                | myGroup6                                                          | Start G6                                                                                      | postgres
 START_GROUP              | END                | myGroup6                                                          | 3 tables/sequences processed                                                                  | postgres
 ROLLBACK_GROUP           | BEGIN              | myGroup6                                                          | Unlogged rollback to mark Start G6 (timestamp)                                                | postgres
 DBLINK_OPEN_CNX          |                    | rlbk#1                                                            | Status = -5                                                                                   | postgres
 LOCK_GROUP               | BEGIN              | myGroup6                                                          | Rollback session #1                                                                           | postgres
 LOCK_GROUP               | END                | myGroup6                                                          | Rollback session #1: 3 tables locked, 0 deadlock(s)                                           | postgres
 ROLLBACK_TABLE           | BEGIN              | myschema6.table_with_51_characters_long_name_____0_________0a     | All log rows where emaj_gid > 123 and <= 129                                                  | postgres
 ROLLBACK_TABLE           | END                | myschema6.table_with_51_characters_long_name_____0_________0a     | 4 rolled back primary keys                                                                    | postgres
 ROLLBACK_GROUP           | NOTICE             | Rollback id 11                                                    | 1 / 3 tables effectively processed.                                                           | postgres
 ROLLBACK_GROUP           | END                | myGroup6                                                          | Rollback_id 11                                                                                | postgres
 STOP_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 LOCK_GROUP               | END                | myGroup6                                                          | 3 tables locked, 0 deadlock(s)                                                                | postgres
 SET_MARK_GROUP           | BEGIN              | myGroup6                                                          | STOP_%                                                                                        | postgres
 SET_MARK_GROUP           | END                | myGroup6                                                          | STOP_%                                                                                        | postgres
 STOP_GROUP               | END                | myGroup6                                                          | 3 tables/sequences processed                                                                  | postgres
 DROP_GROUP               | BEGIN              | myGroup6                                                          |                                                                                               | postgres
 DROP_GROUP               | LOG_SCHEMA DROPPED | emaj_myschema6                                                    |                                                                                               | postgres
 DROP_GROUP               | END                | myGroup6                                                          | 3 tables/sequences processed                                                                  | postgres
(315 rows)

--
reset role;
truncate emaj.emaj_hist;
alter sequence emaj.emaj_hist_hist_id_seq restart 30000;
-- the groups are left in their current state for the parallel rollback test.
-- perform some updates to prepare the parallel rollback test
-- set a mark for both groups
select emaj.emaj_set_mark_groups(array['myGroup1','myGroup2'],'Multi-1');
 emaj_set_mark_groups 
----------------------
                   11
(1 row)

select count(*) from mySchema1.myTbl4;
 count 
-------
     0
(1 row)

select count(*) from mySchema1.myTbl1;
 count 
-------
    20
(1 row)

select count(*) from mySchema1.myTbl2; 
 count 
-------
     3
(1 row)

select count(*) from mySchema1."myTbl3";
 count 
-------
    10
(1 row)

select count(*) from mySchema1.myTbl2b;
 count 
-------
     3
(1 row)

select count(*) from mySchema2.myTbl4;
 count 
-------
     2
(1 row)

select count(*) from mySchema2.myTbl1;
 count 
-------
    10
(1 row)

select count(*) from mySchema2.myTbl2; 
 count 
-------
     2
(1 row)

select count(*) from mySchema2."myTbl3";
 count 
-------
    10
(1 row)

delete from mySchema1.myTbl4;
delete from mySchema1.myTbl1;
delete from mySchema1.myTbl2; 
delete from mySchema1."myTbl3";
delete from mySchema1.myTbl2b;
delete from mySchema2.myTbl4;
delete from mySchema2.myTbl1;
delete from mySchema2.myTbl2; 
delete from mySchema2."myTbl3";
alter sequence mySchema2.mySeq1 restart 9999;
