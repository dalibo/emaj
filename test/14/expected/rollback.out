-- rollback.sql : test updates log, emaj_rollback_group(), emaj_logged_rollback_group(),
--                emaj_rollback_groups(), emaj_logged_rollback_groups(),
--                emaj_cleanup_rollback_state(), emaj_rollback_activity(),
--                emaj_comment_rollback(),
--                emaj_consolidate_rollback_group() and emaj_get_consolidable_rollbacks() functions.
--
-- set sequence restart value
select public.handle_emaj_sequences(4000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-- set the triggers state
ALTER TABLE mySchema1.myTbl2 ENABLE TRIGGER myTbl2trg2;
select emaj.emaj_modify_table('myschema1','mytbl2','{"ignored_triggers":"mytbl2trg2"}'::jsonb);
 emaj_modify_table 
-------------------
                 1
(1 row)

-- switch the myTbl2trg1 as an ALWAYS trigger
ALTER TABLE mySchema1.myTbl2 DISABLE TRIGGER myTbl2trg1, ENABLE ALWAYS TRIGGER myTbl2trg1;
-- disable event triggers to test cases with missing components
select emaj.emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

-----------------------------
-- rollback nothing tests
-----------------------------
-- group or groups is NULL
select * from emaj.emaj_rollback_group(NULL,NULL);
ERROR:  _check_group_names: No group to process.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 27 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group(NULL,NULL);
ERROR:  _check_group_names: No group to process.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 27 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_rollback_groups(NULL,NULL);
WARNING:  _check_group_names: No group to process.
 rlbk_severity | rlbk_message 
---------------+--------------
 Notice        | 0
(1 row)

select * from emaj.emaj_logged_rollback_groups(NULL,NULL);
WARNING:  _check_group_names: No group to process.
 rlbk_severity | rlbk_message 
---------------+--------------
 Notice        | 0
(1 row)

-- group is unknown
select * from emaj.emaj_rollback_group('unknownGroup',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('unknownGroup',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"unknownGroup"}',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"unknownGroup","myGroup1"}',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
begin;
  select emaj.emaj_start_group('myGroup1','');
 emaj_start_group 
------------------
                7
(1 row)

  select * from emaj.emaj_rollback_groups('{"myGroup1","unknownGroup"}','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := p_multiGroup, p_lockGroups := FALSE)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 17 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
rollback;
-- group not in logging state
select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup1" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 84 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_group('myGroup2','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup2" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 84 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup1" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 84 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup2','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup2" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 84 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}',NULL);
ERROR:  _check_group_names: The groups "myGroup1, myGroup2" are not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 87 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
begin;
  select emaj.emaj_start_group('myGroup1','');
 emaj_start_group 
------------------
                7
(1 row)

  select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup2" is not in LOGGING state.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 84 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
rollback;
-- start groups and set some marks
select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                7
(1 row)

select emaj.emaj_start_group('myGroup2','Mark21');
 emaj_start_group 
------------------
               10
(1 row)

select emaj.emaj_set_mark_group('myGroup1','Different_Mark');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select emaj.emaj_set_mark_group('myGroup2','Different_Mark');
 emaj_set_mark_group 
---------------------
                  10
(1 row)

-- log tables are empty
select count(*) from emaj_myschema1.mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2b_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1."myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl4_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema2.mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema2.mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema2."myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.myTbl4_log;
 count 
-------
     0
(1 row)

-- protected group
select emaj.emaj_protect_group('myGroup1');
 emaj_protect_group 
--------------------
                  1
(1 row)

select emaj.emaj_protect_group('myGroup2');
 emaj_protect_group 
--------------------
                  1
(1 row)

select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "myGroup1" is currently protected against rollback operations.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 97 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup2","myGroup1"}',NULL);
ERROR:  _check_group_names: The groups "myGroup1, myGroup2" are currently protected against rollback operations.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 100 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
select emaj.emaj_unprotect_group('myGroup1');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select emaj.emaj_unprotect_group('myGroup2');
 emaj_unprotect_group 
----------------------
                    1
(1 row)

select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4000.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
(3 rows)

-- unknown mark name
select * from emaj.emaj_rollback_group('myGroup1',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_group('myGroup1','DummyMark');
ERROR:  _check_mark_name: The mark "DummyMark" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup1',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_logged_rollback_group('myGroup1','DummyMark');
ERROR:  _check_mark_name: The mark "DummyMark" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2",""}',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 63 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2",NULL}',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 63 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','DummyMark');
ERROR:  _check_mark_name: The mark "DummyMark" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 63 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2","myGroup2"}',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the groups "myGroup1, myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 63 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark11');
ERROR:  _check_mark_name: The mark "Mark11" does not exist for the group "myGroup2".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
-- mark name referencing different points in time
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Different_Mark');
ERROR:  _check_mark_name: The mark "Different_Mark" does not represent the same point in time for all groups.
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 72 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
ERROR:  _check_mark_name: The EMAJ_LAST_MARK does not represent the same point in time for all groups.
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
-- attempt to rollback 'audit_only' groups
select emaj.emaj_create_group('auditOnlyEmptyGroup',false);
 emaj_create_group 
-------------------
                 1
(1 row)

select * from emaj.emaj_rollback_group('phil''s group#3",','EMAJ_LAST_MARK');
ERROR:  _check_group_names: The group "phil's group#3"," has been created as AUDIT_ONLY.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 58 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups(array['phil''s group#3",','auditOnlyEmptyGroup'],'M1_audit_only');
ERROR:  _check_group_names: The groups "auditOnlyEmptyGroup, phil's group#3"," have been created as AUDIT_ONLY.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := p_groupNames, p_mayBeNull := FALSE, p_lockGroups := TRUE,
                                     p_checkLogging := TRUE, p_checkRollbackable := TRUE, p_checkUnprotected := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 16 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
select emaj.emaj_drop_group('auditOnlyEmptyGroup');
 emaj_drop_group 
-----------------
               0
(1 row)

-- attempt to rollback to a stop mark
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

  select emaj.emaj_start_group('myGroup1','StartMark',false);
 emaj_start_group 
------------------
                7
(1 row)

  select emaj.emaj_rename_mark_group('myGroup1',(select emaj.emaj_get_previous_mark_group('myGroup1','StartMark')), 'GeneratedStopMark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

  select * from emaj.emaj_rollback_group('myGroup1','GeneratedStopMark');
ERROR:  _check_mark_name: For the group "myGroup1", the mark "GeneratedStopMark" was set before the latest group start.
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 85 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := p_groupNames, p_mark := p_mark, p_checkActive := TRUE)"
PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 21 at SQL statement
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
-- attempt to rollback over protected marks
begin;
  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 1');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 2');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 2');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_rollback_group('myGroup1','Mark11');
ERROR:  _rlbk_check: Protected marks (Protected Mark 1, Protected Mark 2) for the group "myGroup1" block the rollback to the mark "Mark11".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
-- attempt to rollback several groups over one single-mark protected marks
begin;
  select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Common Mark 1');
 emaj_set_mark_groups 
----------------------
                   17
(1 row)

  select emaj.emaj_set_mark_group('myGroup1','Protected Mark 1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

  select emaj.emaj_protect_mark_group('myGroup1','Protected Mark 1');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Common Mark 1');
ERROR:  _rlbk_check: Protected marks (Protected Mark 1) for the group "myGroup1" block the rollback to the mark "Common Mark 1".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
rollback;
-- attempt to logged-rollback over a protected mark
begin;
  select emaj.emaj_protect_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_logged_rollback_group('myGroup1','Mark11');
ERROR:  _rlbk_check: Protected marks (Different_Mark) for the group "myGroup1" block the rollback to the mark "Mark11".
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 41 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
rollback;
-- rollback to a protected mark
begin;
  select emaj.emaj_protect_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_protect_mark_group 
-------------------------
                       1
(1 row)

  select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4001.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
(3 rows)

rollback;
-- missing application table and mono-group rollback
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_rollback_group('myGroup2','Mark21');
ERROR:  _verify_groups (1): In tables group "myGroup2", the table "myschema2"."myTbl3" does not exist anymore. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 39 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(p_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 28 at PERFORM
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_logged_rollback_group('myGroup2','Mark21');
ERROR:  _verify_groups (1): In tables group "myGroup2", the table "myschema2"."myTbl3" does not exist anymore. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 39 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(p_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 28 at PERFORM
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
rollback;
-- internal error when the row corresponding to an application sequence to rollback is missing in emaj_sequence
begin;
  delete from emaj.emaj_sequence where sequ_schema = 'myschema2' and sequ_name = 'myseq1';
  select * from emaj.emaj_rollback_group('myGroup2','Mark21');
ERROR:  _rlbk_seq: No mark at time id "4004" can be found for the sequence "myschema2.myseq1".
CONTEXT:  PL/pgSQL function emaj._rlbk_seq(emaj.emaj_relation,bigint) line 20 at RAISE
SQL statement "SELECT sum(emaj._rlbk_seq(t.*, greatest(v_rlbkMarkTimeId, lower(t.rel_time_range))))                                  FROM
              (SELECT *
                 FROM emaj.emaj_relation
                 WHERE upper_inf(rel_time_range)
                   AND rel_group = ANY (v_groupNames)
                   AND rel_kind = 'S'
                 ORDER BY rel_schema, rel_tblseq
              ) as t"
PL/pgSQL function emaj._rlbk_session_exec(integer,integer) line 60 at SQL statement
SQL statement "SELECT emaj._rlbk_session_exec(v_rlbkId, 1)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 32 at PERFORM
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
-- should be OK, with different cases of dblink status
-- hide dblink_connect functions
alter function public.dblink_connect(text,text) rename to renamed_dblink_connect;
alter function public.dblink_connect(text) rename to renamed_dblink_connect;
select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4003.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
(3 rows)

select * from emaj.emaj_rollback_group('myGroup2','Mark21');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4004.
 Notice        | 0 / 8 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
(3 rows)

alter function public.renamed_dblink_connect(text,text) rename to dblink_connect;
alter function public.renamed_dblink_connect(text) rename to dblink_connect;
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Mark1B');
 emaj_set_mark_groups 
----------------------
                   17
(1 row)

-- no user/password defined in emaj_param
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4005.
 Notice        | 0 / 13 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

-- bad user/password defined in emaj_param
insert into emaj.emaj_param (param_key, param_value_text) 
  values ('dblink_user_password','user=<user> password=<password>');
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4006.
 Notice        | 0 / 13 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

-- transaction not in READ COMMITTED isolation level => the dblink connection is not possible
begin;
  set transaction isolation level repeatable read;
  select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','EMAJ_LAST_MARK');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4007.
 Notice        | 0 / 13 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

commit;
-- dblink connection should now be ok (missing right on dblink functions is tested in adm1.sql)
update emaj.emaj_param set param_value_text = 'user=postgres password=postgres' 
  where param_key = 'dblink_user_password';
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4008.
 Notice        | 0 / 13 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

-- missing application table and multi-groups rollback
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
ERROR:  _verify_groups (1): In tables group "myGroup2", the table "myschema2"."myTbl3" does not exist anymore. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 39 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(p_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 28 at PERFORM
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean,text) line 8 at RETURN QUERY
rollback;
begin;
  drop table mySchema2."myTbl3" cascade;
  select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mark1B');
ERROR:  _verify_groups (1): In tables group "myGroup2", the table "myschema2"."myTbl3" does not exist anymore. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 39 at RAISE
SQL statement "SELECT 0
        FROM emaj._verify_groups(p_groupNames, TRUE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 28 at PERFORM
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
rollback;
-- restart groups
select emaj.emaj_stop_groups('{"myGroup1","myGroup2"}');
 emaj_stop_groups 
------------------
               17
(1 row)

select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                7
(1 row)

select emaj.emaj_start_group('myGroup2','Mark21');
 emaj_start_group 
------------------
               10
(1 row)

-----------------------------
-- log phase #1 with 2 unlogged rollbacks
-----------------------------
-- Populate application tables
set search_path=public,myschema1;
-- inserts/updates/deletes in myTbl1, myTbl2 and myTbl2b (via trigger)
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
begin transaction;
  update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
  insert into myTbl2 values (1,'ABC',current_date);
commit;
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
insert into myTbl2 values (3,'GHI',NULL);
update myTbl2 set col22 = NULL WHERE col23 IS NULL;
delete from myTbl2 where col21 = 3 and col22 is NULL;
select count(*) from mytbl1;
 count 
-------
    10
(1 row)

select count(*) from mytbl2;
 count 
-------
     2
(1 row)

select count(*) from mytbl2b;
 count 
-------
     6
(1 row)

select count(*) from "myTbl3";
 count 
-------
     0
(1 row)

select count(*) from myTbl4;
 count 
-------
     0
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark12');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         3006 | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         3400 | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         3401 | f                      |                                        |                           | 
 phil's group#3", | Mark4          |         3402 | f                      |                                        |                         0 | 
 phil's group#3", | Mark5          |         3403 | f                      |                                        |                           | 
 myGroup1         | Mark11         |         4028 | f                      |                                        |                        27 | 
 myGroup2         | Mark21         |         4029 | f                      |                                        |                           | 
 myGroup1         | Mark12         |         4030 | f                      |                                        |                           | 
(8 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4028 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4028 |             1 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4030 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4030 |             6 | t
(10 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema1       | myTbl3      |        4028 |                    0
 myschema1       | mytbl1      |        4028 |                    0
 myschema1       | mytbl2      |        4028 |                    0
 myschema1       | mytbl2b     |        4028 |                    0
 myschema1       | mytbl4      |        4028 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4030 |                    0
 myschema1       | mytbl1      |        4030 |                   15
 myschema1       | mytbl2      |        4030 |                    6
 myschema1       | mytbl2b     |        4030 |                    6
 myschema1       | mytbl4      |        4030 |                    0
(22 rows)

select * from emaj.emaj_log_session where lses_group = 'myGroup1' and upper_inf(lses_time_range) order by lses_group, lses_time_range;
 lses_group | lses_time_range | lses_marks | lses_log_rows 
------------+-----------------+------------+---------------
 myGroup1   | [4028,)         |          2 |            27
(1 row)

-- inserts/updates/deletes in myTbl3 and myTbl4
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
update myTbl4 set col44 = NULL where col41 = 1;
select count(*) from "myTbl3";
 count 
-------
    10
(1 row)

select count(*) from myTbl4;
 count 
-------
     1
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark13');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         3006 | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         3400 | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         3401 | f                      |                                        |                           | 
 phil's group#3", | Mark4          |         3402 | f                      |                                        |                         0 | 
 phil's group#3", | Mark5          |         3403 | f                      |                                        |                           | 
 myGroup1         | Mark11         |         4028 | f                      |                                        |                        27 | 
 myGroup2         | Mark21         |         4029 | f                      |                                        |                           | 
 myGroup1         | Mark12         |         4030 | f                      |                                        |                        12 | 
 myGroup1         | Mark13         |         4031 | f                      |                                        |                           | 
(9 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4028 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4028 |             1 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4030 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4030 |             6 | t
 myschema1       | myTbl3_col31_seq  |         4031 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4031 |             6 | t
(12 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema1       | myTbl3      |        4028 |                    0
 myschema1       | mytbl1      |        4028 |                    0
 myschema1       | mytbl2      |        4028 |                    0
 myschema1       | mytbl2b     |        4028 |                    0
 myschema1       | mytbl4      |        4028 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4030 |                    0
 myschema1       | mytbl1      |        4030 |                   15
 myschema1       | mytbl2      |        4030 |                    6
 myschema1       | mytbl2b     |        4030 |                    6
 myschema1       | mytbl4      |        4030 |                    0
 myschema1       | myTbl3      |        4031 |                   10
 myschema1       | mytbl1      |        4031 |                   15
 myschema1       | mytbl2      |        4031 |                    6
 myschema1       | mytbl2b     |        4031 |                    6
 myschema1       | mytbl4      |        4031 |                    2
(27 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |  4000001
     2 | ABC        | \x0c  | INS       | NEW        |  4000002
     3 | ABC        | \x0c  | INS       | NEW        |  4000003
     4 | ABC        | \x0c  | INS       | NEW        |  4000004
     5 | ABC        | \x0c  | INS       | NEW        |  4000005
     6 | ABC        | \x0c  | INS       | NEW        |  4000006
     7 | ABC        | \x0c  | INS       | NEW        |  4000007
     8 | ABC        | \x0c  | INS       | NEW        |  4000008
     9 | ABC        | \x0c  | INS       | NEW        |  4000009
    10 | ABC        | \x0c  | INS       | NEW        |  4000010
    11 | ABC        | \x0c  | INS       | NEW        |  4000011
     1 | ABC        | \x0c  | UPD       | OLD        |  4000012
     1 | ABC        | \x1c  | UPD       | NEW        |  4000012
     2 | ABC        | \x0c  | UPD       | OLD        |  4000013
     2 | ABC        | \x1c  | UPD       | NEW        |  4000013
     3 | ABC        | \x0c  | UPD       | OLD        |  4000014
     3 | ABC        | \x1c  | UPD       | NEW        |  4000014
    11 | ABC        | \x0c  | DEL       | OLD        |  4000017
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |  4000015
     2 | DEF   | INS       | NEW        |  4000018
     3 | GHI   | INS       | NEW        |  4000020
     2 | DEF   | UPD       | OLD        |  4000022
     2 |       | UPD       | NEW        |  4000022
     3 | GHI   | UPD       | OLD        |  4000024
     3 |       | UPD       | NEW        |  4000024
     3 |       | DEL       | OLD        |  4000026
(8 rows)

select col20, col21, col22, col23, col24, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 |       col22        |         col23         | col24 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+--------------------+-----------------------+-------+-----------+------------+----------
     1 |     1 |                  1 |    0.7071067811865476 | t     | INS       | NEW        |  4000016
     2 |     2 |                0.5 | 6.123233995736766e-17 | t     | INS       | NEW        |  4000019
     3 |     3 | 0.3333333333333333 |   -0.7071067811865475 | t     | INS       | NEW        |  4000021
     4 |     2 |                0.5 | 6.123233995736766e-17 | t     | INS       | NEW        |  4000023
     5 |     3 | 0.3333333333333333 |   -0.7071067811865475 | t     | INS       | NEW        |  4000025
     6 |     3 | 0.3333333333333333 |   -0.7071067811865475 | t     | INS       | NEW        |  4000027
(6 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |  4000028
     2 | 10.00 | INS       | NEW        |  4000029
     3 | 10.00 | INS       | NEW        |  4000030
     4 | 10.00 | INS       | NEW        |  4000031
     5 | 10.00 | INS       | NEW        |  4000032
     6 | 10.00 | INS       | NEW        |  4000033
     7 | 10.00 | INS       | NEW        |  4000034
     8 | 10.00 | INS       | NEW        |  4000035
     9 | 10.00 | INS       | NEW        |  4000036
    10 | 10.00 | INS       | NEW        |  4000037
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |  4000038
     1 | FK... |     1 |     1 | ABC        | UPD       | OLD        |  4000039
     1 | FK... |     1 |       | ABC        | UPD       | NEW        |  4000039
(3 rows)

-- rollback #1
select * from emaj.emaj_rollback_group('myGroup1','Mark12');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4009.
 Notice        | 2 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         3006 | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         3400 | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         3401 | f                      |                                        |                           | 
 phil's group#3", | Mark4          |         3402 | f                      |                                        |                         0 | 
 phil's group#3", | Mark5          |         3403 | f                      |                                        |                           | 
 myGroup1         | Mark11         |         4028 | f                      |                                        |                        27 | 
 myGroup2         | Mark21         |         4029 | f                      |                                        |                           | 
 myGroup1         | Mark12         |         4030 | f                      |                                        |                           | 
(8 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4028 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4028 |             1 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4030 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4030 |             6 | t
(10 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema1       | myTbl3      |        4028 |                    0
 myschema1       | mytbl1      |        4028 |                    0
 myschema1       | mytbl2      |        4028 |                    0
 myschema1       | mytbl2b     |        4028 |                    0
 myschema1       | mytbl4      |        4028 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4030 |                    0
 myschema1       | mytbl1      |        4030 |                   15
 myschema1       | mytbl2      |        4030 |                    6
 myschema1       | mytbl2b     |        4030 |                    6
 myschema1       | mytbl4      |        4030 |                    0
(22 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               4030 |             4032 |             10
 myschema1   | mytbl4     |               4030 |             4032 |              2
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 | col45 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

select col31, col33 from myschema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select col41, col42, col43, col44, col45 from myschema1.myTbl4 order by col41, col43;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- rollback #2 (and stop)
select * from emaj.emaj_rollback_group('myGroup1','Mark11',false,'Rollback set by the ''rollback.sql'' script');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4010.
 Notice        | 3 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         3006 | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         3400 | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         3401 | f                      |                                        |                           | 
 phil's group#3", | Mark4          |         3402 | f                      |                                        |                         0 | 
 phil's group#3", | Mark5          |         3403 | f                      |                                        |                           | 
 myGroup1         | Mark11         |         4028 | f                      |                                        |                         0 | 
 myGroup2         | Mark21         |         4029 | f                      |                                        |                           | 
 myGroup1         | STOP_%         |         4034 | f                      |                                        |                         0 | 
(8 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4028 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4028 |             1 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4034 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4034 |             1 | f
(10 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema1       | myTbl3      |        4028 |                    0
 myschema1       | mytbl1      |        4028 |                    0
 myschema1       | mytbl2      |        4028 |                    0
 myschema1       | mytbl2b     |        4028 |                    0
 myschema1       | mytbl4      |        4028 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4034 |                   10
 myschema1       | mytbl1      |        4034 |                   15
 myschema1       | mytbl2      |        4034 |                    6
 myschema1       | mytbl2b     |        4034 |                    6
 myschema1       | mytbl4      |        4034 |                    2
(22 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               4030 |             4032 |             10
 myschema1   | mytbl1     |               4028 |             4033 |             15
 myschema1   | mytbl2     |               4028 |             4033 |              6
 myschema1   | mytbl2b    |               4028 |             4033 |              6
 myschema1   | mytbl4     |               4030 |             4032 |              2
(5 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 | col12 | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------+------------+----------
(0 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
(0 rows)

select col20, col21, col22, col23, col24, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 | col23 | col24 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+-------+-----------+------------+----------
(0 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 | col12 | col13 
-------+-------+-------
(0 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
(0 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

-- restart group
select emaj.emaj_start_group('myGroup1','Mark11');
 emaj_start_group 
------------------
                7
(1 row)

-- check the logs are empty again
select count(*) from emaj_myschema1.mytbl1_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl2b_log;
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1."myTbl3_log";
 count 
-------
     0
(1 row)

select count(*) from emaj_myschema1.mytbl4_log;
 count 
-------
     0
(1 row)

-----------------------------
-- log phase #2 with 2 logged rollbacks
-----------------------------
-- Populate application tables
set search_path=public,myschema1;
-- inserts/updates/deletes in myTbl1, myTbl2 and myTbl2b (via trigger)
insert into myTbl1 select i, 'ABC', E'\\014'::bytea from generate_series (1,11) as i;
begin transaction;
  update myTbl1 set col13=E'\\034'::bytea where col11 <= 3;
  insert into myTbl2 values (1,'ABC',current_date);
commit;
delete from myTbl1 where col11 > 10;
insert into myTbl2 values (2,'DEF',NULL);
select count(*) from mytbl1;
 count 
-------
    10
(1 row)

select count(*) from mytbl2;
 count 
-------
     2
(1 row)

select count(*) from mytbl2b;
 count 
-------
     2
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark12');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

-- inserts/updates/deletes in myTbl3 and myTbl4
insert into "myTbl3" (col33) select generate_series(1000,1039,4)/100;
insert into myTbl4 values (1,'FK...',1,1,'ABC');
select count(*) from "myTbl3";
 count 
-------
    10
(1 row)

select count(*) from myTbl4;
 count 
-------
     1
(1 row)

-- set a mark
select emaj.emaj_set_mark_group('myGroup1','Mark13');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         3006 | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         3400 | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         3401 | f                      |                                        |                           | 
 phil's group#3", | Mark4          |         3402 | f                      |                                        |                         0 | 
 phil's group#3", | Mark5          |         3403 | f                      |                                        |                           | 
 myGroup2         | Mark21         |         4029 | f                      |                                        |                           | 
 myGroup1         | Mark11         |         4035 | f                      |                                        |                        19 | 
 myGroup1         | Mark12         |         4036 | f                      |                                        |                        11 | 
 myGroup1         | Mark13         |         4037 | f                      |                                        |                           | 
(9 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4035 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4035 |             1 | f
 myschema1       | myTbl3_col31_seq  |         4036 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4036 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4037 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4037 |             2 | t
(12 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4035 |                   10
 myschema1       | mytbl1      |        4035 |                   15
 myschema1       | mytbl2      |        4035 |                    6
 myschema1       | mytbl2b     |        4035 |                    6
 myschema1       | mytbl4      |        4035 |                    2
 myschema1       | myTbl3      |        4036 |                   10
 myschema1       | mytbl1      |        4036 |                   30
 myschema1       | mytbl2      |        4036 |                    8
 myschema1       | mytbl2b     |        4036 |                    8
 myschema1       | mytbl4      |        4036 |                    2
 myschema1       | myTbl3      |        4037 |                   20
 myschema1       | mytbl1      |        4037 |                   30
 myschema1       | mytbl2      |        4037 |                    8
 myschema1       | mytbl2b     |        4037 |                    8
 myschema1       | mytbl4      |        4037 |                    3
(27 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |  4000040
     2 | ABC        | \x0c  | INS       | NEW        |  4000041
     3 | ABC        | \x0c  | INS       | NEW        |  4000042
     4 | ABC        | \x0c  | INS       | NEW        |  4000043
     5 | ABC        | \x0c  | INS       | NEW        |  4000044
     6 | ABC        | \x0c  | INS       | NEW        |  4000045
     7 | ABC        | \x0c  | INS       | NEW        |  4000046
     8 | ABC        | \x0c  | INS       | NEW        |  4000047
     9 | ABC        | \x0c  | INS       | NEW        |  4000048
    10 | ABC        | \x0c  | INS       | NEW        |  4000049
    11 | ABC        | \x0c  | INS       | NEW        |  4000050
     1 | ABC        | \x0c  | UPD       | OLD        |  4000051
     1 | ABC        | \x1c  | UPD       | NEW        |  4000051
     2 | ABC        | \x0c  | UPD       | OLD        |  4000052
     2 | ABC        | \x1c  | UPD       | NEW        |  4000052
     3 | ABC        | \x0c  | UPD       | OLD        |  4000053
     3 | ABC        | \x1c  | UPD       | NEW        |  4000053
    11 | ABC        | \x0c  | DEL       | OLD        |  4000056
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |  4000054
     2 | DEF   | INS       | NEW        |  4000057
(2 rows)

select col20, col21, col22, col23, col24, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.mytbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 |         col23         | col24 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------------------+-------+-----------+------------+----------
     1 |     1 |     1 |    0.7071067811865476 | t     | INS       | NEW        |  4000055
     2 |     2 |   0.5 | 6.123233995736766e-17 | t     | INS       | NEW        |  4000058
(2 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |  4000059
     2 | 10.00 | INS       | NEW        |  4000060
     3 | 10.00 | INS       | NEW        |  4000061
     4 | 10.00 | INS       | NEW        |  4000062
     5 | 10.00 | INS       | NEW        |  4000063
     6 | 10.00 | INS       | NEW        |  4000064
     7 | 10.00 | INS       | NEW        |  4000065
     8 | 10.00 | INS       | NEW        |  4000066
     9 | 10.00 | INS       | NEW        |  4000067
    10 | 10.00 | INS       | NEW        |  4000068
(10 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |  4000069
(1 row)

-- logged rollback #1
select * from emaj.emaj_logged_rollback_group('myGroup1','Mark12');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4011.
 Notice        | 2 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace  | mark_time_id | mark_is_rlbk_protected |                    mark_comment                    | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+-----------------+--------------+------------------------+----------------------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2             |         3006 | f                      | a comment on a mark for an empty group             |                         0 | Mark1
 emptyGroup       | EGM3            |         3400 | f                      |                                                    |                         0 | 
 emptyGroup       | EGM4            |         3401 | f                      |                                                    |                           | 
 phil's group#3", | Mark4           |         3402 | f                      |                                                    |                         0 | 
 phil's group#3", | Mark5           |         3403 | f                      |                                                    |                           | 
 myGroup2         | Mark21          |         4029 | f                      |                                                    |                           | 
 myGroup1         | Mark11          |         4035 | f                      |                                                    |                        19 | 
 myGroup1         | Mark12          |         4036 | f                      |                                                    |                        11 | 
 myGroup1         | Mark13          |         4037 | f                      |                                                    |                         0 | 
 myGroup1         | RLBK_4011_START |         4038 | f                      | Automatically set at rollback to mark Mark12 start |                        11 | 
 myGroup1         | RLBK_4011_DONE  |         4039 | f                      | Automatically set at rollback to mark Mark12 end   |                           | Mark12
(11 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4035 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4035 |             1 | f
 myschema1       | myTbl3_col31_seq  |         4036 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4036 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4037 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4037 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4038 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4038 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4039 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4039 |             2 | t
(16 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4035 |                   10
 myschema1       | mytbl1      |        4035 |                   15
 myschema1       | mytbl2      |        4035 |                    6
 myschema1       | mytbl2b     |        4035 |                    6
 myschema1       | mytbl4      |        4035 |                    2
 myschema1       | myTbl3      |        4036 |                   10
 myschema1       | mytbl1      |        4036 |                   30
 myschema1       | mytbl2      |        4036 |                    8
 myschema1       | mytbl2b     |        4036 |                    8
 myschema1       | mytbl4      |        4036 |                    2
 myschema1       | myTbl3      |        4037 |                   20
 myschema1       | mytbl1      |        4037 |                   30
 myschema1       | mytbl2      |        4037 |                    8
 myschema1       | mytbl2b     |        4037 |                    8
 myschema1       | mytbl4      |        4037 |                    3
 myschema1       | myTbl3      |        4038 |                   20
 myschema1       | mytbl1      |        4038 |                   30
 myschema1       | mytbl2      |        4038 |                    8
 myschema1       | mytbl2b     |        4038 |                    8
 myschema1       | mytbl4      |        4038 |                    3
 myschema1       | myTbl3      |        4039 |                   30
 myschema1       | mytbl1      |        4039 |                   30
 myschema1       | mytbl2      |        4039 |                    8
 myschema1       | mytbl2b     |        4039 |                    8
 myschema1       | mytbl4      |        4039 |                    4
(37 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select col31, col33, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1."myTbl3_log" order by emaj_gid, emaj_tuple desc;
 col31 | col33 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | 10.00 | INS       | NEW        |  4000059
     2 | 10.00 | INS       | NEW        |  4000060
     3 | 10.00 | INS       | NEW        |  4000061
     4 | 10.00 | INS       | NEW        |  4000062
     5 | 10.00 | INS       | NEW        |  4000063
     6 | 10.00 | INS       | NEW        |  4000064
     7 | 10.00 | INS       | NEW        |  4000065
     8 | 10.00 | INS       | NEW        |  4000066
     9 | 10.00 | INS       | NEW        |  4000067
    10 | 10.00 | INS       | NEW        |  4000068
     1 | 10.00 | DEL       | OLD        |  4000070
     2 | 10.00 | DEL       | OLD        |  4000071
     3 | 10.00 | DEL       | OLD        |  4000072
     4 | 10.00 | DEL       | OLD        |  4000073
     5 | 10.00 | DEL       | OLD        |  4000074
     6 | 10.00 | DEL       | OLD        |  4000075
     7 | 10.00 | DEL       | OLD        |  4000076
     8 | 10.00 | DEL       | OLD        |  4000077
     9 | 10.00 | DEL       | OLD        |  4000078
    10 | 10.00 | DEL       | OLD        |  4000079
(20 rows)

select col41, col42, col43, col44, col45, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl4_log order by emaj_gid, emaj_tuple desc;
 col41 | col42 | col43 | col44 |   col45    | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-------+------------+-----------+------------+----------
     1 | FK... |     1 |     1 | ABC        | INS       | NEW        |  4000069
     1 | FK... |     1 |     1 | ABC        | DEL       | OLD        |  4000080
(2 rows)

select col31, col33 from myschema1."myTbl3" order by col31;
 col31 | col33 
-------+-------
(0 rows)

select col41, col42, col43, col44, col45 from myschema1.myTbl4 order by col41, col43;
 col41 | col42 | col43 | col44 | col45 
-------+-------+-------+-------+-------
(0 rows)

-- logged rollback #2
select * from emaj.emaj_logged_rollback_group('myGroup1','Mark11',false,'Logged rollback set by the rollback.sql script');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4012.
 Notice        | 5 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace  | mark_time_id | mark_is_rlbk_protected |                    mark_comment                    | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+-----------------+--------------+------------------------+----------------------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2             |         3006 | f                      | a comment on a mark for an empty group             |                         0 | Mark1
 emptyGroup       | EGM3            |         3400 | f                      |                                                    |                         0 | 
 emptyGroup       | EGM4            |         3401 | f                      |                                                    |                           | 
 phil's group#3", | Mark4           |         3402 | f                      |                                                    |                         0 | 
 phil's group#3", | Mark5           |         3403 | f                      |                                                    |                           | 
 myGroup2         | Mark21          |         4029 | f                      |                                                    |                           | 
 myGroup1         | Mark11          |         4035 | f                      |                                                    |                        19 | 
 myGroup1         | Mark12          |         4036 | f                      |                                                    |                        11 | 
 myGroup1         | Mark13          |         4037 | f                      |                                                    |                         0 | 
 myGroup1         | RLBK_4011_START |         4038 | f                      | Automatically set at rollback to mark Mark12 start |                        11 | 
 myGroup1         | RLBK_4011_DONE  |         4039 | f                      | Automatically set at rollback to mark Mark12 end   |                         0 | Mark12
 myGroup1         | RLBK_4012_START |         4040 | f                      | Automatically set at rollback to mark Mark11 start |                        14 | 
 myGroup1         | RLBK_4012_DONE  |         4041 | f                      | Automatically set at rollback to mark Mark11 end   |                           | Mark11
(13 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4035 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4035 |             1 | f
 myschema1       | myTbl3_col31_seq  |         4036 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4036 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4037 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4037 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4038 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4038 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4039 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4039 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4040 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4040 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4041 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4041 |             1 | f
(20 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4035 |                   10
 myschema1       | mytbl1      |        4035 |                   15
 myschema1       | mytbl2      |        4035 |                    6
 myschema1       | mytbl2b     |        4035 |                    6
 myschema1       | mytbl4      |        4035 |                    2
 myschema1       | myTbl3      |        4036 |                   10
 myschema1       | mytbl1      |        4036 |                   30
 myschema1       | mytbl2      |        4036 |                    8
 myschema1       | mytbl2b     |        4036 |                    8
 myschema1       | mytbl4      |        4036 |                    2
 myschema1       | myTbl3      |        4037 |                   20
 myschema1       | mytbl1      |        4037 |                   30
 myschema1       | mytbl2      |        4037 |                    8
 myschema1       | mytbl2b     |        4037 |                    8
 myschema1       | mytbl4      |        4037 |                    3
 myschema1       | myTbl3      |        4038 |                   20
 myschema1       | mytbl1      |        4038 |                   30
 myschema1       | mytbl2      |        4038 |                    8
 myschema1       | mytbl2b     |        4038 |                    8
 myschema1       | mytbl4      |        4038 |                    3
 myschema1       | myTbl3      |        4039 |                   30
 myschema1       | mytbl1      |        4039 |                   30
 myschema1       | mytbl2      |        4039 |                    8
 myschema1       | mytbl2b     |        4039 |                    8
 myschema1       | mytbl4      |        4039 |                    4
 myschema1       | myTbl3      |        4040 |                   30
 myschema1       | mytbl1      |        4040 |                   30
 myschema1       | mytbl2      |        4040 |                    8
 myschema1       | mytbl2b     |        4040 |                    8
 myschema1       | mytbl4      |        4040 |                    4
 myschema1       | myTbl3      |        4041 |                   30
 myschema1       | mytbl1      |        4041 |                   40
 myschema1       | mytbl2      |        4041 |                   10
 myschema1       | mytbl2b     |        4041 |                   10
 myschema1       | mytbl4      |        4041 |                    4
(47 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |  4000040
     2 | ABC        | \x0c  | INS       | NEW        |  4000041
     3 | ABC        | \x0c  | INS       | NEW        |  4000042
     4 | ABC        | \x0c  | INS       | NEW        |  4000043
     5 | ABC        | \x0c  | INS       | NEW        |  4000044
     6 | ABC        | \x0c  | INS       | NEW        |  4000045
     7 | ABC        | \x0c  | INS       | NEW        |  4000046
     8 | ABC        | \x0c  | INS       | NEW        |  4000047
     9 | ABC        | \x0c  | INS       | NEW        |  4000048
    10 | ABC        | \x0c  | INS       | NEW        |  4000049
    11 | ABC        | \x0c  | INS       | NEW        |  4000050
     1 | ABC        | \x0c  | UPD       | OLD        |  4000051
     1 | ABC        | \x1c  | UPD       | NEW        |  4000051
     2 | ABC        | \x0c  | UPD       | OLD        |  4000052
     2 | ABC        | \x1c  | UPD       | NEW        |  4000052
     3 | ABC        | \x0c  | UPD       | OLD        |  4000053
     3 | ABC        | \x1c  | UPD       | NEW        |  4000053
    11 | ABC        | \x0c  | DEL       | OLD        |  4000056
     1 | ABC        | \x1c  | DEL       | OLD        |  4000081
     2 | ABC        | \x1c  | DEL       | OLD        |  4000082
     3 | ABC        | \x1c  | DEL       | OLD        |  4000083
     4 | ABC        | \x0c  | DEL       | OLD        |  4000084
     5 | ABC        | \x0c  | DEL       | OLD        |  4000085
     6 | ABC        | \x0c  | DEL       | OLD        |  4000086
     7 | ABC        | \x0c  | DEL       | OLD        |  4000087
     8 | ABC        | \x0c  | DEL       | OLD        |  4000088
     9 | ABC        | \x0c  | DEL       | OLD        |  4000089
    10 | ABC        | \x0c  | DEL       | OLD        |  4000090
(28 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |  4000054
     2 | DEF   | INS       | NEW        |  4000057
     1 | ABC   | DEL       | OLD        |  4000091
     2 | DEF   | DEL       | OLD        |  4000092
(4 rows)

select col20, col21, col22, col23, col24, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 |         col23         | col24 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------------------+-------+-----------+------------+----------
     1 |     1 |     1 |    0.7071067811865476 | t     | INS       | NEW        |  4000055
     2 |     2 |   0.5 | 6.123233995736766e-17 | t     | INS       | NEW        |  4000058
     1 |     1 |     1 |    0.7071067811865476 | t     | DEL       | OLD        |  4000093
     2 |     2 |   0.5 | 6.123233995736766e-17 | t     | DEL       | OLD        |  4000094
(4 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 | col12 | col13 
-------+-------+-------
(0 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
(0 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
(0 rows)

-- check application triggers state
select nspname, relname, tgname, tgenabled from pg_trigger, pg_class, pg_namespace
  where relnamespace = pg_namespace.oid and tgrelid = pg_class.oid and tgname like 'mytbl2trg%'
  order by 1,2,3;
  nspname  | relname |   tgname   | tgenabled 
-----------+---------+------------+-----------
 myschema1 | mytbl2  | mytbl2trg1 | A
 myschema1 | mytbl2  | mytbl2trg2 | O
(2 rows)

-----------------------------
-- unlogged rollback of logged rollbacks #3
-----------------------------
alter table mySchema1.myTbl2 disable trigger myTbl2trg1;
select * from emaj.emaj_rollback_group('myGroup1','Mark13');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4013.
 Notice        | 5 / 5 tables effectively processed.
 Notice        | 2 / 2 sequences effectively processed.
(3 rows)

alter table mySchema1.myTbl2 enable trigger myTbl2trg1;
-- check impact
select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark order by mark_time_id, mark_group;
    mark_group    | regexp_replace | mark_time_id | mark_is_rlbk_protected |              mark_comment              | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------------+----------------+--------------+------------------------+----------------------------------------+---------------------------+------------------------------
 emptyGroup       | SM2            |         3006 | f                      | a comment on a mark for an empty group |                         0 | Mark1
 emptyGroup       | EGM3           |         3400 | f                      |                                        |                         0 | 
 emptyGroup       | EGM4           |         3401 | f                      |                                        |                           | 
 phil's group#3", | Mark4          |         3402 | f                      |                                        |                         0 | 
 phil's group#3", | Mark5          |         3403 | f                      |                                        |                           | 
 myGroup2         | Mark21         |         4029 | f                      |                                        |                           | 
 myGroup1         | Mark11         |         4035 | f                      |                                        |                        19 | 
 myGroup1         | Mark12         |         4036 | f                      |                                        |                        11 | 
 myGroup1         | Mark13         |         4037 | f                      |                                        |                           | 
(9 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence order by sequ_time_id, sequ_schema, sequ_name;
   sequ_schema   |     sequ_name     | sequ_time_id | sequ_last_val | sequ_is_called 
-----------------+-------------------+--------------+---------------+----------------
 phil's schema"3 | myTbl2\_col21_seq |         3402 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3402 |          1000 | f
 phil's schema"3 | myTbl2\_col21_seq |         3403 |             1 | f
 phil's schema"3 | phil's"seq\1      |         3403 |          1000 | f
 myschema2       | myTbl3_col31_seq  |         4029 |             1 | f
 myschema2       | myseq1            |         4029 |          1000 | f
 myschema1       | myTbl3_col31_seq  |         4035 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4035 |             1 | f
 myschema1       | myTbl3_col31_seq  |         4036 |             1 | f
 myschema1       | mytbl2b_col20_seq |         4036 |             2 | t
 myschema1       | myTbl3_col31_seq  |         4037 |            10 | t
 myschema1       | mytbl2b_col20_seq |         4037 |             2 | t
(12 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4035 |                   10
 myschema1       | mytbl1      |        4035 |                   15
 myschema1       | mytbl2      |        4035 |                    6
 myschema1       | mytbl2b     |        4035 |                    6
 myschema1       | mytbl4      |        4035 |                    2
 myschema1       | myTbl3      |        4036 |                   10
 myschema1       | mytbl1      |        4036 |                   30
 myschema1       | mytbl2      |        4036 |                    8
 myschema1       | mytbl2b     |        4036 |                    8
 myschema1       | mytbl4      |        4036 |                    2
 myschema1       | myTbl3      |        4037 |                   20
 myschema1       | mytbl1      |        4037 |                   30
 myschema1       | mytbl2      |        4037 |                    8
 myschema1       | mytbl2b     |        4037 |                    8
 myschema1       | mytbl4      |        4037 |                    3
(27 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               4037 |             4042 |             10
 myschema1   | mytbl1     |               4037 |             4042 |             10
 myschema1   | mytbl2     |               4037 |             4042 |              2
 myschema1   | mytbl2b    |               4037 |             4042 |              2
 myschema1   | mytbl4     |               4037 |             4042 |              1
(5 rows)

select col11, col12, col13, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl1_log order by emaj_gid, emaj_tuple desc;
 col11 |   col12    | col13 | emaj_verb | emaj_tuple | emaj_gid 
-------+------------+-------+-----------+------------+----------
     1 | ABC        | \x0c  | INS       | NEW        |  4000040
     2 | ABC        | \x0c  | INS       | NEW        |  4000041
     3 | ABC        | \x0c  | INS       | NEW        |  4000042
     4 | ABC        | \x0c  | INS       | NEW        |  4000043
     5 | ABC        | \x0c  | INS       | NEW        |  4000044
     6 | ABC        | \x0c  | INS       | NEW        |  4000045
     7 | ABC        | \x0c  | INS       | NEW        |  4000046
     8 | ABC        | \x0c  | INS       | NEW        |  4000047
     9 | ABC        | \x0c  | INS       | NEW        |  4000048
    10 | ABC        | \x0c  | INS       | NEW        |  4000049
    11 | ABC        | \x0c  | INS       | NEW        |  4000050
     1 | ABC        | \x0c  | UPD       | OLD        |  4000051
     1 | ABC        | \x1c  | UPD       | NEW        |  4000051
     2 | ABC        | \x0c  | UPD       | OLD        |  4000052
     2 | ABC        | \x1c  | UPD       | NEW        |  4000052
     3 | ABC        | \x0c  | UPD       | OLD        |  4000053
     3 | ABC        | \x1c  | UPD       | NEW        |  4000053
    11 | ABC        | \x0c  | DEL       | OLD        |  4000056
(18 rows)

select col21, col22, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2_log order by emaj_gid, emaj_tuple desc;
 col21 | col22 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-----------+------------+----------
     1 | ABC   | INS       | NEW        |  4000054
     2 | DEF   | INS       | NEW        |  4000057
(2 rows)

select col20, col21, col22, col23, col24, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema1.myTbl2b_log order by emaj_gid, emaj_tuple desc;
 col20 | col21 | col22 |         col23         | col24 | emaj_verb | emaj_tuple | emaj_gid 
-------+-------+-------+-----------------------+-------+-----------+------------+----------
     1 |     1 |     1 |    0.7071067811865476 | t     | INS       | NEW        |  4000055
     2 |     2 |   0.5 | 6.123233995736766e-17 | t     | INS       | NEW        |  4000058
(2 rows)

select col11, col12, col13 from myschema1.myTbl1 order by col11, col12;
 col11 |   col12    | col13 
-------+------------+-------
     1 | ABC        | \x1c
     2 | ABC        | \x1c
     3 | ABC        | \x1c
     4 | ABC        | \x0c
     5 | ABC        | \x0c
     6 | ABC        | \x0c
     7 | ABC        | \x0c
     8 | ABC        | \x0c
     9 | ABC        | \x0c
    10 | ABC        | \x0c
(10 rows)

select col21, col22 from myschema1.myTbl2 order by col21;
 col21 | col22 
-------+-------
     1 | ABC
     2 | DEF
(2 rows)

select col20, col21 from myschema1.myTbl2b order by col20;
 col20 | col21 
-------+-------
     1 |     1
     2 |     2
(2 rows)

-----------------------------
-- rollback an empty group
-----------------------------
select * from emaj.emaj_rollback_group('emptyGroup','EGM4');
 rlbk_severity |           rlbk_message           
---------------+----------------------------------
 Notice        | Rollback id = 4014.
 Notice        | no table and sequence to process
(2 rows)

select * from emaj.emaj_logged_rollback_group('emptyGroup','EGM3');
 rlbk_severity |           rlbk_message           
---------------+----------------------------------
 Notice        | Rollback id = 4015.
 Notice        | no table and sequence to process
(2 rows)

-----------------------------
-- test use of partitionned tables
-----------------------------
insert into mySchema4.myTblR1 values (-2), (-1), (0), (1), (2);
select emaj.emaj_assign_table('myschema4', 'mytblr2', 'myGroup4');
 emaj_assign_table 
-------------------
                 1
(1 row)

select emaj.emaj_start_group('myGroup4','myGroup4_start');
WARNING:  _check_fk_groups: The foreign key "mytblp_col1_fkey" on the table "myschema4.mypartp1a" references the table "myschema4.mytblr1" that is outside the groups (myGroup4).
WARNING:  _check_fk_groups: The foreign key "mytblp_col1_fkey" on the table "myschema4.mypartp1b" references the table "myschema4.mytblr1" that is outside the groups (myGroup4).
WARNING:  _check_fk_groups: The foreign key "mytblp_col1_fkey" on the table "myschema4.mypartp2" references the table "myschema4.mytblr1" that is outside the groups (myGroup4).
WARNING:  _check_fk_groups: The foreign key "mytblp_col1_fkey" on the table "myschema4.mypartp1a" is inherited from a partitionned table. An E-Maj rollback targeting a mark set before the latest table assignement could fail.
WARNING:  _check_fk_groups: The foreign key "mytblp_col1_fkey" on the table "myschema4.mypartp1b" is inherited from a partitionned table. An E-Maj rollback targeting a mark set before the latest table assignement could fail.
WARNING:  _check_fk_groups: The foreign key "mytblp_col1_fkey" on the table "myschema4.mypartp2" is inherited from a partitionned table. An E-Maj rollback targeting a mark set before the latest table assignement could fail.
 emaj_start_group 
------------------
                7
(1 row)

insert into myschema4.myTblM values ('2001-09-11',0, 'abc'),('2011-09-11',10, 'def'),('2021-09-11',20, 'ghi');
insert into mySchema4.myTblP values (-2, 'A', 'Stored in partition 1A'), (-1, 'P', 'Stored in partition 1B'),
									(0, 'Q', 'Stored in partition 2'), (1, 'X', 'Stored in partition 2'),
									(2, 'Y', 'Also stored in partition 2');
select emaj.emaj_set_mark_group('myGroup4','mark1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

truncate myschema4.myTblM;
update myschema4.myTblP set col3 = 'Updated column' where col1 = 0;
update myschema4.myTblP set col1 = -2, col3 = 'Moved to partition 1B' where col1 = 2;
insert into myschema4.mytblr2 (col2, col3) values (1, 'X');
begin;
-- failing rollback because mytblr1 is outside the 'myGroup4' and the FK on it is immediate and has a ON DELETE CASCADE clause
  select * from emaj.emaj_logged_rollback_group('myGroup4','mark1');
ERROR:  _rlbk_planning: Some foreign keys (myschema4.mypartp1b.mytblp_col1_fkey, myschema4.mypartp2.mytblp_col1_fkey) would need to be temporarily dropped during the operation. But this would fail because they are inherited from a partitionned table.
CONTEXT:  PL/pgSQL function emaj._rlbk_planning(integer) line 439 at RAISE
while executing query on dblink connection named "rlbk#1"
SQL statement "SELECT return_value FROM public.dblink('rlbk#1', 'SELECT emaj._rlbk_planning(4016)') AS (return_value BIGINT)"
PL/pgSQL function emaj._dblink_sql_exec(text,text,text) line 13 at EXECUTE
SQL statement "SELECT emaj._dblink_sql_exec('rlbk#1', v_stmt, v_dblinkSchema)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 77 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
rollback;
begin;
-- failing rollback because mytblr1 is outside the 'myGroup4' and the FK on it is immediate
  alter table myschema4.myTblP drop constraint mytblp_col1_fkey, add foreign key (col1) references myschema4.mytblr1(col1);
  select * from emaj.emaj_logged_rollback_group('myGroup4','mark1');
ERROR:  _rlbk_planning: Some foreign keys (myschema4.mypartp1b.mytblp_col1_fkey, myschema4.mypartp2.mytblp_col1_fkey) would need to be temporarily dropped during the operation. But this would fail because they are inherited from a partitionned table.
CONTEXT:  PL/pgSQL function emaj._rlbk_planning(integer) line 439 at RAISE
while executing query on dblink connection named "rlbk#1"
SQL statement "SELECT return_value FROM public.dblink('rlbk#1', 'SELECT emaj._rlbk_planning(4017)') AS (return_value BIGINT)"
PL/pgSQL function emaj._dblink_sql_exec(text,text,text) line 13 at EXECUTE
SQL statement "SELECT emaj._dblink_sql_exec('rlbk#1', v_stmt, v_dblinkSchema)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 77 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, TRUE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_group(text,text,boolean,text) line 12 at RETURN QUERY
rollback;
-- should be OK
alter table myschema4.myTblP drop constraint mytblp_col1_fkey, add foreign key (col1) references myschema4.mytblr1(col1)
  deferrable initially immediate;
select * from emaj.emaj_logged_rollback_group('myGroup4','mark1');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | Rollback id = 4018.
 Notice        | 6 / 7 tables effectively processed.
(2 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mytblm_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2021 |   20 | ghi  | INS       | NEW        |  4000097
            |      |      | TRU       |            |  4000103
 09-11-2021 |   20 | ghi  | TRU       | OLD        |  4000104
 09-11-2021 |   20 | ghi  | INS       | NEW        |  4000120
(4 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mytblc1_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2001 |    0 | abc  | INS       | NEW        |  4000095
            |      |      | TRU       |            |  4000105
 09-11-2001 |    0 | abc  | TRU       | OLD        |  4000106
 09-11-2001 |    0 | abc  | INS       | NEW        |  4000118
(4 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mytblc2_log;
    col1    | col2 | col3 | emaj_verb | emaj_tuple | emaj_gid 
------------+------+------+-----------+------------+----------
 09-11-2011 |   10 | def  | INS       | NEW        |  4000096
            |      |      | TRU       |            |  4000107
 09-11-2011 |   10 | def  | TRU       | OLD        |  4000108
 09-11-2011 |   10 | def  | INS       | NEW        |  4000119
(4 rows)

select col1, col2, col3, col4, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartp1a_log;
 col1 | col2 |          col3          | col4 | emaj_verb | emaj_tuple | emaj_gid 
------+------+------------------------+------+-----------+------------+----------
   -2 | A    | Stored in partition 1A |    1 | INS       | NEW        |  4000098
(1 row)

select col1, col2, col3, col4, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartp1b_log;
 col1 | col2 |          col3          | col4 | emaj_verb | emaj_tuple | emaj_gid 
------+------+------------------------+------+-----------+------------+----------
   -1 | P    | Stored in partition 1B |    2 | INS       | NEW        |  4000099
   -2 | Y    | Moved to partition 1B  |    5 | INS       | NEW        |  4000111
   -2 | Y    | Moved to partition 1B  |    5 | DEL       | OLD        |  4000117
(3 rows)

select col1, col2, col3, col4, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartp2_log;
 col1 | col2 |            col3            | col4 | emaj_verb | emaj_tuple | emaj_gid 
------+------+----------------------------+------+-----------+------------+----------
    0 | Q    | Stored in partition 2      |    3 | INS       | NEW        |  4000100
    1 | X    | Stored in partition 2      |    4 | INS       | NEW        |  4000101
    2 | Y    | Also stored in partition 2 |    5 | INS       | NEW        |  4000102
    0 | Q    | Stored in partition 2      |    3 | UPD       | OLD        |  4000109
    0 | Q    | Updated column             |    3 | UPD       | NEW        |  4000109
    2 | Y    | Also stored in partition 2 |    5 | DEL       | OLD        |  4000110
    0 | Q    | Updated column             |    3 | DEL       | OLD        |  4000113
    0 | Q    | Stored in partition 2      |    3 | INS       | NEW        |  4000114
    2 | Y    | Also stored in partition 2 |    5 | INS       | NEW        |  4000115
(9 rows)

-- use the functions dedicated to emaj_web
-- for an equivalent of "select * from emaj.emaj_rollback_group('myGroup4','myGroup4_start',true,'my comment');"
select * from emaj._rlbk_async(emaj._rlbk_init(array['myGroup4'], 'myGroup4_start', false, 1, false, true, 'my comment'), false);
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | Rollback id = 4019.
 Notice        | 7 / 7 tables effectively processed.
(2 rows)

-- and check the result
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
       rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_status, rlbk_begin_hist_id,
       rlbk_dblink_schema, rlbk_is_dblink_used, rlbk_messages
 from emaj.emaj_rlbk order by rlbk_id desc limit 1;
 rlbk_id | rlbk_groups |   rlbk_mark    | rlbk_mark_time_id | rlbk_time_id | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_eff_nb_sequence | rlbk_status | rlbk_begin_hist_id | rlbk_dblink_schema | rlbk_is_dblink_used |                                 rlbk_messages                                 
---------+-------------+----------------+-------------------+--------------+----------------+-----------------------------+-----------------+---------------+------------------+-------------------+----------------------+-------------+--------------------+--------------------+---------------------+-------------------------------------------------------------------------------
    4019 | {myGroup4}  | myGroup4_start |              4047 |         4051 | f              | t                           |               1 |             7 |                0 |                 7 |                    0 | COMPLETED   |               4430 | public             | t                   | {"Notice: Rollback id = 4019.","Notice: 7 / 7 tables effectively processed."}
(1 row)

-----------------------------
-- test emaj_rollback_activity()
-----------------------------
-- insert necessary rows into rollback tables in order to test various cases of emaj_rollback_activity() reports.
-- these tests ares performed inside transactions that are then rolled back.
begin;
-- 1 rollback operation in EXECUTING state, but no rollback steps have started yet
  insert into emaj.emaj_time_stamp (time_id, time_tx_timestamp) overriding system value
    values (-1, now()-'0.1 seconds'::interval);
  insert into emaj.emaj_time_stamp (time_id, time_clock_timestamp) overriding system value
    values (-2, '2000-01-01 01:00:00');
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
             rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_start_datetime, rlbk_status)
    values (1232,array['group1232'],'mark1232',-2,-1,true,false,
             1,5,4,3,1,now()-'0.1 seconds'::interval,'EXECUTING');
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object,
             rlbp_estimated_duration, rlbp_estimated_quantity, rlbp_start_datetime, rlbp_duration)
    values (1232, 'RLBK_TABLE','schema','t1','','50 seconds'::interval,null,null,null),
           (1232, 'RLBK_TABLE','schema','t2','','30 seconds'::interval,null,null,null),
           (1232, 'RLBK_TABLE','schema','t3','','20 seconds'::interval,null,null,null),
           (1232, 'CTRL+DBLINK','',     '',  '','0.3 second'::interval,3,   null,null);
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |    remaining    | rlbk_completion_pct 
---------+-------------+-----------------+---------------------
    1232 | EXECUTING   | @ 1 min 40 secs |                   0
(1 row)

-- the first RLBK_TABLE has started, but the elapse of the step is not yet > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '11 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '11 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't1';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |    remaining    | rlbk_completion_pct 
---------+-------------+-----------------+---------------------
    1232 | EXECUTING   | @ 1 min 29 secs |                  11
(1 row)

  select 1.0 - ((20.0 + 30.0)+(50.0 - 11.0) + 2*0.3/3) / (11.1 + (20.0 + 30.0)+(50.0 - 11.0) + 2*0.3/3); -- the completion % should be 11%
        ?column?        
------------------------
 0.11066799601196410768
(1 row)

-- the first RLBK_TABLE is completed, and the step duration < the estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '45.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '45 seconds'::interval,
                                 rlbp_duration = '45 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't1';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | remaining | rlbk_completion_pct 
---------+-------------+-----------+---------------------
    1232 | EXECUTING   | @ 50 secs |                  47
(1 row)

  select 1.0 - (20.0 + 30.0 + 2*0.3/3) / (45.1 + (20.0 + 30.0) + 2*0.3/3);  -- the completion % should be 47%
        ?column?        
------------------------
 0.47324239244491080797
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is not yet > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '73.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '28 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | remaining | rlbk_completion_pct 
---------+-------------+-----------+---------------------
    1232 | EXECUTING   | @ 22 secs |                  77
(1 row)

  select 1.0 - (20.0 + (30.0 - 28.0) + 1*0.3/3) / (73.1 + (20.0 + (30.0 - 28.0) + 1*0.3/3));  -- the completion % should be 77%
        ?column?        
------------------------
 0.76785714285714285714
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is already > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '85.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '40 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | remaining | rlbk_completion_pct 
---------+-------------+-----------+---------------------
    1232 | EXECUTING   | @ 20 secs |                  81
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (85.1 + (20.0 + 1*0.3/3));  -- the completion % should be 81%
        ?column?        
------------------------
 0.80893536121673003802
(1 row)

-- the second RLBK_TABLE has started, but the elapse of the step is already > estimated duration 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '105.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '60 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | remaining | rlbk_completion_pct 
---------+-------------+-----------+---------------------
    1232 | EXECUTING   | @ 20 secs |                  84
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (105.1 + (20.0 + 1*0.3/3 ));  -- the completion % should be 84%
        ?column?        
------------------------
 0.83945686900958466454
(1 row)

-- the second RLBK_TABLE is completed, and the step duration > the estimated duration
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '110.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '65 seconds'::interval,
                                 rlbp_duration = '65 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't2';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | remaining | rlbk_completion_pct 
---------+-------------+-----------+---------------------
    1232 | EXECUTING   | @ 20 secs |                  85
(1 row)

  select 1.0 - (20.0 + 1*0.3/3) / (110.1 + (20.0 + 1*0.3/3));  -- the completion % should be 85%
        ?column?        
------------------------
 0.84562211981566820276
(1 row)

-- the third RLBK_TABLE has started, and is almost completed 
  update emaj.emaj_rlbk set rlbk_start_datetime = now() - '124.1 seconds'::interval where rlbk_id = 1232;
  update emaj.emaj_rlbk_plan set rlbp_start_datetime = now() - '18.8 seconds'::interval
    where rlbp_rlbk_id = 1232 and rlbp_table = 't3';
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status | remaining | rlbk_completion_pct 
---------+-------------+-----------+---------------------
    1232 | EXECUTING   | @ 1 sec   |                  99
(1 row)

  select 1.0 - ((20.0 - 18.8)) / (124.1 + (20.0 - 18.8));  -- the completion % should be 99%
        ?column?        
------------------------
 0.99042298483639265762
(1 row)

rollback;
begin;
-- 1 rollback operation in LOCKING state and without step other than LOCK_TABLE
  insert into emaj.emaj_time_stamp (time_id, time_tx_timestamp) overriding system value
    values (-1, now()-'2 minutes'::interval);
  insert into emaj.emaj_time_stamp (time_id, time_clock_timestamp) overriding system value
    values (-2, '2000-01-01 01:00:00');
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
             rlbk_comment, rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_start_datetime, rlbk_end_planning_datetime, rlbk_status)
    values (1233,array['group1233'],'mark1233',-2,-1,true,false,
             'Comment',1,5,4,3,1,now()-'2 minutes'::interval,now()-'1 minutes 59 second'::interval,'LOCKING');
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object,
             rlbp_estimated_duration, rlbp_start_datetime, rlbp_duration)
    values (1233, 'LOCK_TABLE','schema','t1','',null,null,null),
           (1233, 'LOCK_TABLE','schema','t2','',null,null,null),
           (1233, 'LOCK_TABLE','schema','t3','',null,null,null);
  select rlbk_id, rlbk_status, rlbk_comment, rlbk_planning_duration, date_trunc('second',rlbk_elapse) as elapse, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct
    from emaj._rollback_activity();
 rlbk_id | rlbk_status | rlbk_comment | rlbk_planning_duration |  elapse  | remaining | rlbk_completion_pct 
---------+-------------+--------------+------------------------+----------+-----------+---------------------
    1233 | LOCKING     | Comment      | @ 1 sec                | @ 2 mins | @ 0       |                   0
(1 row)

-- the rollback operation in LOCKING state now has RLBK_TABLE steps
  insert into emaj.emaj_rlbk_plan (rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object,
             rlbp_estimated_duration, rlbp_start_datetime, rlbp_duration)
    values (1233, 'RLBK_TABLE','schema','t1','','0:20:00'::interval,null,null),
           (1233, 'RLBK_TABLE','schema','t2','','0:02:00'::interval,null,null),
           (1233, 'RLBK_TABLE','schema','t3','','0:00:20'::interval,null,null);
  select rlbk_id, rlbk_status, date_trunc('second',rlbk_elapse) as elapse, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct from emaj._rollback_activity();
 rlbk_id | rlbk_status |  elapse  |     remaining     | rlbk_completion_pct 
---------+-------------+----------+-------------------+---------------------
    1233 | LOCKING     | @ 2 mins | @ 22 mins 20 secs |                   0
(1 row)

-- +1 rollback operation in PLANNING state
  insert into emaj.emaj_time_stamp (time_id, time_tx_timestamp) overriding system value
    values (-3, now()-'1 minute'::interval);
  insert into emaj.emaj_rlbk (rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_time_id, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, 
             rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_start_datetime, rlbk_status)
    values (1234,array['group1234'],'mark1234',-2,-3,true,false,
             1,5,4,3,1,now()-'1 minute'::interval,'PLANNING');
  select rlbk_id, rlbk_groups, rlbk_mark, rlbk_mark_datetime, rlbk_is_logged, rlbk_nb_session, rlbk_nb_table, rlbk_nb_sequence,
         rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_status, date_trunc('second',rlbk_elapse) as elapse, date_trunc('second',rlbk_remaining) as remaining, rlbk_completion_pct 
    from emaj._rollback_activity();
 rlbk_id | rlbk_groups | rlbk_mark |      rlbk_mark_datetime      | rlbk_is_logged | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_eff_nb_sequence | rlbk_status |  elapse  |     remaining     | rlbk_completion_pct 
---------+-------------+-----------+------------------------------+----------------+-----------------+---------------+------------------+-------------------+----------------------+-------------+----------+-------------------+---------------------
    1233 | {group1233} | mark1233  | Sat Jan 01 01:00:00 2000 PST | t              |               1 |             5 |                4 |                 3 |                    1 | LOCKING     | @ 2 mins | @ 22 mins 20 secs |                   0
    1234 | {group1234} | mark1234  | Sat Jan 01 01:00:00 2000 PST | t              |               1 |             5 |                4 |                 3 |                    1 | PLANNING    | @ 1 min  |                   |                   0
(2 rows)

rollback;
-----------------------------
-- test emaj_comment_rollback(),
-----------------------------
-- unknown rollback id
select emaj.emaj_comment_rollback(NULL,NULL);
ERROR:  emaj_comment_rollback: The rollback identifier <NULL> does not exist.
CONTEXT:  PL/pgSQL function emaj.emaj_comment_rollback(integer,text) line 11 at RAISE
select emaj.emaj_comment_rollback(-1,NULL);
ERROR:  emaj_comment_rollback: The rollback identifier -1 does not exist.
CONTEXT:  PL/pgSQL function emaj.emaj_comment_rollback(integer,text) line 11 at RAISE
-- set a comment
select emaj.emaj_comment_rollback(4000,'First comment');
 emaj_comment_rollback 
-----------------------
 
(1 row)

select rlbk_comment from emaj.emaj_rlbk where rlbk_id = 4000;
 rlbk_comment  
---------------
 First comment
(1 row)

-- update a comment
select emaj.emaj_comment_rollback(4000,'Updated comment');
 emaj_comment_rollback 
-----------------------
 
(1 row)

select rlbk_comment from emaj.emaj_rlbk where rlbk_id = 4000;
  rlbk_comment   
-----------------
 Updated comment
(1 row)

-- delete a comment
select emaj.emaj_comment_rollback(4000,NULL);
 emaj_comment_rollback 
-----------------------
 
(1 row)

select rlbk_comment from emaj.emaj_rlbk where rlbk_id = 4000;
 rlbk_comment 
--------------
 
(1 row)

-----------------------------
-- test emaj_consolidate_rollback_group() and emaj_get_consolidable_rollbacks()
-----------------------------
-- group is NULL or unknown
select emaj.emaj_consolidate_rollback_group(NULL,NULL);
ERROR:  _check_group_names: No group to process.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 27 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := ARRAY[p_groupName], p_mayBeNull := FALSE, p_lockGroups := TRUE)"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 16 at PERFORM
select emaj.emaj_consolidate_rollback_group('unknownGroup',NULL);
ERROR:  _check_group_names: The group "unknownGroup" does not exist.
CONTEXT:  PL/pgSQL function emaj._check_group_names(text[],boolean,boolean,boolean,boolean,boolean,boolean) line 39 at RAISE
SQL statement "SELECT emaj._check_group_names(p_groupNames := ARRAY[p_groupName], p_mayBeNull := FALSE, p_lockGroups := TRUE)"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 16 at PERFORM
-- mark is unknown
select emaj.emaj_consolidate_rollback_group('myGroup1',NULL);
ERROR:  _check_mark_name: The mark "<NULL>" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := ARRAY[p_groupName], p_mark := p_endRlbkMark)"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 18 at SQL statement
select emaj.emaj_consolidate_rollback_group('myGroup1','unknown mark');
ERROR:  _check_mark_name: The mark "unknown mark" does not exist for the group "myGroup1".
CONTEXT:  PL/pgSQL function emaj._check_mark_name(text[],text,boolean) line 61 at RAISE
SQL statement "SELECT emaj._check_mark_name(p_groupNames := ARRAY[p_groupName], p_mark := p_endRlbkMark)"
PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 18 at SQL statement
-- mark is known but is not an end rollback mark
select emaj.emaj_consolidate_rollback_group('myGroup1','Mark12');
ERROR:  emaj_consolidate_rollback_group: The mark "Mark12" for the group "myGroup1" is not an end rollback mark.
CONTEXT:  PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 28 at RAISE
-- mark is an end rollback mark but the rollback target mark is invalid
begin;
  update emaj.emaj_mark set mark_logged_rlbk_target_mark = 'dummy' where mark_name = 'Mark12';
  select emaj.emaj_consolidate_rollback_group('myGroup1','Mark12');
ERROR:  emaj_consolidate_rollback_group: The rollback target mark "dummy" for the group "myGroup1" has not been found.
CONTEXT:  PL/pgSQL function emaj.emaj_consolidate_rollback_group(text,text) line 41 at RAISE
rollback;
-- should be ok
set search_path=public,myschema1;
-- rollback without log rows to delete
select emaj.emaj_set_mark_group('myGroup1','Conso_M1');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select * from emaj.emaj_logged_rollback_group('myGroup1','Conso_M1');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4020.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
(3 rows)

select emaj.emaj_consolidate_rollback_group('myGroup1','EMAJ_LAST_MARK');
 emaj_consolidate_rollback_group 
---------------------------------
                               2
(1 row)

-- mark Conso_M2, updates, mark Conso_M3, updates, logged rlbk back to Conso_M2, updates, rename both marks, consolidate, check and cancel
select emaj.emaj_set_mark_group('myGroup1','Conso_M2');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

insert into myTbl1 select i, 'Test', 'Conso' from generate_series (1000,1011) as i;
insert into myTbl2 values (1000,'TC1',NULL);
delete from myTbl1 where col11 > 1010;
select emaj.emaj_set_mark_group('myGroup1','Conso_M3');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

update myTbl2 set col22 = 'TC2' WHERE col22 ='TC1';
select * from emaj.emaj_logged_rollback_group('myGroup1','Conso_M2');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4021.
 Notice        | 3 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

insert into myTbl2 values (1000,'TC3',NULL);
select emaj.emaj_rename_mark_group('myGroup1','Conso_M2','Renamed_conso_M2');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select emaj.emaj_rename_mark_group('myGroup1','EMAJ_LAST_MARK','Renamed_last_mark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select cons_group, cons_target_rlbk_mark_name, cons_target_rlbk_mark_time_id, cons_end_rlbk_mark_name, cons_end_rlbk_mark_time_id, cons_rows, cons_marks 
  from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 emptyGroup | EGM3                       |                          3400 | RLBK_4015_DONE          |                       4045 |         0 |          2
 myGroup1   | Conso_M1                   |                          4052 | RLBK_4020_DONE          |                       4054 |         0 |          0
 myGroup1   | Renamed_conso_M2           |                          4055 | Renamed_last_mark       |                       4058 |        31 |          2
(3 rows)

  
select emaj.emaj_consolidate_rollback_group('myGroup1','Renamed_last_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               5
(1 row)

select cons_group, cons_target_rlbk_mark_name, cons_target_rlbk_mark_time_id, cons_end_rlbk_mark_name, cons_end_rlbk_mark_time_id, cons_rows, cons_marks 
  from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 emptyGroup | EGM3                       |                          3400 | RLBK_4015_DONE          |                       4045 |         0 |          2
 myGroup1   | Conso_M1                   |                          4052 | RLBK_4020_DONE          |                       4054 |         0 |          0
 myGroup1   | Renamed_conso_M2           |                          4055 | Renamed_last_mark       |                       4058 |         0 |          0
(3 rows)

-- consolidate a rollback already consolidated
select emaj.emaj_consolidate_rollback_group('myGroup1','Renamed_last_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               2
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id, mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark from emaj.emaj_mark where mark_group = 'myGroup1' order by mark_time_id, mark_group;
 mark_group |  regexp_replace   | mark_time_id | mark_is_rlbk_protected |                    mark_comment                    | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+-------------------+--------------+------------------------+----------------------------------------------------+---------------------------+------------------------------
 myGroup1   | Mark11            |         4035 | f                      |                                                    |                        19 | 
 myGroup1   | Mark12            |         4036 | f                      |                                                    |                        11 | 
 myGroup1   | Mark13            |         4037 | f                      |                                                    |                         0 | 
 myGroup1   | Conso_M1          |         4052 | f                      |                                                    |                         0 | 
 myGroup1   | RLBK_4020_DONE    |         4054 | f                      | Automatically set at rollback to mark Conso_M1 end |                         0 | Conso_M1
 myGroup1   | Renamed_conso_M2  |         4055 | f                      |                                                    |                         0 | 
 myGroup1   | Renamed_last_mark |         4058 | f                      | Automatically set at rollback to mark Conso_M2 end |                           | Renamed_conso_M2
(7 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence where sequ_schema = 'emaj_myschema1' order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-----------+--------------+---------------+----------------
(0 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_time_id, tbl_schema, tbl_name;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema1       | myTbl3      |        4035 |                   10
 myschema1       | mytbl1      |        4035 |                   15
 myschema1       | mytbl2      |        4035 |                    6
 myschema1       | mytbl2b     |        4035 |                    6
 myschema1       | mytbl4      |        4035 |                    2
 myschema1       | myTbl3      |        4036 |                   10
 myschema1       | mytbl1      |        4036 |                   30
 myschema1       | mytbl2      |        4036 |                    8
 myschema1       | mytbl2b     |        4036 |                    8
 myschema1       | mytbl4      |        4036 |                    2
 myschema1       | myTbl3      |        4037 |                   20
 myschema1       | mytbl1      |        4037 |                   30
 myschema1       | mytbl2      |        4037 |                    8
 myschema1       | mytbl2b     |        4037 |                    8
 myschema1       | mytbl4      |        4037 |                    3
 myschema4       | mypartp1a   |        4047 |                    0
 myschema4       | mypartp1b   |        4047 |                    0
 myschema4       | mypartp2    |        4047 |                    0
 myschema4       | mytblc1     |        4047 |                    0
 myschema4       | mytblc2     |        4047 |                    0
 myschema4       | mytblm      |        4047 |                    0
 myschema4       | mytblr2     |        4047 |                    0
 myschema1       | myTbl3      |        4052 |                   30
 myschema1       | mytbl1      |        4052 |                   40
 myschema1       | mytbl2      |        4052 |                   10
 myschema1       | mytbl2b     |        4052 |                   10
 myschema1       | mytbl4      |        4052 |                    4
 myschema1       | myTbl3      |        4054 |                   30
 myschema1       | mytbl1      |        4054 |                   40
 myschema1       | mytbl2      |        4054 |                   10
 myschema1       | mytbl2b     |        4054 |                   10
 myschema1       | mytbl4      |        4054 |                    4
 myschema1       | myTbl3      |        4055 |                   30
 myschema1       | mytbl1      |        4055 |                   40
 myschema1       | mytbl2      |        4055 |                   10
 myschema1       | mytbl2b     |        4055 |                   10
 myschema1       | mytbl4      |        4055 |                    4
 myschema1       | myTbl3      |        4058 |                   30
 myschema1       | mytbl1      |        4058 |                   64
 myschema1       | mytbl2      |        4058 |                   13
 myschema1       | mytbl2b     |        4058 |                   14
 myschema1       | mytbl4      |        4058 |                    4
(54 rows)

select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole where sqhl_schema = 'myschema1' order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema1   | myTbl3     |               4037 |             4042 |             10
 myschema1   | mytbl1     |               4037 |             4042 |             10
 myschema1   | mytbl1     |               4055 |             4058 |             24
 myschema1   | mytbl2     |               4037 |             4042 |              2
 myschema1   | mytbl2     |               4055 |             4058 |              3
 myschema1   | mytbl2b    |               4037 |             4042 |              2
 myschema1   | mytbl2b    |               4055 |             4058 |              4
 myschema1   | mytbl4     |               4037 |             4042 |              1
(8 rows)

select * from emaj.emaj_rollback_group('myGroup1','Conso_M1');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 4022.
 Notice        | 2 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

select emaj.emaj_modify_table('myschema1','mytbl2','{"ignored_triggers":null}'::jsonb);
 emaj_modify_table 
-------------------
                 1
(1 row)

-- consolidate a stopped (and empty) group
begin;
  select emaj.emaj_rename_mark_group('emptyGroup','EMAJ_LAST_MARK','end_rlbk_mark');
 emaj_rename_mark_group 
------------------------
 
(1 row)

  select emaj.emaj_stop_group('emptyGroup','stop');
 emaj_stop_group 
-----------------
               0
(1 row)

  select * from emaj.emaj_get_consolidable_rollbacks();
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 emptyGroup | EGM3                       |                          3400 | end_rlbk_mark           |                       4045 |         0 |          2
(1 row)

  select emaj.emaj_consolidate_rollback_group('emptyGroup','end_rlbk_mark');
 emaj_consolidate_rollback_group 
---------------------------------
                               0
(1 row)

  select * from emaj.emaj_mark where mark_group = 'emptyGroup' order by mark_time_id, mark_group;
 mark_group |   mark_name   | mark_time_id | mark_is_rlbk_protected |                  mark_comment                  | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+---------------+--------------+------------------------+------------------------------------------------+---------------------------+------------------------------
 emptyGroup | SM2           |         3006 | f                      | a comment on a mark for an empty group         |                         0 | Mark1
 emptyGroup | EGM3          |         3400 | f                      |                                                |                         0 | 
 emptyGroup | end_rlbk_mark |         4045 | f                      | Automatically set at rollback to mark EGM3 end |                         0 | EGM3
 emptyGroup | stop          |         4061 | f                      |                                                |                         0 | 
(4 rows)

rollback;
-- check that dropping the group deletes rows from emaj_sequence and emaj_seq_hole
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

  select emaj.emaj_drop_group('myGroup1');
 emaj_drop_group 
-----------------
               7
(1 row)

  select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence where sequ_name like 'myschema1%' order by sequ_time_id, sequ_schema, sequ_name;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-----------+--------------+---------------+----------------
(0 rows)

  select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table order by tbl_schema, tbl_name, tbl_time_id;
   tbl_schema    |  tbl_name   | tbl_time_id | tbl_log_seq_last_val 
-----------------+-------------+-------------+----------------------
 myschema2       | myTbl3      |        4029 |                    0
 myschema2       | mytbl1      |        4029 |                    0
 myschema2       | mytbl2      |        4029 |                    0
 myschema2       | mytbl4      |        4029 |                    0
 myschema2       | mytbl5      |        4029 |                    0
 myschema2       | mytbl6      |        4029 |                    0
 myschema2       | mytbl7      |        4029 |                    0
 myschema2       | mytbl8      |        4029 |                    0
 myschema4       | mypartp1a   |        4047 |                    0
 myschema4       | mypartp1b   |        4047 |                    0
 myschema4       | mypartp2    |        4047 |                    0
 myschema4       | mytblc1     |        4047 |                    0
 myschema4       | mytblc2     |        4047 |                    0
 myschema4       | mytblm      |        4047 |                    0
 myschema4       | mytblr2     |        4047 |                    0
 phil's schema"3 | myTbl2\     |        3402 |                    0
 phil's schema"3 | myTbl2\     |        3403 |                    0
 phil's schema"3 | phil's tbl1 |        3402 |                    0
 phil's schema"3 | phil's tbl1 |        3403 |                    0
(19 rows)

  select sqhl_schema, sqhl_table, sqhl_begin_time_id, sqhl_end_time_id, sqhl_hole_size from emaj.emaj_seq_hole where sqhl_schema = 'myschema1' order by 1,2,3;
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
(0 rows)

rollback;
-----------------------------
-- test emaj_cleanup_rollback_state()
-----------------------------
-- rollback a transaction with an E-Maj rollback to generate an ABORTED rollback event
begin;
  select * from emaj.emaj_rollback_group('myGroup4','myGroup4_start');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | Rollback id = 4023.
 Notice        | 0 / 7 tables effectively processed.
(2 rows)

rollback;
select rlbk_id, rlbk_status, rlbk_begin_hist_id, rlbk_nb_session from emaj.emaj_rlbk
  where rlbk_status in ('PLANNING', 'LOCKING', 'EXECUTING', 'COMPLETED') order by rlbk_id;
 rlbk_id | rlbk_status | rlbk_begin_hist_id | rlbk_nb_session 
---------+-------------+--------------------+-----------------
    4023 | COMPLETED   |               4576 |               1
(1 row)

select emaj.emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           1
(1 row)

-- Finaly add mytblr1 to the group
select emaj.emaj_assign_table('myschema4', 'mytblr1', 'myGroup4', null, 'Assign mytblr1');
 emaj_assign_table 
-------------------
                 1
(1 row)

-----------------------------
-- check application triggers state
-----------------------------
select nspname, relname, tgname, tgenabled from pg_trigger, pg_class, pg_namespace
  where relnamespace = pg_namespace.oid and tgrelid = pg_class.oid and tgname like 'mytbl2trg%'
  order by 1,2,3;
  nspname  | relname |   tgname   | tgenabled 
-----------+---------+------------+-----------
 myschema1 | mytbl2  | mytbl2trg1 | O
 myschema1 | mytbl2  | mytbl2trg2 | O
(2 rows)

-----------------------------
-- check rollback tables
-----------------------------
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, rlbk_nb_session, rlbk_comment,
       rlbk_nb_table, rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_eff_nb_sequence, rlbk_status, rlbk_begin_hist_id,
       rlbk_dblink_schema, rlbk_is_dblink_used,
       case when rlbk_end_datetime is null then 'null' else '[ts]' end as "end_datetime", rlbk_messages
  from emaj.emaj_rlbk order by rlbk_id;
 rlbk_id |     rlbk_groups     |   rlbk_mark    | rlbk_time_id | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_nb_session |                  rlbk_comment                  | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_eff_nb_sequence | rlbk_status | rlbk_begin_hist_id | rlbk_dblink_schema | rlbk_is_dblink_used | end_datetime |                                                          rlbk_messages                                                          
---------+---------------------+----------------+--------------+----------------+-----------------------------+-----------------+------------------------------------------------+---------------+------------------+-------------------+----------------------+-------------+--------------------+--------------------+---------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------
    4000 | {myGroup1}          | Different_Mark |         4007 | f              | f                           |               1 |                                                |             5 |                2 |                 0 |                    0 | COMMITTED   |               4047 |                    | f                   | [ts]         | {"Notice: Rollback id = 4000.","Notice: 0 / 5 tables effectively processed.","Notice: 0 / 2 sequences effectively processed."}
    4003 | {myGroup1}          | Different_Mark |         4018 | f              | f                           |               1 |                                                |             5 |                2 |                 0 |                    0 | COMMITTED   |               4117 |                    | f                   | [ts]         | {"Notice: Rollback id = 4003.","Notice: 0 / 5 tables effectively processed.","Notice: 0 / 2 sequences effectively processed."}
    4004 | {myGroup2}          | Mark21         |         4019 | f              | f                           |               1 |                                                |             8 |                2 |                 0 |                    0 | COMMITTED   |               4126 |                    | f                   | [ts]         | {"Notice: Rollback id = 4004.","Notice: 0 / 8 tables effectively processed.","Notice: 0 / 2 sequences effectively processed."}
    4005 | {myGroup1,myGroup2} | Mark1B         |         4021 | f              | f                           |               1 |                                                |            13 |                4 |                 0 |                    0 | COMMITTED   |               4141 |                    | f                   | [ts]         | {"Notice: Rollback id = 4005.","Notice: 0 / 13 tables effectively processed.","Notice: 0 / 4 sequences effectively processed."}
    4006 | {myGroup1,myGroup2} | Mark1B         |         4022 | f              | f                           |               1 |                                                |            13 |                4 |                 0 |                    0 | COMMITTED   |               4151 |                    | f                   | [ts]         | {"Notice: Rollback id = 4006.","Notice: 0 / 13 tables effectively processed.","Notice: 0 / 4 sequences effectively processed."}
    4007 | {myGroup1,myGroup2} | Mark1B         |         4023 | t              | f                           |               1 |                                                |            13 |                4 |                 0 |                    0 | COMMITTED   |               4160 |                    | f                   | [ts]         | {"Notice: Rollback id = 4007.","Notice: 0 / 13 tables effectively processed.","Notice: 0 / 4 sequences effectively processed."}
    4008 | {myGroup1,myGroup2} | Mark1B         |         4025 | t              | f                           |               1 |                                                |            13 |                4 |                 0 |                    0 | COMMITTED   |               4175 | public             | t                   | [ts]         | {"Notice: Rollback id = 4008.","Notice: 0 / 13 tables effectively processed.","Notice: 0 / 4 sequences effectively processed."}
    4009 | {myGroup1}          | Mark12         |         4032 | f              | f                           |               1 |                                                |             5 |                2 |                 2 |                    1 | COMMITTED   |               4222 | public             | t                   | [ts]         | {"Notice: Rollback id = 4009.","Notice: 2 / 5 tables effectively processed.","Notice: 1 / 2 sequences effectively processed."}
    4010 | {myGroup1}          | Mark11         |         4033 | f              | f                           |               1 | Rollback set by the 'rollback.sql' script      |             5 |                2 |                 3 |                    1 | COMMITTED   |               4238 | public             | t                   | [ts]         | {"Notice: Rollback id = 4010.","Notice: 3 / 5 tables effectively processed.","Notice: 1 / 2 sequences effectively processed."}
    4011 | {myGroup1}          | Mark12         |         4038 | t              | f                           |               1 |                                                |             5 |                2 |                 2 |                    1 | COMMITTED   |               4282 | public             | t                   | [ts]         | {"Notice: Rollback id = 4011.","Notice: 2 / 5 tables effectively processed.","Notice: 1 / 2 sequences effectively processed."}
    4012 | {myGroup1}          | Mark11         |         4040 | t              | f                           |               1 | Logged rollback set by the rollback.sql script |             5 |                2 |                 5 |                    1 | COMMITTED   |               4302 | public             | t                   | [ts]         | {"Notice: Rollback id = 4012.","Notice: 5 / 5 tables effectively processed.","Notice: 1 / 2 sequences effectively processed."}
    4013 | {myGroup1}          | Mark13         |         4042 | f              | f                           |               1 |                                                |             5 |                2 |                 5 |                    2 | COMMITTED   |               4329 | public             | t                   | [ts]         | {"Notice: Rollback id = 4013.","Notice: 5 / 5 tables effectively processed.","Notice: 2 / 2 sequences effectively processed."}
    4014 | {emptyGroup}        | EGM4           |         4043 | f              | f                           |               1 |                                                |             0 |                0 |                 0 |                    0 | COMMITTED   |               4355 | public             | t                   | [ts]         | {"Notice: Rollback id = 4014.","Notice: no table and sequence to process"}
    4015 | {emptyGroup}        | EGM3           |         4044 | t              | f                           |               1 |                                                |             0 |                0 |                 0 |                    0 | COMMITTED   |               4364 | public             | t                   | [ts]         | {"Notice: Rollback id = 4015.","Notice: no table and sequence to process"}
    4016 | {myGroup4}          | mark1          |              | t              | f                           |               1 |                                                |             7 |                0 |                   |                    0 | ABORTED     |               4398 | public             | t                   | null         | 
    4017 | {myGroup4}          | mark1          |              | t              | f                           |               1 |                                                |             7 |                0 |                   |                    0 | ABORTED     |               4400 | public             | t                   | null         | 
    4018 | {myGroup4}          | mark1          |         4049 | t              | f                           |               1 |                                                |             7 |                0 |                 6 |                    0 | COMMITTED   |               4402 | public             | t                   | [ts]         | {"Notice: Rollback id = 4018.","Notice: 6 / 7 tables effectively processed."}
    4019 | {myGroup4}          | myGroup4_start |         4051 | f              | t                           |               1 | my comment                                     |             7 |                0 |                 7 |                    0 | COMMITTED   |               4430 | public             | t                   | [ts]         | {"Notice: Rollback id = 4019.","Notice: 7 / 7 tables effectively processed."}
    4020 | {myGroup1}          | Conso_M1       |         4053 | t              | f                           |               1 |                                                |             5 |                2 |                 0 |                    0 | COMMITTED   |               4468 | public             | t                   | [ts]         | {"Notice: Rollback id = 4020.","Notice: 0 / 5 tables effectively processed.","Notice: 0 / 2 sequences effectively processed."}
    4021 | {myGroup1}          | Conso_M2       |         4057 | t              | f                           |               1 |                                                |             5 |                2 |                 3 |                    1 | COMMITTED   |               4496 | public             | t                   | [ts]         | {"Notice: Rollback id = 4021.","Notice: 3 / 5 tables effectively processed.","Notice: 1 / 2 sequences effectively processed."}
    4022 | {myGroup1}          | Conso_M1       |         4059 | f              | f                           |               1 |                                                |             5 |                2 |                 2 |                    1 | COMMITTED   |               4526 | public             | t                   | [ts]         | {"Notice: Rollback id = 4022.","Notice: 2 / 5 tables effectively processed.","Notice: 1 / 2 sequences effectively processed."}
    4023 | {myGroup4}          | myGroup4_start |         4064 | f              | f                           |               1 |                                                |             7 |                0 |                 0 |                    0 | ABORTED     |               4576 | public             | t                   | [ts]         | {"Notice: Rollback id = 4023.","Notice: 0 / 7 tables effectively processed."}
(22 rows)

select rlbs_rlbk_id, rlbs_session, 
       case when rlbs_end_datetime is null then 'null' else '[ts]' end as "end_datetime"
  from emaj.emaj_rlbk_session order by rlbs_rlbk_id, rlbs_session;
 rlbs_rlbk_id | rlbs_session | end_datetime 
--------------+--------------+--------------
         4000 |            1 | [ts]
         4003 |            1 | [ts]
         4004 |            1 | [ts]
         4005 |            1 | [ts]
         4006 |            1 | [ts]
         4007 |            1 | [ts]
         4008 |            1 | [ts]
         4009 |            1 | [ts]
         4010 |            1 | [ts]
         4011 |            1 | [ts]
         4012 |            1 | [ts]
         4013 |            1 | [ts]
         4014 |            1 | [ts]
         4015 |            1 | [ts]
         4016 |            1 | null
         4017 |            1 | null
         4018 |            1 | [ts]
         4019 |            1 | [ts]
         4020 |            1 | [ts]
         4021 |            1 | [ts]
         4022 |            1 | [ts]
         4023 |            1 | [ts]
(22 rows)

select rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object, rlbp_target_time_id, rlbp_batch_number, rlbp_session,
       rlbp_object_def, rlbp_app_trg_type, rlbp_is_repl_role_replica, rlbp_estimated_quantity, rlbp_estimate_method, rlbp_quantity
  from emaj.emaj_rlbk_plan order by rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object;
 rlbp_rlbk_id |     rlbp_step      | rlbp_schema | rlbp_table |       rlbp_object       | rlbp_target_time_id | rlbp_batch_number | rlbp_session | rlbp_object_def | rlbp_app_trg_type | rlbp_is_repl_role_replica | rlbp_estimated_quantity | rlbp_estimate_method | rlbp_quantity 
--------------+--------------------+-------------+------------+-------------------------+---------------------+-------------------+--------------+-----------------+-------------------+---------------------------+-------------------------+----------------------+---------------
         4000 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    3 |             2
         4000 | CTRL-DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    3 |              
         4003 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4003 | CTRL-DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    2 |              
         4004 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4004 | CTRL-DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    2 |              
         4005 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       4 |                    2 |             4
         4005 | CTRL-DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    2 |              
         4006 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       4 |                    2 |             4
         4006 | CTRL-DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    2 |              
         4007 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       4 |                    2 |             4
         4007 | CTRL-DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    2 |              
         4008 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       4 |                    2 |             4
         4008 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    3 |              
         4009 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4009 | DIS_LOG_TRG        | myschema1   | myTbl3     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    3 |              
         4009 | DIS_LOG_TRG        | myschema1   | mytbl4     |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4009 | RLBK_TABLE         | myschema1   | myTbl3     |                         |                4030 |                 2 |            1 |                 |                   | f                         |                      10 |                    3 |            10
         4009 | RLBK_TABLE         | myschema1   | mytbl4     |                         |                4030 |                 3 |            1 |                 |                   | t                         |                       2 |                    3 |             1
         4009 | DELETE_LOG         | myschema1   | myTbl3     |                         |                4030 |                 2 |            1 |                 |                   |                           |                      10 |                    3 |            10
         4009 | DELETE_LOG         | myschema1   | mytbl4     |                         |                4030 |                 3 |            1 |                 |                   |                           |                       2 |                    3 |             3
         4009 | ENA_LOG_TRG        | myschema1   | myTbl3     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    3 |              
         4009 | ENA_LOG_TRG        | myschema1   | mytbl4     |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4009 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       9 |                    2 |              
         4010 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4010 | DIS_APP_TRG        | myschema1   | mytbl2     | mytbl2trg1              |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4010 | SET_ALWAYS_APP_TRG | myschema1   | mytbl2     | mytbl2trg2              |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4010 | DIS_LOG_TRG        | myschema1   | mytbl1     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4010 | DIS_LOG_TRG        | myschema1   | mytbl2     |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4010 | DIS_LOG_TRG        | myschema1   | mytbl2b    |                         |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4010 | RLBK_TABLE         | myschema1   | mytbl1     |                         |                4028 |                 2 |            1 |                 |                   | t                         |                      15 |                    3 |            11
         4010 | RLBK_TABLE         | myschema1   | mytbl2     |                         |                4028 |                 3 |            1 |                 |                   | t                         |                       6 |                    3 |             3
         4010 | RLBK_TABLE         | myschema1   | mytbl2b    |                         |                4028 |                 4 |            1 |                 |                   | f                         |                       6 |                    3 |             6
         4010 | DELETE_LOG         | myschema1   | mytbl1     |                         |                4028 |                 2 |            1 |                 |                   |                           |                      15 |                    3 |            18
         4010 | DELETE_LOG         | myschema1   | mytbl2     |                         |                4028 |                 3 |            1 |                 |                   |                           |                       6 |                    3 |             8
         4010 | DELETE_LOG         | myschema1   | mytbl2b    |                         |                4028 |                 4 |            1 |                 |                   |                           |                       6 |                    3 |             6
         4010 | ENA_APP_TRG        | myschema1   | mytbl2     | mytbl2trg1              |                     |                 3 |            1 |                 | ALWAYS            |                           |                         |                    3 |              
         4010 | SET_LOCAL_APP_TRG  | myschema1   | mytbl2     | mytbl2trg2              |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4010 | ENA_LOG_TRG        | myschema1   | mytbl1     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4010 | ENA_LOG_TRG        | myschema1   | mytbl2     |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4010 | ENA_LOG_TRG        | myschema1   | mytbl2b    |                         |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4010 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                      17 |                    2 |              
         4011 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4011 | RLBK_TABLE         | myschema1   | myTbl3     |                         |                4036 |                 2 |            1 |                 |                   | f                         |                      10 |                    1 |            10
         4011 | RLBK_TABLE         | myschema1   | mytbl4     |                         |                4036 |                 3 |            1 |                 |                   | t                         |                       1 |                    1 |             1
         4011 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       3 |                    2 |              
         4012 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4012 | DIS_APP_TRG        | myschema1   | mytbl2     | mytbl2trg1              |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4012 | SET_ALWAYS_APP_TRG | myschema1   | mytbl2     | mytbl2trg2              |                     |                 4 |            1 |                 |                   |                           |                         |                    3 |              
         4012 | RLBK_TABLE         | myschema1   | myTbl3     |                         |                4035 |                 2 |            1 |                 |                   | f                         |                      20 |                    1 |            10
         4012 | RLBK_TABLE         | myschema1   | mytbl1     |                         |                4035 |                 3 |            1 |                 |                   | t                         |                      15 |                    1 |            11
         4012 | RLBK_TABLE         | myschema1   | mytbl2     |                         |                4035 |                 4 |            1 |                 |                   | t                         |                       2 |                    1 |             2
         4012 | RLBK_TABLE         | myschema1   | mytbl2b    |                         |                4035 |                 5 |            1 |                 |                   | f                         |                       2 |                    1 |             2
         4012 | RLBK_TABLE         | myschema1   | mytbl4     |                         |                4035 |                 6 |            1 |                 |                   | t                         |                       2 |                    1 |             1
         4012 | ENA_APP_TRG        | myschema1   | mytbl2     | mytbl2trg1              |                     |                 4 |            1 |                 | ALWAYS            |                           |                         |                    2 |              
         4012 | SET_LOCAL_APP_TRG  | myschema1   | mytbl2     | mytbl2trg2              |                     |                 4 |            1 |                 |                   |                           |                         |                    3 |              
         4012 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                      10 |                    2 |              
         4013 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4013 | SET_ALWAYS_APP_TRG | myschema1   | mytbl2     | mytbl2trg2              |                     |                 4 |            1 |                 |                   |                           |                         |                    3 |              
         4013 | DIS_LOG_TRG        | myschema1   | myTbl3     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | DIS_LOG_TRG        | myschema1   | mytbl1     |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | DIS_LOG_TRG        | myschema1   | mytbl2     |                         |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | DIS_LOG_TRG        | myschema1   | mytbl2b    |                         |                     |                 5 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | DIS_LOG_TRG        | myschema1   | mytbl4     |                         |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | RLBK_TABLE         | myschema1   | myTbl3     |                         |                4037 |                 2 |            1 |                 |                   | f                         |                      10 |                    1 |            10
         4013 | RLBK_TABLE         | myschema1   | mytbl1     |                         |                4037 |                 3 |            1 |                 |                   | t                         |                      10 |                    1 |            10
         4013 | RLBK_TABLE         | myschema1   | mytbl2     |                         |                4037 |                 4 |            1 |                 |                   | t                         |                       2 |                    1 |             2
         4013 | RLBK_TABLE         | myschema1   | mytbl2b    |                         |                4037 |                 5 |            1 |                 |                   | f                         |                       2 |                    1 |             2
         4013 | RLBK_TABLE         | myschema1   | mytbl4     |                         |                4037 |                 6 |            1 |                 |                   | t                         |                       1 |                    1 |             1
         4013 | DELETE_LOG         | myschema1   | myTbl3     |                         |                4037 |                 2 |            1 |                 |                   |                           |                      10 |                    1 |            10
         4013 | DELETE_LOG         | myschema1   | mytbl1     |                         |                4037 |                 3 |            1 |                 |                   |                           |                      10 |                    1 |            10
         4013 | DELETE_LOG         | myschema1   | mytbl2     |                         |                4037 |                 4 |            1 |                 |                   |                           |                       2 |                    1 |             2
         4013 | DELETE_LOG         | myschema1   | mytbl2b    |                         |                4037 |                 5 |            1 |                 |                   |                           |                       2 |                    1 |             2
         4013 | DELETE_LOG         | myschema1   | mytbl4     |                         |                4037 |                 6 |            1 |                 |                   |                           |                       1 |                    1 |             1
         4013 | SET_LOCAL_APP_TRG  | myschema1   | mytbl2     | mytbl2trg2              |                     |                 4 |            1 |                 |                   |                           |                         |                    3 |              
         4013 | ENA_LOG_TRG        | myschema1   | myTbl3     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | ENA_LOG_TRG        | myschema1   | mytbl1     |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | ENA_LOG_TRG        | myschema1   | mytbl2     |                         |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | ENA_LOG_TRG        | myschema1   | mytbl2b    |                         |                     |                 5 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | ENA_LOG_TRG        | myschema1   | mytbl4     |                         |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4013 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                      23 |                    2 |              
         4018 | DIS_APP_TRG        | myschema4   | mytblm     | mytblm_insert_trigger   |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4018 | SET_FK_DEF         | myschema4   | mypartp1b  | mytblp_col1_fkey        |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4018 | SET_FK_DEF         | myschema4   | mypartp2   | mytblp_col1_fkey        |                     |                 2 |            1 |                 |                   |                           |                         |                    3 |              
         4018 | RLBK_TABLE         | myschema4   | mypartp1b  |                         |                4048 |                 3 |            1 |                 |                   | f                         |                       1 |                    3 |             1
         4018 | RLBK_TABLE         | myschema4   | mypartp2   |                         |                4048 |                 2 |            1 |                 |                   | f                         |                       2 |                    3 |             2
         4018 | RLBK_TABLE         | myschema4   | mytblc1    |                         |                4048 |                 4 |            1 |                 |                   | f                         |                       1 |                    3 |             2
         4018 | RLBK_TABLE         | myschema4   | mytblc2    |                         |                4048 |                 5 |            1 |                 |                   | f                         |                       1 |                    3 |             2
         4018 | RLBK_TABLE         | myschema4   | mytblm     |                         |                4048 |                 6 |            1 |                 |                   | f                         |                       1 |                    3 |             2
         4018 | RLBK_TABLE         | myschema4   | mytblr2    |                         |                4048 |                 2 |            1 |                 |                   | t                         |                       1 |                    3 |             1
         4018 | SET_FK_IMM         | myschema4   | mypartp1b  | mytblp_col1_fkey        |                     |                 3 |            1 |                 |                   |                           |                       1 |                    3 |              
         4018 | SET_FK_IMM         | myschema4   | mypartp2   | mytblp_col1_fkey        |                     |                 2 |            1 |                 |                   |                           |                       2 |                    3 |              
         4018 | SET_FK_IMM         | myschema4   | mytblr2    | mytblr2_col2_col3_fkey3 |                     |                 3 |            1 |                 |                   |                           |                       2 |                    3 |              
         4018 | SET_FK_IMM         | myschema4   | mytblr2    | mytblr2_col2_col3_fkey4 |                     |                 2 |            1 |                 |                   |                           |                       3 |                    3 |              
         4018 | ENA_APP_TRG        | myschema4   | mytblm     | mytblm_insert_trigger   |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4018 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                      14 |                    2 |              
         4019 | DIS_APP_TRG        | myschema4   | mytblm     | mytblm_insert_trigger   |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mypartp1a  |                         |                     |                 7 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mypartp1b  |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mypartp2   |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mytblc1    |                         |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mytblc2    |                         |                     |                 5 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mytblm     |                         |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | DIS_LOG_TRG        | myschema4   | mytblr2    |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | SET_FK_DEF         | myschema4   | mypartp1a  | mytblp_col1_fkey        |                     |                 7 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | SET_FK_DEF         | myschema4   | mypartp1b  | mytblp_col1_fkey        |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | SET_FK_DEF         | myschema4   | mypartp2   | mytblp_col1_fkey        |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | RLBK_TABLE         | myschema4   | mypartp1a  |                         |                4047 |                 7 |            1 |                 |                   | f                         |                       1 |                    3 |             1
         4019 | RLBK_TABLE         | myschema4   | mypartp1b  |                         |                4047 |                 3 |            1 |                 |                   | f                         |                       3 |                    1 |             2
         4019 | RLBK_TABLE         | myschema4   | mypartp2   |                         |                4047 |                 2 |            1 |                 |                   | f                         |                       8 |                    1 |             3
         4019 | RLBK_TABLE         | myschema4   | mytblc1    |                         |                4047 |                 4 |            1 |                 |                   | f                         |                       3 |                    1 |             2
         4019 | RLBK_TABLE         | myschema4   | mytblc2    |                         |                4047 |                 5 |            1 |                 |                   | f                         |                       3 |                    1 |             2
         4019 | RLBK_TABLE         | myschema4   | mytblm     |                         |                4047 |                 6 |            1 |                 |                   | f                         |                       3 |                    1 |             2
         4019 | RLBK_TABLE         | myschema4   | mytblr2    |                         |                4047 |                 2 |            1 |                 |                   | t                         |                       2 |                    1 |             1
         4019 | DELETE_LOG         | myschema4   | mypartp1a  |                         |                4047 |                 7 |            1 |                 |                   |                           |                       1 |                    3 |             1
         4019 | DELETE_LOG         | myschema4   | mypartp1b  |                         |                4047 |                 3 |            1 |                 |                   |                           |                       3 |                    3 |             3
         4019 | DELETE_LOG         | myschema4   | mypartp2   |                         |                4047 |                 2 |            1 |                 |                   |                           |                       8 |                    3 |             9
         4019 | DELETE_LOG         | myschema4   | mytblc1    |                         |                4047 |                 4 |            1 |                 |                   |                           |                       3 |                    3 |             4
         4019 | DELETE_LOG         | myschema4   | mytblc2    |                         |                4047 |                 5 |            1 |                 |                   |                           |                       3 |                    3 |             4
         4019 | DELETE_LOG         | myschema4   | mytblm     |                         |                4047 |                 6 |            1 |                 |                   |                           |                       3 |                    3 |             4
         4019 | DELETE_LOG         | myschema4   | mytblr2    |                         |                4047 |                 2 |            1 |                 |                   |                           |                       2 |                    3 |             2
         4019 | SET_FK_IMM         | myschema4   | mypartp1a  | mytblp_col1_fkey        |                     |                 7 |            1 |                 |                   |                           |                       1 |                    3 |              
         4019 | SET_FK_IMM         | myschema4   | mypartp1b  | mytblp_col1_fkey        |                     |                 3 |            1 |                 |                   |                           |                       3 |                    2 |              
         4019 | SET_FK_IMM         | myschema4   | mypartp2   | mytblp_col1_fkey        |                     |                 2 |            1 |                 |                   |                           |                       8 |                    2 |              
         4019 | SET_FK_IMM         | myschema4   | mytblr2    | mytblr2_col2_col3_fkey2 |                     |                 7 |            1 |                 |                   |                           |                       3 |                    3 |              
         4019 | SET_FK_IMM         | myschema4   | mytblr2    | mytblr2_col2_col3_fkey3 |                     |                 3 |            1 |                 |                   |                           |                       5 |                    2 |              
         4019 | SET_FK_IMM         | myschema4   | mytblr2    | mytblr2_col2_col3_fkey4 |                     |                 2 |            1 |                 |                   |                           |                      10 |                    2 |              
         4019 | ENA_APP_TRG        | myschema4   | mytblm     | mytblm_insert_trigger   |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mypartp1a  |                         |                     |                 7 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mypartp1b  |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mypartp2   |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mytblc1    |                         |                     |                 4 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mytblc2    |                         |                     |                 5 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mytblm     |                         |                     |                 6 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | ENA_LOG_TRG        | myschema4   | mytblr2    |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4019 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                      39 |                    2 |              
         4020 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4020 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       1 |                    2 |              
         4021 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4021 | SET_ALWAYS_APP_TRG | myschema1   | mytbl2     | mytbl2trg2              |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4021 | RLBK_TABLE         | myschema1   | mytbl1     |                         |                4055 |                 2 |            1 |                 |                   | t                         |                      13 |                    1 |            12
         4021 | RLBK_TABLE         | myschema1   | mytbl2     |                         |                4055 |                 3 |            1 |                 |                   | t                         |                       2 |                    1 |             1
         4021 | RLBK_TABLE         | myschema1   | mytbl2b    |                         |                4055 |                 4 |            1 |                 |                   | f                         |                       2 |                    1 |             2
         4021 | SET_LOCAL_APP_TRG  | myschema1   | mytbl2     | mytbl2trg2              |                     |                 3 |            1 |                 |                   |                           |                         |                    3 |              
         4021 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                       6 |                    2 |              
         4022 | RLBK_SEQUENCES     |             |            |                         |                     |                 1 |            1 |                 |                   |                           |                       2 |                    2 |             2
         4022 | SET_ALWAYS_APP_TRG | myschema1   | mytbl2     | mytbl2trg2              |                     |                 2 |            1 |                 |                   |                           |                         |                    3 |              
         4022 | DIS_LOG_TRG        | myschema1   | mytbl2     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4022 | DIS_LOG_TRG        | myschema1   | mytbl2b    |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4022 | RLBK_TABLE         | myschema1   | mytbl2     |                         |                4052 |                 2 |            1 |                 |                   | t                         |                       1 |                    1 |             1
         4022 | RLBK_TABLE         | myschema1   | mytbl2b    |                         |                4052 |                 3 |            1 |                 |                   | f                         |                       1 |                    1 |             1
         4022 | DELETE_LOG         | myschema1   | mytbl2     |                         |                4052 |                 2 |            1 |                 |                   |                           |                       1 |                    1 |             1
         4022 | DELETE_LOG         | myschema1   | mytbl2b    |                         |                4052 |                 3 |            1 |                 |                   |                           |                       1 |                    1 |             1
         4022 | SET_LOCAL_APP_TRG  | myschema1   | mytbl2     | mytbl2trg2              |                     |                 2 |            1 |                 |                   |                           |                         |                    3 |              
         4022 | ENA_LOG_TRG        | myschema1   | mytbl2     |                         |                     |                 2 |            1 |                 |                   |                           |                         |                    2 |              
         4022 | ENA_LOG_TRG        | myschema1   | mytbl2b    |                         |                     |                 3 |            1 |                 |                   |                           |                         |                    2 |              
         4022 | CTRL+DBLINK        |             |            |                         |                     |                   |              |                 |                   |                           |                      11 |                    2 |              
(157 rows)

select rlbt_step, rlbt_schema, rlbt_table, rlbt_object, rlbt_rlbk_id, rlbt_quantity from emaj.emaj_rlbk_stat
  order by rlbt_rlbk_id, rlbt_step, rlbt_schema, rlbt_table, rlbt_object;
   rlbt_step    | rlbt_schema | rlbt_table |       rlbt_object       | rlbt_rlbk_id | rlbt_quantity 
----------------+-------------+------------+-------------------------+--------------+---------------
 RLBK_SEQUENCES |             |            |                         |         4000 |             2
 CTRL-DBLINK    |             |            |                         |         4000 |             1
 RLBK_SEQUENCES |             |            |                         |         4003 |             2
 CTRL-DBLINK    |             |            |                         |         4003 |             1
 RLBK_SEQUENCES |             |            |                         |         4004 |             2
 CTRL-DBLINK    |             |            |                         |         4004 |             1
 RLBK_SEQUENCES |             |            |                         |         4005 |             4
 CTRL-DBLINK    |             |            |                         |         4005 |             1
 RLBK_SEQUENCES |             |            |                         |         4006 |             4
 CTRL-DBLINK    |             |            |                         |         4006 |             1
 RLBK_SEQUENCES |             |            |                         |         4007 |             4
 CTRL-DBLINK    |             |            |                         |         4007 |             1
 RLBK_SEQUENCES |             |            |                         |         4008 |             4
 CTRL+DBLINK    |             |            |                         |         4008 |             1
 RLBK_SEQUENCES |             |            |                         |         4009 |             2
 DIS_LOG_TRG    |             |            |                         |         4009 |             2
 RLBK_TABLE     | myschema1   | myTbl3     |                         |         4009 |            10
 RLBK_TABLE     | myschema1   | mytbl4     |                         |         4009 |             2
 DELETE_LOG     | myschema1   | myTbl3     |                         |         4009 |            10
 DELETE_LOG     | myschema1   | mytbl4     |                         |         4009 |             2
 ENA_LOG_TRG    |             |            |                         |         4009 |             2
 CTRL+DBLINK    |             |            |                         |         4009 |             9
 RLBK_SEQUENCES |             |            |                         |         4010 |             2
 DIS_APP_TRG    |             |            |                         |         4010 |             1
 DIS_LOG_TRG    |             |            |                         |         4010 |             3
 RLBK_TABLE     | myschema1   | mytbl1     |                         |         4010 |            15
 RLBK_TABLE     | myschema1   | mytbl2     |                         |         4010 |             6
 RLBK_TABLE     | myschema1   | mytbl2b    |                         |         4010 |             6
 DELETE_LOG     | myschema1   | mytbl1     |                         |         4010 |            15
 DELETE_LOG     | myschema1   | mytbl2     |                         |         4010 |             6
 DELETE_LOG     | myschema1   | mytbl2b    |                         |         4010 |             6
 ENA_APP_TRG    |             |            |                         |         4010 |             1
 ENA_LOG_TRG    |             |            |                         |         4010 |             3
 CTRL+DBLINK    |             |            |                         |         4010 |            17
 RLBK_SEQUENCES |             |            |                         |         4011 |             2
 RLBK_TABLE     | myschema1   | myTbl3     |                         |         4011 |            10
 RLBK_TABLE     | myschema1   | mytbl4     |                         |         4011 |             1
 CTRL+DBLINK    |             |            |                         |         4011 |             3
 RLBK_SEQUENCES |             |            |                         |         4012 |             2
 DIS_APP_TRG    |             |            |                         |         4012 |             1
 RLBK_TABLE     | myschema1   | myTbl3     |                         |         4012 |            20
 RLBK_TABLE     | myschema1   | mytbl1     |                         |         4012 |            15
 RLBK_TABLE     | myschema1   | mytbl2     |                         |         4012 |             2
 RLBK_TABLE     | myschema1   | mytbl2b    |                         |         4012 |             2
 RLBK_TABLE     | myschema1   | mytbl4     |                         |         4012 |             2
 ENA_APP_TRG    |             |            |                         |         4012 |             1
 CTRL+DBLINK    |             |            |                         |         4012 |            10
 RLBK_SEQUENCES |             |            |                         |         4013 |             2
 DIS_LOG_TRG    |             |            |                         |         4013 |             5
 RLBK_TABLE     | myschema1   | myTbl3     |                         |         4013 |            10
 RLBK_TABLE     | myschema1   | mytbl1     |                         |         4013 |            10
 RLBK_TABLE     | myschema1   | mytbl2     |                         |         4013 |             2
 RLBK_TABLE     | myschema1   | mytbl2b    |                         |         4013 |             2
 RLBK_TABLE     | myschema1   | mytbl4     |                         |         4013 |             1
 DELETE_LOG     | myschema1   | myTbl3     |                         |         4013 |            10
 DELETE_LOG     | myschema1   | mytbl1     |                         |         4013 |            10
 DELETE_LOG     | myschema1   | mytbl2     |                         |         4013 |             2
 DELETE_LOG     | myschema1   | mytbl2b    |                         |         4013 |             2
 DELETE_LOG     | myschema1   | mytbl4     |                         |         4013 |             1
 ENA_LOG_TRG    |             |            |                         |         4013 |             5
 CTRL+DBLINK    |             |            |                         |         4013 |            23
 DIS_APP_TRG    |             |            |                         |         4018 |             1
 SET_FK_DEF     |             |            |                         |         4018 |             2
 RLBK_TABLE     | myschema4   | mypartp1b  |                         |         4018 |             1
 RLBK_TABLE     | myschema4   | mypartp2   |                         |         4018 |             2
 RLBK_TABLE     | myschema4   | mytblc1    |                         |         4018 |             1
 RLBK_TABLE     | myschema4   | mytblc2    |                         |         4018 |             1
 RLBK_TABLE     | myschema4   | mytblm     |                         |         4018 |             1
 RLBK_TABLE     | myschema4   | mytblr2    |                         |         4018 |             1
 SET_FK_IMM     | myschema4   | mypartp1b  | mytblp_col1_fkey        |         4018 |             1
 SET_FK_IMM     | myschema4   | mypartp2   | mytblp_col1_fkey        |         4018 |             2
 SET_FK_IMM     | myschema4   | mytblr2    | mytblr2_col2_col3_fkey3 |         4018 |             2
 SET_FK_IMM     | myschema4   | mytblr2    | mytblr2_col2_col3_fkey4 |         4018 |             3
 ENA_APP_TRG    |             |            |                         |         4018 |             1
 CTRL+DBLINK    |             |            |                         |         4018 |            14
 DIS_APP_TRG    |             |            |                         |         4019 |             1
 DIS_LOG_TRG    |             |            |                         |         4019 |             7
 SET_FK_DEF     |             |            |                         |         4019 |             3
 RLBK_TABLE     | myschema4   | mypartp1a  |                         |         4019 |             1
 RLBK_TABLE     | myschema4   | mypartp1b  |                         |         4019 |             3
 RLBK_TABLE     | myschema4   | mypartp2   |                         |         4019 |             8
 RLBK_TABLE     | myschema4   | mytblc1    |                         |         4019 |             3
 RLBK_TABLE     | myschema4   | mytblc2    |                         |         4019 |             3
 RLBK_TABLE     | myschema4   | mytblm     |                         |         4019 |             3
 RLBK_TABLE     | myschema4   | mytblr2    |                         |         4019 |             2
 DELETE_LOG     | myschema4   | mypartp1a  |                         |         4019 |             1
 DELETE_LOG     | myschema4   | mypartp1b  |                         |         4019 |             3
 DELETE_LOG     | myschema4   | mypartp2   |                         |         4019 |             8
 DELETE_LOG     | myschema4   | mytblc1    |                         |         4019 |             3
 DELETE_LOG     | myschema4   | mytblc2    |                         |         4019 |             3
 DELETE_LOG     | myschema4   | mytblm     |                         |         4019 |             3
 DELETE_LOG     | myschema4   | mytblr2    |                         |         4019 |             2
 SET_FK_IMM     | myschema4   | mypartp1a  | mytblp_col1_fkey        |         4019 |             1
 SET_FK_IMM     | myschema4   | mypartp1b  | mytblp_col1_fkey        |         4019 |             3
 SET_FK_IMM     | myschema4   | mypartp2   | mytblp_col1_fkey        |         4019 |             8
 SET_FK_IMM     | myschema4   | mytblr2    | mytblr2_col2_col3_fkey2 |         4019 |             3
 SET_FK_IMM     | myschema4   | mytblr2    | mytblr2_col2_col3_fkey3 |         4019 |             5
 SET_FK_IMM     | myschema4   | mytblr2    | mytblr2_col2_col3_fkey4 |         4019 |            10
 ENA_APP_TRG    |             |            |                         |         4019 |             1
 ENA_LOG_TRG    |             |            |                         |         4019 |             7
 CTRL+DBLINK    |             |            |                         |         4019 |            39
 RLBK_SEQUENCES |             |            |                         |         4020 |             2
 CTRL+DBLINK    |             |            |                         |         4020 |             1
 RLBK_SEQUENCES |             |            |                         |         4021 |             2
 RLBK_TABLE     | myschema1   | mytbl1     |                         |         4021 |            13
 RLBK_TABLE     | myschema1   | mytbl2     |                         |         4021 |             2
 RLBK_TABLE     | myschema1   | mytbl2b    |                         |         4021 |             2
 CTRL+DBLINK    |             |            |                         |         4021 |             6
 RLBK_SEQUENCES |             |            |                         |         4022 |             2
 DIS_LOG_TRG    |             |            |                         |         4022 |             2
 RLBK_TABLE     | myschema1   | mytbl2     |                         |         4022 |             1
 RLBK_TABLE     | myschema1   | mytbl2b    |                         |         4022 |             1
 DELETE_LOG     | myschema1   | mytbl2     |                         |         4022 |             1
 DELETE_LOG     | myschema1   | mytbl2b    |                         |         4022 |             1
 ENA_LOG_TRG    |             |            |                         |         4022 |             2
 CTRL+DBLINK    |             |            |                         |         4022 |            11
(116 rows)

-----------------------------
-- test end: reset history and force sequences id
-----------------------------
select emaj.emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

select * from emaj.emaj_log_session where lower(lses_time_range) >= 4000 order by lses_group, lses_time_range;
 lses_group | lses_time_range | lses_marks | lses_log_rows 
------------+-----------------+------------+---------------
 myGroup1   | [4003,4028)     |          8 |             0
 myGroup1   | [4028,4035)     |          4 |            39
 myGroup1   | [4035,)         |         15 |            86
 myGroup2   | [4004,4028)     |          8 |             0
 myGroup2   | [4029,)         |          1 |             0
 myGroup4   | [4047,)         |          5 |            23
(6 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 4000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    4000 |            4000000 | A
    4003 |            4000000 | S
    4004 |            4000000 | S
    4005 |            4000000 | M
    4006 |            4000000 | M
    4007 |            4000000 | R
    4008 |            4000000 | C
    4009 |            4000000 | D
    4018 |            4000000 | R
    4019 |            4000000 | R
    4020 |            4000000 | M
    4021 |            4000000 | R
    4022 |            4000000 | R
    4023 |            4000000 | R
    4024 |            4000000 | M
    4025 |            4000000 | R
    4026 |            4000000 | M
    4027 |            4000000 | X
    4028 |            4000000 | S
    4029 |            4000000 | S
    4030 |            4000027 | M
    4031 |            4000039 | M
    4032 |            4000039 | R
    4033 |            4000039 | R
    4034 |            4000039 | X
    4035 |            4000039 | S
    4036 |            4000058 | M
    4037 |            4000069 | M
    4038 |            4000069 | R
    4039 |            4000080 | M
    4040 |            4000080 | R
    4041 |            4000094 | M
    4042 |            4000094 | R
    4043 |            4000094 | R
    4044 |            4000094 | R
    4045 |            4000094 | M
    4046 |            4000094 | A
    4047 |            4000094 | S
    4048 |            4000102 | M
    4049 |            4000112 | R
    4050 |            4000120 | M
    4051 |            4000120 | R
    4052 |            4000120 | M
    4053 |            4000120 | R
    4054 |            4000120 | M
    4055 |            4000120 | M
    4056 |            4000135 | M
    4057 |            4000137 | R
    4058 |            4000151 | M
    4059 |            4000153 | R
    4060 |            4000153 | A
    4064 |            4000153 | R
    4065 |            4000153 | A
(53 rows)

select hist_id, hist_function, hist_event, hist_object, regexp_replace(regexp_replace(hist_wording,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),E'\\[.+\\]','(timestamp)','g'), hist_user from 
  (select * from emaj.emaj_hist where hist_id >= 4000 order by hist_id) as t;
 hist_id |     hist_function      |         hist_event         |         hist_object          |                                          regexp_replace                                          | hist_user 
---------+------------------------+----------------------------+------------------------------+--------------------------------------------------------------------------------------------------+-----------
    4000 | MODIFY_TABLE           | BEGIN                      |                              |                                                                                                  | postgres
    4001 | MODIFY_TABLE           | TIME STAMP SET             | 4000                         |                                                                                                  | postgres
    4002 | MODIFY_TABLE           | TRIGGERS TO IGNORE CHANGED | myschema1.mytbl2             | none => {mytbl2trg2}                                                                             | postgres
    4003 | MODIFY_TABLE           | END                        |                              | 1 tables effectively modified                                                                    | postgres
    4004 | DISABLE_PROTECTION     | EVENT TRIGGERS DISABLED    |                              | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                   | postgres
    4019 | START_GROUP            | BEGIN                      | myGroup1                     | With log reset                                                                                   | postgres
    4020 | START_GROUP            | TIME STAMP SET             | 4003                         |                                                                                                  | postgres
    4021 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4022 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4023 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | Mark11                                                                                           | postgres
    4024 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark11                                                                                           | postgres
    4025 | START_GROUP            | END                        | myGroup1                     | 7 tables/sequences processed                                                                     | postgres
    4026 | START_GROUP            | BEGIN                      | myGroup2                     | With log reset                                                                                   | postgres
    4027 | START_GROUP            | TIME STAMP SET             | 4004                         |                                                                                                  | postgres
    4028 | LOCK_GROUP             | BEGIN                      | myGroup2                     |                                                                                                  | postgres
    4029 | LOCK_GROUP             | END                        | myGroup2                     | 8 tables locked, 0 deadlock(s)                                                                   | postgres
    4030 | SET_MARK_GROUP         | BEGIN                      | myGroup2                     | Mark21                                                                                           | postgres
    4031 | SET_MARK_GROUP         | END                        | myGroup2                     | Mark21                                                                                           | postgres
    4032 | START_GROUP            | END                        | myGroup2                     | 10 tables/sequences processed                                                                    | postgres
    4033 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4034 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4035 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4036 | SET_MARK_GROUP         | TIME STAMP SET             | 4005                         |                                                                                                  | postgres
    4037 | SET_MARK_GROUP         | END                        | myGroup1                     | Different_Mark                                                                                   | postgres
    4038 | SET_MARK_GROUP         | BEGIN                      | myGroup2                     |                                                                                                  | postgres
    4039 | LOCK_GROUP             | BEGIN                      | myGroup2                     |                                                                                                  | postgres
    4040 | LOCK_GROUP             | END                        | myGroup2                     | 8 tables locked, 0 deadlock(s)                                                                   | postgres
    4041 | SET_MARK_GROUP         | TIME STAMP SET             | 4006                         |                                                                                                  | postgres
    4042 | SET_MARK_GROUP         | END                        | myGroup2                     | Different_Mark                                                                                   | postgres
    4043 | PROTECT_GROUP          |                            | myGroup1                     | Status 1                                                                                         | postgres
    4044 | PROTECT_GROUP          |                            | myGroup2                     | Status 1                                                                                         | postgres
    4045 | UNPROTECT_GROUP        |                            | myGroup1                     | Status 1                                                                                         | postgres
    4046 | UNPROTECT_GROUP        |                            | myGroup2                     | Status 1                                                                                         | postgres
    4047 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Unlogged rollback to mark Different_Mark (timestamp)                                             | postgres
    4048 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = -5 (missing 'dblink_user_password' parameter in emaj_param table)                       | postgres
    4049 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4050 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4051 | ROLLBACK_GROUP         | TIME STAMP SET             | 4007                         |                                                                                                  | postgres
    4052 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4000             | Rollback id = 4000.                                                                              | postgres
    4053 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4000             | 0 / 5 tables effectively processed.                                                              | postgres
    4054 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4000             | 0 / 2 sequences effectively processed.                                                           | postgres
    4055 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4000                                                                                 | postgres
    4056 | CREATE_GROUP           | BEGIN                      | auditOnlyEmptyGroup          | audit_only                                                                                       | postgres
    4057 | CREATE_GROUP           | TIME STAMP SET             | 4008                         |                                                                                                  | postgres
    4058 | CREATE_GROUP           | END                        | auditOnlyEmptyGroup          |                                                                                                  | postgres
    4059 | DROP_GROUP             | BEGIN                      | auditOnlyEmptyGroup          |                                                                                                  | postgres
    4060 | DROP_GROUP             | TIME STAMP SET             | 4009                         |                                                                                                  | postgres
    4061 | DROP_GROUP             | END                        | auditOnlyEmptyGroup          | 0 tables/sequences processed                                                                     | postgres
    4117 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Unlogged rollback to mark Different_Mark (timestamp)                                             | postgres
    4118 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = -1 (dblink extension not installed)                                                     | postgres
    4119 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4120 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4121 | ROLLBACK_GROUP         | TIME STAMP SET             | 4018                         |                                                                                                  | postgres
    4122 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4003             | Rollback id = 4003.                                                                              | postgres
    4123 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4003             | 0 / 5 tables effectively processed.                                                              | postgres
    4124 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4003             | 0 / 2 sequences effectively processed.                                                           | postgres
    4125 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4003                                                                                 | postgres
    4126 | ROLLBACK_GROUP         | BEGIN                      | myGroup2                     | Unlogged rollback to mark Mark21 (timestamp)                                                     | postgres
    4127 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = -1 (dblink extension not installed)                                                     | postgres
    4128 | LOCK_GROUP             | BEGIN                      | myGroup2                     | Rollback session #1                                                                              | postgres
    4129 | LOCK_GROUP             | END                        | myGroup2                     | Rollback session #1: 8 tables locked, 0 deadlock(s)                                              | postgres
    4130 | ROLLBACK_GROUP         | TIME STAMP SET             | 4019                         |                                                                                                  | postgres
    4131 | ROLLBACK_GROUP         | MARK DELETED               | myGroup2                     | mark Different_Mark is deleted                                                                   | postgres
    4132 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4004             | Rollback id = 4004.                                                                              | postgres
    4133 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4004             | 0 / 8 tables effectively processed.                                                              | postgres
    4134 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4004             | 0 / 2 sequences effectively processed.                                                           | postgres
    4135 | ROLLBACK_GROUP         | END                        | myGroup2                     | Rollback_id 4004                                                                                 | postgres
    4136 | SET_MARK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | Mark1B                                                                                           | postgres
    4137 | LOCK_GROUPS            | BEGIN                      | myGroup1,myGroup2            |                                                                                                  | postgres
    4138 | LOCK_GROUPS            | END                        | myGroup1,myGroup2            | 13 tables locked, 0 deadlock(s)                                                                  | postgres
    4139 | SET_MARK_GROUPS        | TIME STAMP SET             | 4020                         |                                                                                                  | postgres
    4140 | SET_MARK_GROUPS        | END                        | myGroup1,myGroup2            | Mark1B                                                                                           | postgres
    4141 | ROLLBACK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | Unlogged rollback to mark Mark1B (timestamp)                                                     | postgres
    4142 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = -5 (missing 'dblink_user_password' parameter in emaj_param table)                       | postgres
    4143 | LOCK_GROUP             | BEGIN                      | myGroup1,myGroup2            | Rollback session #1                                                                              | postgres
    4144 | LOCK_GROUP             | END                        | myGroup1,myGroup2            | Rollback session #1: 13 tables locked, 0 deadlock(s)                                             | postgres
    4145 | ROLLBACK_GROUPS        | TIME STAMP SET             | 4021                         |                                                                                                  | postgres
    4146 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4005             | Rollback id = 4005.                                                                              | postgres
    4147 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4005             | 0 / 13 tables effectively processed.                                                             | postgres
    4148 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4005             | 0 / 4 sequences effectively processed.                                                           | postgres
    4149 | ROLLBACK_GROUPS        | END                        | myGroup1,myGroup2            | Rollback_id 4005                                                                                 | postgres
    4150 |                        | INSERTED PARAMETER         | dblink_user_password         | <masked data>                                                                                    | postgres
    4151 | ROLLBACK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | Unlogged rollback to mark Mark1B (timestamp)                                                     | postgres
    4152 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = -6 (dblink connection test failed - SQLSTATE 08001)                                     | postgres
    4153 | LOCK_GROUP             | BEGIN                      | myGroup1,myGroup2            | Rollback session #1                                                                              | postgres
    4154 | LOCK_GROUP             | END                        | myGroup1,myGroup2            | Rollback session #1: 13 tables locked, 0 deadlock(s)                                             | postgres
    4155 | ROLLBACK_GROUPS        | TIME STAMP SET             | 4022                         |                                                                                                  | postgres
    4156 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4006             | Rollback id = 4006.                                                                              | postgres
    4157 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4006             | 0 / 13 tables effectively processed.                                                             | postgres
    4158 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4006             | 0 / 4 sequences effectively processed.                                                           | postgres
    4159 | ROLLBACK_GROUPS        | END                        | myGroup1,myGroup2            | Rollback_id 4006                                                                                 | postgres
    4160 | ROLLBACK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | Logged rollback to mark Mark1B (timestamp)                                                       | postgres
    4161 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = -4 (transaction isolation level not READ COMMITTED)                                     | postgres
    4162 | LOCK_GROUP             | BEGIN                      | myGroup1,myGroup2            | Rollback session #1                                                                              | postgres
    4163 | LOCK_GROUP             | END                        | myGroup1,myGroup2            | Rollback session #1: 13 tables locked, 0 deadlock(s)                                             | postgres
    4164 | ROLLBACK_GROUPS        | TIME STAMP SET             | 4023                         |                                                                                                  | postgres
    4165 | SET_MARK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | RLBK_4007_START                                                                                  | postgres
    4166 | SET_MARK_GROUPS        | END                        | myGroup1,myGroup2            | RLBK_4007_START                                                                                  | postgres
    4167 | ROLLBACK_GROUPS        | TIME STAMP SET             | 4024                         |                                                                                                  | postgres
    4168 | SET_MARK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | RLBK_4007_DONE                                                                                   | postgres
    4169 | SET_MARK_GROUPS        | END                        | myGroup1,myGroup2            | RLBK_4007_DONE                                                                                   | postgres
    4170 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4007             | Rollback id = 4007.                                                                              | postgres
    4171 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4007             | 0 / 13 tables effectively processed.                                                             | postgres
    4172 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4007             | 0 / 4 sequences effectively processed.                                                           | postgres
    4173 | ROLLBACK_GROUPS        | END                        | myGroup1,myGroup2            | Rollback_id 4007                                                                                 | postgres
    4174 |                        | UPDATED PARAMETER          | dblink_user_password         | <masked data>                                                                                    | postgres
    4175 | ROLLBACK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | Logged rollback to mark Mark1B (timestamp)                                                       | postgres
    4176 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4177 | LOCK_GROUP             | BEGIN                      | myGroup1,myGroup2            | Rollback session #1                                                                              | postgres
    4178 | LOCK_GROUP             | END                        | myGroup1,myGroup2            | Rollback session #1: 13 tables locked, 0 deadlock(s)                                             | postgres
    4179 | ROLLBACK_GROUPS        | TIME STAMP SET             | 4025                         |                                                                                                  | postgres
    4180 | SET_MARK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | RLBK_4008_START                                                                                  | postgres
    4181 | SET_MARK_GROUPS        | END                        | myGroup1,myGroup2            | RLBK_4008_START                                                                                  | postgres
    4182 | ROLLBACK_GROUPS        | TIME STAMP SET             | 4026                         |                                                                                                  | postgres
    4183 | SET_MARK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | RLBK_4008_DONE                                                                                   | postgres
    4184 | SET_MARK_GROUPS        | END                        | myGroup1,myGroup2            | RLBK_4008_DONE                                                                                   | postgres
    4185 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4008             | Rollback id = 4008.                                                                              | postgres
    4186 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4008             | 0 / 13 tables effectively processed.                                                             | postgres
    4187 | ROLLBACK_GROUPS        | NOTICE                     | Rollback id 4008             | 0 / 4 sequences effectively processed.                                                           | postgres
    4188 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4189 | ROLLBACK_GROUPS        | END                        | myGroup1,myGroup2            | Rollback_id 4008                                                                                 | postgres
    4190 | STOP_GROUPS            | BEGIN                      | myGroup1,myGroup2            |                                                                                                  | postgres
    4191 | STOP_GROUPS            | TIME STAMP SET             | 4027                         |                                                                                                  | postgres
    4192 | LOCK_GROUPS            | BEGIN                      | myGroup1,myGroup2            |                                                                                                  | postgres
    4193 | LOCK_GROUPS            | END                        | myGroup1,myGroup2            | 13 tables locked, 0 deadlock(s)                                                                  | postgres
    4194 | SET_MARK_GROUPS        | BEGIN                      | myGroup1,myGroup2            | STOP_%                                                                                           | postgres
    4195 | CLEANUP_RLBK_STATE     |                            | Rollback id 4008             | set to COMMITTED                                                                                 | postgres
    4196 | SET_MARK_GROUPS        | END                        | myGroup1,myGroup2            | STOP_%                                                                                           | postgres
    4197 | STOP_GROUPS            | END                        | myGroup1,myGroup2            | 17 tables/sequences processed                                                                    | postgres
    4198 | START_GROUP            | BEGIN                      | myGroup1                     | With log reset                                                                                   | postgres
    4199 | START_GROUP            | TIME STAMP SET             | 4028                         |                                                                                                  | postgres
    4200 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4201 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4202 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | Mark11                                                                                           | postgres
    4203 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark11                                                                                           | postgres
    4204 | START_GROUP            | END                        | myGroup1                     | 7 tables/sequences processed                                                                     | postgres
    4205 | START_GROUP            | BEGIN                      | myGroup2                     | With log reset                                                                                   | postgres
    4206 | START_GROUP            | TIME STAMP SET             | 4029                         |                                                                                                  | postgres
    4207 | LOCK_GROUP             | BEGIN                      | myGroup2                     |                                                                                                  | postgres
    4208 | LOCK_GROUP             | END                        | myGroup2                     | 8 tables locked, 0 deadlock(s)                                                                   | postgres
    4209 | SET_MARK_GROUP         | BEGIN                      | myGroup2                     | Mark21                                                                                           | postgres
    4210 | SET_MARK_GROUP         | END                        | myGroup2                     | Mark21                                                                                           | postgres
    4211 | START_GROUP            | END                        | myGroup2                     | 10 tables/sequences processed                                                                    | postgres
    4212 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4213 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4214 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4215 | SET_MARK_GROUP         | TIME STAMP SET             | 4030                         |                                                                                                  | postgres
    4216 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark12                                                                                           | postgres
    4217 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4218 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4219 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4220 | SET_MARK_GROUP         | TIME STAMP SET             | 4031                         |                                                                                                  | postgres
    4221 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark13                                                                                           | postgres
    4222 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Unlogged rollback to mark Mark12 (timestamp)                                                     | postgres
    4223 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4224 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4225 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4226 | ROLLBACK_GROUP         | TIME STAMP SET             | 4032                         |                                                                                                  | postgres
    4227 | ROLLBACK_SEQUENCE      |                            | myschema1."myTbl3_col31_seq" | RESTART 1                                                                                        | postgres
    4228 | ROLLBACK_TABLE         | BEGIN                      | myschema1."myTbl3"           | All log rows where emaj_gid > 4000027 and <= 4000039                                             | postgres
    4229 | ROLLBACK_TABLE         | END                        | myschema1."myTbl3"           | 10 rolled back primary keys                                                                      | postgres
    4230 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl4             | All log rows where emaj_gid > 4000027 and <= 4000039, in session_replication_role = replica mode | postgres
    4231 | ROLLBACK_TABLE         | END                        | myschema1.mytbl4             | 1 rolled back primary keys                                                                       | postgres
    4232 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark Mark13 is deleted                                                                           | postgres
    4233 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4009             | Rollback id = 4009.                                                                              | postgres
    4234 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4009             | 2 / 5 tables effectively processed.                                                              | postgres
    4235 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4009             | 1 / 2 sequences effectively processed.                                                           | postgres
    4236 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4237 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4009                                                                                 | postgres
    4238 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Unlogged rollback to mark Mark11 (timestamp)                                                     | postgres
    4239 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4240 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4241 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4242 | ROLLBACK_GROUP         | TIME STAMP SET             | 4033                         |                                                                                                  | postgres
    4243 | ROLLBACK_SEQUENCE      |                            | myschema1.mytbl2b_col20_seq  | RESTART 1                                                                                        | postgres
    4244 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl1             | All log rows where emaj_gid > 4000000 and <= 4000039, in session_replication_role = replica mode | postgres
    4245 | ROLLBACK_TABLE         | END                        | myschema1.mytbl1             | 11 rolled back primary keys                                                                      | postgres
    4246 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2             | All log rows where emaj_gid > 4000000 and <= 4000039, in session_replication_role = replica mode | postgres
    4247 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2             | 3 rolled back primary keys                                                                       | postgres
    4248 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2b            | All log rows where emaj_gid > 4000000 and <= 4000039                                             | postgres
    4249 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2b            | 6 rolled back primary keys                                                                       | postgres
    4250 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark Mark12 is deleted                                                                           | postgres
    4251 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4010             | Rollback id = 4010.                                                                              | postgres
    4252 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4010             | 3 / 5 tables effectively processed.                                                              | postgres
    4253 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4010             | 1 / 2 sequences effectively processed.                                                           | postgres
    4254 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4255 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4010                                                                                 | postgres
    4256 | STOP_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4257 | STOP_GROUP             | TIME STAMP SET             | 4034                         |                                                                                                  | postgres
    4258 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4259 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4260 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | STOP_%                                                                                           | postgres
    4261 | CLEANUP_RLBK_STATE     |                            | Rollback id 4009             | set to COMMITTED                                                                                 | postgres
    4262 | CLEANUP_RLBK_STATE     |                            | Rollback id 4010             | set to COMMITTED                                                                                 | postgres
    4263 | SET_MARK_GROUP         | END                        | myGroup1                     | STOP_%                                                                                           | postgres
    4264 | STOP_GROUP             | END                        | myGroup1                     | 7 tables/sequences processed                                                                     | postgres
    4265 | START_GROUP            | BEGIN                      | myGroup1                     | With log reset                                                                                   | postgres
    4266 | START_GROUP            | TIME STAMP SET             | 4035                         |                                                                                                  | postgres
    4267 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4268 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4269 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | Mark11                                                                                           | postgres
    4270 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark11                                                                                           | postgres
    4271 | START_GROUP            | END                        | myGroup1                     | 7 tables/sequences processed                                                                     | postgres
    4272 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4273 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4274 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4275 | SET_MARK_GROUP         | TIME STAMP SET             | 4036                         |                                                                                                  | postgres
    4276 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark12                                                                                           | postgres
    4277 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4278 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4279 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4280 | SET_MARK_GROUP         | TIME STAMP SET             | 4037                         |                                                                                                  | postgres
    4281 | SET_MARK_GROUP         | END                        | myGroup1                     | Mark13                                                                                           | postgres
    4282 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Logged rollback to mark Mark12 (timestamp)                                                       | postgres
    4283 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4284 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4285 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4286 | ROLLBACK_GROUP         | TIME STAMP SET             | 4038                         |                                                                                                  | postgres
    4287 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4011_START                                                                                  | postgres
    4288 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4011_START                                                                                  | postgres
    4289 | ROLLBACK_SEQUENCE      |                            | myschema1."myTbl3_col31_seq" | RESTART 1                                                                                        | postgres
    4290 | ROLLBACK_TABLE         | BEGIN                      | myschema1."myTbl3"           | All log rows where emaj_gid > 4000058 and <= 4000069                                             | postgres
    4291 | ROLLBACK_TABLE         | END                        | myschema1."myTbl3"           | 10 rolled back primary keys                                                                      | postgres
    4292 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl4             | All log rows where emaj_gid > 4000058 and <= 4000069, in session_replication_role = replica mode | postgres
    4293 | ROLLBACK_TABLE         | END                        | myschema1.mytbl4             | 1 rolled back primary keys                                                                       | postgres
    4294 | ROLLBACK_GROUP         | TIME STAMP SET             | 4039                         |                                                                                                  | postgres
    4295 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4011_DONE                                                                                   | postgres
    4296 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4011_DONE                                                                                   | postgres
    4297 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4011             | Rollback id = 4011.                                                                              | postgres
    4298 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4011             | 2 / 5 tables effectively processed.                                                              | postgres
    4299 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4011             | 1 / 2 sequences effectively processed.                                                           | postgres
    4300 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4301 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4011                                                                                 | postgres
    4302 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Logged rollback to mark Mark11 (timestamp)                                                       | postgres
    4303 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4304 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4305 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4306 | ROLLBACK_GROUP         | TIME STAMP SET             | 4040                         |                                                                                                  | postgres
    4307 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4012_START                                                                                  | postgres
    4308 | CLEANUP_RLBK_STATE     |                            | Rollback id 4011             | set to COMMITTED                                                                                 | postgres
    4309 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4012_START                                                                                  | postgres
    4310 | ROLLBACK_SEQUENCE      |                            | myschema1.mytbl2b_col20_seq  | RESTART 1                                                                                        | postgres
    4311 | ROLLBACK_TABLE         | BEGIN                      | myschema1."myTbl3"           | All log rows where emaj_gid > 4000039 and <= 4000080                                             | postgres
    4312 | ROLLBACK_TABLE         | END                        | myschema1."myTbl3"           | 10 rolled back primary keys                                                                      | postgres
    4313 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl1             | All log rows where emaj_gid > 4000039 and <= 4000080, in session_replication_role = replica mode | postgres
    4314 | ROLLBACK_TABLE         | END                        | myschema1.mytbl1             | 11 rolled back primary keys                                                                      | postgres
    4315 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2             | All log rows where emaj_gid > 4000039 and <= 4000080, in session_replication_role = replica mode | postgres
    4316 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2             | 2 rolled back primary keys                                                                       | postgres
    4317 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2b            | All log rows where emaj_gid > 4000039 and <= 4000080                                             | postgres
    4318 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2b            | 2 rolled back primary keys                                                                       | postgres
    4319 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl4             | All log rows where emaj_gid > 4000039 and <= 4000080, in session_replication_role = replica mode | postgres
    4320 | ROLLBACK_TABLE         | END                        | myschema1.mytbl4             | 1 rolled back primary keys                                                                       | postgres
    4321 | ROLLBACK_GROUP         | TIME STAMP SET             | 4041                         |                                                                                                  | postgres
    4322 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4012_DONE                                                                                   | postgres
    4323 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4012_DONE                                                                                   | postgres
    4324 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4012             | Rollback id = 4012.                                                                              | postgres
    4325 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4012             | 5 / 5 tables effectively processed.                                                              | postgres
    4326 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4012             | 1 / 2 sequences effectively processed.                                                           | postgres
    4327 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4328 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4012                                                                                 | postgres
    4329 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Unlogged rollback to mark Mark13 (timestamp)                                                     | postgres
    4330 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4331 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4332 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4333 | ROLLBACK_GROUP         | TIME STAMP SET             | 4042                         |                                                                                                  | postgres
    4334 | ROLLBACK_SEQUENCE      |                            | myschema1."myTbl3_col31_seq" | RESTART 11                                                                                       | postgres
    4335 | ROLLBACK_SEQUENCE      |                            | myschema1.mytbl2b_col20_seq  | RESTART 3                                                                                        | postgres
    4336 | ROLLBACK_TABLE         | BEGIN                      | myschema1."myTbl3"           | All log rows where emaj_gid > 4000069 and <= 4000094                                             | postgres
    4337 | ROLLBACK_TABLE         | END                        | myschema1."myTbl3"           | 10 rolled back primary keys                                                                      | postgres
    4338 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl1             | All log rows where emaj_gid > 4000069 and <= 4000094, in session_replication_role = replica mode | postgres
    4339 | ROLLBACK_TABLE         | END                        | myschema1.mytbl1             | 10 rolled back primary keys                                                                      | postgres
    4340 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2             | All log rows where emaj_gid > 4000069 and <= 4000094, in session_replication_role = replica mode | postgres
    4341 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2             | 2 rolled back primary keys                                                                       | postgres
    4342 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2b            | All log rows where emaj_gid > 4000069 and <= 4000094                                             | postgres
    4343 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2b            | 2 rolled back primary keys                                                                       | postgres
    4344 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl4             | All log rows where emaj_gid > 4000069 and <= 4000094, in session_replication_role = replica mode | postgres
    4345 | ROLLBACK_TABLE         | END                        | myschema1.mytbl4             | 1 rolled back primary keys                                                                       | postgres
    4346 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark RLBK_4011_START is deleted                                                                  | postgres
    4347 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark RLBK_4011_DONE is deleted                                                                   | postgres
    4348 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark RLBK_4012_START is deleted                                                                  | postgres
    4349 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark RLBK_4012_DONE is deleted                                                                   | postgres
    4350 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4013             | Rollback id = 4013.                                                                              | postgres
    4351 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4013             | 5 / 5 tables effectively processed.                                                              | postgres
    4352 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4013             | 2 / 2 sequences effectively processed.                                                           | postgres
    4353 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4354 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4013                                                                                 | postgres
    4355 | ROLLBACK_GROUP         | BEGIN                      | emptyGroup                   | Unlogged rollback to mark EGM4 (timestamp)                                                       | postgres
    4356 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4357 | LOCK_GROUP             | BEGIN                      | emptyGroup                   | Rollback session #1                                                                              | postgres
    4358 | LOCK_GROUP             | END                        | emptyGroup                   | Rollback session #1: 0 tables locked, 0 deadlock(s)                                              | postgres
    4359 | ROLLBACK_GROUP         | TIME STAMP SET             | 4043                         |                                                                                                  | postgres
    4360 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4014             | Rollback id = 4014.                                                                              | postgres
    4361 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4014             | no table and sequence to process                                                                 | postgres
    4362 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4363 | ROLLBACK_GROUP         | END                        | emptyGroup                   | Rollback_id 4014                                                                                 | postgres
    4364 | ROLLBACK_GROUP         | BEGIN                      | emptyGroup                   | Logged rollback to mark EGM3 (timestamp)                                                         | postgres
    4365 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4366 | LOCK_GROUP             | BEGIN                      | emptyGroup                   | Rollback session #1                                                                              | postgres
    4367 | LOCK_GROUP             | END                        | emptyGroup                   | Rollback session #1: 0 tables locked, 0 deadlock(s)                                              | postgres
    4368 | ROLLBACK_GROUP         | TIME STAMP SET             | 4044                         |                                                                                                  | postgres
    4369 | SET_MARK_GROUP         | BEGIN                      | emptyGroup                   | RLBK_4015_START                                                                                  | postgres
    4370 | CLEANUP_RLBK_STATE     |                            | Rollback id 4012             | set to COMMITTED                                                                                 | postgres
    4371 | CLEANUP_RLBK_STATE     |                            | Rollback id 4013             | set to COMMITTED                                                                                 | postgres
    4372 | CLEANUP_RLBK_STATE     |                            | Rollback id 4014             | set to COMMITTED                                                                                 | postgres
    4373 | SET_MARK_GROUP         | END                        | emptyGroup                   | RLBK_4015_START                                                                                  | postgres
    4374 | ROLLBACK_GROUP         | TIME STAMP SET             | 4045                         |                                                                                                  | postgres
    4375 | SET_MARK_GROUP         | BEGIN                      | emptyGroup                   | RLBK_4015_DONE                                                                                   | postgres
    4376 | SET_MARK_GROUP         | END                        | emptyGroup                   | RLBK_4015_DONE                                                                                   | postgres
    4377 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4015             | Rollback id = 4015.                                                                              | postgres
    4378 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4015             | no table and sequence to process                                                                 | postgres
    4379 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4380 | ROLLBACK_GROUP         | END                        | emptyGroup                   | Rollback_id 4015                                                                                 | postgres
    4381 | ASSIGN_TABLE           | BEGIN                      |                              |                                                                                                  | postgres
    4382 | ASSIGN_TABLE           | TIME STAMP SET             | 4046                         |                                                                                                  | postgres
    4383 | ASSIGN_TABLE           | TABLE ADDED                | myschema4.mytblr2            | To the idle group myGroup4                                                                       | postgres
    4384 | ASSIGN_TABLE           | END                        |                              | 1 tables assigned to the group myGroup4                                                          | postgres
    4385 | START_GROUP            | BEGIN                      | myGroup4                     | With log reset                                                                                   | postgres
    4386 | START_GROUP            | TIME STAMP SET             | 4047                         |                                                                                                  | postgres
    4387 | LOCK_GROUP             | BEGIN                      | myGroup4                     |                                                                                                  | postgres
    4388 | LOCK_GROUP             | END                        | myGroup4                     | 7 tables locked, 0 deadlock(s)                                                                   | postgres
    4389 | SET_MARK_GROUP         | BEGIN                      | myGroup4                     | myGroup4_start                                                                                   | postgres
    4390 | CLEANUP_RLBK_STATE     |                            | Rollback id 4015             | set to COMMITTED                                                                                 | postgres
    4391 | SET_MARK_GROUP         | END                        | myGroup4                     | myGroup4_start                                                                                   | postgres
    4392 | START_GROUP            | END                        | myGroup4                     | 7 tables/sequences processed                                                                     | postgres
    4393 | SET_MARK_GROUP         | BEGIN                      | myGroup4                     |                                                                                                  | postgres
    4394 | LOCK_GROUP             | BEGIN                      | myGroup4                     |                                                                                                  | postgres
    4395 | LOCK_GROUP             | END                        | myGroup4                     | 7 tables locked, 0 deadlock(s)                                                                   | postgres
    4396 | SET_MARK_GROUP         | TIME STAMP SET             | 4048                         |                                                                                                  | postgres
    4397 | SET_MARK_GROUP         | END                        | myGroup4                     | mark1                                                                                            | postgres
    4402 | ROLLBACK_GROUP         | BEGIN                      | myGroup4                     | Logged rollback to mark mark1 (timestamp)                                                        | postgres
    4403 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 0                                                                                       | postgres
    4404 | LOCK_GROUP             | BEGIN                      | myGroup4                     | Rollback session #1                                                                              | postgres
    4405 | LOCK_GROUP             | END                        | myGroup4                     | Rollback session #1: 7 tables locked, 0 deadlock(s)                                              | postgres
    4406 | ROLLBACK_GROUP         | TIME STAMP SET             | 4049                         |                                                                                                  | postgres
    4407 | SET_MARK_GROUP         | BEGIN                      | myGroup4                     | RLBK_4018_START                                                                                  | postgres
    4408 | CLEANUP_RLBK_STATE     |                            | Rollback id 4016             | set to ABORTED                                                                                   | postgres
    4409 | CLEANUP_RLBK_STATE     |                            | Rollback id 4017             | set to ABORTED                                                                                   | postgres
    4410 | SET_MARK_GROUP         | END                        | myGroup4                     | RLBK_4018_START                                                                                  | postgres
    4411 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mypartp2           | All log rows where emaj_gid > 4000102 and <= 4000112                                             | postgres
    4412 | ROLLBACK_TABLE         | END                        | myschema4.mypartp2           | 2 rolled back primary keys                                                                       | postgres
    4413 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblr2            | All log rows where emaj_gid > 4000102 and <= 4000112, in session_replication_role = replica mode | postgres
    4414 | ROLLBACK_TABLE         | END                        | myschema4.mytblr2            | 1 rolled back primary keys                                                                       | postgres
    4415 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mypartp1b          | All log rows where emaj_gid > 4000102 and <= 4000112                                             | postgres
    4416 | ROLLBACK_TABLE         | END                        | myschema4.mypartp1b          | 1 rolled back primary keys                                                                       | postgres
    4417 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblc1            | All log rows where emaj_gid > 4000102 and <= 4000112                                             | postgres
    4418 | ROLLBACK_TABLE         | END                        | myschema4.mytblc1            | 2 rolled back primary keys                                                                       | postgres
    4419 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblc2            | All log rows where emaj_gid > 4000102 and <= 4000112                                             | postgres
    4420 | ROLLBACK_TABLE         | END                        | myschema4.mytblc2            | 2 rolled back primary keys                                                                       | postgres
    4421 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblm             | All log rows where emaj_gid > 4000102 and <= 4000112                                             | postgres
    4422 | ROLLBACK_TABLE         | END                        | myschema4.mytblm             | 2 rolled back primary keys                                                                       | postgres
    4423 | ROLLBACK_GROUP         | TIME STAMP SET             | 4050                         |                                                                                                  | postgres
    4424 | SET_MARK_GROUP         | BEGIN                      | myGroup4                     | RLBK_4018_DONE                                                                                   | postgres
    4425 | SET_MARK_GROUP         | END                        | myGroup4                     | RLBK_4018_DONE                                                                                   | postgres
    4426 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4018             | Rollback id = 4018.                                                                              | postgres
    4427 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4018             | 6 / 7 tables effectively processed.                                                              | postgres
    4428 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4429 | ROLLBACK_GROUP         | END                        | myGroup4                     | Rollback_id 4018                                                                                 | postgres
    4430 | ROLLBACK_GROUP         | BEGIN                      | myGroup4                     | Unlogged rollback to mark myGroup4_start (timestamp)                                             | postgres
    4431 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4432 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 0                                                                                       | postgres
    4433 | LOCK_GROUP             | BEGIN                      | myGroup4                     | Rollback session #1                                                                              | postgres
    4434 | LOCK_GROUP             | END                        | myGroup4                     | Rollback session #1: 7 tables locked, 0 deadlock(s)                                              | postgres
    4435 | ROLLBACK_GROUP         | TIME STAMP SET             | 4051                         |                                                                                                  | postgres
    4436 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mypartp2           | All log rows where emaj_gid > 4000094 and <= 4000120                                             | postgres
    4437 | ROLLBACK_TABLE         | END                        | myschema4.mypartp2           | 3 rolled back primary keys                                                                       | postgres
    4438 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblr2            | All log rows where emaj_gid > 4000094 and <= 4000120, in session_replication_role = replica mode | postgres
    4439 | ROLLBACK_TABLE         | END                        | myschema4.mytblr2            | 1 rolled back primary keys                                                                       | postgres
    4440 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mypartp1b          | All log rows where emaj_gid > 4000094 and <= 4000120                                             | postgres
    4441 | ROLLBACK_TABLE         | END                        | myschema4.mypartp1b          | 2 rolled back primary keys                                                                       | postgres
    4442 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblc1            | All log rows where emaj_gid > 4000094 and <= 4000120                                             | postgres
    4443 | ROLLBACK_TABLE         | END                        | myschema4.mytblc1            | 2 rolled back primary keys                                                                       | postgres
    4444 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblc2            | All log rows where emaj_gid > 4000094 and <= 4000120                                             | postgres
    4445 | ROLLBACK_TABLE         | END                        | myschema4.mytblc2            | 2 rolled back primary keys                                                                       | postgres
    4446 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mytblm             | All log rows where emaj_gid > 4000094 and <= 4000120                                             | postgres
    4447 | ROLLBACK_TABLE         | END                        | myschema4.mytblm             | 2 rolled back primary keys                                                                       | postgres
    4448 | ROLLBACK_TABLE         | BEGIN                      | myschema4.mypartp1a          | All log rows where emaj_gid > 4000094 and <= 4000120                                             | postgres
    4449 | ROLLBACK_TABLE         | END                        | myschema4.mypartp1a          | 1 rolled back primary keys                                                                       | postgres
    4450 | ROLLBACK_GROUP         | MARK DELETED               | myGroup4                     | mark mark1 is deleted                                                                            | postgres
    4451 | ROLLBACK_GROUP         | MARK DELETED               | myGroup4                     | mark RLBK_4018_START is deleted                                                                  | postgres
    4452 | ROLLBACK_GROUP         | MARK DELETED               | myGroup4                     | mark RLBK_4018_DONE is deleted                                                                   | postgres
    4453 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4019             | Rollback id = 4019.                                                                              | postgres
    4454 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4019             | 7 / 7 tables effectively processed.                                                              | postgres
    4455 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4456 | ROLLBACK_GROUP         | END                        | myGroup4                     | Rollback_id 4019                                                                                 | postgres
    4457 | COMMENT_ROLLBACK       |                            | 4000                         |                                                                                                  | postgres
    4458 | COMMENT_ROLLBACK       |                            | 4000                         |                                                                                                  | postgres
    4459 | COMMENT_ROLLBACK       |                            | 4000                         |                                                                                                  | postgres
    4461 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4462 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4463 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4464 | SET_MARK_GROUP         | TIME STAMP SET             | 4052                         |                                                                                                  | postgres
    4465 | CLEANUP_RLBK_STATE     |                            | Rollback id 4018             | set to COMMITTED                                                                                 | postgres
    4466 | CLEANUP_RLBK_STATE     |                            | Rollback id 4019             | set to COMMITTED                                                                                 | postgres
    4467 | SET_MARK_GROUP         | END                        | myGroup1                     | Conso_M1                                                                                         | postgres
    4468 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Logged rollback to mark Conso_M1 (timestamp)                                                     | postgres
    4469 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4470 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4471 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4472 | ROLLBACK_GROUP         | TIME STAMP SET             | 4053                         |                                                                                                  | postgres
    4473 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4020_START                                                                                  | postgres
    4474 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4020_START                                                                                  | postgres
    4475 | ROLLBACK_GROUP         | TIME STAMP SET             | 4054                         |                                                                                                  | postgres
    4476 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4020_DONE                                                                                   | postgres
    4477 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4020_DONE                                                                                   | postgres
    4478 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4020             | Rollback id = 4020.                                                                              | postgres
    4479 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4020             | 0 / 5 tables effectively processed.                                                              | postgres
    4480 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4020             | 0 / 2 sequences effectively processed.                                                           | postgres
    4481 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4482 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4020                                                                                 | postgres
    4483 | CONSOLIDATE_RLBK_GROUP | BEGIN                      | myGroup1                     | Erase all between marks Conso_M1 and RLBK_4020_DONE                                              | postgres
    4484 | CONSOLIDATE_RLBK_GROUP | END                        | myGroup1                     | 0 tables and 2 sequences processed ; 1 marks deleted                                             | postgres
    4485 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4486 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4487 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4488 | SET_MARK_GROUP         | TIME STAMP SET             | 4055                         |                                                                                                  | postgres
    4489 | CLEANUP_RLBK_STATE     |                            | Rollback id 4020             | set to COMMITTED                                                                                 | postgres
    4490 | SET_MARK_GROUP         | END                        | myGroup1                     | Conso_M2                                                                                         | postgres
    4491 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4492 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4493 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4494 | SET_MARK_GROUP         | TIME STAMP SET             | 4056                         |                                                                                                  | postgres
    4495 | SET_MARK_GROUP         | END                        | myGroup1                     | Conso_M3                                                                                         | postgres
    4496 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Logged rollback to mark Conso_M2 (timestamp)                                                     | postgres
    4497 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4498 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4499 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4500 | ROLLBACK_GROUP         | TIME STAMP SET             | 4057                         |                                                                                                  | postgres
    4501 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4021_START                                                                                  | postgres
    4502 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4021_START                                                                                  | postgres
    4503 | ROLLBACK_SEQUENCE      |                            | myschema1.mytbl2b_col20_seq  | RESTART 3                                                                                        | postgres
    4504 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl1             | All log rows where emaj_gid > 4000120 and <= 4000137, in session_replication_role = replica mode | postgres
    4505 | ROLLBACK_TABLE         | END                        | myschema1.mytbl1             | 12 rolled back primary keys                                                                      | postgres
    4506 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2             | All log rows where emaj_gid > 4000120 and <= 4000137, in session_replication_role = replica mode | postgres
    4507 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2             | 1 rolled back primary keys                                                                       | postgres
    4508 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2b            | All log rows where emaj_gid > 4000120 and <= 4000137                                             | postgres
    4509 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2b            | 2 rolled back primary keys                                                                       | postgres
    4510 | ROLLBACK_GROUP         | TIME STAMP SET             | 4058                         |                                                                                                  | postgres
    4511 | SET_MARK_GROUP         | BEGIN                      | myGroup1                     | RLBK_4021_DONE                                                                                   | postgres
    4512 | SET_MARK_GROUP         | END                        | myGroup1                     | RLBK_4021_DONE                                                                                   | postgres
    4513 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4021             | Rollback id = 4021.                                                                              | postgres
    4514 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4021             | 3 / 5 tables effectively processed.                                                              | postgres
    4515 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4021             | 1 / 2 sequences effectively processed.                                                           | postgres
    4516 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4517 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4021                                                                                 | postgres
    4518 | RENAME_MARK_GROUP      | BEGIN                      | myGroup1                     | Conso_M2                                                                                         | postgres
    4519 | RENAME_MARK_GROUP      | END                        | myGroup1                     | Conso_M2 renamed Renamed_conso_M2                                                                | postgres
    4520 | RENAME_MARK_GROUP      | BEGIN                      | myGroup1                     | EMAJ_LAST_MARK                                                                                   | postgres
    4521 | RENAME_MARK_GROUP      | END                        | myGroup1                     | RLBK_4021_DONE renamed Renamed_last_mark                                                         | postgres
    4522 | CONSOLIDATE_RLBK_GROUP | BEGIN                      | myGroup1                     | Erase all between marks Renamed_conso_M2 and Renamed_last_mark                                   | postgres
    4523 | CONSOLIDATE_RLBK_GROUP | END                        | myGroup1                     | 3 tables and 2 sequences processed ; 2 marks deleted                                             | postgres
    4524 | CONSOLIDATE_RLBK_GROUP | BEGIN                      | myGroup1                     | Erase all between marks Renamed_conso_M2 and Renamed_last_mark                                   | postgres
    4525 | CONSOLIDATE_RLBK_GROUP | END                        | myGroup1                     | 0 tables and 2 sequences processed ; 0 marks deleted                                             | postgres
    4526 | ROLLBACK_GROUP         | BEGIN                      | myGroup1                     | Unlogged rollback to mark Conso_M1 (timestamp)                                                   | postgres
    4527 | DBLINK_OPEN_CNX        |                            | rlbk#1                       | Status = 1                                                                                       | postgres
    4528 | LOCK_GROUP             | BEGIN                      | myGroup1                     | Rollback session #1                                                                              | postgres
    4529 | LOCK_GROUP             | END                        | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                              | postgres
    4530 | ROLLBACK_GROUP         | TIME STAMP SET             | 4059                         |                                                                                                  | postgres
    4531 | ROLLBACK_SEQUENCE      |                            | myschema1.mytbl2b_col20_seq  | RESTART 3                                                                                        | postgres
    4532 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2             | All log rows where emaj_gid > 4000120 and <= 4000153, in session_replication_role = replica mode | postgres
    4533 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2             | 1 rolled back primary keys                                                                       | postgres
    4534 | ROLLBACK_TABLE         | BEGIN                      | myschema1.mytbl2b            | All log rows where emaj_gid > 4000120 and <= 4000153                                             | postgres
    4535 | ROLLBACK_TABLE         | END                        | myschema1.mytbl2b            | 1 rolled back primary keys                                                                       | postgres
    4536 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark RLBK_4020_DONE is deleted                                                                   | postgres
    4537 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark Renamed_conso_M2 is deleted                                                                 | postgres
    4538 | ROLLBACK_GROUP         | MARK DELETED               | myGroup1                     | mark Renamed_last_mark is deleted                                                                | postgres
    4539 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4022             | Rollback id = 4022.                                                                              | postgres
    4540 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4022             | 2 / 5 tables effectively processed.                                                              | postgres
    4541 | ROLLBACK_GROUP         | NOTICE                     | Rollback id 4022             | 1 / 2 sequences effectively processed.                                                           | postgres
    4542 | DBLINK_CLOSE_CNX       |                            | rlbk#1                       |                                                                                                  | postgres
    4543 | ROLLBACK_GROUP         | END                        | myGroup1                     | Rollback_id 4022                                                                                 | postgres
    4544 | MODIFY_TABLE           | BEGIN                      |                              |                                                                                                  | postgres
    4545 | MODIFY_TABLE           | TIME STAMP SET             | 4060                         |                                                                                                  | postgres
    4546 | LOCK_GROUP             | BEGIN                      | myGroup1                     |                                                                                                  | postgres
    4547 | LOCK_GROUP             | END                        | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                   | postgres
    4548 | SET_MARK_GROUPS        | BEGIN                      | myGroup1                     | MODIFY_%                                                                                         | postgres
    4549 | CLEANUP_RLBK_STATE     |                            | Rollback id 4021             | set to COMMITTED                                                                                 | postgres
    4550 | CLEANUP_RLBK_STATE     |                            | Rollback id 4022             | set to COMMITTED                                                                                 | postgres
    4551 | SET_MARK_GROUPS        | END                        | myGroup1                     | MODIFY_%                                                                                         | postgres
    4552 | MODIFY_TABLE           | TRIGGERS TO IGNORE CHANGED | myschema1.mytbl2             | {mytbl2trg2} => none                                                                             | postgres
    4553 | MODIFY_TABLE           | END                        |                              | 1 tables effectively modified                                                                    | postgres
    4585 | CLEANUP_RLBK_STATE     |                            | Rollback id 4023             | set to ABORTED                                                                                   | postgres
    4586 | ASSIGN_TABLE           | BEGIN                      |                              |                                                                                                  | postgres
    4587 | ASSIGN_TABLE           | TIME STAMP SET             | 4065                         |                                                                                                  | postgres
    4588 | LOCK_GROUP             | BEGIN                      | myGroup4                     |                                                                                                  | postgres
    4589 | LOCK_GROUP             | END                        | myGroup4                     | 7 tables locked, 0 deadlock(s)                                                                   | postgres
    4590 | SET_MARK_GROUP         | BEGIN                      | myGroup4                     | Assign mytblr1                                                                                   | postgres
    4591 | SET_MARK_GROUP         | END                        | myGroup4                     | Assign mytblr1                                                                                   | postgres
    4592 | ASSIGN_TABLE           | TABLE ADDED                | myschema4.mytblr1            | To the logging group myGroup4                                                                    | postgres
    4593 | ASSIGN_TABLE           | END                        |                              | 1 tables assigned to the group myGroup4                                                          | postgres
    4594 | ENABLE_PROTECTION      | EVENT TRIGGERS ENABLED     |                              | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                   | postgres
(490 rows)

