-- alterLogging.sql : test groups structure changes with groups in LOGGING state
--
-- It follows alter.sql that tests the same functions but with groups in IDLE state.
-- It uses the same tables and groups, and the same sequences range
-- It includes the final checks for both alter.sql and alterLogging.sql scenarios
-- set sequence restart value
select public.handle_emaj_sequences(9000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-- define and create the temp file directory to be used by the script
\setenv EMAJTESTTMPDIR '/tmp/emaj_'`echo $PGVER`'/alter_logging'
\set EMAJTESTTMPDIR `echo $EMAJTESTTMPDIR`
\! mkdir -p $EMAJTESTTMPDIR
select emaj.emaj_remove_tables('myschema2', array['mytbl7','mytbl8']);
 emaj_remove_tables 
--------------------
                  2
(1 row)

select emaj.emaj_start_groups('{"myGroup1","myGroup2"}','Mk1');
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup1,myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup1,myGroup2).
 emaj_start_groups 
-------------------
                15
(1 row)

-- Save the groups configuration
select emaj.emaj_export_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json');
 emaj_export_groups_configuration 
----------------------------------
                                5
(1 row)

-----------------------------
-- change attributes
-----------------------------
-- bad mark (duplicate name)
select emaj.emaj_modify_table('myschema1','mytbl1','{"priority":30}'::jsonb,emaj.emaj_get_previous_mark_group('myGroup1',now()));
ERROR:  _check_new_mark: The group "myGroup1" already contains a mark named "Mk1".
CONTEXT:  PL/pgSQL function emaj._check_new_mark(text[],text) line 29 at RAISE
SQL statement "SELECT emaj._check_new_mark(v_loggingGroups, p_mark)"
PL/pgSQL function emaj._modify_tables(text,text[],jsonb,text,boolean,boolean) line 53 at SQL statement
PL/pgSQL function emaj.emaj_modify_table(text,text,jsonb,text) line 7 at RETURN
-- change the priority
select emaj.emaj_modify_table('myschema1','mytbl1','{"priority":30}'::jsonb,'Priority Changed');
 emaj_modify_table 
-------------------
                 1
(1 row)

-- change the log data tablespace and the log index tablespace for different tables
set default_tablespace = tspemaj_renamed;
select emaj.emaj_modify_table('myschema1','mytbl2b','{"log_data_tablespace":null}'::jsonb,'Attributes_changed_1');
 emaj_modify_table 
-------------------
                 1
(1 row)

select emaj.emaj_modify_table('myschema2','mytbl6','{"log_index_tablespace":"tsplog1"}'::jsonb,'Attributes_changed_2');
 emaj_modify_table 
-------------------
                 1
(1 row)

reset default_tablespace;
-- change the triggers to ignore at rollback time
select emaj.emaj_modify_table('myschema1','mytbl2','{"ignored_triggers_profiles":["trg1", "trg2"]}');
 emaj_modify_table 
-------------------
                 1
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_ignored_triggers from emaj.emaj_relation where rel_ignored_triggers is not null order by 1,2,3;
 rel_schema | rel_tblseq | rel_time_range |  rel_ignored_triggers   
------------+------------+----------------+-------------------------
 myschema1  | mytbl2     | [8203,)        | {mytbl2trg1,mytbl2trg2}
(1 row)

-- perform some operations: set an intermediate mark, update myTbl3 and rollback
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Mk2');
 emaj_set_mark_groups 
----------------------
                   15
(1 row)

insert into myschema1."myTbl3" values (11, now(), 11.0);
update myschema2."myTbl3" set col33 = 11.0 where col31 = 10;
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mk2');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 9000.
 Notice        | 2 / 11 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

-- revert the properties changes
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json', '{"myGroup1","myGroup2"}', true);
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup1,myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup1,myGroup2).
 emaj_import_groups_configuration 
----------------------------------
                                2
(1 row)

-- checks for attributes changes
select * from emaj.emaj_relation_change where rlchg_time_id >= 9000 order by 1,2,3,4;
 rlchg_time_id | rlchg_schema | rlchg_tblseq |      rlchg_change_kind      | rlchg_group | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers  | rlchg_new_ignored_triggers 
---------------+--------------+--------------+-----------------------------+-------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+-------------------------+----------------------------
          9000 | myschema2    | mytbl7       | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                         | 
          9000 | myschema2    | mytbl8       | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                         | 
          9002 | myschema1    | mytbl1       | CHANGE_PRIORITY             | myGroup1    |                  |                  |                 |             20 |                 30 |                    |                        |                     |                         |                         | 
          9003 | myschema1    | mytbl2b      | CHANGE_LOG_DATA_TABLESPACE  | myGroup1    |                  |                  |                 |                |                    | tsp log'2          |                        |                     |                         |                         | 
          9004 | myschema2    | mytbl6       | CHANGE_LOG_INDEX_TABLESPACE | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     | tsplog1                 |                         | 
          9005 | myschema1    | mytbl2       | CHANGE_IGNORED_TRIGGERS     | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                         | {mytbl2trg1,mytbl2trg2}
          9008 | myschema1    | mytbl1       | CHANGE_PRIORITY             | myGroup1    |                  |                  |                 |             30 |                 20 |                    |                        |                     |                         |                         | 
          9008 | myschema1    | mytbl2       | CHANGE_IGNORED_TRIGGERS     | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         | {mytbl2trg1,mytbl2trg2} | 
          9008 | myschema1    | mytbl2b      | CHANGE_LOG_DATA_TABLESPACE  | myGroup1    |                  |                  |                 |                |                    |                    | tsp log'2              |                     |                         |                         | 
          9008 | myschema2    | mytbl6       | CHANGE_LOG_INDEX_TABLESPACE | myGroup2    |                  |                  |                 |                |                    |                    |                        | tsplog1             |                         |                         | 
(10 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 9000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    9000 |            9000000 | A
    9001 |            9000000 | S
    9002 |            9000000 | A
    9003 |            9000000 | A
    9004 |            9000000 | A
    9005 |            9000000 | A
    9006 |            9000000 | M
    9007 |            9000002 | R
    9008 |            9000002 | I
(9 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist where hist_id >= 9000 order by hist_id;
   hist_function    |          hist_event          |    hist_object     |                        regexp_replace                         | hist_user 
--------------------+------------------------------+--------------------+---------------------------------------------------------------+-----------
 REMOVE_TABLES      | BEGIN                        |                    |                                                               | postgres
 REMOVE_TABLES      | TIME STAMP SET               | 9000               |                                                               | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2.mytbl7   | From the idle group myGroup2                                  | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2.mytbl8   | From the idle group myGroup2                                  | postgres
 REMOVE_TABLES      | END                          |                    | 2 tables removed from their groups                            | postgres
 START_GROUPS       | BEGIN                        | myGroup1,myGroup2  | With log reset                                                | postgres
 START_GROUPS       | TIME STAMP SET               | 9001               |                                                               | postgres
 LOCK_GROUPS        | BEGIN                        | myGroup1,myGroup2  |                                                               | postgres
 LOCK_GROUPS        | END                          | myGroup1,myGroup2  | 11 tables locked, 0 deadlock(s)                               | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2  | Mk1                                                           | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2  | Mk1                                                           | postgres
 START_GROUPS       | END                          | myGroup1,myGroup2  | 15 tables/sequences processed                                 | postgres
 MODIFY_TABLE       | BEGIN                        |                    |                                                               | postgres
 MODIFY_TABLE       | TIME STAMP SET               | 9002               |                                                               | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1           |                                                               | postgres
 LOCK_GROUP         | END                          | myGroup1           | 5 tables locked, 0 deadlock(s)                                | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1           | Priority Changed                                              | postgres
 SET_MARK_GROUPS    | END                          | myGroup1           | Priority Changed                                              | postgres
 MODIFY_TABLE       | PRIORITY CHANGED             | myschema1.mytbl1   | 20 => 30                                                      | postgres
 MODIFY_TABLE       | END                          |                    | 1 tables effectively modified                                 | postgres
 MODIFY_TABLE       | BEGIN                        |                    |                                                               | postgres
 MODIFY_TABLE       | TIME STAMP SET               | 9003               |                                                               | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1           |                                                               | postgres
 LOCK_GROUP         | END                          | myGroup1           | 5 tables locked, 0 deadlock(s)                                | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1           | Attributes_changed_1                                          | postgres
 SET_MARK_GROUPS    | END                          | myGroup1           | Attributes_changed_1                                          | postgres
 MODIFY_TABLE       | LOG DATA TABLESPACE CHANGED  | myschema1.mytbl2b  | tsp log'2 => Default tablespace                               | postgres
 MODIFY_TABLE       | END                          |                    | 1 tables effectively modified                                 | postgres
 MODIFY_TABLE       | BEGIN                        |                    |                                                               | postgres
 MODIFY_TABLE       | TIME STAMP SET               | 9004               |                                                               | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2           |                                                               | postgres
 LOCK_GROUP         | END                          | myGroup2           | 6 tables locked, 0 deadlock(s)                                | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup2           | Attributes_changed_2                                          | postgres
 SET_MARK_GROUPS    | END                          | myGroup2           | Attributes_changed_2                                          | postgres
 MODIFY_TABLE       | LOG INDEX TABLESPACE CHANGED | myschema2.mytbl6   | Default tablespace => tsplog1                                 | postgres
 MODIFY_TABLE       | END                          |                    | 1 tables effectively modified                                 | postgres
 MODIFY_TABLE       | BEGIN                        |                    |                                                               | postgres
 MODIFY_TABLE       | TIME STAMP SET               | 9005               |                                                               | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1           |                                                               | postgres
 LOCK_GROUP         | END                          | myGroup1           | 5 tables locked, 0 deadlock(s)                                | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1           | MODIFY_%                                                      | postgres
 SET_MARK_GROUPS    | END                          | myGroup1           | MODIFY_%                                                      | postgres
 MODIFY_TABLE       | TRIGGERS TO IGNORE CHANGED   | myschema1.mytbl2   | none => {mytbl2trg1,mytbl2trg2}                               | postgres
 MODIFY_TABLE       | END                          |                    | 1 tables effectively modified                                 | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2  | Mk2                                                           | postgres
 LOCK_GROUPS        | BEGIN                        | myGroup1,myGroup2  |                                                               | postgres
 LOCK_GROUPS        | END                          | myGroup1,myGroup2  | 11 tables locked, 0 deadlock(s)                               | postgres
 SET_MARK_GROUPS    | TIME STAMP SET               | 9006               |                                                               | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2  | Mk2                                                           | postgres
 ROLLBACK_GROUPS    | BEGIN                        | myGroup1,myGroup2  | Unlogged rollback to mark Mk2 (timestamp)                     | postgres
 DBLINK_OPEN_CNX    |                              | rlbk#1             | Status = 1                                                    | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2  | Rollback session #1                                           | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2  | Rollback session #1: 11 tables locked, 0 deadlock(s)          | postgres
 ROLLBACK_GROUPS    | TIME STAMP SET               | 9007               |                                                               | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema1."myTbl3" | All log rows where emaj_gid > 9000000 and <= 9000002          | postgres
 ROLLBACK_TABLE     | END                          | myschema1."myTbl3" | 1 rolled back primary keys                                    | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema2."myTbl3" | All log rows where emaj_gid > 9000000 and <= 9000002          | postgres
 ROLLBACK_TABLE     | END                          | myschema2."myTbl3" | 1 rolled back primary keys                                    | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 9000   | Rollback id = 9000.                                           | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 9000   | 2 / 11 tables effectively processed.                          | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 9000   | 0 / 4 sequences effectively processed.                        | postgres
 DBLINK_CLOSE_CNX   |                              | rlbk#1             |                                                               | postgres
 ROLLBACK_GROUPS    | END                          | myGroup1,myGroup2  | Rollback_id 9000                                              | postgres
 IMPORT_GROUPS      | BEGIN                        | myGroup1, myGroup2 | Input file: '/tmp/emaj_15/alter_logging/all_groups_conf.json' | postgres
 IMPORT_GROUPS      | TIME STAMP SET               | 9008               |                                                               | postgres
 LOCK_GROUPS        | BEGIN                        | myGroup1,myGroup2  |                                                               | postgres
 LOCK_GROUPS        | END                          | myGroup1,myGroup2  | 11 tables locked, 0 deadlock(s)                               | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2  | IMPORT_%                                                      | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 9000   | set to COMMITTED                                              | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2  | IMPORT_%                                                      | postgres
 IMPORT_GROUPS      | PRIORITY CHANGED             | myschema1.mytbl1   | 30 => 20                                                      | postgres
 IMPORT_GROUPS      | LOG DATA TABLESPACE CHANGED  | myschema1.mytbl2b  | Default tablespace => tsp log'2                               | postgres
 IMPORT_GROUPS      | LOG INDEX TABLESPACE CHANGED | myschema2.mytbl6   | tsplog1 => Default tablespace                                 | postgres
 IMPORT_GROUPS      | TRIGGERS TO IGNORE CHANGED   | myschema1.mytbl2   | {mytbl2trg1,mytbl2trg2} => none                               | postgres
 IMPORT_GROUPS      | END                          |                    | 2 created or altered tables groups                            | postgres
(75 rows)

-- set sequence restart value
select public.handle_emaj_sequences(9100);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- add sequences
-----------------------------
-- add myschema2.mySeq2 to the myGroup2 group
-- first perform changes and set marks
select emaj.emaj_set_mark_group('myGroup2','ADD_SEQ test');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

select nextval('myschema2.myseq2');
 nextval 
---------
       1
(1 row)

select emaj.emaj_set_mark_group('myGroup2','Before ADD_SEQ');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

select nextval('myschema2.myseq2');
 nextval 
---------
       2
(1 row)

-- then add the sequence to the group
select emaj.emaj_assign_sequence('myschema2', 'myseq2', 'myGroup2', 'Add myseq2');
 emaj_assign_sequence 
----------------------
                    1
(1 row)

select group_name, group_last_alter_time_id, group_nb_table, group_nb_sequence
  from emaj.emaj_group where group_name = 'myGroup2';
 group_name | group_last_alter_time_id | group_nb_table | group_nb_sequence 
------------+--------------------------+----------------+-------------------
 myGroup2   |                     9102 |              6 |                 3
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
  from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq = 'myseq2' order by rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind 
------------+------------+----------------+-----------+----------
 myschema2  | myseq2     | [9102,)        | myGroup2  | S
(1 row)

select * from emaj.emaj_sequence where sequ_name = 'myseq2';
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
(1 row)

-- perform some other updates
select nextval('myschema2.myseq2');
 nextval 
---------
       3
(1 row)

select emaj.emaj_set_mark_group('myGroup2','After ADD_SEQ');
 emaj_set_mark_group 
---------------------
                   9
(1 row)

select nextval('myschema2.myseq2');
 nextval 
---------
       4
(1 row)

select nextval('myschema2.myseq2');
 nextval 
---------
       5
(1 row)

-- get statistics
select stat_group, stat_schema, stat_sequence, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_increments, stat_has_structure_changed
  from emaj.emaj_sequence_stat_group('myGroup2', 'ADD_SEQ test', NULL)
  order by stat_group, stat_schema, stat_sequence, stat_first_mark_datetime;
 stat_group | stat_schema |  stat_sequence   | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_increments | stat_has_structure_changed 
------------+-------------+------------------+-----------------+--------------------+----------------+-------------------+-----------------+----------------------------
 myGroup2   | myschema2   | myTbl3_col31_seq | ADD_SEQ test    |               9100 |                |                   |               0 | f
 myGroup2   | myschema2   | myseq1           | ADD_SEQ test    |               9100 |                |                   |               0 | f
 myGroup2   | myschema2   | myseq2           | Add myseq2      |               9102 |                |                   |               3 | f
(3 rows)

select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_increments, stat_has_structure_changed, stat_rollbacks
  from emaj.emaj_log_stat_sequence('myschema2', 'myseq2', 'myGroup2', 'Mk1');
 stat_group | stat_first_mark | stat_is_log_start | stat_last_mark  | stat_is_log_stop | stat_increments | stat_has_structure_changed | stat_rollbacks 
------------+-----------------+-------------------+-----------------+------------------+-----------------+----------------------------+----------------
 myGroup2   | Add myseq2      | t                 | After ADD_SEQ   | f                |               1 | f                          |              0
 myGroup2   | After ADD_SEQ   | f                 | [current state] | f                |               2 | f                          |              0
(2 rows)

--testing snap, dump changes and sql generation
\! mkdir $EMAJTESTTMPDIR/snap
select emaj.emaj_snap_group('myGroup2',:'EMAJTESTTMPDIR' || '/snap','');
 emaj_snap_group 
-----------------
               9
(1 row)

\! cat $EMAJTESTTMPDIR/snap/myschema2_myseq2.snap
myseq2	5	1	1	9223372036854775807	1	1	f	t
\! rm $EMAJTESTTMPDIR/snap/*
select emaj.emaj_gen_sql_dump_changes_group('myGroup2','Mk1','After ADD_SEQ','SEQUENCES_ONLY',NULL);
                    emaj_gen_sql_dump_changes_group                    
-----------------------------------------------------------------------
 3 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

select sql_text from emaj_temp_sql where sql_line_number = 0;
                                                               sql_text                                                                
---------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup2" between marks "Mk1" and "After ADD_SEQ" using options: SEQUENCES_ONLY
 -- Dump changes for sequence myschema2.myTbl3_col31_seq between marks "Mk1" and "After ADD_SEQ"
 -- Dump changes for sequence myschema2.myseq1 between marks "Mk1" and "After ADD_SEQ"
 -- Dump changes for sequence myschema2.myseq2 between marks "Add myseq2" and "After ADD_SEQ"
(4 rows)

select emaj.emaj_gen_sql_group('myGroup2', 'Before ADD_SEQ', NULL, :'EMAJTESTTMPDIR' || '/myFile');
 emaj_gen_sql_group 
--------------------
                  0
(1 row)

\! grep myseq2 $EMAJTESTTMPDIR/myFile
select emaj.emaj_gen_sql_group('myGroup2', 'Before ADD_SEQ', NULL, :'EMAJTESTTMPDIR' || '/myFile',array['myschema2.myseq2']);
ERROR:  _check_tblseqs_filter: 1 tables/sequences (myschema2.myseq2) did not belong to any of the selected tables groups at start mark time.
CONTEXT:  PL/pgSQL function emaj._check_tblseqs_filter(text[],text[],bigint,bigint,boolean) line 29 at RAISE
SQL statement "SELECT emaj._check_tblseqs_filter(p_tblseqs, p_groupNames, v_firstMarkTimeId, v_lastMarkTimeId, TRUE)"
PL/pgSQL function emaj._gen_sql_groups(text[],boolean,text,text,text,text[],text) line 52 at SQL statement
PL/pgSQL function emaj.emaj_gen_sql_group(text,text,text,text,text[]) line 14 at RETURN
\! rm $EMAJTESTTMPDIR/myFile
-- testing mark deletions
begin;
  -- testing delete a single mark set after the sequence addition
  select emaj.emaj_delete_mark_group('myGroup2','After ADD_SEQ');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select 'Should not exist' from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'After ADD_SEQ';
 ?column? 
----------
(0 rows)

  -- testing delete all marks up to a mark set after the alter_group
  select emaj.emaj_delete_before_mark_group('myGroup2','EMAJ_LAST_MARK');
 emaj_delete_before_mark_group 
-------------------------------
                             6
(1 row)

  select * from emaj.emaj_mark where mark_group = 'myGroup2';
 mark_group | mark_name  | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+------------+--------------+------------------------+--------------+---------------------------+------------------------------
 myGroup2   | Add myseq2 |         9102 | f                      |              |                           | 
(1 row)

  select * from emaj.emaj_sequence where sequ_name = 'myseq2' order by sequ_time_id;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
(1 row)

rollback;
begin;
  -- testing the alter_group mark deletion
  select mark_time_id from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'Add myseq2';
 mark_time_id 
--------------
         9102
(1 row)

  select emaj.emaj_delete_mark_group('myGroup2','Add myseq2');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select * from emaj.emaj_sequence where sequ_name = 'myseq2' order by sequ_time_id limit 1;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
(1 row)

  select stat_group, stat_schema, stat_sequence, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_increments, stat_has_structure_changed
    from emaj.emaj_sequence_stat_group('myGroup2', 'ADD_SEQ test', NULL)
    order by stat_group, stat_schema, stat_sequence, stat_first_mark_datetime;
 stat_group | stat_schema |  stat_sequence   | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_increments | stat_has_structure_changed 
------------+-------------+------------------+-----------------+--------------------+----------------+-------------------+-----------------+----------------------------
 myGroup2   | myschema2   | myTbl3_col31_seq | ADD_SEQ test    |               9100 |                |                   |               0 | f
 myGroup2   | myschema2   | myseq1           | ADD_SEQ test    |               9100 |                |                   |               0 | f
 myGroup2   | myschema2   | myseq2           | [deleted mark]  |               9102 |                |                   |               3 | f
(3 rows)

  select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_increments, stat_has_structure_changed, stat_rollbacks
    from emaj.emaj_log_stat_sequence('myschema2', 'myseq2', 'myGroup2', 'Mk1');
 stat_group | stat_first_mark | stat_is_log_start | stat_last_mark  | stat_is_log_stop | stat_increments | stat_has_structure_changed | stat_rollbacks 
------------+-----------------+-------------------+-----------------+------------------+-----------------+----------------------------+----------------
 myGroup2   | [deleted mark]  | t                 | After ADD_SEQ   | f                |               1 | f                          |              0
 myGroup2   | After ADD_SEQ   | f                 | [current state] | f                |               2 | f                          |              0
(2 rows)

rollback;
-- test sequences at bounds following a rollback targeting a mark set before an ADD_SEQ
begin;
  delete from emaj.emaj_param where param_key = 'dblink_user_password';
  select mark_time_id from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'Add myseq2';
 mark_time_id 
--------------
         9102
(1 row)

-- beware, the sequence changes generated by the E-Maj rollback will not be rollback by the transaction rollback
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup2','Before ADD_SEQ',true);
 rlbk_severity |                                               regexp_replace                                               
---------------+------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9100.
 Notice        | 0 / 6 tables effectively processed.
 Notice        | 1 / 3 sequences effectively processed.
 Warning       | The sequence myschema2.myseq2 has only been rolled back to its latest group attachment state (<timestamp>)
(4 rows)

  select * from emaj.emaj_sequence where sequ_schema = 'myschema2' and sequ_name = 'myseq2';
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
(1 row)

rollback;
-- estimate and then perform a logged rollback to reach a mark prior the ADD_SEQ operation and check
delete from emaj.emaj_rlbk_stat;    -- to avoid unstable results in estimates
select * from emaj.emaj_estimate_rollback_group('myGroup2','Before ADD_SEQ',true);
 emaj_estimate_rollback_group 
------------------------------
 @ 0.0155 secs
(1 row)

select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_logged_rollback_group('myGroup2','Before ADD_SEQ',true);
 rlbk_severity |                                               regexp_replace                                               
---------------+------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9101.
 Notice        | 0 / 6 tables effectively processed.
 Notice        | 1 / 3 sequences effectively processed.
 Warning       | The sequence myschema2.myseq2 has only been rolled back to its latest group attachment state (<timestamp>)
(4 rows)

select * from myschema2.myseq2;
 last_value | log_cnt | is_called 
------------+---------+-----------
          3 |       0 | f
(1 row)

select * from emaj.emaj_sequence where sequ_name = 'myseq2' order by sequ_time_id;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
 myschema2   | myseq2    |         9103 |             3 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
 myschema2   | myseq2    |         9105 |             5 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
 myschema2   | myseq2    |         9106 |             3 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
(4 rows)

-- consolidate this logged rollback
select emaj.emaj_rename_mark_group('myGroup2','EMAJ_LAST_MARK','Logged_Rlbk_End');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select mark_time_id from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'Add myseq2';
 mark_time_id 
--------------
         9102
(1 row)

select * from emaj.emaj_get_consolidable_rollbacks() where cons_group = 'myGroup2'; -- should report 1 row to consolidate
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 myGroup2   | Before ADD_SEQ             |                          9101 | Logged_Rlbk_End         |                       9106 |         0 |          3
(1 row)

select * from emaj.emaj_consolidate_rollback_group('myGroup2', 'Logged_Rlbk_End');
 emaj_consolidate_rollback_group 
---------------------------------
                               3
(1 row)

select * from emaj.emaj_sequence where sequ_schema = 'myschema2' and sequ_name = 'myseq2' order by sequ_schema, sequ_name, sequ_time_id;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
 myschema2   | myseq2    |         9106 |             3 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
(2 rows)

-- remove mySeq2 from the group, then re-add it
select emaj.emaj_remove_sequence('myschema2', 'myseq2', 'Remove myseq2');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

select emaj.emaj_assign_sequence('myschema2', 'myseq2', 'myGroup2', 'Re-add myseq2');
 emaj_assign_sequence 
----------------------
                    1
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
  from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq = 'myseq2' order by rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind 
------------+------------+----------------+-----------+----------
 myschema2  | myseq2     | [9102,9107)    | myGroup2  | S
 myschema2  | myseq2     | [9108,)        | myGroup2  | S
(2 rows)

-- finaly remove mySeq2 from the group
select emaj.emaj_remove_sequence('myschema2', 'myseq2', 'Really remove myseq2');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

-- and perform a full rollback (that do not process mySeq2)
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_group('myGroup2', 'ADD_SEQ test',true);
 rlbk_severity |                                         regexp_replace                                         
---------------+------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9102.
 Notice        | 0 / 6 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
 Warning       | The sequence myschema2.myseq2 has been left unchanged (not in group anymore since <timestamp>)
(4 rows)

select * from myschema2.myseq2;
 last_value | log_cnt | is_called 
------------+---------+-----------
          3 |       0 | f
(1 row)

-- verify that all time range bounds of emaj_relation has its corresponding row into emaj_sequence
select * from emaj.emaj_sequence where sequ_schema = 'myschema2' and sequ_name = 'myseq2' and sequ_time_id in
  (select lower(rel_time_range) from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq = 'myseq2' union 
   select upper(rel_time_range) from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq = 'myseq2')
  order by sequ_time_id;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment |    sequ_max_val     | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+---------------------+--------------+----------------+----------------+----------------
 myschema2   | myseq2    |         9102 |             2 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | t
 myschema2   | myseq2    |         9107 |             3 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
 myschema2   | myseq2    |         9108 |             3 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
 myschema2   | myseq2    |         9109 |             3 |              1 |              1 | 9223372036854775807 |            1 |              1 | f              | f
(4 rows)

-- checks for add sequences test
select * from emaj.emaj_relation_change where rlchg_time_id >= 9100 order by 1,2,3,4;
 rlchg_time_id | rlchg_schema | rlchg_tblseq | rlchg_change_kind | rlchg_group | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers | rlchg_new_ignored_triggers 
---------------+--------------+--------------+-------------------+-------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+------------------------+----------------------------
          9102 | myschema2    | myseq2       | ADD_SEQUENCE      | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9107 | myschema2    | myseq2       | REMOVE_SEQUENCE   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9108 | myschema2    | myseq2       | ADD_SEQUENCE      | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9109 | myschema2    | myseq2       | REMOVE_SEQUENCE   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
(4 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 9100 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    9100 |            9100000 | M
    9101 |            9100000 | M
    9102 |            9100000 | A
    9103 |            9100000 | M
    9105 |            9100000 | R
    9106 |            9100000 | M
    9107 |            9100000 | A
    9108 |            9100000 | A
    9109 |            9100000 | A
    9110 |            9100000 | R
(10 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist where hist_id >= 9100 order by hist_id;
     hist_function      |    hist_event    |   hist_object    |                                               regexp_replace                                               | hist_user 
------------------------+------------------+------------------+------------------------------------------------------------------------------------------------------------+-----------
 SET_MARK_GROUP         | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | TIME STAMP SET   | 9100             |                                                                                                            | postgres
 SET_MARK_GROUP         | END              | myGroup2         | ADD_SEQ test                                                                                               | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | TIME STAMP SET   | 9101             |                                                                                                            | postgres
 SET_MARK_GROUP         | END              | myGroup2         | Before ADD_SEQ                                                                                             | postgres
 ASSIGN_SEQUENCE        | BEGIN            |                  |                                                                                                            | postgres
 ASSIGN_SEQUENCE        | TIME STAMP SET   | 9102             |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         | Add myseq2                                                                                                 | postgres
 SET_MARK_GROUP         | END              | myGroup2         | Add myseq2                                                                                                 | postgres
 ASSIGN_SEQUENCE        | SEQUENCE ADDED   | myschema2.myseq2 | To the logging group myGroup2                                                                              | postgres
 ASSIGN_SEQUENCE        | END              |                  | 1 sequences assigned to the group myGroup2                                                                 | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | TIME STAMP SET   | 9103             |                                                                                                            | postgres
 SET_MARK_GROUP         | END              | myGroup2         | After ADD_SEQ                                                                                              | postgres
 SNAP_GROUP             | BEGIN            | myGroup2         | /tmp/emaj_15/alter_logging/snap                                                                            | postgres
 SNAP_GROUP             | END              | myGroup2         | 9 tables/sequences processed                                                                               | postgres
 GEN_SQL_GROUP          | BEGIN            | myGroup2         | From mark Before ADD_SEQ to current state                                                                  | postgres
 GEN_SQL_GROUP          | END              | myGroup2         | 0 generated statements - script exported into /tmp/emaj_15/alter_logging/myFile                            | postgres
 ROLLBACK_GROUP         | BEGIN            | myGroup2         | Logged rollback to mark Before ADD_SEQ (timestamp)                                                         | postgres
 DBLINK_OPEN_CNX        |                  | rlbk#1           | Status = 1                                                                                                 | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         | Rollback session #1                                                                                        | postgres
 LOCK_GROUP             | END              | myGroup2         | Rollback session #1: 6 tables locked, 0 deadlock(s)                                                        | postgres
 ROLLBACK_GROUP         | TIME STAMP SET   | 9105             |                                                                                                            | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         | RLBK_9101_START                                                                                            | postgres
 SET_MARK_GROUP         | END              | myGroup2         | RLBK_9101_START                                                                                            | postgres
 ROLLBACK_SEQUENCE      |                  | myschema2.myseq2 | RESTART 3                                                                                                  | postgres
 ROLLBACK_GROUP         | TIME STAMP SET   | 9106             |                                                                                                            | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         | RLBK_9101_DONE                                                                                             | postgres
 SET_MARK_GROUP         | END              | myGroup2         | RLBK_9101_DONE                                                                                             | postgres
 ROLLBACK_GROUP         | NOTICE           | Rollback id 9101 | Rollback id = 9101.                                                                                        | postgres
 ROLLBACK_GROUP         | NOTICE           | Rollback id 9101 | 0 / 6 tables effectively processed.                                                                        | postgres
 ROLLBACK_GROUP         | NOTICE           | Rollback id 9101 | 1 / 3 sequences effectively processed.                                                                     | postgres
 ROLLBACK_GROUP         | WARNING          | Rollback id 9101 | The sequence myschema2.myseq2 has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 DBLINK_CLOSE_CNX       |                  | rlbk#1           |                                                                                                            | postgres
 ROLLBACK_GROUP         | END              | myGroup2         | Rollback_id 9101                                                                                           | postgres
 RENAME_MARK_GROUP      | BEGIN            | myGroup2         | EMAJ_LAST_MARK                                                                                             | postgres
 RENAME_MARK_GROUP      | END              | myGroup2         | RLBK_9101_DONE renamed Logged_Rlbk_End                                                                     | postgres
 CONSOLIDATE_RLBK_GROUP | BEGIN            | myGroup2         | Erase all between marks Before ADD_SEQ and Logged_Rlbk_End                                                 | postgres
 CONSOLIDATE_RLBK_GROUP | END              | myGroup2         | 0 tables and 3 sequences processed ; 3 marks deleted                                                       | postgres
 REMOVE_SEQUENCE        | BEGIN            |                  |                                                                                                            | postgres
 REMOVE_SEQUENCE        | TIME STAMP SET   | 9107             |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         | Remove myseq2                                                                                              | postgres
 CLEANUP_RLBK_STATE     |                  | Rollback id 9101 | set to COMMITTED                                                                                           | postgres
 SET_MARK_GROUP         | END              | myGroup2         | Remove myseq2                                                                                              | postgres
 REMOVE_SEQUENCE        | SEQUENCE REMOVED | myschema2.myseq2 | From the logging group myGroup2                                                                            | postgres
 REMOVE_SEQUENCE        | END              |                  | 1 sequences removed from their groups                                                                      | postgres
 ASSIGN_SEQUENCE        | BEGIN            |                  |                                                                                                            | postgres
 ASSIGN_SEQUENCE        | TIME STAMP SET   | 9108             |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         | Re-add myseq2                                                                                              | postgres
 SET_MARK_GROUP         | END              | myGroup2         | Re-add myseq2                                                                                              | postgres
 ASSIGN_SEQUENCE        | SEQUENCE ADDED   | myschema2.myseq2 | To the logging group myGroup2                                                                              | postgres
 ASSIGN_SEQUENCE        | END              |                  | 1 sequences assigned to the group myGroup2                                                                 | postgres
 REMOVE_SEQUENCE        | BEGIN            |                  |                                                                                                            | postgres
 REMOVE_SEQUENCE        | TIME STAMP SET   | 9109             |                                                                                                            | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         |                                                                                                            | postgres
 LOCK_GROUP             | END              | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                             | postgres
 SET_MARK_GROUP         | BEGIN            | myGroup2         | Really remove myseq2                                                                                       | postgres
 SET_MARK_GROUP         | END              | myGroup2         | Really remove myseq2                                                                                       | postgres
 REMOVE_SEQUENCE        | SEQUENCE REMOVED | myschema2.myseq2 | From the logging group myGroup2                                                                            | postgres
 REMOVE_SEQUENCE        | END              |                  | 1 sequences removed from their groups                                                                      | postgres
 ROLLBACK_GROUP         | BEGIN            | myGroup2         | Unlogged rollback to mark ADD_SEQ test (timestamp)                                                         | postgres
 DBLINK_OPEN_CNX        |                  | rlbk#1           | Status = 1                                                                                                 | postgres
 LOCK_GROUP             | BEGIN            | myGroup2         | Rollback session #1                                                                                        | postgres
 LOCK_GROUP             | END              | myGroup2         | Rollback session #1: 6 tables locked, 0 deadlock(s)                                                        | postgres
 ROLLBACK_GROUP         | TIME STAMP SET   | 9110             |                                                                                                            | postgres
 ROLLBACK_GROUP         | MARK DELETED     | myGroup2         | mark Before ADD_SEQ is deleted                                                                             | postgres
 ROLLBACK_GROUP         | MARK DELETED     | myGroup2         | mark Logged_Rlbk_End is deleted                                                                            | postgres
 ROLLBACK_GROUP         | MARK DELETED     | myGroup2         | mark Remove myseq2 is deleted                                                                              | postgres
 ROLLBACK_GROUP         | MARK DELETED     | myGroup2         | mark Re-add myseq2 is deleted                                                                              | postgres
 ROLLBACK_GROUP         | MARK DELETED     | myGroup2         | mark Really remove myseq2 is deleted                                                                       | postgres
 ROLLBACK_GROUP         | NOTICE           | Rollback id 9102 | Rollback id = 9102.                                                                                        | postgres
 ROLLBACK_GROUP         | NOTICE           | Rollback id 9102 | 0 / 6 tables effectively processed.                                                                        | postgres
 ROLLBACK_GROUP         | NOTICE           | Rollback id 9102 | 0 / 2 sequences effectively processed.                                                                     | postgres
 ROLLBACK_GROUP         | WARNING          | Rollback id 9102 | The sequence myschema2.myseq2 has been left unchanged (not in group anymore since <timestamp>)             | postgres
 DBLINK_CLOSE_CNX       |                  | rlbk#1           |                                                                                                            | postgres
 ROLLBACK_GROUP         | END              | myGroup2         | Rollback_id 9102                                                                                           | postgres
(89 rows)

-- set sequence restart value
select public.handle_emaj_sequences(9300);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- remove sequences
-----------------------------
select emaj.emaj_set_mark_group('myGroup1','Mk2b');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select emaj.emaj_set_mark_group('myGroup1','Before_remove');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

select group_name, group_last_alter_time_id, group_nb_table, group_nb_sequence
  from emaj.emaj_group where group_name = 'myGroup1';
 group_name | group_last_alter_time_id | group_nb_table | group_nb_sequence 
------------+--------------------------+----------------+-------------------
 myGroup1   |                     9008 |              5 |                 2
(1 row)

select emaj.emaj_remove_sequence('myschema1', 'myTbl3_col31_seq', 'Sequence_removed');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

select group_name, group_last_alter_time_id, group_nb_table, group_nb_sequence
  from emaj.emaj_group where group_name = 'myGroup1';
 group_name | group_last_alter_time_id | group_nb_table | group_nb_sequence 
------------+--------------------------+----------------+-------------------
 myGroup1   |                     9302 |              5 |                 1
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
  from emaj.emaj_relation where rel_schema = 'myschema1' and rel_tblseq = 'myTbl3_col31_seq' order by rel_time_range;
 rel_schema |    rel_tblseq    | rel_time_range | rel_group | rel_kind 
------------+------------------+----------------+-----------+----------
 myschema1  | myTbl3_col31_seq | [8010,9302)    | myGroup1  | S
(1 row)

select * from emaj.emaj_verify_all() as t(msg) where msg not like '%foreign key%';
        msg        
-------------------
 No error detected
(1 row)

--testing snap, dump changes and sql generation
select emaj.emaj_snap_group('myGroup1',:'EMAJTESTTMPDIR' || '/snap','');
 emaj_snap_group 
-----------------
               6
(1 row)

\! ls $EMAJTESTTMPDIR/snap
_INFO
myschema1_myTbl3.snap
myschema1_mytbl1.snap
myschema1_mytbl2.snap
myschema1_mytbl2b.snap
myschema1_mytbl2b_col20_seq.snap
myschema1_mytbl4.snap
\! rm -R $EMAJTESTTMPDIR/snap/*
select emaj.emaj_set_mark_group('myGroup1','After_remove');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

select emaj.emaj_gen_sql_dump_changes_group('myGroup1','Mk1','EMAJ_LAST_MARK','SEQUENCES_ONLY',NULL);
                    emaj_gen_sql_dump_changes_group                    
-----------------------------------------------------------------------
 2 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

select sql_text from emaj_temp_sql where sql_line_number = 0;
                                                               sql_text                                                               
--------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup1" between marks "Mk1" and "After_remove" using options: SEQUENCES_ONLY
 -- Dump changes for sequence myschema1.myTbl3_col31_seq between marks "Mk1" and "Sequence_removed"
 -- Dump changes for sequence myschema1.mytbl2b_col20_seq between marks "Mk1" and "After_remove"
(3 rows)

-- testing statistics
select stat_group, stat_schema, stat_sequence, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_increments, stat_has_structure_changed
  from emaj.emaj_sequence_stat_group('myGroup1', 'Before_remove', NULL)
  order by stat_group, stat_schema, stat_sequence, stat_first_mark_datetime;
 stat_group | stat_schema |   stat_sequence   | stat_first_mark | stat_first_time_id |  stat_last_mark  | stat_last_time_id | stat_increments | stat_has_structure_changed 
------------+-------------+-------------------+-----------------+--------------------+------------------+-------------------+-----------------+----------------------------
 myGroup1   | myschema1   | myTbl3_col31_seq  | Before_remove   |               9301 | Sequence_removed |              9302 |               0 | f
 myGroup1   | myschema1   | mytbl2b_col20_seq | Before_remove   |               9301 |                  |                   |               0 | f
(2 rows)

select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_increments, stat_has_structure_changed, stat_rollbacks
  from emaj.emaj_log_stat_sequence('myschema1', 'myTbl3_col31_seq', 'myGroup1', 'Mk2b');
 stat_group | stat_first_mark | stat_is_log_start |  stat_last_mark  | stat_is_log_stop | stat_increments | stat_has_structure_changed | stat_rollbacks 
------------+-----------------+-------------------+------------------+------------------+-----------------+----------------------------+----------------
 myGroup1   | Mk2b            | f                 | Before_remove    | f                |               0 | f                          |              0
 myGroup1   | Before_remove   | f                 | Sequence_removed | t                |               0 | f                          |              0
(2 rows)

-- testing sql script generation
select emaj.emaj_gen_sql_group('myGroup1', 'Mk1', 'EMAJ_LAST_MARK', :'EMAJTESTTMPDIR' || '/script.sql',array['myschema1.myTbl3_col31_seq']);
 emaj_gen_sql_group 
--------------------
                  0
(1 row)

\! grep -v 'generated by E-Maj at' $EMAJTESTTMPDIR/script.sql
--    for tables group(s): myGroup1
--    processing logs between mark Mk1 and mark After_remove
--    only for the following tables/sequences: myschema1.myTbl3_col31_seq
SET standard_conforming_strings = OFF;
SET escape_string_warning = OFF;
SET datestyle = 'ISO, YMD';
BEGIN TRANSACTION;
COMMIT;
RESET standard_conforming_strings;
RESET escape_string_warning;
RESET datestyle;
\! rm $EMAJTESTTMPDIR/script.sql
begin;
  -- testing the alter_group mark deletion
  select emaj.emaj_delete_mark_group('myGroup1','Sequence_removed');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select stat_group, stat_schema, stat_sequence, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_increments, stat_has_structure_changed
    from emaj.emaj_sequence_stat_group('myGroup1', 'Before_remove', NULL)
    order by stat_group, stat_schema, stat_sequence, stat_first_mark_datetime;
 stat_group | stat_schema |   stat_sequence   | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_increments | stat_has_structure_changed 
------------+-------------+-------------------+-----------------+--------------------+----------------+-------------------+-----------------+----------------------------
 myGroup1   | myschema1   | myTbl3_col31_seq  | Before_remove   |               9301 | [deleted mark] |              9302 |               0 | f
 myGroup1   | myschema1   | mytbl2b_col20_seq | Before_remove   |               9301 |                |                   |               0 | f
(2 rows)

  select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_increments, stat_has_structure_changed, stat_rollbacks
    from emaj.emaj_log_stat_sequence('myschema1', 'myTbl3_col31_seq', 'myGroup1', 'Mk2b');
 stat_group | stat_first_mark | stat_is_log_start | stat_last_mark | stat_is_log_stop | stat_increments | stat_has_structure_changed | stat_rollbacks 
------------+-----------------+-------------------+----------------+------------------+-----------------+----------------------------+----------------
 myGroup1   | Mk2b            | f                 | Before_remove  | f                |               0 | f                          |              0
 myGroup1   | Before_remove   | f                 | [deleted mark] | t                |               0 | f                          |              0
(2 rows)

  select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
    from emaj.emaj_relation where rel_schema = 'myschema1' and rel_tblseq = 'myTbl3_col31_seq' order by rel_time_range;
 rel_schema |    rel_tblseq    | rel_time_range | rel_group | rel_kind 
------------+------------------+----------------+-----------+----------
 myschema1  | myTbl3_col31_seq | [8010,9302)    | myGroup1  | S
(1 row)

  select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id,
    mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark
    from emaj.emaj_mark where mark_group = 'myGroup1' order by mark_time_id desc limit 2;
 mark_group | regexp_replace | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+----------------+--------------+------------------------+--------------+---------------------------+------------------------------
 myGroup1   | After_remove   |         9303 | f                      |              |                           | 
 myGroup1   | Before_remove  |         9301 | f                      |              |                         0 | 
(2 rows)

rollback;
begin;
  -- testing delete a single mark set before the sequence removal
  select emaj.emaj_delete_mark_group('myGroup1','Before_remove');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select * from emaj.emaj_sequence where sequ_schema = 'myschema1'
    and sequ_time_id not in (select distinct mark_time_id from emaj.emaj_mark where mark_group = 'myGroup1');
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_start_val | sequ_increment | sequ_max_val | sequ_min_val | sequ_cache_val | sequ_is_cycled | sequ_is_called 
-------------+-----------+--------------+---------------+----------------+----------------+--------------+--------------+----------------+----------------+----------------
(0 rows)

  -- testing rollback
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_logged_rollback_group('myGroup1','Mk2b',true) order by 1,2;
 rlbk_severity |                                               regexp_replace                                               
---------------+------------------------------------------------------------------------------------------------------------
 Notice        | 0 / 1 sequences effectively processed.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | Rollback id = 9300.
 Warning       | The sequence myschema1."myTbl3_col31_seq" has been left unchanged (not in group anymore since <timestamp>)
(4 rows)

  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup1','Mk2b',true) order by 1,2;
 rlbk_severity |                                               regexp_replace                                               
---------------+------------------------------------------------------------------------------------------------------------
 Notice        | 0 / 1 sequences effectively processed.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | Rollback id = 9301.
 Warning       | The sequence myschema1."myTbl3_col31_seq" has been left unchanged (not in group anymore since <timestamp>)
(4 rows)

  savepoint svp1;
  -- testing group's reset
    select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               6
(1 row)

    select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
      from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range) order by 1,2,3;
 rel_schema |    rel_tblseq    | rel_time_range | rel_group | rel_kind 
------------+------------------+----------------+-----------+----------
 myschema1  | myTbl3_col31_seq | [8010,9302)    | myGroup1  | S
(1 row)

    select emaj.emaj_reset_group('myGroup1');
 emaj_reset_group 
------------------
                6
(1 row)

    select count(*) from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range);
 count 
-------
     0
(1 row)

  rollback to svp1;
  -- testing marks deletion
  select emaj.emaj_set_mark_group('myGroup1','Mk2d');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

  select emaj.emaj_delete_before_mark_group('myGroup1','Mk2b');
 emaj_delete_before_mark_group 
-------------------------------
                             6
(1 row)

  select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
    from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range) order by 1,2,3;
 rel_schema |    rel_tblseq    | rel_time_range | rel_group | rel_kind 
------------+------------------+----------------+-----------+----------
 myschema1  | myTbl3_col31_seq | [8010,9302)    | myGroup1  | S
(1 row)

  select emaj.emaj_delete_before_mark_group('myGroup1','Mk2d');
 emaj_delete_before_mark_group 
-------------------------------
                             1
(1 row)

  select count(*) from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range);
 count 
-------
     0
(1 row)

  -- testing the sequence drop
  drop sequence mySchema1."myTbl3_col31_seq" cascade;
NOTICE:  drop cascades to default value for column col31 of table myschema1."myTbl3"
rollback;
-- revert the changes
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json', '{"myGroup1"}', true, 'Revert_sequences_removal');
 emaj_import_groups_configuration 
----------------------------------
                                1
(1 row)

select emaj.emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           0
(1 row)

-- checks for remove sequences test
select * from emaj.emaj_relation_change where rlchg_time_id >= 9300 order by 1,2,3,4;
 rlchg_time_id | rlchg_schema |   rlchg_tblseq   | rlchg_change_kind | rlchg_group | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers | rlchg_new_ignored_triggers 
---------------+--------------+------------------+-------------------+-------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+------------------------+----------------------------
          9302 | myschema1    | myTbl3_col31_seq | REMOVE_SEQUENCE   | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9309 | myschema1    | myTbl3_col31_seq | ADD_SEQUENCE      | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
(2 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 9300 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    9300 |            9300000 | M
    9301 |            9300000 | M
    9302 |            9300000 | A
    9303 |            9300000 | M
    9304 |            9300000 | R
    9305 |            9300000 | M
    9306 |            9300000 | R
    9309 |            9300000 | I
(8 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist where hist_id >= 9300 order by hist_id;
   hist_function    |    hist_event    |         hist_object          |                                   regexp_replace                                    | hist_user 
--------------------+------------------+------------------------------+-------------------------------------------------------------------------------------+-----------
 SET_MARK_GROUP     | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | END              | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                      | postgres
 SET_MARK_GROUP     | TIME STAMP SET   | 9300                         |                                                                                     | postgres
 CLEANUP_RLBK_STATE |                  | Rollback id 9102             | set to COMMITTED                                                                    | postgres
 SET_MARK_GROUP     | END              | myGroup1                     | Mk2b                                                                                | postgres
 SET_MARK_GROUP     | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | END              | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                      | postgres
 SET_MARK_GROUP     | TIME STAMP SET   | 9301                         |                                                                                     | postgres
 SET_MARK_GROUP     | END              | myGroup1                     | Before_remove                                                                       | postgres
 REMOVE_SEQUENCE    | BEGIN            |                              |                                                                                     | postgres
 REMOVE_SEQUENCE    | TIME STAMP SET   | 9302                         |                                                                                     | postgres
 LOCK_GROUP         | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | END              | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                      | postgres
 SET_MARK_GROUP     | BEGIN            | myGroup1                     | Sequence_removed                                                                    | postgres
 SET_MARK_GROUP     | END              | myGroup1                     | Sequence_removed                                                                    | postgres
 REMOVE_SEQUENCE    | SEQUENCE REMOVED | myschema1."myTbl3_col31_seq" | From the logging group myGroup1                                                     | postgres
 REMOVE_SEQUENCE    | END              |                              | 1 sequences removed from their groups                                               | postgres
 SNAP_GROUP         | BEGIN            | myGroup1                     | /tmp/emaj_15/alter_logging/snap                                                     | postgres
 SNAP_GROUP         | END              | myGroup1                     | 6 tables/sequences processed                                                        | postgres
 SET_MARK_GROUP     | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUP         | END              | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                      | postgres
 SET_MARK_GROUP     | TIME STAMP SET   | 9303                         |                                                                                     | postgres
 SET_MARK_GROUP     | END              | myGroup1                     | After_remove                                                                        | postgres
 GEN_SQL_GROUP      | BEGIN            | myGroup1                     | From mark Mk1 to mark EMAJ_LAST_MARK with tables/sequences filtering                | postgres
 GEN_SQL_GROUP      | END              | myGroup1                     | 0 generated statements - script exported into /tmp/emaj_15/alter_logging/script.sql | postgres
 ROLLBACK_GROUP     | TIME STAMP SET   | 9305                         |                                                                                     | postgres
 IMPORT_GROUPS      | BEGIN            | myGroup1                     | Input file: '/tmp/emaj_15/alter_logging/all_groups_conf.json'                       | postgres
 IMPORT_GROUPS      | TIME STAMP SET   | 9309                         |                                                                                     | postgres
 LOCK_GROUPS        | BEGIN            | myGroup1                     |                                                                                     | postgres
 LOCK_GROUPS        | END              | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                      | postgres
 SET_MARK_GROUPS    | BEGIN            | myGroup1                     | Revert_sequences_removal                                                            | postgres
 CLEANUP_RLBK_STATE |                  | Rollback id 9300             | set to ABORTED                                                                      | postgres
 CLEANUP_RLBK_STATE |                  | Rollback id 9301             | set to ABORTED                                                                      | postgres
 SET_MARK_GROUPS    | END              | myGroup1                     | Revert_sequences_removal                                                            | postgres
 IMPORT_GROUPS      | SEQUENCE ADDED   | myschema1."myTbl3_col31_seq" | To the logging group myGroup1                                                       | postgres
 IMPORT_GROUPS      | END              |                              | 1 created or altered tables groups                                                  | postgres
(39 rows)

-- set sequence restart value
select public.handle_emaj_sequences(9500);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- add tables
-----------------------------
-- add myschema2.mytbl7 to the myGroup2 group
-- first perform updates and set marks
select emaj.emaj_set_mark_group('myGroup2','ADD_TBL test');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

insert into myschema2.mytbl7 values (1),(2),(3);
select emaj.emaj_set_mark_group('myGroup2','Before ADD_TBL');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

delete from myschema2.mytbl7 where col71 = 3;
-- then add the table to the group
select emaj.emaj_assign_table('myschema2', 'mytbl7', 'myGroup2', null, 'Add mytbl7');
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_assign_table 
-------------------
                 1
(1 row)

select group_name, group_last_alter_time_id, group_nb_table, group_nb_sequence
  from emaj.emaj_group where group_name = 'myGroup2';
 group_name | group_last_alter_time_id | group_nb_table | group_nb_sequence 
------------+--------------------------+----------------+-------------------
 myGroup2   |                     9502 |              7 |                 2
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table
  from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq = 'mytbl7' order by rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table 
------------+------------+----------------+-----------+----------+----------------+---------------
 myschema2  | mytbl7     | [9502,)        | myGroup2  | r        | emaj_myschema2 | mytbl7_log
(1 row)

-- perform some other updates
insert into myschema2.mytbl7 values (4),(5);
-- remove the alter group mark just after the alter operation and then get statistics and set a mark
begin;
  select emaj.emaj_delete_mark_group('myGroup2','Add mytbl7');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows 
    from emaj.emaj_log_stat_group('myGroup2','Before ADD_TBL',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------
 myGroup2   | myschema2   | myTbl3     | Before ADD_TBL  |               9501 |                |                   |         0
 myGroup2   | myschema2   | mytbl1     | Before ADD_TBL  |               9501 |                |                   |         0
 myGroup2   | myschema2   | mytbl2     | Before ADD_TBL  |               9501 |                |                   |         0
 myGroup2   | myschema2   | mytbl4     | Before ADD_TBL  |               9501 |                |                   |         0
 myGroup2   | myschema2   | mytbl5     | Before ADD_TBL  |               9501 |                |                   |         0
 myGroup2   | myschema2   | mytbl6     | Before ADD_TBL  |               9501 |                |                   |         0
 myGroup2   | myschema2   | mytbl7     | [deleted mark]  |               9502 |                |                   |         2
(7 rows)

  select emaj.emaj_set_mark_group('myGroup2','Just after ADD_TBL');
 emaj_set_mark_group 
---------------------
                   9
(1 row)

  select mark_log_rows_before_next from emaj.emaj_mark where mark_name = 'Before ADD_TBL';
 mark_log_rows_before_next 
---------------------------
                         2
(1 row)

rollback;
-- set marks and look at statistics
select emaj.emaj_set_mark_group('myGroup2','Just after ADD_TBL');
 emaj_set_mark_group 
---------------------
                   9
(1 row)

update myschema2.mytbl7 set col71 = 6 where col71 = 2;
select col71, emaj_verb, emaj_tuple from emaj_myschema2.mytbl7_log order by emaj_gid;
 col71 | emaj_verb | emaj_tuple 
-------+-----------+------------
     4 | INS       | NEW
     5 | INS       | NEW
     2 | UPD       | OLD
     6 | UPD       | NEW
(4 rows)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows
  from emaj.emaj_log_stat_group('myGroup2','ADD_TBL test',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------
 myGroup2   | myschema2   | myTbl3     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl1     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl2     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl4     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl5     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl6     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl7     | Add mytbl7      |               9502 |                |                   |         3
(7 rows)

select emaj.emaj_set_mark_group('myGroup2','After ADD_TBL');
 emaj_set_mark_group 
---------------------
                   9
(1 row)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_role, stat_verb, stat_rows
  from emaj.emaj_detailed_log_stat_group('myGroup2','ADD_TBL test','After ADD_TBL');
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_role | stat_verb | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------+-----------+-----------
 myGroup2   | myschema2   | mytbl7     | Add mytbl7      |               9502 | After ADD_TBL  |              9505 | postgres  | INSERT    |         2
 myGroup2   | myschema2   | mytbl7     | Add mytbl7      |               9502 | After ADD_TBL  |              9505 | postgres  | UPDATE    |         1
(2 rows)

select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_changes, stat_rollbacks
  from emaj.emaj_log_stat_table('myschema2', 'mytbl7', 'myGroup2', 'Mk1');
 stat_group |  stat_first_mark   | stat_is_log_start |   stat_last_mark   | stat_is_log_stop | stat_changes | stat_rollbacks 
------------+--------------------+-------------------+--------------------+------------------+--------------+----------------
 myGroup2   | Add mytbl7         | t                 | Just after ADD_TBL | f                |            2 |              0
 myGroup2   | Just after ADD_TBL | f                 | After ADD_TBL      | f                |            1 |              0
 myGroup2   | After ADD_TBL      | f                 | [current state]    | f                |            0 |              0
(3 rows)

--testing snap, dump changes and sql generation
select emaj.emaj_snap_group('myGroup2',:'EMAJTESTTMPDIR' || '/snap','');
 emaj_snap_group 
-----------------
               9
(1 row)

\! ls $EMAJTESTTMPDIR/snap
_INFO
myschema2_myTbl3.snap
myschema2_myTbl3_col31_seq.snap
myschema2_myseq1.snap
myschema2_mytbl1.snap
myschema2_mytbl2.snap
myschema2_mytbl4.snap
myschema2_mytbl5.snap
myschema2_mytbl6.snap
myschema2_mytbl7.snap
\! rm $EMAJTESTTMPDIR/snap/*
select emaj.emaj_gen_sql_dump_changes_group('myGroup2','Mk1','After ADD_TBL','TABLES_ONLY',NULL);
                    emaj_gen_sql_dump_changes_group                    
-----------------------------------------------------------------------
 7 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

select sql_text from emaj_temp_sql where sql_line_number = 0;
                                                              sql_text                                                              
------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup2" between marks "Mk1" and "After ADD_TBL" using options: TABLES_ONLY
 -- Dump changes for table myschema2.myTbl3 between marks "Mk1" and "After ADD_TBL" (0 changes)
 -- Dump changes for table myschema2.mytbl1 between marks "Mk1" and "After ADD_TBL" (0 changes)
 -- Dump changes for table myschema2.mytbl2 between marks "Mk1" and "After ADD_TBL" (0 changes)
 -- Dump changes for table myschema2.mytbl4 between marks "Mk1" and "After ADD_TBL" (0 changes)
 -- Dump changes for table myschema2.mytbl5 between marks "Mk1" and "After ADD_TBL" (0 changes)
 -- Dump changes for table myschema2.mytbl6 between marks "Mk1" and "After ADD_TBL" (0 changes)
 -- Dump changes for table myschema2.mytbl7 between marks "Add mytbl7" and "After ADD_TBL" (3 changes)
(8 rows)

select emaj.emaj_gen_sql_group('myGroup2', 'Before ADD_TBL', NULL, :'EMAJTESTTMPDIR' || '/script.sql',array['myschema2.mytbl7']);
ERROR:  _check_tblseqs_filter: 1 tables/sequences (myschema2.mytbl7) did not belong to any of the selected tables groups at start mark time.
CONTEXT:  PL/pgSQL function emaj._check_tblseqs_filter(text[],text[],bigint,bigint,boolean) line 29 at RAISE
SQL statement "SELECT emaj._check_tblseqs_filter(p_tblseqs, p_groupNames, v_firstMarkTimeId, v_lastMarkTimeId, TRUE)"
PL/pgSQL function emaj._gen_sql_groups(text[],boolean,text,text,text,text[],text) line 52 at SQL statement
PL/pgSQL function emaj.emaj_gen_sql_group(text,text,text,text,text[]) line 14 at RETURN
\! rm $EMAJTESTTMPDIR/script.sql
rm: cannot remove '/tmp/emaj_15/alter_logging/script.sql': No such file or directory
-- testing mark deletions
begin;
  -- testing delete a single mark set after the table addition
  select emaj.emaj_delete_mark_group('myGroup2','After ADD_TBL');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select 'Should not exist' from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'After ADD_TBL';
 ?column? 
----------
(0 rows)

  -- testing delete all marks up to a mark set after the alter_group
  select emaj.emaj_delete_before_mark_group('myGroup2','EMAJ_LAST_MARK');
 emaj_delete_before_mark_group 
-------------------------------
                             8
(1 row)

  select * from emaj.emaj_mark where mark_group = 'myGroup2';
 mark_group |     mark_name      | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+--------------------+--------------+------------------------+--------------+---------------------------+------------------------------
 myGroup2   | Just after ADD_TBL |         9504 | f                      |              |                           | 
(1 row)

  select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table
    where tbl_name = 'mytbl7' order by tbl_time_id;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl7   |        9502 |                    0
 myschema2  | mytbl7   |        9504 |                    2
(2 rows)

rollback;
begin;
  -- testing the add table mark deletion
  select mark_time_id from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'Add mytbl7';
 mark_time_id 
--------------
         9502
(1 row)

  select emaj.emaj_delete_mark_group('myGroup2','Add mytbl7');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table
    where tbl_name = 'mytbl7' order by tbl_time_id limit 1;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl7   |        9502 |                    0
(1 row)

  select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_changes, stat_rollbacks
    from emaj.emaj_log_stat_table('myschema2', 'mytbl7', 'myGroup2', 'Mk1');
 stat_group |  stat_first_mark   | stat_is_log_start |   stat_last_mark   | stat_is_log_stop | stat_changes | stat_rollbacks 
------------+--------------------+-------------------+--------------------+------------------+--------------+----------------
 myGroup2   | [deleted mark]     | t                 | Just after ADD_TBL | f                |            2 |              0
 myGroup2   | Just after ADD_TBL | f                 | After ADD_TBL      | f                |            1 |              0
 myGroup2   | After ADD_TBL      | f                 | [current state]    | f                |            0 |              0
(3 rows)

rollback;
-- test sequences and holes at bounds following a rollback targeting a mark set before an ADD_TBL
begin;
  delete from emaj.emaj_param where param_key = 'dblink_user_password';
  select mark_time_id from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'Add mytbl7';
 mark_time_id 
--------------
         9502
(1 row)

  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup2','Before ADD_TBL',true);
 rlbk_severity |                                          regexp_replace                                           
---------------+---------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9500.
 Notice        | 1 / 7 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
 Warning       | The table myschema2.mytbl7 has only been rolled back to its latest group attachment (<timestamp>)
(4 rows)

  select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table
    where tbl_schema = 'myschema2' and tbl_name = 'mytbl7' order by tbl_time_id;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl7   |        9502 |                    0
(1 row)

  select * from emaj.emaj_seq_hole where sqhl_schema = 'myschema2' and sqhl_table = 'mytbl7';
 sqhl_schema | sqhl_table | sqhl_begin_time_id | sqhl_end_time_id | sqhl_hole_size 
-------------+------------+--------------------+------------------+----------------
 myschema2   | mytbl7     |               9502 |             9506 |              3
(1 row)

  select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows
    from emaj.emaj_log_stat_group('myGroup2','ADD_TBL test',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------
 myGroup2   | myschema2   | myTbl3     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl1     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl2     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl4     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl5     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl6     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl7     | [deleted mark]  |               9502 |                |                   |         0
(7 rows)

rollback;
-- estimate and then perform a logged rollback to reach a mark prior the ADD_TBL operation and check
delete from emaj.emaj_rlbk_stat;    -- to avoid unstable results in estimates
select * from emaj.emaj_estimate_rollback_group('myGroup2','Before ADD_TBL',true);
 emaj_estimate_rollback_group 
------------------------------
 @ 0.0328 secs
(1 row)

select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_logged_rollback_group('myGroup2','Before ADD_TBL',true);
 rlbk_severity |                                          regexp_replace                                           
---------------+---------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9501.
 Notice        | 1 / 7 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
 Warning       | The table myschema2.mytbl7 has only been rolled back to its latest group attachment (<timestamp>)
(4 rows)

select col71, emaj_verb, emaj_tuple from emaj_myschema2.mytbl7_log order by emaj_gid;
 col71 | emaj_verb | emaj_tuple 
-------+-----------+------------
     4 | INS       | NEW
     5 | INS       | NEW
     2 | UPD       | OLD
     6 | UPD       | NEW
     4 | DEL       | OLD
     5 | DEL       | OLD
     6 | DEL       | OLD
     2 | INS       | NEW
(8 rows)

select * from myschema2.mytbl7 order by col71;
 col71 
-------
     1
     2
(2 rows)

-- consolidate this logged rollback
select emaj.emaj_rename_mark_group('myGroup2','EMAJ_LAST_MARK','Logged_Rlbk_End');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select mark_time_id from emaj.emaj_mark where mark_group = 'myGroup2' and mark_name = 'Add mytbl7';
 mark_time_id 
--------------
         9502
(1 row)

select * from emaj.emaj_get_consolidable_rollbacks() where cons_group = 'myGroup2'; -- should report 1 row to consolidate
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 myGroup2   | Before ADD_TBL             |                          9501 | Logged_Rlbk_End         |                       9508 |         7 |          4
(1 row)

select * from emaj.emaj_consolidate_rollback_group('myGroup2', 'Logged_Rlbk_End');
 emaj_consolidate_rollback_group 
---------------------------------
                               3
(1 row)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table
  where tbl_schema = 'myschema2' and tbl_name = 'mytbl7' order by tbl_time_id;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl7   |        9502 |                    0
 myschema2  | mytbl7   |        9508 |                    7
(2 rows)

-- perform some other updates
insert into myschema2.myTbl7 values (7),(8),(9);
-- verify the group and detect the lack of the new log table
begin;
  select emaj.emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

  drop table emaj_myschema2.mytbl7_log;
  select * from emaj.emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                 msg                                                                 
-------------------------------------------------------------------------------------------------------------------------------------
 Error: In tables group "myGroup2", the log table "emaj_myschema2"."mytbl7_log" is not found.
 Warning: Some E-Maj event triggers are disabled. You may enable them using the emaj_enable_protection_by_event_triggers() function.
(2 rows)

  select emaj.emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

rollback;
-- remove myTbl7 from the group, then re-add it
select emaj.emaj_remove_table('myschema2', 'mytbl7', 'Remove mytbl7');
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('myschema2', 'mytbl7', 'myGroup2', null, 'Re-add mytbl7');
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_assign_table 
-------------------
                 1
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table, rel_log_seq_last_value
  from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq = 'mytbl7' order by rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+---------------+------------------------
 myschema2  | mytbl7     | [9502,9509)    | myGroup2  | r        | emaj_myschema2 | mytbl7_log_1  |                     10
 myschema2  | mytbl7     | [9510,)        | myGroup2  | r        | emaj_myschema2 | mytbl7_log    |                       
(2 rows)

delete from myschema2.myTbl7 where col71 = 9;
-- get statistics
select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows 
  from emaj.emaj_log_stat_group('myGroup2','ADD_TBL test',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------
 myGroup2   | myschema2   | myTbl3     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl1     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl2     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl4     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl5     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl6     | ADD_TBL test    |               9500 |                |                   |         0
 myGroup2   | myschema2   | mytbl7     | [deleted mark]  |               9502 | Remove mytbl7  |              9509 |         3
 myGroup2   | myschema2   | mytbl7     | Re-add mytbl7   |               9510 |                |                   |         1
(8 rows)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_role, stat_verb, stat_rows 
  from emaj.emaj_detailed_log_stat_group('myGroup2','ADD_TBL test',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_role | stat_verb | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------+-----------+-----------
 myGroup2   | myschema2   | mytbl7     | [deleted mark]  |               9502 | Remove mytbl7  |              9509 | postgres  | INSERT    |         3
 myGroup2   | myschema2   | mytbl7     | Re-add mytbl7   |               9510 |                |                   | postgres  | DELETE    |         1
(2 rows)

-- dump changes
select emaj.emaj_gen_sql_dump_changes_group('myGroup2','Mk1','EMAJ_LAST_MARK','TABLES_ONLY',NULL);
                    emaj_gen_sql_dump_changes_group                    
-----------------------------------------------------------------------
 7 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

select sql_text from emaj_temp_sql where sql_line_number = 0;
                                                              sql_text                                                              
------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup2" between marks "Mk1" and "Re-add mytbl7" using options: TABLES_ONLY
 -- Dump changes for table myschema2.myTbl3 between marks "Mk1" and "Re-add mytbl7" (0 changes)
 -- Dump changes for table myschema2.mytbl1 between marks "Mk1" and "Re-add mytbl7" (0 changes)
 -- Dump changes for table myschema2.mytbl2 between marks "Mk1" and "Re-add mytbl7" (0 changes)
 -- Dump changes for table myschema2.mytbl4 between marks "Mk1" and "Re-add mytbl7" (0 changes)
 -- Dump changes for table myschema2.mytbl5 between marks "Mk1" and "Re-add mytbl7" (0 changes)
 -- Dump changes for table myschema2.mytbl6 between marks "Mk1" and "Re-add mytbl7" (0 changes)
 -- Dump changes for table myschema2.mytbl7 between marks "[deleted mark]" and "Remove mytbl7" (3 changes)
(8 rows)

-- and finaly revert the group configuration changes
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json', '{"myGroup2"}', true);
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_import_groups_configuration 
----------------------------------
                                1
(1 row)

-- and perform a full rollback (that do not process myTbl7)
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_group('myGroup2', 'ADD_TBL test',true);
 rlbk_severity |                                       regexp_replace                                        
---------------+---------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9502.
 Notice        | 0 / 6 tables effectively processed.
 Notice        | 0 / 2 sequences effectively processed.
 Warning       | The table myschema2.mytbl7 has been left unchanged (not in group anymore since <timestamp>)
(4 rows)

select * from myschema2.mytbl7 order by col71;
 col71 
-------
     1
     2
     7
     8
(4 rows)

-- checks for add tables tests
select * from emaj.emaj_relation_change where rlchg_time_id >= 9500 order by 1,2,3,4;
 rlchg_time_id | rlchg_schema | rlchg_tblseq | rlchg_change_kind | rlchg_group | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers | rlchg_new_ignored_triggers 
---------------+--------------+--------------+-------------------+-------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+------------------------+----------------------------
          9502 | myschema2    | mytbl7       | ADD_TABLE         | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9509 | myschema2    | mytbl7       | REMOVE_TABLE      | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9510 | myschema2    | mytbl7       | ADD_TABLE         | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9511 | myschema2    | mytbl7       | REMOVE_TABLE      | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
(4 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 9500 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    9500 |            9500000 | M
    9501 |            9500000 | M
    9502 |            9500000 | A
    9504 |            9500002 | M
    9505 |            9500003 | M
    9507 |            9500003 | R
    9508 |            9500007 | M
    9509 |            9500010 | A
    9510 |            9500010 | A
    9511 |            9500011 | I
    9512 |            9500011 | R
(11 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist where hist_id >= 9500 order by hist_id;
     hist_function      |   hist_event   |   hist_object    |                                          regexp_replace                                           | hist_user 
------------------------+----------------+------------------+---------------------------------------------------------------------------------------------------+-----------
 SET_MARK_GROUP         | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | TIME STAMP SET | 9500             |                                                                                                   | postgres
 SET_MARK_GROUP         | END            | myGroup2         | ADD_TBL test                                                                                      | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | TIME STAMP SET | 9501             |                                                                                                   | postgres
 SET_MARK_GROUP         | END            | myGroup2         | Before ADD_TBL                                                                                    | postgres
 ASSIGN_TABLE           | BEGIN          |                  |                                                                                                   | postgres
 ASSIGN_TABLE           | TIME STAMP SET | 9502             |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         | Add mytbl7                                                                                        | postgres
 SET_MARK_GROUP         | END            | myGroup2         | Add mytbl7                                                                                        | postgres
 ASSIGN_TABLE           | TABLE ADDED    | myschema2.mytbl7 | To the logging group myGroup2                                                                     | postgres
 ASSIGN_TABLE           | END            |                  | 1 tables assigned to the group myGroup2                                                           | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 7 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | TIME STAMP SET | 9504             |                                                                                                   | postgres
 SET_MARK_GROUP         | END            | myGroup2         | Just after ADD_TBL                                                                                | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 7 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | TIME STAMP SET | 9505             |                                                                                                   | postgres
 SET_MARK_GROUP         | END            | myGroup2         | After ADD_TBL                                                                                     | postgres
 SNAP_GROUP             | BEGIN          | myGroup2         | /tmp/emaj_15/alter_logging/snap                                                                   | postgres
 SNAP_GROUP             | END            | myGroup2         | 9 tables/sequences processed                                                                      | postgres
 ROLLBACK_GROUP         | BEGIN          | myGroup2         | Logged rollback to mark Before ADD_TBL (timestamp)                                                | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1           | Status = 1                                                                                        | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         | Rollback session #1                                                                               | postgres
 LOCK_GROUP             | END            | myGroup2         | Rollback session #1: 7 tables locked, 0 deadlock(s)                                               | postgres
 ROLLBACK_GROUP         | TIME STAMP SET | 9507             |                                                                                                   | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         | RLBK_9501_START                                                                                   | postgres
 SET_MARK_GROUP         | END            | myGroup2         | RLBK_9501_START                                                                                   | postgres
 ROLLBACK_TABLE         | BEGIN          | myschema2.mytbl7 | All log rows where emaj_gid > 9500000 and <= 9500003                                              | postgres
 ROLLBACK_TABLE         | END            | myschema2.mytbl7 | 4 rolled back primary keys                                                                        | postgres
 ROLLBACK_GROUP         | TIME STAMP SET | 9508             |                                                                                                   | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         | RLBK_9501_DONE                                                                                    | postgres
 SET_MARK_GROUP         | END            | myGroup2         | RLBK_9501_DONE                                                                                    | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9501 | Rollback id = 9501.                                                                               | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9501 | 1 / 7 tables effectively processed.                                                               | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9501 | 0 / 2 sequences effectively processed.                                                            | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9501 | The table myschema2.mytbl7 has only been rolled back to its latest group attachment (<timestamp>) | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1           |                                                                                                   | postgres
 ROLLBACK_GROUP         | END            | myGroup2         | Rollback_id 9501                                                                                  | postgres
 RENAME_MARK_GROUP      | BEGIN          | myGroup2         | EMAJ_LAST_MARK                                                                                    | postgres
 RENAME_MARK_GROUP      | END            | myGroup2         | RLBK_9501_DONE renamed Logged_Rlbk_End                                                            | postgres
 CONSOLIDATE_RLBK_GROUP | BEGIN          | myGroup2         | Erase all between marks Before ADD_TBL and Logged_Rlbk_End                                        | postgres
 CONSOLIDATE_RLBK_GROUP | END            | myGroup2         | 1 tables and 2 sequences processed ; 4 marks deleted                                              | postgres
 REMOVE_TABLE           | BEGIN          |                  |                                                                                                   | postgres
 REMOVE_TABLE           | TIME STAMP SET | 9509             |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 7 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         | Remove mytbl7                                                                                     | postgres
 CLEANUP_RLBK_STATE     |                | Rollback id 9501 | set to COMMITTED                                                                                  | postgres
 SET_MARK_GROUP         | END            | myGroup2         | Remove mytbl7                                                                                     | postgres
 REMOVE_TABLE           | TABLE REMOVED  | myschema2.mytbl7 | From the logging group myGroup2                                                                   | postgres
 REMOVE_TABLE           | END            |                  | 1 tables removed from their groups                                                                | postgres
 ASSIGN_TABLE           | BEGIN          |                  |                                                                                                   | postgres
 ASSIGN_TABLE           | TIME STAMP SET | 9510             |                                                                                                   | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUP             | END            | myGroup2         | 6 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup2         | Re-add mytbl7                                                                                     | postgres
 SET_MARK_GROUP         | END            | myGroup2         | Re-add mytbl7                                                                                     | postgres
 ASSIGN_TABLE           | TABLE ADDED    | myschema2.mytbl7 | To the logging group myGroup2                                                                     | postgres
 ASSIGN_TABLE           | END            |                  | 1 tables assigned to the group myGroup2                                                           | postgres
 IMPORT_GROUPS          | BEGIN          | myGroup2         | Input file: '/tmp/emaj_15/alter_logging/all_groups_conf.json'                                     | postgres
 IMPORT_GROUPS          | TIME STAMP SET | 9511             |                                                                                                   | postgres
 LOCK_GROUPS            | BEGIN          | myGroup2         |                                                                                                   | postgres
 LOCK_GROUPS            | END            | myGroup2         | 7 tables locked, 0 deadlock(s)                                                                    | postgres
 SET_MARK_GROUPS        | BEGIN          | myGroup2         | IMPORT_%                                                                                          | postgres
 SET_MARK_GROUPS        | END            | myGroup2         | IMPORT_%                                                                                          | postgres
 IMPORT_GROUPS          | TABLE REMOVED  | myschema2.mytbl7 | From the logging group myGroup2                                                                   | postgres
 IMPORT_GROUPS          | END            |                  | 1 created or altered tables groups                                                                | postgres
 ROLLBACK_GROUP         | BEGIN          | myGroup2         | Unlogged rollback to mark ADD_TBL test (timestamp)                                                | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1           | Status = 1                                                                                        | postgres
 LOCK_GROUP             | BEGIN          | myGroup2         | Rollback session #1                                                                               | postgres
 LOCK_GROUP             | END            | myGroup2         | Rollback session #1: 6 tables locked, 0 deadlock(s)                                               | postgres
 ROLLBACK_GROUP         | TIME STAMP SET | 9512             |                                                                                                   | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup2         | mark Before ADD_TBL is deleted                                                                    | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup2         | mark Logged_Rlbk_End is deleted                                                                   | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup2         | mark Remove mytbl7 is deleted                                                                     | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup2         | mark Re-add mytbl7 is deleted                                                                     | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup2         | mark IMPORT_% is deleted                                                                          | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9502 | Rollback id = 9502.                                                                               | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9502 | 0 / 6 tables effectively processed.                                                               | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9502 | 0 / 2 sequences effectively processed.                                                            | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9502 | The table myschema2.mytbl7 has been left unchanged (not in group anymore since <timestamp>)       | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1           |                                                                                                   | postgres
 ROLLBACK_GROUP         | END            | myGroup2         | Rollback_id 9502                                                                                  | postgres
(93 rows)

-- set sequence restart value
select public.handle_emaj_sequences(9700);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- remove tables
-----------------------------
insert into myschema1."myTbl3" (col33) values (1.);
select emaj.emaj_set_mark_group('myGroup1','Mk2c');
 emaj_set_mark_group 
---------------------
                   7
(1 row)

insert into myschema1."myTbl3" (col33) values (1.);
select emaj.emaj_remove_tables('myschema1', '^(myTbl3|mytbl2b)$', null, '2 tables removed from myGroup1');
 emaj_remove_tables 
--------------------
                  2
(1 row)

select group_name, group_last_alter_time_id, group_nb_table, group_nb_sequence
  from emaj.emaj_group where group_name = 'myGroup1';
 group_name | group_last_alter_time_id | group_nb_table | group_nb_sequence 
------------+--------------------------+----------------+-------------------
 myGroup1   |                     9701 |              3 |                 2
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table, rel_log_seq_last_value
  from emaj.emaj_relation where rel_schema = 'myschema1' and (rel_tblseq = 'myTbl3' or rel_tblseq = 'mytbl2b') order by 1,2,3;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+---------------+------------------------
 myschema1  | myTbl3     | [8019,9701)    | myGroup1  | r        | emaj_myschema1 | myTbl3_log_1  |                      3
 myschema1  | mytbl2b    | [8202,9701)    | myGroup1  | r        | emaj_myschema1 | mytbl2b_log_1 |                      0
(2 rows)

delete from myschema1."myTbl3" where col33 = 1.;
select count(*) from emaj_myschema1."myTbl3_log_1";
 count 
-------
     2
(1 row)

select * from emaj.emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                                        msg                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Warning: In tables group "myGroup1", the sequence "myschema1"."myTbl3_col31_seq" is linked to the table "myschema1"."myTbl3" but this table does not belong to any tables group.
 Warning: In tables group "myGroup1", the sequence "myschema1"."mytbl2b_col20_seq" is linked to the table "myschema1"."mytbl2b" but this table does not belong to any tables group.
 No error detected
(3 rows)

-- test statistics following a rollback targeting a mark set before a REMOVE_TBL
begin;
  delete from emaj.emaj_param where param_key = 'dblink_user_password';
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup1','Mk2c',true);
 rlbk_severity |                                        regexp_replace                                         
---------------+-----------------------------------------------------------------------------------------------
 Notice        | Rollback id = 9700.
 Notice        | 0 / 3 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
 Warning       | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema1.mytbl2b has been left unchanged (not in group anymore since <timestamp>)
(5 rows)

  select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows
    from emaj.emaj_log_stat_group('myGroup1','Mk2b',NULL) order by 1,2,3,4;
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id | stat_last_mark | stat_last_time_id | stat_rows 
------------+-------------+------------+-----------------+--------------------+----------------+-------------------+-----------
 myGroup1   | myschema1   | myTbl3     | Mk2b            |               9300 | [deleted mark] |              9701 |         2
 myGroup1   | myschema1   | mytbl1     | Mk2b            |               9300 |                |                   |         0
 myGroup1   | myschema1   | mytbl2     | Mk2b            |               9300 |                |                   |         0
 myGroup1   | myschema1   | mytbl2b    | Mk2b            |               9300 | [deleted mark] |              9701 |         0
 myGroup1   | myschema1   | mytbl4     | Mk2b            |               9300 |                |                   |         0
(5 rows)

rollback;
-- get statistics
select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows 
  from emaj.emaj_log_stat_group('myGroup1','Mk1',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id |         stat_last_mark         | stat_last_time_id | stat_rows 
------------+-------------+------------+-----------------+--------------------+--------------------------------+-------------------+-----------
 myGroup1   | myschema1   | myTbl3     | Mk1             |               9001 | 2 tables removed from myGroup1 |              9701 |         2
 myGroup1   | myschema1   | mytbl1     | Mk1             |               9001 |                                |                   |         0
 myGroup1   | myschema1   | mytbl2     | Mk1             |               9001 |                                |                   |         0
 myGroup1   | myschema1   | mytbl2b    | Mk1             |               9001 | 2 tables removed from myGroup1 |              9701 |         0
 myGroup1   | myschema1   | mytbl4     | Mk1             |               9001 |                                |                   |         0
(5 rows)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_role, stat_verb, stat_rows 
  from emaj.emaj_detailed_log_stat_group('myGroup1','Mk1',NULL);
 stat_group | stat_schema | stat_table | stat_first_mark | stat_first_time_id |         stat_last_mark         | stat_last_time_id | stat_role | stat_verb | stat_rows 
------------+-------------+------------+-----------------+--------------------+--------------------------------+-------------------+-----------+-----------+-----------
 myGroup1   | myschema1   | myTbl3     | Mk1             |               9001 | 2 tables removed from myGroup1 |              9701 | postgres  | INSERT    |         2
(1 row)

select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_changes, stat_rollbacks
  from emaj.emaj_log_stat_table('myschema1', 'myTbl3', 'myGroup1', 'Revert_sequences_removal');
 stat_group |     stat_first_mark      | stat_is_log_start |         stat_last_mark         | stat_is_log_stop | stat_changes | stat_rollbacks 
------------+--------------------------+-------------------+--------------------------------+------------------+--------------+----------------
 myGroup1   | Revert_sequences_removal | f                 | Mk2c                           | f                |            1 |              0
 myGroup1   | Mk2c                     | f                 | 2 tables removed from myGroup1 | t                |            1 |              0
(2 rows)

--testing snap, dump changes and sql generation
select emaj.emaj_snap_group('myGroup1',:'EMAJTESTTMPDIR' || '/snap','');
 emaj_snap_group 
-----------------
               5
(1 row)

\! ls $EMAJTESTTMPDIR/snap
_INFO
myschema1_myTbl3_col31_seq.snap
myschema1_mytbl1.snap
myschema1_mytbl2.snap
myschema1_mytbl2b_col20_seq.snap
myschema1_mytbl4.snap
\! rm $EMAJTESTTMPDIR/snap/*
select emaj.emaj_set_mark_group('myGroup1','After_2_tables_removed');
 emaj_set_mark_group 
---------------------
                   5
(1 row)

select emaj.emaj_gen_sql_dump_changes_group('myGroup1','Mk1','EMAJ_LAST_MARK','TABLES_ONLY',NULL);
                    emaj_gen_sql_dump_changes_group                    
-----------------------------------------------------------------------
 5 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

select sql_text from emaj_temp_sql where sql_line_number = 0;
                                                                  sql_text                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup1" between marks "Mk1" and "After_2_tables_removed" using options: TABLES_ONLY
 -- Dump changes for table myschema1.myTbl3 between marks "Mk1" and "2 tables removed from myGroup1" (2 changes)
 -- Dump changes for table myschema1.mytbl1 between marks "Mk1" and "After_2_tables_removed" (0 changes)
 -- Dump changes for table myschema1.mytbl2 between marks "Mk1" and "After_2_tables_removed" (0 changes)
 -- Dump changes for table myschema1.mytbl2b between marks "Mk1" and "2 tables removed from myGroup1" (0 changes)
 -- Dump changes for table myschema1.mytbl4 between marks "Mk1" and "After_2_tables_removed" (0 changes)
(6 rows)

select emaj.emaj_gen_sql_group('myGroup1', 'Mk1', NULL, :'EMAJTESTTMPDIR' || '/script.sql',array['myschema1.myTbl3']);
 emaj_gen_sql_group 
--------------------
                  2
(1 row)

\! rm $EMAJTESTTMPDIR/script.sql
-- test marks deletions
begin;
-- testing delete a single mark set before the table removal
  select emaj.emaj_delete_mark_group('myGroup1','Mk2c');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select * from emaj.emaj_mark where mark_group = 'myGroup1' and mark_name = 'Mk2b';
 mark_group | mark_name | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+-----------+--------------+------------------------+--------------+---------------------------+------------------------------
 myGroup1   | Mk2b      |         9300 | f                      |              |                         0 | 
(1 row)

-- testing marks deletion (delete all marks before the alter_group)
  select emaj.emaj_delete_before_mark_group('myGroup1','EMAJ_LAST_MARK');
 emaj_delete_before_mark_group 
-------------------------------
                            12
(1 row)

  select 'should not exist' from pg_class, pg_namespace 
    where relnamespace = pg_namespace.oid and nspname = 'emaj_myschema1' and relname in ('myTbl3_log','mytbl2b_log');
 ?column? 
----------
(0 rows)

  select count(*) from emaj.emaj_relation where rel_schema = 'myschema1' and rel_tblseq in ('myTbl3','mytbl2b');
 count 
-------
     0
(1 row)

  select * from emaj.emaj_rel_hist where relh_schema = 'myschema1' and relh_tblseq in ('myTbl3','mytbl2b') order by 1,2,3;
 relh_schema | relh_tblseq | relh_time_range | relh_group | relh_kind 
-------------+-------------+-----------------+------------+-----------
 myschema1   | myTbl3      | [2000,8001)     | myGroup1   | r
 myschema1   | myTbl3      | [8010,8014)     | myGroup1   | r
 myschema1   | myTbl3      | [8019,9701)     | myGroup1   | r
 myschema1   | mytbl2b     | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl2b     | [8010,8013)     | myGroup1   | r
 myschema1   | mytbl2b     | [8019,8201)     | myGroup1   | r
 myschema1   | mytbl2b     | [8201,8202)     | myGroup2   | r
 myschema1   | mytbl2b     | [8202,9701)     | myGroup1   | r
(8 rows)

rollback;
begin;
-- testing the alter group mark deletion
  select emaj.emaj_delete_mark_group('myGroup1','2 tables removed from myGroup1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table, rel_log_seq_last_value
    from emaj.emaj_relation where rel_schema = 'myschema1' and (rel_tblseq = 'myTbl3' or rel_tblseq = 'mytbl2b') order by rel_tblseq;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+---------------+------------------------
 myschema1  | myTbl3     | [8019,9701)    | myGroup1  | r        | emaj_myschema1 | myTbl3_log_1  |                      3
 myschema1  | mytbl2b    | [8202,9701)    | myGroup1  | r        | emaj_myschema1 | mytbl2b_log_1 |                      0
(2 rows)

  select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table
    where tbl_name in ('mytbl2b', 'myTbl3') order by tbl_time_id desc, tbl_name limit 2;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema1  | myTbl3   |        9701 |                    3
 myschema1  | mytbl2b  |        9701 |                    0
(2 rows)

  select * from emaj.emaj_mark where mark_group = 'myGroup1' and mark_name = '2 tables removed from myGroup1';
 mark_group | mark_name | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+-----------+--------------+------------------------+--------------+---------------------------+------------------------------
(0 rows)

  select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_changes, stat_rollbacks
    from emaj.emaj_log_stat_table('myschema1', 'myTbl3', 'myGroup1', 'Revert_sequences_removal');
 stat_group |     stat_first_mark      | stat_is_log_start | stat_last_mark | stat_is_log_stop | stat_changes | stat_rollbacks 
------------+--------------------------+-------------------+----------------+------------------+--------------+----------------
 myGroup1   | Revert_sequences_removal | f                 | Mk2c           | f                |            1 |              0
 myGroup1   | Mk2c                     | f                 | [deleted mark] | t                |            1 |              0
(2 rows)

rollback;
begin;
-- testing marks deletion (other cases)
  select emaj.emaj_set_mark_group('myGroup1','Mk2d');
 emaj_set_mark_group 
---------------------
                   5
(1 row)

  select emaj.emaj_delete_before_mark_group('myGroup1','Mk2b');
 emaj_delete_before_mark_group 
-------------------------------
                             6
(1 row)

  select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table, rel_log_seq_last_value
    from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range) order by 1,2,3;
 rel_schema |    rel_tblseq    | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table | rel_log_seq_last_value 
------------+------------------+----------------+-----------+----------+----------------+---------------+------------------------
 myschema1  | myTbl3           | [8019,9701)    | myGroup1  | r        | emaj_myschema1 | myTbl3_log_1  |                      3
 myschema1  | myTbl3_col31_seq | [8010,9302)    | myGroup1  | S        |                |               |                       
 myschema1  | mytbl2b          | [8202,9701)    | myGroup1  | r        | emaj_myschema1 | mytbl2b_log_1 |                      0
(3 rows)

  select * from emaj.emaj_rel_hist where relh_schema = 'myschema1' and relh_tblseq = 'mytbl2b' order by 1,2,3;
 relh_schema | relh_tblseq | relh_time_range | relh_group | relh_kind 
-------------+-------------+-----------------+------------+-----------
 myschema1   | mytbl2b     | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl2b     | [8010,8013)     | myGroup1   | r
 myschema1   | mytbl2b     | [8019,8201)     | myGroup1   | r
 myschema1   | mytbl2b     | [8201,8202)     | myGroup2   | r
(4 rows)

  select 'found' from pg_class, pg_namespace where relnamespace = pg_namespace.oid and relname = 'mytbl2b_log_1' and nspname = 'emaj_myschema1';
 ?column? 
----------
 found
(1 row)

  select emaj.emaj_delete_before_mark_group('myGroup1','Mk2d');
 emaj_delete_before_mark_group 
-------------------------------
                             8
(1 row)

  select 'should not exist' from pg_class, pg_namespace where relnamespace = pg_namespace.oid and relname = 'mytbl2b_log' and nspname = 'emaj_myschema1';
 ?column? 
----------
(0 rows)

  select count(*) from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range);
 count 
-------
     0
(1 row)

  select * from emaj.emaj_rel_hist where relh_schema = 'myschema1' and relh_tblseq = 'mytbl2b' order by 1,2,3;
 relh_schema | relh_tblseq | relh_time_range | relh_group | relh_kind 
-------------+-------------+-----------------+------------+-----------
 myschema1   | mytbl2b     | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl2b     | [8010,8013)     | myGroup1   | r
 myschema1   | mytbl2b     | [8019,8201)     | myGroup1   | r
 myschema1   | mytbl2b     | [8201,8202)     | myGroup2   | r
 myschema1   | mytbl2b     | [8202,9701)     | myGroup1   | r
(5 rows)

rollback;
-- testing rollback and consolidation
insert into myschema1.mytbl1 values (100, 'Alter_logg', E'\\000'::bytea);
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_logged_rollback_group('myGroup1','Mk2b',true) order by 1,2;
 rlbk_severity |                                                     regexp_replace                                                     
---------------+------------------------------------------------------------------------------------------------------------------------
 Notice        | 1 / 2 sequences effectively processed.
 Notice        | 1 / 3 tables effectively processed.
 Notice        | Rollback id = 9701.
 Warning       | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema1.mytbl2b has been left unchanged (not in group anymore since <timestamp>)
(6 rows)

select emaj.emaj_rename_mark_group('myGroup1','EMAJ_LAST_MARK','Logged_Rlbk_End');
 emaj_rename_mark_group 
------------------------
 
(1 row)

select emaj.emaj_remove_table('myschema1', 'mytbl1','2nd remove_tbl');
 emaj_remove_table 
-------------------
                 1
(1 row)

select * from emaj.emaj_get_consolidable_rollbacks() where cons_group = 'myGroup1';
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 myGroup1   | Mk2b                       |                          9300 | Logged_Rlbk_End         |                       9706 |         2 |          8
(1 row)

select * from emaj.emaj_consolidate_rollback_group('myGroup1', 'Logged_Rlbk_End');
 emaj_consolidate_rollback_group 
---------------------------------
                               3
(1 row)

select count(*) from emaj_myschema1.mytbl1_log_1;   -- the log table should be empty
 count 
-------
     0
(1 row)

select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_group('myGroup1','Mk2b',true) order by 1,2;
 rlbk_severity |                                                     regexp_replace                                                     
---------------+------------------------------------------------------------------------------------------------------------------------
 Notice        | 0 / 2 sequences effectively processed.
 Notice        | 0 / 2 tables effectively processed.
 Notice        | Rollback id = 9702.
 Warning       | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema1.mytbl1 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema1.mytbl2b has been left unchanged (not in group anymore since <timestamp>)
(7 rows)

-- testing group's reset
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               4
(1 row)

  select emaj.emaj_reset_group('myGroup1');
 emaj_reset_group 
------------------
                4
(1 row)

  select * from emaj.emaj_rel_hist where relh_schema = 'myschema1' and upper(relh_time_range) > 6050 order by 1,2,3;
 relh_schema |    relh_tblseq    | relh_time_range | relh_group | relh_kind 
-------------+-------------------+-----------------+------------+-----------
 myschema1   | myTbl3            | [2000,8001)     | myGroup1   | r
 myschema1   | myTbl3            | [8010,8014)     | myGroup1   | r
 myschema1   | myTbl3            | [8019,9701)     | myGroup1   | r
 myschema1   | myTbl3_col31_seq  | [2000,8001)     | myGroup1   | S
 myschema1   | myTbl3_col31_seq  | [8010,9302)     | myGroup1   | S
 myschema1   | mytbl1            | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl1            | [8010,8012)     | myGroup1   | r
 myschema1   | mytbl1            | [8019,8200)     | myGroup1   | r
 myschema1   | mytbl1            | [8200,8202)     | myGroup2   | r
 myschema1   | mytbl1            | [8202,9707)     | myGroup1   | r
 myschema1   | mytbl2            | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl2            | [8010,8013)     | myGroup1   | r
 myschema1   | mytbl2            | [8019,8201)     | myGroup1   | r
 myschema1   | mytbl2            | [8201,8203)     | myGroup2   | r
 myschema1   | mytbl2b           | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl2b           | [8010,8013)     | myGroup1   | r
 myschema1   | mytbl2b           | [8019,8201)     | myGroup1   | r
 myschema1   | mytbl2b           | [8201,8202)     | myGroup2   | r
 myschema1   | mytbl2b           | [8202,9701)     | myGroup1   | r
 myschema1   | mytbl2b_col20_seq | [2000,8001)     | myGroup1   | S
 myschema1   | mytbl4            | [2000,8001)     | myGroup1   | r
 myschema1   | mytbl4            | [8010,8014)     | myGroup1   | r
(22 rows)

rollback;
-- testing group's stop and start
begin;
  select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               4
(1 row)

  select emaj.emaj_start_group('myGroup1');
WARNING:  _check_fk_groups: The foreign key "mytbl4_col44_fkey" on the table "myschema1.mytbl4" references the table "myschema1.mytbl1" that is outside the groups (myGroup1).
 emaj_start_group 
------------------
                4
(1 row)

  select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table, rel_log_seq_last_value
    from emaj.emaj_relation where rel_group = 'myGroup1' and not upper_inf(rel_time_range) order by 1,2,3;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+---------------+------------------------
(0 rows)

  select 'should not exist' from pg_class, pg_namespace where relnamespace = pg_namespace.oid and relname = 'mytbl2b_log' and nspname = 'emaj_myschema1';
 ?column? 
----------
(0 rows)

rollback;
-- testing the table drop (remove first the sequence linked to the table, otherwise an event triger fires)
begin;
  select emaj.emaj_remove_sequence('myschema1', 'myTbl3_col31_seq','remove_seq_before_drop_mytbl3');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

  drop table mySchema1."myTbl3";
rollback;
-- testing an ALTER TABLE leading to a table rewrite
begin;
  alter table mySchema1."myTbl3" alter column col33 type decimal (10,1);
rollback;
-- re-add all removed tables
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json', array['myGroup1'], true, 'Revert_tables_removal');
 emaj_import_groups_configuration 
----------------------------------
                                1
(1 row)

select emaj.emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           0
(1 row)

-- set an intermediate mark
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','Mk3');
 emaj_set_mark_groups 
----------------------
                   15
(1 row)

select mark_group, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_time_id,
       mark_is_rlbk_protected, mark_comment, mark_log_rows_before_next, mark_logged_rlbk_target_mark
  from emaj.emaj_mark order by mark_time_id, mark_group;
 mark_group |    regexp_replace     | mark_time_id | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+-----------------------+--------------+------------------------+--------------+---------------------------+------------------------------
 myGroup1   | Mk1                   |         9001 | f                      |              |                         0 | 
 myGroup2   | Mk1                   |         9001 | f                      |              |                         0 | 
 myGroup1   | Priority Changed      |         9002 | f                      |              |                         0 | 
 myGroup1   | Attributes_changed_1  |         9003 | f                      |              |                         0 | 
 myGroup2   | Attributes_changed_2  |         9004 | f                      |              |                         0 | 
 myGroup1   | MODIFY_%              |         9005 | f                      |              |                         0 | 
 myGroup1   | Mk2                   |         9006 | f                      |              |                         0 | 
 myGroup2   | Mk2                   |         9006 | f                      |              |                         0 | 
 myGroup1   | IMPORT_%              |         9008 | f                      |              |                         0 | 
 myGroup2   | IMPORT_%              |         9008 | f                      |              |                         0 | 
 myGroup2   | ADD_SEQ test          |         9100 | f                      |              |                         0 | 
 myGroup1   | Mk2b                  |         9300 | f                      |              |                         0 | 
 myGroup2   | ADD_TBL test          |         9500 | f                      |              |                         0 | 
 myGroup1   | Revert_tables_removal |         9713 | f                      |              |                         0 | 
 myGroup1   | Mk3                   |         9714 | f                      |              |                           | 
 myGroup2   | Mk3                   |         9714 | f                      |              |                           | 
(16 rows)

-- estimate a rollback crossing alter group operations
delete from emaj.emaj_rlbk_stat;    -- to avoid unstable results in estimates
select emaj.emaj_estimate_rollback_groups('{"myGroup1","myGroup2"}','Mk1',false);
 emaj_estimate_rollback_groups 
-------------------------------
 @ 0.0215 secs
(1 row)

-- execute a rollback not crossing any alter group operation
select * from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mk3',false) order by 1,2;
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
 Notice        | Rollback id = 9703.
(3 rows)

-- execute rollbacks crossing alter group operations
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mk2');
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 59 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mk2',false) order by 1,2;
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 59 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, TRUE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_logged_rollback_groups(text[],text,boolean,text) line 12 at RETURN QUERY
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','Mk2',true) order by 1,2;
 rlbk_severity |                                                     regexp_replace                                                     
---------------+------------------------------------------------------------------------------------------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
 Notice        | Rollback id = 9704.
 Warning       | Tables group change not rolled back: E-Maj priority for myschema1.mytbl1
 Warning       | Tables group change not rolled back: ignored triggers list for myschema1.mytbl2
 Warning       | Tables group change not rolled back: log data tablespace for myschema1.mytbl2b
 Warning       | Tables group change not rolled back: log index tablespace for myschema2.mytbl6
 Warning       | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The sequence myschema2.myseq2 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema1."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema1.mytbl1 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema1.mytbl2b has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema2.mytbl7 has been left unchanged (not in group anymore since <timestamp>)
(13 rows)

select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','Mk1',true,'Rollback 2 groups crossing an alter group') order by 1,2;
 rlbk_severity |                                                     regexp_replace                                                     
---------------+------------------------------------------------------------------------------------------------------------------------
 Notice        | 0 / 11 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
 Notice        | Rollback id = 9705.
 Warning       | Tables group change not rolled back: E-Maj priority for myschema1.mytbl1
 Warning       | Tables group change not rolled back: ignored triggers list for myschema1.mytbl2
 Warning       | Tables group change not rolled back: log data tablespace for myschema1.mytbl2b
 Warning       | Tables group change not rolled back: log index tablespace for myschema2.mytbl6
 Warning       | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The sequence myschema2.myseq2 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The table myschema1."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema1.mytbl1 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema1.mytbl2b has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema2.mytbl7 has been left unchanged (not in group anymore since <timestamp>)
(13 rows)

-- checks for remove tables tests
select * from emaj.emaj_relation_change where rlchg_time_id >= 9700 order by 1,2,3,4;
 rlchg_time_id | rlchg_schema | rlchg_tblseq | rlchg_change_kind | rlchg_group | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers | rlchg_new_ignored_triggers 
---------------+--------------+--------------+-------------------+-------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+------------------------+----------------------------
          9701 | myschema1    | myTbl3       | REMOVE_TABLE      | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9701 | myschema1    | mytbl2b      | REMOVE_TABLE      | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9707 | myschema1    | mytbl1       | REMOVE_TABLE      | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9713 | myschema1    | myTbl3       | ADD_TABLE         | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9713 | myschema1    | mytbl1       | ADD_TABLE         | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
          9713 | myschema1    | mytbl2b      | ADD_TABLE         | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
(6 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 9700 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
    9700 |            9700001 | M
    9701 |            9700002 | A
    9703 |            9700002 | M
    9705 |            9700003 | R
    9706 |            9700004 | M
    9707 |            9700004 | A
    9708 |            9700004 | R
    9713 |            9700004 | I
    9714 |            9700004 | M
    9715 |            9700004 | R
    9716 |            9700004 | R
    9717 |            9700004 | M
    9718 |            9700004 | R
(13 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist where hist_id >= 9700 order by hist_id;
     hist_function      |   hist_event   |         hist_object          |                                                     regexp_replace                                                     | hist_user 
------------------------+----------------+------------------------------+------------------------------------------------------------------------------------------------------------------------+-----------
 SET_MARK_GROUP         | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP             | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP             | END            | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP         | TIME STAMP SET | 9700                         |                                                                                                                        | postgres
 CLEANUP_RLBK_STATE     |                | Rollback id 9502             | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUP         | END            | myGroup1                     | Mk2c                                                                                                                   | postgres
 REMOVE_TABLES          | BEGIN          |                              |                                                                                                                        | postgres
 REMOVE_TABLES          | TIME STAMP SET | 9701                         |                                                                                                                        | postgres
 LOCK_GROUP             | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP             | END            | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup1                     | 2 tables removed from myGroup1                                                                                         | postgres
 SET_MARK_GROUP         | END            | myGroup1                     | 2 tables removed from myGroup1                                                                                         | postgres
 REMOVE_TABLES          | TABLE REMOVED  | myschema1."myTbl3"           | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLES          | TABLE REMOVED  | myschema1.mytbl2b            | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLES          | END            |                              | 2 tables removed from their groups                                                                                     | postgres
 SNAP_GROUP             | BEGIN          | myGroup1                     | /tmp/emaj_15/alter_logging/snap                                                                                        | postgres
 SNAP_GROUP             | END            | myGroup1                     | 5 tables/sequences processed                                                                                           | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP             | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP             | END            | myGroup1                     | 3 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP         | TIME STAMP SET | 9703                         |                                                                                                                        | postgres
 SET_MARK_GROUP         | END            | myGroup1                     | After_2_tables_removed                                                                                                 | postgres
 GEN_SQL_GROUP          | BEGIN          | myGroup1                     | From mark Mk1 to current state with tables/sequences filtering                                                         | postgres
 GEN_SQL_GROUP          | END            | myGroup1                     | 2 generated statements - script exported into /tmp/emaj_15/alter_logging/script.sql                                    | postgres
 ROLLBACK_GROUP         | BEGIN          | myGroup1                     | Logged rollback to mark Mk2b (timestamp)                                                                               | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP             | BEGIN          | myGroup1                     | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP             | END            | myGroup1                     | Rollback session #1: 3 tables locked, 0 deadlock(s)                                                                    | postgres
 ROLLBACK_GROUP         | TIME STAMP SET | 9705                         |                                                                                                                        | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup1                     | RLBK_9701_START                                                                                                        | postgres
 SET_MARK_GROUP         | END            | myGroup1                     | RLBK_9701_START                                                                                                        | postgres
 ROLLBACK_SEQUENCE      |                | myschema1."myTbl3_col31_seq" | RESTART 11                                                                                                             | postgres
 ROLLBACK_TABLE         | BEGIN          | myschema1.mytbl1             | All log rows where emaj_gid > 9300000 and <= 9700003, in session_replication_role = replica mode                       | postgres
 ROLLBACK_TABLE         | END            | myschema1.mytbl1             | 1 rolled back primary keys                                                                                             | postgres
 ROLLBACK_GROUP         | TIME STAMP SET | 9706                         |                                                                                                                        | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup1                     | RLBK_9701_DONE                                                                                                         | postgres
 SET_MARK_GROUP         | END            | myGroup1                     | RLBK_9701_DONE                                                                                                         | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9701             | Rollback id = 9701.                                                                                                    | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9701             | 1 / 3 tables effectively processed.                                                                                    | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9701             | 1 / 2 sequences effectively processed.                                                                                 | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9701             | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9701             | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>)                          | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9701             | The table myschema1.mytbl2b has been left unchanged (not in group anymore since <timestamp>)                           | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUP         | END            | myGroup1                     | Rollback_id 9701                                                                                                       | postgres
 RENAME_MARK_GROUP      | BEGIN          | myGroup1                     | EMAJ_LAST_MARK                                                                                                         | postgres
 RENAME_MARK_GROUP      | END            | myGroup1                     | RLBK_9701_DONE renamed Logged_Rlbk_End                                                                                 | postgres
 REMOVE_TABLE           | BEGIN          |                              |                                                                                                                        | postgres
 REMOVE_TABLE           | TIME STAMP SET | 9707                         |                                                                                                                        | postgres
 LOCK_GROUP             | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP             | END            | myGroup1                     | 3 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP         | BEGIN          | myGroup1                     | 2nd remove_tbl                                                                                                         | postgres
 CLEANUP_RLBK_STATE     |                | Rollback id 9701             | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUP         | END            | myGroup1                     | 2nd remove_tbl                                                                                                         | postgres
 REMOVE_TABLE           | TABLE REMOVED  | myschema1.mytbl1             | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLE           | END            |                              | 1 tables removed from their groups                                                                                     | postgres
 CONSOLIDATE_RLBK_GROUP | BEGIN          | myGroup1                     | Erase all between marks Mk2b and Logged_Rlbk_End                                                                       | postgres
 CONSOLIDATE_RLBK_GROUP | END            | myGroup1                     | 1 tables and 2 sequences processed ; 8 marks deleted                                                                   | postgres
 ROLLBACK_GROUP         | BEGIN          | myGroup1                     | Unlogged rollback to mark Mk2b (timestamp)                                                                             | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP             | BEGIN          | myGroup1                     | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP             | END            | myGroup1                     | Rollback session #1: 2 tables locked, 0 deadlock(s)                                                                    | postgres
 ROLLBACK_GROUP         | TIME STAMP SET | 9708                         |                                                                                                                        | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup1                     | mark Logged_Rlbk_End is deleted                                                                                        | postgres
 ROLLBACK_GROUP         | MARK DELETED   | myGroup1                     | mark 2nd remove_tbl is deleted                                                                                         | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9702             | Rollback id = 9702.                                                                                                    | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9702             | 0 / 2 tables effectively processed.                                                                                    | postgres
 ROLLBACK_GROUP         | NOTICE         | Rollback id 9702             | 0 / 2 sequences effectively processed.                                                                                 | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9702             | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9702             | The table myschema1."myTbl3" has been left unchanged (not in group anymore since <timestamp>)                          | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9702             | The table myschema1.mytbl2b has been left unchanged (not in group anymore since <timestamp>)                           | postgres
 ROLLBACK_GROUP         | WARNING        | Rollback id 9702             | The table myschema1.mytbl1 has been left unchanged (not in group anymore since <timestamp>)                            | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUP         | END            | myGroup1                     | Rollback_id 9702                                                                                                       | postgres
 IMPORT_GROUPS          | BEGIN          | myGroup1                     | Input file: '/tmp/emaj_15/alter_logging/all_groups_conf.json'                                                          | postgres
 IMPORT_GROUPS          | TIME STAMP SET | 9713                         |                                                                                                                        | postgres
 LOCK_GROUPS            | BEGIN          | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUPS            | END            | myGroup1                     | 2 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUPS        | BEGIN          | myGroup1                     | Revert_tables_removal                                                                                                  | postgres
 CLEANUP_RLBK_STATE     |                | Rollback id 9702             | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUPS        | END            | myGroup1                     | Revert_tables_removal                                                                                                  | postgres
 IMPORT_GROUPS          | TABLE ADDED    | myschema1."myTbl3"           | To the logging group myGroup1                                                                                          | postgres
 IMPORT_GROUPS          | TABLE ADDED    | myschema1.mytbl1             | To the logging group myGroup1                                                                                          | postgres
 IMPORT_GROUPS          | TABLE ADDED    | myschema1.mytbl2b            | To the logging group myGroup1                                                                                          | postgres
 IMPORT_GROUPS          | END            |                              | 1 created or altered tables groups                                                                                     | postgres
 SET_MARK_GROUPS        | BEGIN          | myGroup1,myGroup2            | Mk3                                                                                                                    | postgres
 LOCK_GROUPS            | BEGIN          | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUPS            | END            | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS        | TIME STAMP SET | 9714                         |                                                                                                                        | postgres
 SET_MARK_GROUPS        | END            | myGroup1,myGroup2            | Mk3                                                                                                                    | postgres
 ROLLBACK_GROUPS        | BEGIN          | myGroup1,myGroup2            | Unlogged rollback to mark Mk3 (timestamp)                                                                              | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP             | BEGIN          | myGroup1,myGroup2            | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP             | END            | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)                                                                   | postgres
 ROLLBACK_GROUPS        | TIME STAMP SET | 9715                         |                                                                                                                        | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9703             | Rollback id = 9703.                                                                                                    | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9703             | 0 / 11 tables effectively processed.                                                                                   | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9703             | 0 / 4 sequences effectively processed.                                                                                 | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUPS        | END            | myGroup1,myGroup2            | Rollback_id 9703                                                                                                       | postgres
 ROLLBACK_GROUPS        | BEGIN          | myGroup1,myGroup2            | Logged rollback to mark Mk2 (timestamp)                                                                                | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP             | BEGIN          | myGroup1,myGroup2            | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP             | END            | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)                                                                   | postgres
 ROLLBACK_GROUPS        | TIME STAMP SET | 9716                         |                                                                                                                        | postgres
 SET_MARK_GROUPS        | BEGIN          | myGroup1,myGroup2            | RLBK_9704_START                                                                                                        | postgres
 CLEANUP_RLBK_STATE     |                | Rollback id 9703             | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUPS        | END            | myGroup1,myGroup2            | RLBK_9704_START                                                                                                        | postgres
 ROLLBACK_GROUPS        | TIME STAMP SET | 9717                         |                                                                                                                        | postgres
 SET_MARK_GROUPS        | BEGIN          | myGroup1,myGroup2            | RLBK_9704_DONE                                                                                                         | postgres
 SET_MARK_GROUPS        | END            | myGroup1,myGroup2            | RLBK_9704_DONE                                                                                                         | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9704             | Rollback id = 9704.                                                                                                    | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9704             | 0 / 11 tables effectively processed.                                                                                   | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9704             | 0 / 4 sequences effectively processed.                                                                                 | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | Tables group change not rolled back: log data tablespace for myschema1.mytbl2b                                         | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | Tables group change not rolled back: log index tablespace for myschema2.mytbl6                                         | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | Tables group change not rolled back: E-Maj priority for myschema1.mytbl1                                               | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | Tables group change not rolled back: ignored triggers list for myschema1.mytbl2                                        | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | The sequence myschema2.myseq2 has been left unchanged (not in group anymore since <timestamp>)                         | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | The table myschema2.mytbl7 has been left unchanged (not in group anymore since <timestamp>)                            | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | The table myschema1."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)                    | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | The table myschema1.mytbl1 has only been rolled back to its latest group attachment (<timestamp>)                      | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9704             | The table myschema1.mytbl2b has only been rolled back to its latest group attachment (<timestamp>)                     | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUPS        | END            | myGroup1,myGroup2            | Rollback_id 9704                                                                                                       | postgres
 ROLLBACK_GROUPS        | BEGIN          | myGroup1,myGroup2            | Unlogged rollback to mark Mk1 (timestamp)                                                                              | postgres
 DBLINK_OPEN_CNX        |                | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP             | BEGIN          | myGroup1,myGroup2            | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP             | END            | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)                                                                   | postgres
 ROLLBACK_GROUPS        | TIME STAMP SET | 9718                         |                                                                                                                        | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark Priority Changed is deleted                                                                                       | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark Attributes_changed_1 is deleted                                                                                   | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark Attributes_changed_2 is deleted                                                                                   | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark MODIFY_% is deleted                                                                                               | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark Mk2 is deleted                                                                                                    | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark Mk2 is deleted                                                                                                    | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark IMPORT_% is deleted                                                                                               | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark IMPORT_% is deleted                                                                                               | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark ADD_SEQ test is deleted                                                                                           | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark Mk2b is deleted                                                                                                   | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark ADD_TBL test is deleted                                                                                           | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark Revert_tables_removal is deleted                                                                                  | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark Mk3 is deleted                                                                                                    | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark Mk3 is deleted                                                                                                    | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark RLBK_9704_START is deleted                                                                                        | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark RLBK_9704_START is deleted                                                                                        | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup1                     | mark RLBK_9704_DONE is deleted                                                                                         | postgres
 ROLLBACK_GROUPS        | MARK DELETED   | myGroup2                     | mark RLBK_9704_DONE is deleted                                                                                         | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9705             | Rollback id = 9705.                                                                                                    | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9705             | 0 / 11 tables effectively processed.                                                                                   | postgres
 ROLLBACK_GROUPS        | NOTICE         | Rollback id 9705             | 0 / 4 sequences effectively processed.                                                                                 | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | Tables group change not rolled back: log data tablespace for myschema1.mytbl2b                                         | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | Tables group change not rolled back: log index tablespace for myschema2.mytbl6                                         | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | Tables group change not rolled back: E-Maj priority for myschema1.mytbl1                                               | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | Tables group change not rolled back: ignored triggers list for myschema1.mytbl2                                        | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | The sequence myschema2.myseq2 has been left unchanged (not in group anymore since <timestamp>)                         | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | The sequence myschema1."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | The table myschema2.mytbl7 has been left unchanged (not in group anymore since <timestamp>)                            | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | The table myschema1."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)                    | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | The table myschema1.mytbl1 has only been rolled back to its latest group attachment (<timestamp>)                      | postgres
 ROLLBACK_GROUPS        | WARNING        | Rollback id 9705             | The table myschema1.mytbl2b has only been rolled back to its latest group attachment (<timestamp>)                     | postgres
 DBLINK_CLOSE_CNX       |                | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUPS        | END            | myGroup1,myGroup2            | Rollback_id 9705                                                                                                       | postgres
(164 rows)

-- set sequence restart value
select public.handle_emaj_sequences(10000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- change the group ownership of a table and a sequence (and some other attributes)
-----------------------------
-- case when the source group is idle and the destination group is logging
begin;
  select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               8
(1 row)

  select emaj.emaj_move_table('myschema2', 'myTbl3', 'myGroup1', 'move table to myGroup1 while logging');
 emaj_move_table 
-----------------
               1
(1 row)

  select emaj.emaj_move_sequence('myschema2', 'myTbl3_col31_seq', 'myGroup1', 'move seq to myGroup1 while logging');
 emaj_move_sequence 
--------------------
                  1
(1 row)

  select emaj.emaj_modify_table('myschema2', 'myTbl3', '{"log_data_tablespace":"tsplog1", "log_index_tablespace":"tsplog1"}'::jsonb, 'modify table to myGroup1 while logging');
 emaj_modify_table 
-------------------
                 1
(1 row)

  select hist_function, hist_event, hist_object, hist_wording from emaj.emaj_hist 
    where hist_function like 'MO%' order by hist_id desc limit 13;
 hist_function |          hist_event          |         hist_object          |                        hist_wording                        
---------------+------------------------------+------------------------------+------------------------------------------------------------
 MODIFY_TABLE  | END                          |                              | 1 tables effectively modified
 MODIFY_TABLE  | LOG INDEX TABLESPACE CHANGED | myschema2."myTbl3"           | Default tablespace => tsplog1
 MODIFY_TABLE  | LOG DATA TABLESPACE CHANGED  | myschema2."myTbl3"           | Default tablespace => tsplog1
 MODIFY_TABLE  | TIME STAMP SET               | 10003                        | 
 MODIFY_TABLE  | BEGIN                        |                              | 
 MOVE_SEQUENCE | END                          |                              | 1 sequences moved to the tables group myGroup1
 MOVE_SEQUENCE | SEQUENCE MOVED               | myschema2."myTbl3_col31_seq" | From the idle group myGroup2 to the logging group myGroup1
 MOVE_SEQUENCE | TIME STAMP SET               | 10002                        | 
 MOVE_SEQUENCE | BEGIN                        |                              | 
 MOVE_TABLE    | END                          |                              | 1 tables moved to the tables group myGroup1
 MOVE_TABLE    | TABLE MOVED                  | myschema2."myTbl3"           | From the idle group myGroup2 to the logging group myGroup1
 MOVE_TABLE    | TIME STAMP SET               | 10001                        | 
 MOVE_TABLE    | BEGIN                        |                              | 
(13 rows)

rollback;
-- case when both groups are logging
-- generates updates before the group change
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','before move');
 emaj_set_mark_groups 
----------------------
                   15
(1 row)

update myschema2."myTbl3" set col32 = col32 + '1 day' where col31 >= 8;
select emaj.emaj_move_table('myschema2', 'myTbl3', 'myGroup1', 'move table to myGroup1');
 emaj_move_table 
-----------------
               1
(1 row)

select emaj.emaj_move_sequence('myschema2', 'myTbl3_col31_seq', 'myGroup1', 'move seq to myGroup1');
 emaj_move_sequence 
--------------------
                  1
(1 row)

begin;
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup1','before move',false);
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 59 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
begin;
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup2','before move',false);
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 59 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean,text) line 25 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed, p_comment)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
begin;
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup1','before move',true);
 rlbk_severity |                                                     regexp_replace                                                     
---------------+------------------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 10000.
 Notice        | 0 / 6 tables effectively processed.
 Notice        | 0 / 3 sequences effectively processed.
 Warning       | The table myschema2."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The sequence myschema2."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
(5 rows)

rollback;
begin;
  select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
    from emaj.emaj_rollback_group('myGroup2','before move',true);
 rlbk_severity |                                               regexp_replace                                               
---------------+------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 10001.
 Notice        | 0 / 5 tables effectively processed.
 Notice        | 0 / 1 sequences effectively processed.
 Warning       | The table myschema2."myTbl3" has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The sequence myschema2."myTbl3_col31_seq" has been left unchanged (not in group anymore since <timestamp>)
(5 rows)

rollback;
select emaj.emaj_modify_table('myschema2', 'myTbl3', '{"log_data_tablespace":"tsplog1", "log_index_tablespace":"tsplog1", "priority":100}'::jsonb, 'modify table');
 emaj_modify_table 
-------------------
                 1
(1 row)

select * from emaj.emaj_relation where rel_schema = 'myschema2' and (rel_tblseq = 'myTbl3' or rel_tblseq = 'myTbl3_col31_seq') order by 1,2,3,4;
 rel_schema |    rel_tblseq    | rel_time_range | rel_group | rel_kind | rel_priority | rel_log_schema | rel_log_table | rel_log_dat_tsp |  rel_log_index   | rel_log_idx_tsp | rel_log_sequence | rel_log_function | rel_ignored_triggers | rel_pk_cols | rel_gen_expr_cols | rel_emaj_verb_attnum | rel_has_always_ident_col |     rel_sql_rlbk_columns      | rel_sql_gen_ins_col |                                                  rel_sql_gen_ins_val                                                  |                                                               rel_sql_gen_upd_set                                                               | rel_sql_gen_pk_conditions | rel_log_seq_last_value 
------------+------------------+----------------+-----------+----------+--------------+----------------+---------------+-----------------+------------------+-----------------+------------------+------------------+----------------------+-------------+-------------------+----------------------+--------------------------+-------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------------------
 myschema2  | myTbl3           | [8010,10005)   | myGroup2  | r        |              | emaj_myschema2 | myTbl3_log_1  |                 | myTbl3_log_idx_1 |                 | myTbl3_log_seq   | myTbl3_log_fnct  |                      | {col31}     |                   |                    4 | f                        | tbl.col31,tbl.col32,tbl.col33 |                     | ' || coalesce(o.col31::TEXT,'NULL') || ', ' || quote_nullable(o.col32) || ', ' || coalesce(o.col33::TEXT,'NULL') || ' | col31 = ' || coalesce(n.col31 ::TEXT,'NULL') || ', col32 = ' || quote_nullable(n.col32) || ', col33 = ' || coalesce(n.col33 ::TEXT,'NULL') || ' | col31 = ' || o.col31 || ' |                       
 myschema2  | myTbl3           | [10005,)       | myGroup1  | r        |          100 | emaj_myschema2 | myTbl3_log    | tsplog1         | myTbl3_log_idx   | tsplog1         | myTbl3_log_seq   | myTbl3_log_fnct  |                      | {col31}     |                   |                    4 | f                        | tbl.col31,tbl.col32,tbl.col33 |                     | ' || coalesce(o.col31::TEXT,'NULL') || ', ' || quote_nullable(o.col32) || ', ' || coalesce(o.col33::TEXT,'NULL') || ' | col31 = ' || coalesce(n.col31 ::TEXT,'NULL') || ', col32 = ' || quote_nullable(n.col32) || ', col33 = ' || coalesce(n.col33 ::TEXT,'NULL') || ' | col31 = ' || o.col31 || ' |                       
 myschema2  | myTbl3_col31_seq | [8019,10006)   | myGroup2  | S        |              |                |               |                 |                  |                 |                  |                  |                      |             |                   |                      |                          |                               |                     |                                                                                                                       |                                                                                                                                                 |                           |                       
 myschema2  | myTbl3_col31_seq | [10006,)       | myGroup1  | S        |              |                |               |                 |                  |                 |                  |                  |                      |             |                   |                      |                          |                               |                     |                                                                                                                       |                                                                                                                                                 |                           |                       
(4 rows)

-- perform various tasks on the groups
select emaj.emaj_set_mark_groups('{"myGroup1","myGroup2"}','after move');
 emaj_set_mark_groups 
----------------------
                   15
(1 row)

update myschema2."myTbl3" set col33 = 12.0 where col31 >= 9;
-- groups statistics
select  stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_rows
  from emaj.emaj_log_stat_groups('{"myGroup1","myGroup2"}', 'before move', NULL)
  where stat_schema = 'myschema2' and stat_table = 'myTbl3';
 stat_group | stat_schema | stat_table |    stat_first_mark     | stat_first_time_id |     stat_last_mark     | stat_last_time_id | stat_rows 
------------+-------------+------------+------------------------+--------------------+------------------------+-------------------+-----------
 myGroup2   | myschema2   | myTbl3     | before move            |              10004 | move table to myGroup1 |             10005 |         3
 myGroup1   | myschema2   | myTbl3     | move table to myGroup1 |              10005 |                        |                   |         2
(2 rows)

select  stat_group, stat_schema, stat_table, stat_first_mark, stat_first_time_id, stat_last_mark, stat_last_time_id, stat_verb, stat_role, stat_rows
  from emaj.emaj_detailed_log_stat_groups('{"myGroup1","myGroup2"}', 'before move', NULL) where stat_schema = 'myschema2' and stat_table = 'myTbl3';
 stat_group | stat_schema | stat_table |    stat_first_mark     | stat_first_time_id |     stat_last_mark     | stat_last_time_id | stat_verb | stat_role | stat_rows 
------------+-------------+------------+------------------------+--------------------+------------------------+-------------------+-----------+-----------+-----------
 myGroup2   | myschema2   | myTbl3     | before move            |              10004 | move table to myGroup1 |             10005 | UPDATE    | postgres  |         3
 myGroup1   | myschema2   | myTbl3     | move table to myGroup1 |              10005 |                        |                   | UPDATE    | postgres  |         2
(2 rows)

-- table and sequence statistics
select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_changes, stat_rollbacks
  from emaj.emaj_log_stat_table('myschema2', 'myTbl3', 'myGroup2', 'Mk1');
 stat_group |    stat_first_mark     | stat_is_log_start |     stat_last_mark     | stat_is_log_stop | stat_changes | stat_rollbacks 
------------+------------------------+-------------------+------------------------+------------------+--------------+----------------
 myGroup2   | Mk1                    | t                 | before move            | f                |            0 |              8
 myGroup2   | before move            | f                 | move table to myGroup1 | t                |            3 |              0
 myGroup1   | move table to myGroup1 | t                 | move seq to myGroup1   | f                |            0 |              0
 myGroup1   | move seq to myGroup1   | f                 | modify table           | f                |            0 |              1
 myGroup1   | modify table           | f                 | after move             | f                |            0 |              0
 myGroup1   | after move             | f                 | [current state]        | f                |            2 |              0
(6 rows)

select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_increments, stat_has_structure_changed, stat_rollbacks
  from emaj.emaj_log_stat_sequence('myschema2', 'myTbl3_col31_seq', 'myGroup2', 'Mk1');
 stat_group |    stat_first_mark     | stat_is_log_start |     stat_last_mark     | stat_is_log_stop | stat_increments | stat_has_structure_changed | stat_rollbacks 
------------+------------------------+-------------------+------------------------+------------------+-----------------+----------------------------+----------------
 myGroup2   | Mk1                    | t                 | before move            | f                |               0 | f                          |              8
 myGroup2   | before move            | f                 | move table to myGroup1 | f                |               0 | f                          |              0
 myGroup2   | move table to myGroup1 | f                 | move seq to myGroup1   | t                |               0 | f                          |              0
 myGroup1   | move seq to myGroup1   | t                 | modify table           | f                |               0 | f                          |              1
 myGroup1   | modify table           | f                 | after move             | f                |               0 | f                          |              0
 myGroup1   | after move             | f                 | [current state]        | f                |               0 | f                          |              0
(6 rows)

-- delete both move marks
begin;
  select emaj.emaj_delete_mark_group('myGroup2','move table to myGroup1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select emaj.emaj_delete_mark_group('myGroup1','move table to myGroup1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select emaj.emaj_delete_mark_group('myGroup2','move seq to myGroup1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select emaj.emaj_delete_mark_group('myGroup1','move seq to myGroup1');
 emaj_delete_mark_group 
------------------------
                      1
(1 row)

  select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_changes, stat_rollbacks
    from emaj.emaj_log_stat_table('myschema2', 'myTbl3', 'myGroup2', 'Mk1');
 stat_group | stat_first_mark | stat_is_log_start | stat_last_mark  | stat_is_log_stop | stat_changes | stat_rollbacks 
------------+-----------------+-------------------+-----------------+------------------+--------------+----------------
 myGroup2   | Mk1             | t                 | before move     | f                |            0 |              8
 myGroup2   | before move     | f                 | [deleted mark]  | t                |            3 |              0
 myGroup1   | [deleted mark]  | t                 | modify table    | f                |            0 |              1
 myGroup1   | modify table    | f                 | after move      | f                |            0 |              0
 myGroup1   | after move      | f                 | [current state] | f                |            2 |              0
(5 rows)

  select stat_group, stat_first_mark, stat_is_log_start, stat_last_mark, stat_is_log_stop, stat_increments, stat_has_structure_changed, stat_rollbacks
    from emaj.emaj_log_stat_sequence('myschema2', 'myTbl3_col31_seq', 'myGroup2', 'Mk1');
 stat_group | stat_first_mark | stat_is_log_start | stat_last_mark  | stat_is_log_stop | stat_increments | stat_has_structure_changed | stat_rollbacks 
------------+-----------------+-------------------+-----------------+------------------+-----------------+----------------------------+----------------
 myGroup2   | Mk1             | t                 | before move     | f                |               0 | f                          |              8
 myGroup2   | before move     | f                 | [deleted mark]  | t                |               0 | f                          |              0
 myGroup1   | [deleted mark]  | t                 | modify table    | f                |               0 | f                          |              1
 myGroup1   | modify table    | f                 | after move      | f                |               0 | f                          |              0
 myGroup1   | after move      | f                 | [current state] | f                |               0 | f                          |              0
(5 rows)

rollback;
-- generate a sql script crossing the move (before rollback)
select emaj.emaj_gen_sql_groups('{"myGroup1","myGroup2"}', 'before move', NULL, :'EMAJTESTTMPDIR' || '/script1.sql',
  array['myschema2.myTbl3','myschema2.myTbl3_col31_seq']);
 emaj_gen_sql_groups 
---------------------
                   3
(1 row)

-- rollback to a mark set after the group change
select * from emaj.emaj_logged_rollback_groups('{"myGroup1","myGroup2"}','after move',false,'Logged rollback on 2 groups');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 10002.
 Notice        | 1 / 11 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
(3 rows)

-- rollback to a mark set before the group change
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_groups('{"myGroup1","myGroup2"}','before move',true);
 rlbk_severity |                                                     regexp_replace                                                     
---------------+------------------------------------------------------------------------------------------------------------------------
 Notice        | Rollback id = 10003.
 Notice        | 1 / 11 tables effectively processed.
 Notice        | 0 / 4 sequences effectively processed.
 Warning       | The table myschema2."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The sequence myschema2."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | Tables group change not rolled back: log data tablespace for myschema2."myTbl3"
 Warning       | Tables group change not rolled back: log index tablespace for myschema2."myTbl3"
 Warning       | Tables group change not rolled back: E-Maj priority for myschema2."myTbl3"
(8 rows)

-- generate a sql script crossing the move (after rollback)
select emaj.emaj_gen_sql_group('myGroup1', 'before move', NULL, :'EMAJTESTTMPDIR' || '/script2.sql',
  array['myschema2.myTbl3','myschema2.myTbl3_col31_seq']);
ERROR:  _check_tblseqs_filter: 2 tables/sequences (myschema2.myTbl3, myschema2.myTbl3_col31_seq) did not belong to any of the selected tables groups at start mark time.
CONTEXT:  PL/pgSQL function emaj._check_tblseqs_filter(text[],text[],bigint,bigint,boolean) line 29 at RAISE
SQL statement "SELECT emaj._check_tblseqs_filter(p_tblseqs, p_groupNames, v_firstMarkTimeId, v_lastMarkTimeId, TRUE)"
PL/pgSQL function emaj._gen_sql_groups(text[],boolean,text,text,text,text[],text) line 52 at SQL statement
PL/pgSQL function emaj.emaj_gen_sql_group(text,text,text,text,text[]) line 14 at RETURN
select emaj.emaj_gen_sql_groups('{"myGroup1","myGroup2"}', 'before move', NULL, :'EMAJTESTTMPDIR' || '/script3.sql',
  array['myschema2.myTbl3','myschema2.myTbl3_col31_seq']);
 emaj_gen_sql_groups 
---------------------
                   3
(1 row)

\! rm $EMAJTESTTMPDIR/script*
-- revert the changes and apply with a destination group in idle state
select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               6
(1 row)

-- This first import try fails because myGroup1 is missing in the groups to process list
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json', array['myGroup2'], true);
WARNING:  _import_groups_conf (2): In tables group "myGroup2", the table myschema2."myTbl3" is already assigned to the group ""myGroup1"".
WARNING:  _import_groups_conf (2): In tables group "myGroup2", the sequence myschema2."myTbl3_col31_seq" is already assigned to the group "myGroup1".
ERROR:  _import_groups_conf: One or several errors have been detected in the JSON groups configuration.
CONTEXT:  PL/pgSQL function emaj._import_groups_conf(json,text[],boolean,text,text) line 78 at RAISE
PL/pgSQL function emaj.emaj_import_groups_configuration(text,text[],boolean,text) line 30 at RETURN
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/all_groups_conf.json', '{"myGroup1","myGroup2"}', true);
 emaj_import_groups_configuration 
----------------------------------
                                2
(1 row)

-----------------------------
-- some extra tests with tables and sequences removal and addition
-----------------------------
select emaj.emaj_start_group('myGroup2','Start');
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_start_group 
------------------
                8
(1 row)

insert into myschema2.mytbl1 values (100, 'Started', E'\\000'::bytea);
select nextval('myschema2.myseq1');
 nextval 
---------
    1003
(1 row)

-- remove and assign somes tables and sequences in a single transaction
begin;
  select emaj.emaj_remove_tables('myschema2','{"mytbl1","mytbl2","myTbl3"}'::text[],'REMOVE_3_TABLES');
 emaj_remove_tables 
--------------------
                  3
(1 row)

  select emaj.emaj_remove_sequence('myschema2','myseq1','REMOVE_1_SEQUENCES');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

  select emaj.emaj_assign_tables('myschema2','{"mytbl1","mytbl2","myTbl3"}'::text[],'myGroup2',null,'ASSIGN_3_TABLES');
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_assign_tables 
--------------------
                  3
(1 row)

  select emaj.emaj_assign_sequences('myschema2','{"myseq1","myseq2"}'::text[],'myGroup2','ASSIGN_2_SEQUENCES');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

  insert into myschema2.mytbl1 values (110, 'Assigned', E'\\000'::bytea);
  select nextval('myschema2.myseq1');
 nextval 
---------
    1004
(1 row)

  -- what if some (all but the emaj sequence) emaj components are missing at remove_table time ?
  select emaj.emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

  drop table emaj_myschema2.mytbl1_log;
  drop function emaj_myschema2.mytbl1_log_fnct() cascade;
NOTICE:  drop cascades to trigger emaj_log_trg on table myschema2.mytbl1
  select emaj.emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

  select emaj.emaj_remove_tables('myschema2','{"mytbl1","mytbl2","myTbl3"}');
NOTICE:  relation "mytbl1_log" does not exist, skipping
NOTICE:  relation "mytbl1_log_idx" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema2.mytbl1" does not exist, skipping
NOTICE:  function emaj_myschema2.mytbl1_log_fnct() does not exist, skipping
 emaj_remove_tables 
--------------------
                  3
(1 row)

  select emaj.emaj_remove_sequences('myschema2','{"myseq1","myseq2"}');
 emaj_remove_sequences 
-----------------------
                     2
(1 row)

  select emaj.emaj_assign_tables('myschema2','{"mytbl1","mytbl2","myTbl3"}','myGroup2',
                                 '{"priority":1, "log_data_tablespace":"tsplog1", "log_index_tablespace":"tsplog1"}'::jsonb);
WARNING:  _check_fk_groups: The foreign key "mytbl6_col61_fkey" on the table "myschema2.mytbl6" references the table "myschema2.mytbl7" that is outside the groups (myGroup2).
WARNING:  _check_fk_groups: The table "myschema2.mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" on the table "myschema2.mytbl8" that is outside the groups (myGroup2).
 emaj_assign_tables 
--------------------
                  3
(1 row)

  select emaj.emaj_assign_sequences('myschema2','{"myseq1","myseq2"}'::text[],'myGroup2','Mark_assign_sequences');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

commit;
-- remove tables and sequences with bad marks
select emaj.emaj_remove_table('myschema2','mytbl1','Mark_assign_sequences');
ERROR:  _check_new_mark: The group "myGroup2" already contains a mark named "Mark_assign_sequences".
CONTEXT:  PL/pgSQL function emaj._check_new_mark(text[],text) line 29 at RAISE
SQL statement "SELECT emaj._check_new_mark(v_loggingGroups, p_mark)"
PL/pgSQL function emaj._remove_tables(text,text[],text,boolean,boolean) line 32 at SQL statement
PL/pgSQL function emaj.emaj_remove_table(text,text,text) line 6 at RETURN
select emaj.emaj_remove_sequence('myschema2','myseq1','Mark_assign_sequences');
ERROR:  _check_new_mark: The group "myGroup2" already contains a mark named "Mark_assign_sequences".
CONTEXT:  PL/pgSQL function emaj._check_new_mark(text[],text) line 29 at RAISE
SQL statement "SELECT emaj._check_new_mark(v_loggingGroups, p_mark)"
PL/pgSQL function emaj._remove_sequences(text,text[],text,boolean,boolean) line 31 at SQL statement
PL/pgSQL function emaj.emaj_remove_sequence(text,text,text) line 6 at RETURN
-- alter a table in a logging group
select emaj.emaj_remove_table('myschema1','mytbl4');
 emaj_remove_table 
-------------------
                 1
(1 row)

alter table myschema1.mytbl4 alter column col45 type varchar(15);
select emaj.emaj_assign_table('myschema1','mytbl4','myGroup1');
 emaj_assign_table 
-------------------
                 1
(1 row)

begin;
  select emaj.emaj_remove_table('myschema1','mytbl4');
 emaj_remove_table 
-------------------
                 1
(1 row)

  alter table myschema1.mytbl4 alter column col45 type varchar(10);
  select emaj.emaj_assign_table('myschema1','mytbl4','myGroup1',NULL,'Assign_mytbl4');
 emaj_assign_table 
-------------------
                 1
(1 row)

commit;
-- checks
select count(*) from emaj.emaj_mark where mark_group = 'myGroup2' and (mark_name like 'REMOVE%' or mark_name like 'ASSIGN%');
 count 
-------
     7
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table, rel_log_seq_last_value
  from emaj.emaj_relation where rel_schema = 'myschema2' and rel_tblseq in ('mytbl1','mytbl2','myTbl3','myseq1','myseq2')
  order by rel_schema, rel_tblseq, rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+---------------+------------------------
 myschema2  | myTbl3     | [10005,10015)  | myGroup1  | r        | emaj_myschema2 | myTbl3_log_2  |                       
 myschema2  | myTbl3     | [10015,10017)  | myGroup2  | r        | emaj_myschema2 | myTbl3_log_3  |                     10
 myschema2  | myTbl3     | [10019,10021)  | myGroup2  | r        | emaj_myschema2 | myTbl3_log_4  |                     10
 myschema2  | myTbl3     | [10023,)       | myGroup2  | r        | emaj_myschema2 | myTbl3_log    |                       
 myschema2  | myseq1     | [8206,8207)    | myGroup4  | S        |                |               |                       
 myschema2  | myseq1     | [8207,10018)   | myGroup2  | S        |                |               |                       
 myschema2  | myseq1     | [10020,10022)  | myGroup2  | S        |                |               |                       
 myschema2  | myseq1     | [10024,)       | myGroup2  | S        |                |               |                       
 myschema2  | myseq2     | [10020,10022)  | myGroup2  | S        |                |               |                       
 myschema2  | myseq2     | [10024,)       | myGroup2  | S        |                |               |                       
 myschema2  | mytbl1     | [8010,10017)   | myGroup2  | r        | emaj_myschema2 | mytbl1_log_1  |                      1
 myschema2  | mytbl1     | [10019,10021)  | myGroup2  | r        | emaj_myschema2 | mytbl1_log_2  |                      2
 myschema2  | mytbl1     | [10023,)       | myGroup2  | r        | emaj_myschema2 | mytbl1_log    |                       
 myschema2  | mytbl2     | [8010,10017)   | myGroup2  | r        | emaj_myschema2 | mytbl2_log_1  |                      0
 myschema2  | mytbl2     | [10019,10021)  | myGroup2  | r        | emaj_myschema2 | mytbl2_log_2  |                      0
 myschema2  | mytbl2     | [10023,)       | myGroup2  | r        | emaj_myschema2 | mytbl2_log    |                       
(16 rows)

select sequ_schema, sequ_name, sequ_time_id, sequ_last_val, sequ_is_called from emaj.emaj_sequence
  where sequ_schema = 'myschema2' and sequ_name like 'myseq%' order by sequ_name, sequ_time_id;
 sequ_schema | sequ_name | sequ_time_id | sequ_last_val | sequ_is_called 
-------------+-----------+--------------+---------------+----------------
 myschema2   | myseq1    |        10016 |          1003 | f
 myschema2   | myseq1    |        10017 |          1003 | t
 myschema2   | myseq1    |        10018 |          1003 | t
 myschema2   | myseq1    |        10020 |          1003 | t
 myschema2   | myseq1    |        10021 |          1004 | t
 myschema2   | myseq1    |        10022 |          1004 | t
 myschema2   | myseq1    |        10024 |          1004 | t
 myschema2   | myseq2    |        10020 |             3 | f
 myschema2   | myseq2    |        10021 |             3 | f
 myschema2   | myseq2    |        10022 |             3 | f
 myschema2   | myseq2    |        10024 |             3 | f
(11 rows)

select tbl_schema, tbl_name, tbl_time_id, tbl_log_seq_last_val from emaj.emaj_table
  where tbl_schema = 'myschema2' and tbl_name = 'mytbl1' order by tbl_time_id;
 tbl_schema | tbl_name | tbl_time_id | tbl_log_seq_last_val 
------------+----------+-------------+----------------------
 myschema2  | mytbl1   |       10016 |                    0
 myschema2  | mytbl1   |       10017 |                    1
 myschema2  | mytbl1   |       10019 |                    1
 myschema2  | mytbl1   |       10020 |                    1
 myschema2  | mytbl1   |       10021 |                    2
 myschema2  | mytbl1   |       10023 |                    2
 myschema2  | mytbl1   |       10024 |                    2
(7 rows)

-- referential integrity violation attempt while rollbacking to a mark set before an ADD_TBL with a FK involved in the operation.
insert into myschema1.mytbl2 values (1000,'a',current_date);
insert into myschema1.mytbl4 values (100,'b',1000,2,'ABC');
begin;
  select emaj.emaj_remove_table('myschema1','mytbl4','Remove_mytbl4');
 emaj_remove_table 
-------------------
                 1
(1 row)

  select emaj.emaj_assign_table('myschema1','mytbl4','myGroup1',NULL,'Reassign_mytbl4');
 emaj_assign_table 
-------------------
                 1
(1 row)

-- deactivate the dblink usage to avoid deadlock, the assign_table and the rollback being executed in the same transaction,
--   they conflict on the emaj_myschema1.mytbl4_log_seq log sequence
  delete from emaj.emaj_param where param_key = 'dblink_user_password';
-- the rollback should fail at FK check
  select * from emaj.emaj_rollback_group('myGroup1',emaj.emaj_get_previous_mark_group('myGroup1','Remove_mytbl4'),true);
ERROR:  update or delete on table "mytbl2" violates foreign key constraint "mytbl4_col43_fkey" on table "mytbl4"
DETAIL:  Key (col21)=(1000) is still referenced from table "mytbl4".
CONTEXT:  SQL statement "SET CONSTRAINTS myschema1.mytbl4_col43_fkey IMMEDIATE"
PL/pgSQL function emaj._rlbk_session_exec(integer,integer) line 119 at EXECUTE
SQL statement "SELECT emaj._rlbk_session_exec(v_rlbkId, 1)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean,text) line 32 at PERFORM
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE), p_comment)"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean,text) line 8 at RETURN QUERY
rollback;
select * from emaj.emaj_rollback_group('myGroup1','EMAJ_LAST_MARK');
 rlbk_severity |              rlbk_message              
---------------+----------------------------------------
 Notice        | Rollback id = 10005.
 Notice        | 3 / 5 tables effectively processed.
 Notice        | 1 / 2 sequences effectively processed.
(3 rows)

-----------------------------
-- some extra tests with group ownership change for some tables and sequences
-----------------------------
-- from an idle to a logging group
select emaj.emaj_move_tables('myschema4','.*','','myGroup1','MOVE_TBL_idle_to_logging');
 emaj_move_tables 
------------------
                6
(1 row)

select emaj.emaj_move_sequences('myschema2','.*','','myGroup1','MOVE_SEQ_idle_to_logging');
 emaj_move_sequences 
---------------------
                   3
(1 row)

-- bad mark
select emaj.emaj_move_tables('myschema4','.*','','myGroup2',emaj.emaj_get_previous_mark_group('myGroup1',now()));
ERROR:  _check_new_mark: The groups "myGroup1, myGroup2" already contain a mark named "MOVE_SEQ_idle_to_logging".
CONTEXT:  PL/pgSQL function emaj._check_new_mark(text[],text) line 31 at RAISE
SQL statement "SELECT emaj._check_new_mark(v_loggingGroups, p_mark)"
PL/pgSQL function emaj._move_tables(text,text[],text,text,boolean,boolean) line 56 at SQL statement
PL/pgSQL function emaj.emaj_move_tables(text,text,text,text,text) line 11 at RETURN
select emaj.emaj_move_sequences('myschema2','.*','','myGroup2',emaj.emaj_get_previous_mark_group('myGroup1',now()));
ERROR:  _check_new_mark: The groups "myGroup1, myGroup2" already contain a mark named "MOVE_SEQ_idle_to_logging".
CONTEXT:  PL/pgSQL function emaj._check_new_mark(text[],text) line 31 at RAISE
SQL statement "SELECT emaj._check_new_mark(v_loggingGroups, p_mark)"
PL/pgSQL function emaj._move_sequences(text,text[],text,text,boolean,boolean) line 50 at SQL statement
PL/pgSQL function emaj.emaj_move_sequences(text,text,text,text,text) line 11 at RETURN
-- from a logging group to another logging group
select emaj.emaj_move_tables('myschema4','.*','','myGroup2','MOVE_TBL_logging_to_logging');
 emaj_move_tables 
------------------
                6
(1 row)

select emaj.emaj_move_sequences('myschema2','.*','','myGroup2','MOVE_SEQ_logging_to_logging');
 emaj_move_sequences 
---------------------
                   3
(1 row)

-- reset an idle group to check the emaj_sequence cleaning
begin;
  select emaj.emaj_reset_group('myGroup4');
 emaj_reset_group 
------------------
                0
(1 row)

  select rel_group, count(*) from emaj.emaj_sequence, emaj.emaj_relation
    where sequ_schema = rel_schema and sequ_name = rel_tblseq and sequ_time_id <@ rel_time_range
      and sequ_schema = 'myschema2' and sequ_name = 'myseq1'
    group by 1;
 rel_group | count 
-----------+-------
 myGroup1  |     2
 myGroup2  |     6
(2 rows)

rollback;
-- and back to the idle group
select emaj.emaj_move_tables('myschema4','.*','','myGroup4','MOVE_TBL_logging_to_idle');
 emaj_move_tables 
------------------
                6
(1 row)

select emaj.emaj_move_sequences('myschema2','.*','','myGroup4','MOVE_SEQ_logging_to_idle');
 emaj_move_sequences 
---------------------
                   3
(1 row)

-- move a table with fkey and verify all
select emaj.emaj_move_table('myschema2','mytbl2','myGroup1','Move a table with fkey');
 emaj_move_table 
-----------------
               1
(1 row)

select * from emaj.emaj_verify_all() as t(msg) where msg not like '%foreign key%';
                                                                                           msg                                                                                           
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Error: In tables group "myGroup2", the log table "emaj_myschema2"."mytbl1_log_2" is not found.
 Warning: In tables group "myGroup4", the sequence "myschema2"."myTbl3_col31_seq" is linked to the table "myschema2"."myTbl3" but this table belongs to another tables group (myGroup2).
(2 rows)

select emaj.emaj_move_table('myschema2','mytbl2','myGroup2','Move a table with fkey back');
 emaj_move_table 
-----------------
               1
(1 row)

-- rename a table and/or change its schema
alter table myschema1.mytbl1 rename to mytbl1_new_name;
select emaj.emaj_remove_table('myschema1','mytbl1');
WARNING:  _check_tblseqs_array: In schema "myschema1", some tables (mytbl1) do not exist.
NOTICE:  drop cascades to trigger emaj_log_trg on table myschema1.mytbl1_new_name
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('myschema1','mytbl1_new_name','myGroup1');
 emaj_assign_table 
-------------------
                 1
(1 row)

alter table myschema1.mytbl1_new_name set schema public;
select emaj.emaj_remove_table('myschema1','mytbl1_new_name');
WARNING:  _check_tblseqs_array: In schema "myschema1", some tables (mytbl1_new_name) do not exist.
NOTICE:  drop cascades to trigger emaj_log_trg on table public.mytbl1_new_name
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('public','mytbl1_new_name','myGroup1');
 emaj_assign_table 
-------------------
                 1
(1 row)

alter table public.mytbl1_new_name rename to mytbl1;
alter table public.mytbl1 set schema myschema1;
select emaj.emaj_remove_table('public','mytbl1_new_name');
WARNING:  _check_tblseqs_array: In schema "public", some tables (mytbl1_new_name) do not exist.
NOTICE:  drop cascades to trigger emaj_log_trg on table myschema1.mytbl1
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('myschema1','mytbl1','myGroup1');
 emaj_assign_table 
-------------------
                 1
(1 row)

-----------------------------
-- test end: check
-----------------------------
select emaj.emaj_stop_group('myGroup1');
 emaj_stop_group 
-----------------
               7
(1 row)

select emaj.emaj_stop_group('myGroup2');
 emaj_stop_group 
-----------------
               6
(1 row)

select emaj.emaj_gen_sql_dump_changes_group('myGroup1','Mk1','EMAJ_LAST_MARK',NULL,NULL);
                    emaj_gen_sql_dump_changes_group                     
------------------------------------------------------------------------
 28 SQL statements are available in the "emaj_temp_sql" temporary table
(1 row)

select regexp_replace(sql_text, E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','<timestamp>','g') from emaj_temp_sql where sql_line_number = 0;
                                                            regexp_replace                                                            
--------------------------------------------------------------------------------------------------------------------------------------
 -- Generated SQL for dumping changes in tables group "myGroup1" between marks "Mk1" and "STOP_<timestamp>"
 -- Dump changes for table myschema1.myTbl3 between marks "Mk1" and "[deleted mark]" (2 changes)
 -- Dump changes for table myschema1.myTbl3 between marks "[deleted mark]" and "STOP_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl1 between marks "Mk1" and "[deleted mark]" (0 changes)
 -- Dump changes for table myschema1.mytbl1 between marks "[deleted mark]" and "REMOVE_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl1 between marks "ASSIGN_<timestamp>" and "STOP_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl1_new_name between marks "ASSIGN_<timestamp>" and "REMOVE_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl2 between marks "Mk1" and "STOP_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl2b between marks "Mk1" and "[deleted mark]" (0 changes)
 -- Dump changes for table myschema1.mytbl2b between marks "[deleted mark]" and "STOP_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl4 between marks "Mk1" and "REMOVE_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl4 between marks "ASSIGN_<timestamp>" and "REMOVE_<timestamp>" (0 changes)
 -- Dump changes for table myschema1.mytbl4 between marks "Assign_mytbl4" and "STOP_<timestamp>" (0 changes)
 -- Dump changes for table myschema2.myTbl3 between marks "[deleted mark]" and "IMPORT_<timestamp>" (6 changes)
 -- Dump changes for table myschema2.mytbl2 between marks "Move a table with fkey" and "Move a table with fkey back" (0 changes)
 -- Dump changes for table myschema4.mypartp1a between marks "MOVE_TBL_idle_to_logging" and "MOVE_TBL_logging_to_logging" (0 changes)
 -- Dump changes for table myschema4.mypartp1b between marks "MOVE_TBL_idle_to_logging" and "MOVE_TBL_logging_to_logging" (0 changes)
 -- Dump changes for table myschema4.mypartp2 between marks "MOVE_TBL_idle_to_logging" and "MOVE_TBL_logging_to_logging" (0 changes)
 -- Dump changes for table myschema4.mytblc1 between marks "MOVE_TBL_idle_to_logging" and "MOVE_TBL_logging_to_logging" (0 changes)
 -- Dump changes for table myschema4.mytblc2 between marks "MOVE_TBL_idle_to_logging" and "MOVE_TBL_logging_to_logging" (0 changes)
 -- Dump changes for table myschema4.mytblm between marks "MOVE_TBL_idle_to_logging" and "MOVE_TBL_logging_to_logging" (0 changes)
 -- Dump changes for table public.mytbl1_new_name between marks "ASSIGN_<timestamp>" and "REMOVE_<timestamp>" (0 changes)
 -- Dump changes for sequence myschema1.myTbl3_col31_seq between marks "Mk1" and "[deleted mark]"
 -- Dump changes for sequence myschema1.myTbl3_col31_seq between marks "[deleted mark]" and "STOP_<timestamp>"
 -- Dump changes for sequence myschema1.mytbl2b_col20_seq between marks "Mk1" and "STOP_<timestamp>"
 -- Dump changes for sequence myschema2.myTbl3_col31_seq between marks "[deleted mark]" and "IMPORT_<timestamp>"
 -- Dump changes for sequence myschema2.myTbl3_col31_seq between marks "MOVE_SEQ_idle_to_logging" and "MOVE_SEQ_logging_to_logging"
 -- Dump changes for sequence myschema2.myseq1 between marks "MOVE_SEQ_idle_to_logging" and "MOVE_SEQ_logging_to_logging"
 -- Dump changes for sequence myschema2.myseq2 between marks "MOVE_SEQ_idle_to_logging" and "MOVE_SEQ_logging_to_logging"
(29 rows)

select emaj.emaj_drop_group('myGroup1');
 emaj_drop_group 
-----------------
               7
(1 row)

select emaj.emaj_drop_group('myGroup2');
NOTICE:  table "mytbl1_log_2" does not exist, skipping
 emaj_drop_group 
-----------------
               6
(1 row)

select emaj.emaj_drop_group('myGroup4');
 emaj_drop_group 
-----------------
               9
(1 row)

select emaj.emaj_drop_group('myGroup5');
 emaj_drop_group 
-----------------
               2
(1 row)

select emaj.emaj_drop_group('emptyGroup');
 emaj_drop_group 
-----------------
               0
(1 row)

-- checks for group ownership change tests
select * from emaj.emaj_relation_change where rlchg_time_id >= 10000 order by 1,2,3,4;
 rlchg_time_id |  rlchg_schema   |   rlchg_tblseq    |      rlchg_change_kind      | rlchg_group | rlchg_new_schema | rlchg_new_tblseq | rlchg_new_group | rlchg_priority | rlchg_new_priority | rlchg_log_data_tsp | rlchg_new_log_data_tsp | rlchg_log_index_tsp | rlchg_new_log_index_tsp | rlchg_ignored_triggers | rlchg_new_ignored_triggers 
---------------+-----------------+-------------------+-----------------------------+-------------+------------------+------------------+-----------------+----------------+--------------------+--------------------+------------------------+---------------------+-------------------------+------------------------+----------------------------
         10005 | myschema2       | myTbl3            | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10006 | myschema2       | myTbl3_col31_seq  | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10009 | myschema2       | myTbl3            | CHANGE_LOG_DATA_TABLESPACE  | myGroup1    |                  |                  |                 |                |                    |                    | tsplog1                |                     |                         |                        | 
         10009 | myschema2       | myTbl3            | CHANGE_LOG_INDEX_TABLESPACE | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     | tsplog1                 |                        | 
         10009 | myschema2       | myTbl3            | CHANGE_PRIORITY             | myGroup1    |                  |                  |                 |                |                100 |                    |                        |                     |                         |                        | 
         10015 | myschema2       | myTbl3            | CHANGE_LOG_DATA_TABLESPACE  | myGroup1    |                  |                  |                 |                |                    | tsplog1            |                        |                     |                         |                        | 
         10015 | myschema2       | myTbl3            | CHANGE_LOG_INDEX_TABLESPACE | myGroup1    |                  |                  |                 |                |                    |                    |                        | tsplog1             |                         |                        | 
         10015 | myschema2       | myTbl3            | CHANGE_PRIORITY             | myGroup1    |                  |                  |                 |            100 |                    |                    |                        |                     |                         |                        | 
         10015 | myschema2       | myTbl3            | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10015 | myschema2       | myTbl3_col31_seq  | MOVE_SEQUENCE               | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10017 | myschema2       | myTbl3            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10017 | myschema2       | mytbl1            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10017 | myschema2       | mytbl2            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10018 | myschema2       | myseq1            | REMOVE_SEQUENCE             | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10019 | myschema2       | myTbl3            | ADD_TABLE                   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10019 | myschema2       | mytbl1            | ADD_TABLE                   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10019 | myschema2       | mytbl2            | ADD_TABLE                   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10020 | myschema2       | myseq1            | ADD_SEQUENCE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10020 | myschema2       | myseq2            | ADD_SEQUENCE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10021 | myschema2       | myTbl3            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10021 | myschema2       | mytbl1            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10021 | myschema2       | mytbl2            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10022 | myschema2       | myseq1            | REMOVE_SEQUENCE             | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10022 | myschema2       | myseq2            | REMOVE_SEQUENCE             | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10023 | myschema2       | myTbl3            | ADD_TABLE                   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10023 | myschema2       | mytbl1            | ADD_TABLE                   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10023 | myschema2       | mytbl2            | ADD_TABLE                   | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10024 | myschema2       | myseq1            | ADD_SEQUENCE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10024 | myschema2       | myseq2            | ADD_SEQUENCE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10025 | myschema1       | mytbl4            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10026 | myschema1       | mytbl4            | ADD_TABLE                   | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10027 | myschema1       | mytbl4            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10028 | myschema1       | mytbl4            | ADD_TABLE                   | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10033 | myschema4       | mypartp1a         | MOVE_TABLE                  | myGroup4    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10033 | myschema4       | mypartp1b         | MOVE_TABLE                  | myGroup4    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10033 | myschema4       | mypartp2          | MOVE_TABLE                  | myGroup4    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10033 | myschema4       | mytblc1           | MOVE_TABLE                  | myGroup4    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10033 | myschema4       | mytblc2           | MOVE_TABLE                  | myGroup4    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10033 | myschema4       | mytblm            | MOVE_TABLE                  | myGroup4    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10034 | myschema2       | myTbl3_col31_seq  | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10034 | myschema2       | myseq1            | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10034 | myschema2       | myseq2            | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10035 | myschema4       | mypartp1a         | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10035 | myschema4       | mypartp1b         | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10035 | myschema4       | mypartp2          | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10035 | myschema4       | mytblc1           | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10035 | myschema4       | mytblc2           | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10035 | myschema4       | mytblm            | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10036 | myschema2       | myTbl3_col31_seq  | MOVE_SEQUENCE               | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10036 | myschema2       | myseq1            | MOVE_SEQUENCE               | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10036 | myschema2       | myseq2            | MOVE_SEQUENCE               | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10037 | myschema4       | mypartp1a         | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10037 | myschema4       | mypartp1b         | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10037 | myschema4       | mypartp2          | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10037 | myschema4       | mytblc1           | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10037 | myschema4       | mytblc2           | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10037 | myschema4       | mytblm            | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10038 | myschema2       | myTbl3_col31_seq  | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10038 | myschema2       | myseq1            | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10038 | myschema2       | myseq2            | MOVE_SEQUENCE               | myGroup2    |                  |                  | myGroup4        |                |                    |                    |                        |                     |                         |                        | 
         10039 | myschema2       | mytbl2            | MOVE_TABLE                  | myGroup2    |                  |                  | myGroup1        |                |                    |                    |                        |                     |                         |                        | 
         10040 | myschema2       | mytbl2            | MOVE_TABLE                  | myGroup1    |                  |                  | myGroup2        |                |                    |                    |                        |                     |                         |                        | 
         10041 | myschema1       | mytbl1            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10042 | myschema1       | mytbl1_new_name   | ADD_TABLE                   | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10043 | myschema1       | mytbl1_new_name   | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10044 | public          | mytbl1_new_name   | ADD_TABLE                   | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10045 | public          | mytbl1_new_name   | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10046 | myschema1       | mytbl1            | ADD_TABLE                   | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | myTbl3            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | myTbl3_col31_seq  | REMOVE_SEQUENCE             | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | mytbl1            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | mytbl2            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | mytbl2b           | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | mytbl2b_col20_seq | REMOVE_SEQUENCE             | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10049 | myschema1       | mytbl4            | REMOVE_TABLE                | myGroup1    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10050 | myschema2       | myTbl3            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10050 | myschema2       | mytbl1            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10050 | myschema2       | mytbl2            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10050 | myschema2       | mytbl4            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10050 | myschema2       | mytbl5            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10050 | myschema2       | mytbl6            | REMOVE_TABLE                | myGroup2    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema2       | myTbl3_col31_seq  | REMOVE_SEQUENCE             | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema2       | myseq1            | REMOVE_SEQUENCE             | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema2       | myseq2            | REMOVE_SEQUENCE             | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema4       | mypartp1a         | REMOVE_TABLE                | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema4       | mypartp1b         | REMOVE_TABLE                | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema4       | mypartp2          | REMOVE_TABLE                | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema4       | mytblc1           | REMOVE_TABLE                | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema4       | mytblc2           | REMOVE_TABLE                | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10051 | myschema4       | mytblm            | REMOVE_TABLE                | myGroup4    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10052 | myschema5       | myunloggedtbl     | REMOVE_TABLE                | myGroup5    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
         10052 | phil's schema"3 | myTbl2\           | REMOVE_TABLE                | myGroup5    |                  |                  |                 |                |                    |                    |                        |                     |                         |                        | 
(92 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 10000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   10004 |           10000000 | M
   10005 |           10000003 | A
   10006 |           10000003 | A
   10007 |           10000003 | R
   10008 |           10000003 | R
   10009 |           10000003 | A
   10010 |           10000003 | M
   10011 |           10000005 | R
   10012 |           10000009 | M
   10013 |           10000009 | R
   10014 |           10000009 | X
   10015 |           10000009 | I
   10016 |           10000009 | S
   10017 |           10000010 | A
   10018 |           10000010 | A
   10019 |           10000010 | A
   10020 |           10000010 | A
   10021 |           10000011 | A
   10022 |           10000011 | A
   10023 |           10000011 | A
   10024 |           10000011 | A
   10025 |           10000011 | A
   10026 |           10000011 | A
   10027 |           10000011 | A
   10028 |           10000011 | A
   10032 |           10000014 | R
   10033 |           10000014 | A
   10034 |           10000014 | A
   10035 |           10000014 | A
   10036 |           10000014 | A
   10037 |           10000014 | A
   10038 |           10000014 | A
   10039 |           10000014 | A
   10040 |           10000014 | A
   10041 |           10000014 | A
   10042 |           10000014 | A
   10043 |           10000014 | A
   10044 |           10000014 | A
   10045 |           10000014 | A
   10046 |           10000014 | A
   10047 |           10000014 | X
   10048 |           10000014 | X
   10049 |           10000014 | D
   10050 |           10000014 | D
   10051 |           10000014 | D
   10052 |           10000014 | D
   10053 |           10000014 | D
(47 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user 
  from emaj.emaj_hist where hist_id >= 10000 order by hist_id;
   hist_function    |          hist_event          |         hist_object          |                                                     regexp_replace                                                     | hist_user 
--------------------+------------------------------+------------------------------+------------------------------------------------------------------------------------------------------------------------+-----------
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | before move                                                                                                            | postgres
 LOCK_GROUPS        | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUPS        | END                          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | TIME STAMP SET               | 10004                        |                                                                                                                        | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 9704             | set to COMMITTED                                                                                                       | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 9705             | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | before move                                                                                                            | postgres
 MOVE_TABLE         | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_TABLE         | TIME STAMP SET               | 10005                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | move table to myGroup1                                                                                                 | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | move table to myGroup1                                                                                                 | postgres
 MOVE_TABLE         | TABLE MOVED                  | myschema2."myTbl3"           | From the logging group myGroup2 to the logging group myGroup1                                                          | postgres
 MOVE_TABLE         | END                          |                              | 1 tables moved to the tables group myGroup1                                                                            | postgres
 MOVE_SEQUENCE      | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_SEQUENCE      | TIME STAMP SET               | 10006                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | move seq to myGroup1                                                                                                   | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | move seq to myGroup1                                                                                                   | postgres
 MOVE_SEQUENCE      | SEQUENCE MOVED               | myschema2."myTbl3_col31_seq" | From the logging group myGroup2 to the logging group myGroup1                                                          | postgres
 MOVE_SEQUENCE      | END                          |                              | 1 sequences moved to the tables group myGroup1                                                                         | postgres
 MODIFY_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 MODIFY_TABLE       | TIME STAMP SET               | 10009                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1                     | modify table                                                                                                           | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 10000            | set to ABORTED                                                                                                         | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 10001            | set to ABORTED                                                                                                         | postgres
 SET_MARK_GROUPS    | END                          | myGroup1                     | modify table                                                                                                           | postgres
 MODIFY_TABLE       | PRIORITY CHANGED             | myschema2."myTbl3"           | NULL => 100                                                                                                            | postgres
 MODIFY_TABLE       | LOG DATA TABLESPACE CHANGED  | myschema2."myTbl3"           | Default tablespace => tsplog1                                                                                          | postgres
 MODIFY_TABLE       | LOG INDEX TABLESPACE CHANGED | myschema2."myTbl3"           | Default tablespace => tsplog1                                                                                          | postgres
 MODIFY_TABLE       | END                          |                              | 1 tables effectively modified                                                                                          | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | after move                                                                                                             | postgres
 LOCK_GROUPS        | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUPS        | END                          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | TIME STAMP SET               | 10010                        |                                                                                                                        | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | after move                                                                                                             | postgres
 GEN_SQL_GROUPS     | BEGIN                        | myGroup1,myGroup2            | From mark before move to current state with tables/sequences filtering                                                 | postgres
 GEN_SQL_GROUPS     | END                          | myGroup1,myGroup2            | 3 generated statements - script exported into /tmp/emaj_15/alter_logging/script1.sql                                   | postgres
 ROLLBACK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | Logged rollback to mark after move (timestamp)                                                                         | postgres
 DBLINK_OPEN_CNX    |                              | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)                                                                   | postgres
 ROLLBACK_GROUPS    | TIME STAMP SET               | 10011                        |                                                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | RLBK_10002_START                                                                                                       | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | RLBK_10002_START                                                                                                       | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema2."myTbl3"           | All log rows where emaj_gid > 10000003 and <= 10000005                                                                 | postgres
 ROLLBACK_TABLE     | END                          | myschema2."myTbl3"           | 2 rolled back primary keys                                                                                             | postgres
 ROLLBACK_GROUPS    | TIME STAMP SET               | 10012                        |                                                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | RLBK_10002_DONE                                                                                                        | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | RLBK_10002_DONE                                                                                                        | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 10002            | Rollback id = 10002.                                                                                                   | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 10002            | 1 / 11 tables effectively processed.                                                                                   | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 10002            | 0 / 4 sequences effectively processed.                                                                                 | postgres
 DBLINK_CLOSE_CNX   |                              | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUPS    | END                          | myGroup1,myGroup2            | Rollback_id 10002                                                                                                      | postgres
 ROLLBACK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | Unlogged rollback to mark before move (timestamp)                                                                      | postgres
 DBLINK_OPEN_CNX    |                              | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | Rollback session #1: 11 tables locked, 0 deadlock(s)                                                                   | postgres
 ROLLBACK_GROUPS    | TIME STAMP SET               | 10013                        |                                                                                                                        | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema2."myTbl3"           | All log rows where emaj_gid > 10000003 and <= 10000009                                                                 | postgres
 ROLLBACK_TABLE     | END                          | myschema2."myTbl3"           | 2 rolled back primary keys                                                                                             | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup1                     | mark move table to myGroup1 is deleted                                                                                 | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup2                     | mark move table to myGroup1 is deleted                                                                                 | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup1                     | mark move seq to myGroup1 is deleted                                                                                   | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup2                     | mark move seq to myGroup1 is deleted                                                                                   | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup1                     | mark modify table is deleted                                                                                           | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup1                     | mark after move is deleted                                                                                             | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup2                     | mark after move is deleted                                                                                             | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup1                     | mark RLBK_10002_START is deleted                                                                                       | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup2                     | mark RLBK_10002_START is deleted                                                                                       | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup1                     | mark RLBK_10002_DONE is deleted                                                                                        | postgres
 ROLLBACK_GROUPS    | MARK DELETED                 | myGroup2                     | mark RLBK_10002_DONE is deleted                                                                                        | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 10003            | Rollback id = 10003.                                                                                                   | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 10003            | 1 / 11 tables effectively processed.                                                                                   | postgres
 ROLLBACK_GROUPS    | NOTICE                       | Rollback id 10003            | 0 / 4 sequences effectively processed.                                                                                 | postgres
 ROLLBACK_GROUPS    | WARNING                      | Rollback id 10003            | The table myschema2."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)                    | postgres
 ROLLBACK_GROUPS    | WARNING                      | Rollback id 10003            | The sequence myschema2."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUPS    | WARNING                      | Rollback id 10003            | Tables group change not rolled back: log data tablespace for myschema2."myTbl3"                                        | postgres
 ROLLBACK_GROUPS    | WARNING                      | Rollback id 10003            | Tables group change not rolled back: log index tablespace for myschema2."myTbl3"                                       | postgres
 ROLLBACK_GROUPS    | WARNING                      | Rollback id 10003            | Tables group change not rolled back: E-Maj priority for myschema2."myTbl3"                                             | postgres
 DBLINK_CLOSE_CNX   |                              | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUPS    | END                          | myGroup1,myGroup2            | Rollback_id 10003                                                                                                      | postgres
 GEN_SQL_GROUPS     | BEGIN                        | myGroup1,myGroup2            | From mark before move to current state with tables/sequences filtering                                                 | postgres
 GEN_SQL_GROUPS     | END                          | myGroup1,myGroup2            | 3 generated statements - script exported into /tmp/emaj_15/alter_logging/script3.sql                                   | postgres
 STOP_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 STOP_GROUP         | TIME STAMP SET               | 10014                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | STOP_%                                                                                                                 | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 10002            | set to COMMITTED                                                                                                       | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 10003            | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | STOP_%                                                                                                                 | postgres
 STOP_GROUP         | END                          | myGroup2                     | 6 tables/sequences processed                                                                                           | postgres
 IMPORT_GROUPS      | BEGIN                        | myGroup1, myGroup2           | Input file: '/tmp/emaj_15/alter_logging/all_groups_conf.json'                                                          | postgres
 IMPORT_GROUPS      | TIME STAMP SET               | 10015                        |                                                                                                                        | postgres
 LOCK_GROUPS        | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUPS        | END                          | myGroup1                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1                     | IMPORT_%                                                                                                               | postgres
 SET_MARK_GROUPS    | END                          | myGroup1                     | IMPORT_%                                                                                                               | postgres
 IMPORT_GROUPS      | PRIORITY CHANGED             | myschema2."myTbl3"           | 100 => NULL                                                                                                            | postgres
 IMPORT_GROUPS      | LOG DATA TABLESPACE CHANGED  | myschema2."myTbl3"           | tsplog1 => Default tablespace                                                                                          | postgres
 IMPORT_GROUPS      | LOG INDEX TABLESPACE CHANGED | myschema2."myTbl3"           | tsplog1 => Default tablespace                                                                                          | postgres
 IMPORT_GROUPS      | TABLE MOVED                  | myschema2."myTbl3"           | From the logging group myGroup1 to the idle group myGroup2                                                             | postgres
 IMPORT_GROUPS      | SEQUENCE MOVED               | myschema2."myTbl3_col31_seq" | From the logging group myGroup1 to the idle group myGroup2                                                             | postgres
 IMPORT_GROUPS      | END                          |                              | 2 created or altered tables groups                                                                                     | postgres
 START_GROUP        | BEGIN                        | myGroup2                     | With log reset                                                                                                         | postgres
 START_GROUP        | TIME STAMP SET               | 10016                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | Start                                                                                                                  | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | Start                                                                                                                  | postgres
 START_GROUP        | END                          | myGroup2                     | 8 tables/sequences processed                                                                                           | postgres
 REMOVE_TABLES      | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLES      | TIME STAMP SET               | 10017                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | REMOVE_3_TABLES                                                                                                        | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | REMOVE_3_TABLES                                                                                                        | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2."myTbl3"           | From the logging group myGroup2                                                                                        | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2.mytbl1             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2.mytbl2             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_TABLES      | END                          |                              | 3 tables removed from their groups                                                                                     | postgres
 REMOVE_SEQUENCE    | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_SEQUENCE    | TIME STAMP SET               | 10018                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 3 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | REMOVE_1_SEQUENCES                                                                                                     | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | REMOVE_1_SEQUENCES                                                                                                     | postgres
 REMOVE_SEQUENCE    | SEQUENCE REMOVED             | myschema2.myseq1             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_SEQUENCE    | END                          |                              | 1 sequences removed from their groups                                                                                  | postgres
 ASSIGN_TABLES      | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLES      | TIME STAMP SET               | 10019                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 3 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | ASSIGN_3_TABLES                                                                                                        | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | ASSIGN_3_TABLES                                                                                                        | postgres
 ASSIGN_TABLES      | TABLE ADDED                  | myschema2."myTbl3"           | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_TABLES      | TABLE ADDED                  | myschema2.mytbl1             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_TABLES      | TABLE ADDED                  | myschema2.mytbl2             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_TABLES      | END                          |                              | 3 tables assigned to the group myGroup2                                                                                | postgres
 ASSIGN_SEQUENCES   | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_SEQUENCES   | TIME STAMP SET               | 10020                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | ASSIGN_2_SEQUENCES                                                                                                     | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | ASSIGN_2_SEQUENCES                                                                                                     | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED               | myschema2.myseq1             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED               | myschema2.myseq2             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_SEQUENCES   | END                          |                              | 2 sequences assigned to the group myGroup2                                                                             | postgres
 DISABLE_PROTECTION | EVENT TRIGGERS DISABLED      |                              | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                                         | postgres
 ENABLE_PROTECTION  | EVENT TRIGGERS ENABLED       |                              | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                                         | postgres
 REMOVE_TABLES      | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLES      | TIME STAMP SET               | 10021                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | REMOVE_%                                                                                                               | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2."myTbl3"           | From the logging group myGroup2                                                                                        | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2.mytbl1             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_TABLES      | TABLE REMOVED                | myschema2.mytbl2             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_TABLES      | END                          |                              | 3 tables removed from their groups                                                                                     | postgres
 REMOVE_SEQUENCES   | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_SEQUENCES   | TIME STAMP SET               | 10022                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 3 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | REMOVE_%                                                                                                               | postgres
 REMOVE_SEQUENCES   | SEQUENCE REMOVED             | myschema2.myseq1             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_SEQUENCES   | SEQUENCE REMOVED             | myschema2.myseq2             | From the logging group myGroup2                                                                                        | postgres
 REMOVE_SEQUENCES   | END                          |                              | 2 sequences removed from their groups                                                                                  | postgres
 ASSIGN_TABLES      | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLES      | TIME STAMP SET               | 10023                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 3 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | ASSIGN_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | ASSIGN_%                                                                                                               | postgres
 ASSIGN_TABLES      | TABLE ADDED                  | myschema2."myTbl3"           | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_TABLES      | TABLE ADDED                  | myschema2.mytbl1             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_TABLES      | TABLE ADDED                  | myschema2.mytbl2             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_TABLES      | END                          |                              | 3 tables assigned to the group myGroup2                                                                                | postgres
 ASSIGN_SEQUENCES   | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_SEQUENCES   | TIME STAMP SET               | 10024                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | Mark_assign_sequences                                                                                                  | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | Mark_assign_sequences                                                                                                  | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED               | myschema2.myseq1             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED               | myschema2.myseq2             | To the logging group myGroup2                                                                                          | postgres
 ASSIGN_SEQUENCES   | END                          |                              | 2 sequences assigned to the group myGroup2                                                                             | postgres
 REMOVE_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLE       | TIME STAMP SET               | 10025                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | REMOVE_%                                                                                                               | postgres
 REMOVE_TABLE       | TABLE REMOVED                | myschema1.mytbl4             | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLE       | END                          |                              | 1 tables removed from their groups                                                                                     | postgres
 ASSIGN_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLE       | TIME STAMP SET               | 10026                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 ASSIGN_TABLE       | TABLE ADDED                  | myschema1.mytbl4             | To the logging group myGroup1                                                                                          | postgres
 ASSIGN_TABLE       | END                          |                              | 1 tables assigned to the group myGroup1                                                                                | postgres
 REMOVE_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLE       | TIME STAMP SET               | 10027                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | REMOVE_%                                                                                                               | postgres
 REMOVE_TABLE       | TABLE REMOVED                | myschema1.mytbl4             | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLE       | END                          |                              | 1 tables removed from their groups                                                                                     | postgres
 ASSIGN_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLE       | TIME STAMP SET               | 10028                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | Assign_mytbl4                                                                                                          | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | Assign_mytbl4                                                                                                          | postgres
 ASSIGN_TABLE       | TABLE ADDED                  | myschema1.mytbl4             | To the logging group myGroup1                                                                                          | postgres
 ASSIGN_TABLE       | END                          |                              | 1 tables assigned to the group myGroup1                                                                                | postgres
 ROLLBACK_GROUP     | BEGIN                        | myGroup1                     | Unlogged rollback to mark Assign_mytbl4 (timestamp)                                                                    | postgres
 DBLINK_OPEN_CNX    |                              | rlbk#1                       | Status = 1                                                                                                             | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     | Rollback session #1                                                                                                    | postgres
 LOCK_GROUP         | END                          | myGroup1                     | Rollback session #1: 5 tables locked, 0 deadlock(s)                                                                    | postgres
 ROLLBACK_GROUP     | TIME STAMP SET               | 10032                        |                                                                                                                        | postgres
 ROLLBACK_SEQUENCE  |                              | myschema1.mytbl2b_col20_seq  | RESTART 3                                                                                                              | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema1.mytbl2             | All log rows where emaj_gid > 10000011 and <= 10000014, in session_replication_role = replica mode                     | postgres
 ROLLBACK_TABLE     | END                          | myschema1.mytbl2             | 1 rolled back primary keys                                                                                             | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema1.mytbl2b            | All log rows where emaj_gid > 10000011 and <= 10000014                                                                 | postgres
 ROLLBACK_TABLE     | END                          | myschema1.mytbl2b            | 1 rolled back primary keys                                                                                             | postgres
 ROLLBACK_TABLE     | BEGIN                        | myschema1.mytbl4             | All log rows where emaj_gid > 10000011 and <= 10000014, in session_replication_role = replica mode                     | postgres
 ROLLBACK_TABLE     | END                          | myschema1.mytbl4             | 1 rolled back primary keys                                                                                             | postgres
 ROLLBACK_GROUP     | NOTICE                       | Rollback id 10005            | Rollback id = 10005.                                                                                                   | postgres
 ROLLBACK_GROUP     | NOTICE                       | Rollback id 10005            | 3 / 5 tables effectively processed.                                                                                    | postgres
 ROLLBACK_GROUP     | NOTICE                       | Rollback id 10005            | 1 / 2 sequences effectively processed.                                                                                 | postgres
 DBLINK_CLOSE_CNX   |                              | rlbk#1                       |                                                                                                                        | postgres
 ROLLBACK_GROUP     | END                          | myGroup1                     | Rollback_id 10005                                                                                                      | postgres
 MOVE_TABLES        | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_TABLES        | TIME STAMP SET               | 10033                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1                     | MOVE_TBL_idle_to_logging                                                                                               | postgres
 CLEANUP_RLBK_STATE |                              | Rollback id 10005            | set to COMMITTED                                                                                                       | postgres
 SET_MARK_GROUPS    | END                          | myGroup1                     | MOVE_TBL_idle_to_logging                                                                                               | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp1a          | From the idle group myGroup4 to the logging group myGroup1                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp1b          | From the idle group myGroup4 to the logging group myGroup1                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp2           | From the idle group myGroup4 to the logging group myGroup1                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblc1            | From the idle group myGroup4 to the logging group myGroup1                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblc2            | From the idle group myGroup4 to the logging group myGroup1                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblm             | From the idle group myGroup4 to the logging group myGroup1                                                             | postgres
 MOVE_TABLES        | END                          |                              | 6 tables moved to the tables group myGroup1                                                                            | postgres
 MOVE_SEQUENCES     | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_SEQUENCES     | TIME STAMP SET               | 10034                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 17 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | MOVE_SEQ_idle_to_logging                                                                                               | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | MOVE_SEQ_idle_to_logging                                                                                               | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2."myTbl3_col31_seq" | From the logging group myGroup2 to the logging group myGroup1                                                          | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2.myseq1             | From the logging group myGroup2 to the logging group myGroup1                                                          | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2.myseq2             | From the logging group myGroup2 to the logging group myGroup1                                                          | postgres
 MOVE_SEQUENCES     | END                          |                              | 3 sequences moved to the tables group myGroup1                                                                         | postgres
 MOVE_TABLES        | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_TABLES        | TIME STAMP SET               | 10035                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 17 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | MOVE_TBL_logging_to_logging                                                                                            | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | MOVE_TBL_logging_to_logging                                                                                            | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp1a          | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp1b          | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp2           | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblc1            | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblc2            | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblm             | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLES        | END                          |                              | 6 tables moved to the tables group myGroup2                                                                            | postgres
 MOVE_SEQUENCES     | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_SEQUENCES     | TIME STAMP SET               | 10036                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 17 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | MOVE_SEQ_logging_to_logging                                                                                            | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | MOVE_SEQ_logging_to_logging                                                                                            | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2."myTbl3_col31_seq" | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2.myseq1             | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2.myseq2             | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_SEQUENCES     | END                          |                              | 3 sequences moved to the tables group myGroup2                                                                         | postgres
 MOVE_TABLES        | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_TABLES        | TIME STAMP SET               | 10037                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 12 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup2                     | MOVE_TBL_logging_to_idle                                                                                               | postgres
 SET_MARK_GROUPS    | END                          | myGroup2                     | MOVE_TBL_logging_to_idle                                                                                               | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp1a          | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp1b          | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mypartp2           | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblc1            | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblc2            | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_TABLES        | TABLE MOVED                  | myschema4.mytblm             | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_TABLES        | END                          |                              | 6 tables moved to the tables group myGroup4                                                                            | postgres
 MOVE_SEQUENCES     | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_SEQUENCES     | TIME STAMP SET               | 10038                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup2                     | MOVE_SEQ_logging_to_idle                                                                                               | postgres
 SET_MARK_GROUPS    | END                          | myGroup2                     | MOVE_SEQ_logging_to_idle                                                                                               | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2."myTbl3_col31_seq" | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2.myseq1             | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_SEQUENCES     | SEQUENCE MOVED               | myschema2.myseq2             | From the logging group myGroup2 to the idle group myGroup4                                                             | postgres
 MOVE_SEQUENCES     | END                          |                              | 3 sequences moved to the tables group myGroup4                                                                         | postgres
 MOVE_TABLE         | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_TABLE         | TIME STAMP SET               | 10039                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | Move a table with fkey                                                                                                 | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | Move a table with fkey                                                                                                 | postgres
 MOVE_TABLE         | TABLE MOVED                  | myschema2.mytbl2             | From the logging group myGroup2 to the logging group myGroup1                                                          | postgres
 MOVE_TABLE         | END                          |                              | 1 tables moved to the tables group myGroup1                                                                            | postgres
 MOVE_TABLE         | BEGIN                        |                              |                                                                                                                        | postgres
 MOVE_TABLE         | TIME STAMP SET               | 10040                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1,myGroup2            |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1,myGroup2            | 11 tables locked, 0 deadlock(s)                                                                                        | postgres
 SET_MARK_GROUPS    | BEGIN                        | myGroup1,myGroup2            | Move a table with fkey back                                                                                            | postgres
 SET_MARK_GROUPS    | END                          | myGroup1,myGroup2            | Move a table with fkey back                                                                                            | postgres
 MOVE_TABLE         | TABLE MOVED                  | myschema2.mytbl2             | From the logging group myGroup1 to the logging group myGroup2                                                          | postgres
 MOVE_TABLE         | END                          |                              | 1 tables moved to the tables group myGroup2                                                                            | postgres
 REMOVE_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLE       | TIME STAMP SET               | 10041                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | REMOVE_%                                                                                                               | postgres
 REMOVE_TABLE       | TABLE REMOVED                | myschema1.mytbl1             | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLE       | END                          |                              | 1 tables removed from their groups                                                                                     | postgres
 ASSIGN_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLE       | TIME STAMP SET               | 10042                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 ASSIGN_TABLE       | TABLE ADDED                  | myschema1.mytbl1_new_name    | To the logging group myGroup1                                                                                          | postgres
 ASSIGN_TABLE       | END                          |                              | 1 tables assigned to the group myGroup1                                                                                | postgres
 REMOVE_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLE       | TIME STAMP SET               | 10043                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | REMOVE_%                                                                                                               | postgres
 REMOVE_TABLE       | TABLE REMOVED                | myschema1.mytbl1_new_name    | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLE       | END                          |                              | 1 tables removed from their groups                                                                                     | postgres
 ASSIGN_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLE       | TIME STAMP SET               | 10044                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 ASSIGN_TABLE       | LOG_SCHEMA CREATED           | emaj_public                  |                                                                                                                        | postgres
 ASSIGN_TABLE       | TABLE ADDED                  | public.mytbl1_new_name       | To the logging group myGroup1                                                                                          | postgres
 ASSIGN_TABLE       | END                          |                              | 1 tables assigned to the group myGroup1                                                                                | postgres
 REMOVE_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 REMOVE_TABLE       | TIME STAMP SET               | 10045                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | REMOVE_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | REMOVE_%                                                                                                               | postgres
 REMOVE_TABLE       | TABLE REMOVED                | public.mytbl1_new_name       | From the logging group myGroup1                                                                                        | postgres
 REMOVE_TABLE       | END                          |                              | 1 tables removed from their groups                                                                                     | postgres
 ASSIGN_TABLE       | BEGIN                        |                              |                                                                                                                        | postgres
 ASSIGN_TABLE       | TIME STAMP SET               | 10046                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 4 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | ASSIGN_%                                                                                                               | postgres
 ASSIGN_TABLE       | TABLE ADDED                  | myschema1.mytbl1             | To the logging group myGroup1                                                                                          | postgres
 ASSIGN_TABLE       | END                          |                              | 1 tables assigned to the group myGroup1                                                                                | postgres
 STOP_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 STOP_GROUP         | TIME STAMP SET               | 10047                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup1                     | 5 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup1                     | STOP_%                                                                                                                 | postgres
 SET_MARK_GROUP     | END                          | myGroup1                     | STOP_%                                                                                                                 | postgres
 STOP_GROUP         | END                          | myGroup1                     | 7 tables/sequences processed                                                                                           | postgres
 STOP_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 STOP_GROUP         | TIME STAMP SET               | 10048                        |                                                                                                                        | postgres
 LOCK_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 LOCK_GROUP         | END                          | myGroup2                     | 6 tables locked, 0 deadlock(s)                                                                                         | postgres
 SET_MARK_GROUP     | BEGIN                        | myGroup2                     | STOP_%                                                                                                                 | postgres
 SET_MARK_GROUP     | END                          | myGroup2                     | STOP_%                                                                                                                 | postgres
 STOP_GROUP         | END                          | myGroup2                     | 6 tables/sequences processed                                                                                           | postgres
 DROP_GROUP         | BEGIN                        | myGroup1                     |                                                                                                                        | postgres
 DROP_GROUP         | TIME STAMP SET               | 10049                        |                                                                                                                        | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED           | emaj_myschema1               |                                                                                                                        | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED           | emaj_public                  |                                                                                                                        | postgres
 DROP_GROUP         | END                          | myGroup1                     | 7 tables/sequences processed                                                                                           | postgres
 DROP_GROUP         | BEGIN                        | myGroup2                     |                                                                                                                        | postgres
 DROP_GROUP         | TIME STAMP SET               | 10050                        |                                                                                                                        | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED           | emaj_myschema2               |                                                                                                                        | postgres
 DROP_GROUP         | END                          | myGroup2                     | 6 tables/sequences processed                                                                                           | postgres
 DROP_GROUP         | BEGIN                        | myGroup4                     |                                                                                                                        | postgres
 DROP_GROUP         | TIME STAMP SET               | 10051                        |                                                                                                                        | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED           | emaj_myschema4               |                                                                                                                        | postgres
 DROP_GROUP         | END                          | myGroup4                     | 9 tables/sequences processed                                                                                           | postgres
 DROP_GROUP         | BEGIN                        | myGroup5                     |                                                                                                                        | postgres
 DROP_GROUP         | TIME STAMP SET               | 10052                        |                                                                                                                        | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED           | emaj_myschema5               |                                                                                                                        | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED           | "emaj_phil's schema""3"      |                                                                                                                        | postgres
 DROP_GROUP         | END                          | myGroup5                     | 2 tables/sequences processed                                                                                           | postgres
 DROP_GROUP         | BEGIN                        | emptyGroup                   |                                                                                                                        | postgres
 DROP_GROUP         | TIME STAMP SET               | 10053                        |                                                                                                                        | postgres
 DROP_GROUP         | END                          | emptyGroup                   | 0 tables/sequences processed                                                                                           | postgres
(413 rows)

select nspname from pg_namespace where nspname like 'emaj%' order by nspname;
 nspname 
---------
 emaj
(1 row)

select * from emaj.emaj_schema order by 1;
 sch_name | sch_time_id 
----------+-------------
 emaj     |            
(1 row)

select * from emaj.emaj_rel_hist order by 1,2,3;
   relh_schema   |    relh_tblseq    | relh_time_range |    relh_group    | relh_kind 
-----------------+-------------------+-----------------+------------------+-----------
 myschema1       | myTbl3            | [2000,8001)     | myGroup1         | r
 myschema1       | myTbl3            | [8010,8014)     | myGroup1         | r
 myschema1       | myTbl3            | [8019,9701)     | myGroup1         | r
 myschema1       | myTbl3            | [9713,10049)    | myGroup1         | r
 myschema1       | myTbl3_col31_seq  | [2000,8001)     | myGroup1         | S
 myschema1       | myTbl3_col31_seq  | [8010,9302)     | myGroup1         | S
 myschema1       | myTbl3_col31_seq  | [9309,10049)    | myGroup1         | S
 myschema1       | mytbl1            | [2000,8001)     | myGroup1         | r
 myschema1       | mytbl1            | [8010,8012)     | myGroup1         | r
 myschema1       | mytbl1            | [8019,8200)     | myGroup1         | r
 myschema1       | mytbl1            | [8200,8202)     | myGroup2         | r
 myschema1       | mytbl1            | [8202,9707)     | myGroup1         | r
 myschema1       | mytbl1            | [9713,10041)    | myGroup1         | r
 myschema1       | mytbl1            | [10046,10049)   | myGroup1         | r
 myschema1       | mytbl1_new_name   | [10042,10043)   | myGroup1         | r
 myschema1       | mytbl2            | [2000,8001)     | myGroup1         | r
 myschema1       | mytbl2            | [8010,8013)     | myGroup1         | r
 myschema1       | mytbl2            | [8019,8201)     | myGroup1         | r
 myschema1       | mytbl2            | [8201,8203)     | myGroup2         | r
 myschema1       | mytbl2            | [8203,10049)    | myGroup1         | r
 myschema1       | mytbl2b           | [2000,8001)     | myGroup1         | r
 myschema1       | mytbl2b           | [8010,8013)     | myGroup1         | r
 myschema1       | mytbl2b           | [8019,8201)     | myGroup1         | r
 myschema1       | mytbl2b           | [8201,8202)     | myGroup2         | r
 myschema1       | mytbl2b           | [8202,9701)     | myGroup1         | r
 myschema1       | mytbl2b           | [9713,10049)    | myGroup1         | r
 myschema1       | mytbl2b_col20_seq | [2000,8001)     | myGroup1         | S
 myschema1       | mytbl2b_col20_seq | [8010,10049)    | myGroup1         | S
 myschema1       | mytbl4            | [2000,8001)     | myGroup1         | r
 myschema1       | mytbl4            | [8010,8014)     | myGroup1         | r
 myschema1       | mytbl4            | [8019,10025)    | myGroup1         | r
 myschema1       | mytbl4            | [10026,10027)   | myGroup1         | r
 myschema1       | mytbl4            | [10028,10049)   | myGroup1         | r
 myschema2       | myTbl3            | [2000,8002)     | myGroup2         | r
 myschema2       | myTbl3            | [8010,10005)    | myGroup2         | r
 myschema2       | myTbl3            | [10005,10015)   | myGroup1         | r
 myschema2       | myTbl3            | [10015,10017)   | myGroup2         | r
 myschema2       | myTbl3            | [10019,10021)   | myGroup2         | r
 myschema2       | myTbl3            | [10023,10050)   | myGroup2         | r
 myschema2       | myTbl3_col31_seq  | [2000,8002)     | myGroup2         | S
 myschema2       | myTbl3_col31_seq  | [8010,8018)     | myGroup2         | S
 myschema2       | myTbl3_col31_seq  | [8019,10006)    | myGroup2         | S
 myschema2       | myTbl3_col31_seq  | [10006,10015)   | myGroup1         | S
 myschema2       | myTbl3_col31_seq  | [10015,10034)   | myGroup2         | S
 myschema2       | myTbl3_col31_seq  | [10034,10036)   | myGroup1         | S
 myschema2       | myTbl3_col31_seq  | [10036,10038)   | myGroup2         | S
 myschema2       | myTbl3_col31_seq  | [10038,10051)   | myGroup4         | S
 myschema2       | myseq1            | [2000,8002)     | myGroup2         | S
 myschema2       | myseq1            | [8010,8015)     | myGroup2         | S
 myschema2       | myseq1            | [8019,8204)     | myGroup2         | S
 myschema2       | myseq1            | [8204,8205)     | myGroup1         | S
 myschema2       | myseq1            | [8205,8206)     | myGroup2         | S
 myschema2       | myseq1            | [8206,8207)     | myGroup4         | S
 myschema2       | myseq1            | [8207,10018)    | myGroup2         | S
 myschema2       | myseq1            | [10020,10022)   | myGroup2         | S
 myschema2       | myseq1            | [10024,10034)   | myGroup2         | S
 myschema2       | myseq1            | [10034,10036)   | myGroup1         | S
 myschema2       | myseq1            | [10036,10038)   | myGroup2         | S
 myschema2       | myseq1            | [10038,10051)   | myGroup4         | S
 myschema2       | myseq2            | [8016,8017)     | myGroup2         | S
 myschema2       | myseq2            | [9102,9107)     | myGroup2         | S
 myschema2       | myseq2            | [9108,9109)     | myGroup2         | S
 myschema2       | myseq2            | [10020,10022)   | myGroup2         | S
 myschema2       | myseq2            | [10024,10034)   | myGroup2         | S
 myschema2       | myseq2            | [10034,10036)   | myGroup1         | S
 myschema2       | myseq2            | [10036,10038)   | myGroup2         | S
 myschema2       | myseq2            | [10038,10051)   | myGroup4         | S
 myschema2       | mytbl1            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl1            | [8010,10017)    | myGroup2         | r
 myschema2       | mytbl1            | [10019,10021)   | myGroup2         | r
 myschema2       | mytbl1            | [10023,10050)   | myGroup2         | r
 myschema2       | mytbl2            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl2            | [8010,10017)    | myGroup2         | r
 myschema2       | mytbl2            | [10019,10021)   | myGroup2         | r
 myschema2       | mytbl2            | [10023,10039)   | myGroup2         | r
 myschema2       | mytbl2            | [10039,10040)   | myGroup1         | r
 myschema2       | mytbl2            | [10040,10050)   | myGroup2         | r
 myschema2       | mytbl4            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl4            | [8010,10050)    | myGroup2         | r
 myschema2       | mytbl5            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl5            | [8010,10050)    | myGroup2         | r
 myschema2       | mytbl6            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl6            | [8010,10050)    | myGroup2         | r
 myschema2       | mytbl7            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl7            | [8010,9000)     | myGroup2         | r
 myschema2       | mytbl7            | [9502,9509)     | myGroup2         | r
 myschema2       | mytbl7            | [9510,9511)     | myGroup2         | r
 myschema2       | mytbl8            | [2000,8002)     | myGroup2         | r
 myschema2       | mytbl8            | [8010,9000)     | myGroup2         | r
 myschema4       | mypartp1a         | [1023,8006)     | myGroup4         | r
 myschema4       | mypartp1a         | [8010,10033)    | myGroup4         | r
 myschema4       | mypartp1a         | [10033,10035)   | myGroup1         | r
 myschema4       | mypartp1a         | [10035,10037)   | myGroup2         | r
 myschema4       | mypartp1a         | [10037,10051)   | myGroup4         | r
 myschema4       | mypartp1b         | [1023,8006)     | myGroup4         | r
 myschema4       | mypartp1b         | [8010,10033)    | myGroup4         | r
 myschema4       | mypartp1b         | [10033,10035)   | myGroup1         | r
 myschema4       | mypartp1b         | [10035,10037)   | myGroup2         | r
 myschema4       | mypartp1b         | [10037,10051)   | myGroup4         | r
 myschema4       | mypartp2          | [1023,8006)     | myGroup4         | r
 myschema4       | mypartp2          | [8010,10033)    | myGroup4         | r
 myschema4       | mypartp2          | [10033,10035)   | myGroup1         | r
 myschema4       | mypartp2          | [10035,10037)   | myGroup2         | r
 myschema4       | mypartp2          | [10037,10051)   | myGroup4         | r
 myschema4       | mytblc1           | [1023,8006)     | myGroup4         | r
 myschema4       | mytblc1           | [8010,10033)    | myGroup4         | r
 myschema4       | mytblc1           | [10033,10035)   | myGroup1         | r
 myschema4       | mytblc1           | [10035,10037)   | myGroup2         | r
 myschema4       | mytblc1           | [10037,10051)   | myGroup4         | r
 myschema4       | mytblc2           | [1023,8006)     | myGroup4         | r
 myschema4       | mytblc2           | [8010,10033)    | myGroup4         | r
 myschema4       | mytblc2           | [10033,10035)   | myGroup1         | r
 myschema4       | mytblc2           | [10035,10037)   | myGroup2         | r
 myschema4       | mytblc2           | [10037,10051)   | myGroup4         | r
 myschema4       | mytblm            | [1023,8006)     | myGroup4         | r
 myschema4       | mytblm            | [8010,10033)    | myGroup4         | r
 myschema4       | mytblm            | [10033,10035)   | myGroup1         | r
 myschema4       | mytblm            | [10035,10037)   | myGroup2         | r
 myschema4       | mytblm            | [10037,10051)   | myGroup4         | r
 myschema4       | mytblr1           | [4065,8006)     | myGroup4         | r
 myschema4       | mytblr2           | [4046,8006)     | myGroup4         | r
 myschema5       | myunloggedtbl     | [8010,10052)    | myGroup5         | r
 phil's schema"3 | myTbl2\           | [1019,8004)     | phil's group#3", | r
 phil's schema"3 | myTbl2\           | [8011,10052)    | myGroup5         | r
 phil's schema"3 | myTbl2\_col21_seq | [1028,8004)     | phil's group#3", | S
 phil's schema"3 | phil's tbl1       | [1019,8004)     | phil's group#3", | r
 phil's schema"3 | phil's"seq\1      | [1028,8004)     | phil's group#3", | S
 public          | mytbl1_new_name   | [10044,10045)   | myGroup1         | r
(128 rows)

select rlbk_id, rlbk_status, rlbk_comment from emaj.emaj_rlbk where rlbk_comment is not null order by 1;
 rlbk_id | rlbk_status |                  rlbk_comment                  
---------+-------------+------------------------------------------------
    4010 | COMMITTED   | Rollback set by the 'rollback.sql' script
    4012 | COMMITTED   | Logged rollback set by the rollback.sql script
    4019 | COMMITTED   | my comment
    9705 | COMMITTED   | Rollback 2 groups crossing an alter group
   10002 | COMMITTED   | Logged rollback on 2 groups
(5 rows)

truncate emaj.emaj_hist;
-- remove the temp directory
\! rm -R $EMAJTESTTMPDIR
