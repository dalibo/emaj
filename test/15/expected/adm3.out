-- adm3.sql : complex scenario executed by an emaj_adm role. 
--            Follows adm1.sql and adm2.sql
--
-- set sequence restart value
select public.handle_emaj_sequences(17000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-- define and create the temp file directory to be used by the script
\setenv EMAJTESTTMPDIR '/tmp/emaj_'`echo $PGVER`'/adm3'
\set EMAJTESTTMPDIR `echo $EMAJTESTTMPDIR`
\! mkdir -p $EMAJTESTTMPDIR
set role emaj_regression_tests_adm_user1;
set search_path=public,myschema1;
-----------------------------
-- Step 15 : export / import configurations
-----------------------------
-- save parameters on a file and reload them
select emaj.emaj_export_parameters_configuration(:'EMAJTESTTMPDIR' || '/param_config.json');
 emaj_export_parameters_configuration 
--------------------------------------
                                    3
(1 row)

select emaj.emaj_import_parameters_configuration(:'EMAJTESTTMPDIR' || '/param_config.json', true);
 emaj_import_parameters_configuration 
--------------------------------------
                                    3
(1 row)

-- also save the groups configuration on a file
select emaj.emaj_export_groups_configuration(:'EMAJTESTTMPDIR' || '/groups_config.json');
 emaj_export_groups_configuration 
----------------------------------
                                3
(1 row)

-----------------------------
-- Checking step 15
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
(0 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17000 order by hist_id;
   hist_function   |     hist_event     |         hist_object          |                                                             regexp_replace                                                             | hist_user 
-------------------+--------------------+------------------------------+----------------------------------------------------------------------------------------------------------------------------------------+-----------
 IMPORT_PARAMETERS | BEGIN              |                              | Input file: '/tmp/emaj_15/adm3/param_config.json'                                                                                      | postgres
                   | DELETED PARAMETER  | dblink_user_password         |                                                                                                                                        | postgres
                   | DELETED PARAMETER  | alter_log_table              |                                                                                                                                        | postgres
                   | DELETED PARAMETER  | fixed_step_rollback_duration |                                                                                                                                        | postgres
                   | INSERTED PARAMETER | dblink_user_password         | <masked data>                                                                                                                          | postgres
                   | INSERTED PARAMETER | alter_log_table              | ADD COLUMN emaj_user_ip INET DEFAULT inet_client_addr(), ADD COLUMN extra_col_appname TEXT DEFAULT current_setting('application_name') | postgres
                   | INSERTED PARAMETER | fixed_step_rollback_duration | @ 0.0025 secs                                                                                                                          | postgres
 IMPORT_PARAMETERS | END                |                              | 3 parameters imported                                                                                                                  | postgres
(8 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17100);
 handle_emaj_sequences 
-----------------------
 
(1 row)

\! rm $EMAJTESTTMPDIR/*
-----------------------------
-- Step 16 : test transactions with several emaj operations
-----------------------------
select emaj.emaj_create_group('myGroup4');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj.emaj_assign_tables('myschema4','.*',null,'myGroup4');
WARNING:  _assign_tables: Some partitionned tables (mytblp) are not selected.
NOTICE:  table "mytblr_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblr" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblr" does not exist, skipping
NOTICE:  table "mytblm_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblm" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblm" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mytblm" has triggers that will be automatically disabled during E-Maj rollback operations (mytblm_insert_trigger). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblc2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  table "mypartp2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp2" does not exist, skipping
NOTICE:  table "mytblc1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  table "mypartp1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  6
(1 row)

-- several similar operations in a single transaction, using different mark names
begin;
  select emaj.emaj_start_group('myGroup4','M1');
 emaj_start_group 
------------------
                6
(1 row)

  select emaj.emaj_set_mark_group('myGroup4','M2');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

  select emaj.emaj_set_mark_group('myGroup4','M3');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

  select emaj.emaj_stop_group('myGroup4','M4');
 emaj_stop_group 
-----------------
               6
(1 row)

  select emaj.emaj_start_group('myGroup4','M5',false);
 emaj_start_group 
------------------
                6
(1 row)

  select emaj.emaj_stop_group('myGroup4','M6');
 emaj_stop_group 
-----------------
               6
(1 row)

commit;
-----------------------------
-- Checking step 16
-----------------------------
-- emaj tables
select * from emaj.emaj_mark where mark_group = 'myGroup4' order by mark_time_id, mark_group;
 mark_group | mark_name | mark_time_id | mark_is_deleted | mark_is_rlbk_protected | mark_comment | mark_log_rows_before_next | mark_logged_rlbk_target_mark 
------------+-----------+--------------+-----------------+------------------------+--------------+---------------------------+------------------------------
 myGroup4   | M1        |        17102 | t               | f                      |              |                         0 | 
 myGroup4   | M2        |        17103 | t               | f                      |              |                         0 | 
 myGroup4   | M3        |        17104 | t               | f                      |              |                         0 | 
 myGroup4   | M4        |        17105 | t               | f                      |              |                         0 | 
 myGroup4   | M5        |        17106 | t               | f                      |              |                         0 | 
 myGroup4   | M6        |        17107 | t               | f                      |              |                         0 | 
(6 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17100 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17100 |           17100000 | C
   17101 |           17100000 | A
   17102 |           17100000 | M
   17103 |           17100000 | M
   17104 |           17100000 | M
   17105 |           17100000 | M
   17106 |           17100000 | M
   17107 |           17100000 | M
(8 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17100 order by hist_id;
   hist_function    |     hist_event     |    hist_object     |             regexp_replace              | hist_user 
--------------------+--------------------+--------------------+-----------------------------------------+-----------
 CREATE_GROUP       | BEGIN              | myGroup4           | rollbackable                            | postgres
 CREATE_GROUP       | END                | myGroup4           |                                         | postgres
 ASSIGN_TABLES      | BEGIN              |                    |                                         | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED | emaj_myschema4     |                                         | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblr   | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblm   | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblc2  | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp2 | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblc1  | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp1 | To the idle group myGroup4              | postgres
 ASSIGN_TABLES      | END                |                    | 6 tables assigned to the group myGroup4 | postgres
 START_GROUP        | BEGIN              | myGroup4           | With log reset                          | postgres
 LOCK_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | END                | myGroup4           | 6 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4           | M1                                      | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 14707  | set to COMMITTED                        | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 14708  | set to COMMITTED                        | postgres
 SET_MARK_GROUP     | END                | myGroup4           | M1                                      | postgres
 START_GROUP        | END                | myGroup4           | 6 tables/sequences processed            | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | END                | myGroup4           | 6 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | END                | myGroup4           | M2                                      | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | END                | myGroup4           | 6 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | END                | myGroup4           | M3                                      | postgres
 STOP_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | END                | myGroup4           | 6 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4           | M4                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4           | M4                                      | postgres
 STOP_GROUP         | END                | myGroup4           | 6 tables/sequences processed            | postgres
 START_GROUP        | BEGIN              | myGroup4           | Without log reset                       | postgres
 LOCK_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | END                | myGroup4           | 6 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4           | M5                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4           | M5                                      | postgres
 START_GROUP        | END                | myGroup4           | 6 tables/sequences processed            | postgres
 STOP_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4           |                                         | postgres
 LOCK_GROUP         | END                | myGroup4           | 6 tables locked, 0 deadlock(s)          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4           | M6                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4           | M6                                      | postgres
 STOP_GROUP         | END                | myGroup4           | 6 tables/sequences processed            | postgres
(45 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17200);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- Step 17 : test partition attach and detach
-----------------------------
-- Needs postgres 10+
set role emaj_regression_tests_adm_user2;
select emaj.emaj_start_group('myGroup4','Start');
 emaj_start_group 
------------------
                6
(1 row)

insert into mySchema4.myTblP values (-1,'Stored in partition 1'), (1,'Stored in partition 2');
select emaj.emaj_set_mark_group('myGroup4','M1');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

update mySchema4.myTblP set col1 = 2 where col1 = 1;
-- create a new partition and add it into the group ; in passing also add the sequence linked to the serial column of the mother table
reset role;
CREATE TABLE mySchema4.myPartP3 PARTITION OF mySchema4.myTblP FOR VALUES FROM (10) TO (19);
-- create the table with PG 9.6- so that next scripts do not abort
CREATE TABLE IF NOT EXISTS mySchema4.myPartP3 () INHERITS (mySchema4.myTblP);
NOTICE:  relation "mypartp3" already exists, skipping
-- add a PK (will fail with PG12+ because of the global PK)
ALTER TABLE mySchema4.myPartP3 ADD PRIMARY KEY (col1);
ERROR:  multiple primary keys for table "mypartp3" are not allowed
grant all on mySchema4.myPartP3 to emaj_regression_tests_adm_user1, emaj_regression_tests_adm_user2;
set role emaj_regression_tests_adm_user1;
select emaj.emaj_assign_table('myschema4','mypartp3','myGroup4',null,'Add partition 3');
NOTICE:  table "mypartp3_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp3" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp3" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_sequence('myschema4','mytblp_col3_seq','myGroup4','Add partition 3_seq');
 emaj_assign_sequence 
----------------------
                    1
(1 row)

insert into mySchema4.myTblP values (11,'Stored in partition 3');
-- remove an obsolete partition ; in passing also remove the sequence linked to the serial column of the mother table
select emaj.emaj_remove_table('myschema4','mypartp1','Remove partition 1');
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_remove_sequence('myschema4','mytblp_col3_seq','Remove partition 1_seq');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

reset role;
drop table mySchema4.myPartP1 cascade;
NOTICE:  drop cascades to constraint mytblr_col2_fkey on table myschema4.mytblr
set role emaj_regression_tests_adm_user2;
-- verify that emaj_adm has the proper grants to delete old marks leading to an old log table drop
begin transaction;
  select emaj.emaj_delete_before_mark_group('myGroup4','EMAJ_LAST_MARK');
 emaj_delete_before_mark_group 
-------------------------------
                             5
(1 row)

rollback;
-- look at statistics and log content
select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj.emaj_log_stat_group('myGroup4',NULL, NULL) order by 1,2,3,4;
 stat_group | stat_schema | stat_table | stat_first_mark |   stat_last_mark   | stat_rows 
------------+-------------+------------+-----------------+--------------------+-----------
 myGroup4   | myschema4   | mypartp1   | Start           | Remove partition 1 |         1
 myGroup4   | myschema4   | mypartp2   | Start           |                    |         2
 myGroup4   | myschema4   | mypartp3   | Add partition 3 |                    |         1
 myGroup4   | myschema4   | mytblc1    | Start           |                    |         0
 myGroup4   | myschema4   | mytblc2    | Start           |                    |         0
 myGroup4   | myschema4   | mytblm     | Start           |                    |         0
 myGroup4   | myschema4   | mytblr     | Start           |                    |         0
(7 rows)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind, rel_log_schema, rel_log_table,
       rel_emaj_verb_attnum, rel_has_always_ident_col, rel_log_seq_last_value
  from emaj.emaj_relation where rel_schema = 'myschema4' and rel_tblseq like 'mypar%' order by rel_tblseq, rel_time_range;
 rel_schema | rel_tblseq | rel_time_range | rel_group | rel_kind | rel_log_schema | rel_log_table  | rel_emaj_verb_attnum | rel_has_always_ident_col | rel_log_seq_last_value 
------------+------------+----------------+-----------+----------+----------------+----------------+----------------------+--------------------------+------------------------
 myschema4  | mypartp1   | [17101,17204)  | myGroup4  | r        | emaj_myschema4 | mypartp1_log_1 |                    4 | f                        |                      1
 myschema4  | mypartp2   | [17101,)       | myGroup4  | r        | emaj_myschema4 | mypartp2_log   |                    4 | f                        |                       
 myschema4  | mypartp3   | [17202,)       | myGroup4  | r        | emaj_myschema4 | mypartp3_log   |                    4 | f                        |                       
(3 rows)

select col1, col2, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartP3_log order by emaj_gid;
 col1 |         col2          | emaj_verb | emaj_tuple | emaj_gid 
------+-----------------------+-----------+------------+----------
   11 | Stored in partition 3 | INS       | NEW        | 17200004
(1 row)

select col1, col2, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartP1_log_1 order by emaj_gid;
 col1 |         col2          | emaj_verb | emaj_tuple | emaj_gid 
------+-----------------------+-----------+------------+----------
   -1 | Stored in partition 1 | INS       | NEW        | 17200001
(1 row)

-- rollback to a mark set before the first changes
select * from emaj.emaj_rollback_group('myGroup4','Start');
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 60 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(array[p_groupName], p_mark, FALSE, FALSE, coalesce(p_isAlterGroupAllowed, FALSE))"
PL/pgSQL function emaj.emaj_rollback_group(text,text,boolean) line 7 at RETURN QUERY
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_group('myGroup4','Start',true);
 rlbk_severity |                                             regexp_replace                                              
---------------+---------------------------------------------------------------------------------------------------------
 Notice        | 2 / 6 tables effectively processed.
 Warning       | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mypartp1 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The sequence myschema4.mytblp_col3_seq has been left unchanged (not in group anymore since <timestamp>)
(4 rows)

-- testing a row update leading to a partition change (needs pg 11)
insert into mySchema4.myTblP values (1,'Initialy stored in partition 2'), (11,'Stored in partition 3');
select emaj.emaj_set_mark_group('myGroup4','Before update');
 emaj_set_mark_group 
---------------------
                   6
(1 row)

update mySchema4.myTblP set col1 = 12 where col1=1;
select * from emaj.emaj_logged_rollback_group('myGroup4','Before update');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 2 / 6 tables effectively processed.
(1 row)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartP2_log;
 col1 |              col2              | col3 | emaj_verb | emaj_tuple | emaj_gid 
------+--------------------------------+------+-----------+------------+----------
    1 | Initialy stored in partition 2 |    7 | INS       | NEW        | 17200005
    1 | Initialy stored in partition 2 |    7 | DEL       | OLD        | 17200007
    1 | Initialy stored in partition 2 |    7 | INS       | NEW        | 17200009
(3 rows)

select col1, col2, col3, emaj_verb, emaj_tuple, emaj_gid from emaj_myschema4.mypartP3_log;
 col1 |              col2              | col3 | emaj_verb | emaj_tuple | emaj_gid 
------+--------------------------------+------+-----------+------------+----------
   11 | Stored in partition 3          |    8 | INS       | NEW        | 17200006
   12 | Initialy stored in partition 2 |    7 | INS       | NEW        | 17200008
   12 | Initialy stored in partition 2 |    7 | DEL       | OLD        | 17200010
(3 rows)

select emaj.emaj_stop_group('myGroup4');
 emaj_stop_group 
-----------------
               6
(1 row)

select emaj.emaj_drop_group('myGroup4');
 emaj_drop_group 
-----------------
               6
(1 row)

-----------------------------
-- Checking step 17
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17200 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17200 |           17200000 | M
   17201 |           17200002 | M
   17202 |           17200003 | A
   17203 |           17200003 | A
   17204 |           17200004 | A
   17205 |           17200004 | A
   17206 |           17200004 | R
   17207 |           17200006 | M
   17208 |           17200008 | R
   17209 |           17200010 | M
   17210 |           17200010 | M
   17211 |           17200010 | D
(12 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17200 order by hist_id;
   hist_function    |     hist_event     |        hist_object        |                                             regexp_replace                                              | hist_user 
--------------------+--------------------+---------------------------+---------------------------------------------------------------------------------------------------------+-----------
 START_GROUP        | BEGIN              | myGroup4                  | With log reset                                                                                          | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 6 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Start                                                                                                   | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Start                                                                                                   | postgres
 START_GROUP        | END                | myGroup4                  | 6 tables/sequences processed                                                                            | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 6 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | M1                                                                                                      | postgres
 ASSIGN_TABLE       | BEGIN              |                           |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 6 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Add partition 3                                                                                         | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Add partition 3                                                                                         | postgres
 ASSIGN_TABLE       | TABLE ADDED        | myschema4.mypartp3        | To the logging group myGroup4                                                                           | postgres
 ASSIGN_TABLE       | END                |                           | 1 tables assigned to the group myGroup4                                                                 | postgres
 ASSIGN_SEQUENCE    | BEGIN              |                           |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 7 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Add partition 3_seq                                                                                     | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Add partition 3_seq                                                                                     | postgres
 ASSIGN_SEQUENCE    | SEQUENCE ADDED     | myschema4.mytblp_col3_seq | To the logging group myGroup4                                                                           | postgres
 ASSIGN_SEQUENCE    | END                |                           | 1 sequences assigned to the group myGroup4                                                              | postgres
 REMOVE_TABLE       | BEGIN              |                           |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 7 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Remove partition 1                                                                                      | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Remove partition 1                                                                                      | postgres
 REMOVE_TABLE       | TABLE REMOVED      | myschema4.mypartp1        | From the logging group myGroup4                                                                         | postgres
 REMOVE_TABLE       | END                |                           | 1 tables removed from their groups                                                                      | postgres
 REMOVE_SEQUENCE    | BEGIN              |                           |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 6 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | Remove partition 1_seq                                                                                  | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Remove partition 1_seq                                                                                  | postgres
 REMOVE_SEQUENCE    | SEQUENCE REMOVED   | myschema4.mytblp_col3_seq | From the logging group myGroup4                                                                         | postgres
 REMOVE_SEQUENCE    | END                |                           | 1 sequences removed from their groups                                                                   | postgres
 ROLLBACK_GROUP     | BEGIN              | myGroup4                  | Unlogged rollback to mark Start (timestamp)                                                             | postgres
 DBLINK_OPEN_CNX    |                    | rlbk#1                    | Status = 1                                                                                              | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  | Rollback session #1                                                                                     | postgres
 LOCK_GROUP         | END                | myGroup4                  | Rollback session #1: 6 tables locked, 0 deadlock(s)                                                     | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp2        | All log rows where emaj_gid > 17200000 and <= 17200004                                                  | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp2        | 2 rolled back primary keys                                                                              | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp3        | All log rows where emaj_gid > 17200003 and <= 17200004                                                  | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp3        | 1 rolled back primary keys                                                                              | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark M1 is deleted                                                                                      | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Add partition 3 is deleted                                                                         | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Add partition 3_seq is deleted                                                                     | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Remove partition 1 is deleted                                                                      | postgres
 ROLLBACK_GROUP     | MARK DELETED       | myGroup4                  | mark Remove partition 1_seq is deleted                                                                  | postgres
 ROLLBACK_GROUP     | NOTICE             | Rollback id 17200         | 2 / 6 tables effectively processed.                                                                     | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)     | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The table myschema4.mypartp1 has been left unchanged (not in group anymore since <timestamp>)           | postgres
 ROLLBACK_GROUP     | WARNING            | Rollback id 17200         | The sequence myschema4.mytblp_col3_seq has been left unchanged (not in group anymore since <timestamp>) | postgres
 DBLINK_CLOSE_CNX   |                    | rlbk#1                    |                                                                                                         | postgres
 ROLLBACK_GROUP     | END                | myGroup4                  | Rollback_id 17200, 2 tables and 0 sequences effectively processed                                       | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 6 tables locked, 0 deadlock(s)                                                                          | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 17200         | set to COMMITTED                                                                                        | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | Before update                                                                                           | postgres
 ROLLBACK_GROUP     | BEGIN              | myGroup4                  | Logged rollback to mark Before update (timestamp)                                                       | postgres
 DBLINK_OPEN_CNX    |                    | rlbk#1                    | Status = 1                                                                                              | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  | Rollback session #1                                                                                     | postgres
 LOCK_GROUP         | END                | myGroup4                  | Rollback session #1: 6 tables locked, 0 deadlock(s)                                                     | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | RLBK_Before update_%_START                                                                              | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | RLBK_Before update_%_START                                                                              | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp2        | All log rows where emaj_gid > 17200006 and <= 17200008                                                  | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp2        | 1 rolled back primary keys                                                                              | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp3        | All log rows where emaj_gid > 17200006 and <= 17200008                                                  | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp3        | 1 rolled back primary keys                                                                              | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | RLBK_Before update_%_DONE                                                                               | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | RLBK_Before update_%_DONE                                                                               | postgres
 ROLLBACK_GROUP     | NOTICE             | Rollback id 17201         | 2 / 6 tables effectively processed.                                                                     | postgres
 DBLINK_CLOSE_CNX   |                    | rlbk#1                    |                                                                                                         | postgres
 ROLLBACK_GROUP     | END                | myGroup4                  | Rollback_id 17201, 2 tables and 0 sequences effectively processed                                       | postgres
 STOP_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 LOCK_GROUP         | END                | myGroup4                  | 6 tables locked, 0 deadlock(s)                                                                          | postgres
 SET_MARK_GROUP     | BEGIN              | myGroup4                  | STOP_%                                                                                                  | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 17201         | set to COMMITTED                                                                                        | postgres
 SET_MARK_GROUP     | END                | myGroup4                  | STOP_%                                                                                                  | postgres
 STOP_GROUP         | END                | myGroup4                  | 6 tables/sequences processed                                                                            | postgres
 DROP_GROUP         | BEGIN              | myGroup4                  |                                                                                                         | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED | emaj_myschema4            |                                                                                                         | postgres
 DROP_GROUP         | END                | myGroup4                  | 6 tables/sequences processed                                                                            | postgres
(87 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17400);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- Step 18 : test defect with application table or sequence
--           also test some changes on the unlogged and the with oids tables
-----------------------------
select emaj.emaj_create_group('phil''s group#3",',false);
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj.emaj_assign_tables('phil''s schema3','.*',null,'phil''s group#3",');
NOTICE:  table "myTbl2\_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.myTbl2\" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.myTbl2\" does not exist, skipping
NOTICE:  table "mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  table "phil's tbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.phil's tbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.phil's tbl1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  3
(1 row)

select emaj.emaj_assign_sequences('phil''s schema3','.*',null,'phil''s group#3",');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

select emaj.emaj_assign_tables('myschema5','.*',null,'phil''s group#3",');
NOTICE:  table "myoidstbl_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema5.myoidstbl" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema5.myoidstbl" does not exist, skipping
NOTICE:  table "myunloggedtbl_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema5.myunloggedtbl" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema5.myunloggedtbl" does not exist, skipping
 emaj_assign_tables 
--------------------
                  2
(1 row)

select emaj.emaj_start_group('phil''s group#3",','start');
 emaj_start_group 
------------------
                7
(1 row)

-----------------------------
-- test changes on the unlogged and the with oids tables
-----------------------------
insert into myschema5.myUnloggedTbl values (10),(11),(12);
update myschema5.myUnloggedTbl set col1 = 13 where col1 = 12;
delete from myschema5.myUnloggedTbl where col1 = 10;
insert into myschema5.myOidsTbl values (20),(21),(22);
update myschema5.myOidsTbl set col1 = 23 where col1 = 22;
delete from myschema5.myOidsTbl where col1 = 21;
select col1, emaj_verb, emaj_tuple, emaj_gid, emaj_user from emaj_myschema5.myUnloggedTbl_log order by emaj_gid;
 col1 | emaj_verb | emaj_tuple | emaj_gid | emaj_user 
------+-----------+------------+----------+-----------
   10 | INS       | NEW        | 17400001 | postgres
   11 | INS       | NEW        | 17400002 | postgres
   12 | INS       | NEW        | 17400003 | postgres
   12 | UPD       | OLD        | 17400004 | postgres
   13 | UPD       | NEW        | 17400004 | postgres
   10 | DEL       | OLD        | 17400005 | postgres
(6 rows)

select col1, emaj_verb, emaj_tuple, emaj_gid, emaj_user from emaj_myschema5.myOidsTbl_log order by emaj_gid;
 col1 | emaj_verb | emaj_tuple | emaj_gid | emaj_user 
------+-----------+------------+----------+-----------
   20 | INS       | NEW        | 17400006 | postgres
   21 | INS       | NEW        | 17400007 | postgres
   22 | INS       | NEW        | 17400008 | postgres
   22 | UPD       | OLD        | 17400009 | postgres
   23 | UPD       | NEW        | 17400009 | postgres
   21 | DEL       | OLD        | 17400010 | postgres
(6 rows)

-- disable event triggers for this step and change an application table structure
select emaj.emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

-----------------------------
-- test remove_and_add operations to repair an application table
-----------------------------
reset role;
alter table "phil's schema3".mytbl4 alter column col45 type char(11);
set role emaj_regression_tests_adm_user1;
select * from emaj.emaj_verify_all();
                                                                                      emaj_verify_all                                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Error: In the group "phil's group#3",", the structure of the application table "phil's schema3"."mytbl4" is not coherent with its log table ("emaj_phil's schema3"."mytbl4_log").
 Warning: In the group "myGroup2", the foreign key "mytbl6_col61_fkey" on the table "myschema2"."mytbl6" references the table "myschema2"."mytbl7" that does not belong to any group.
 Warning: In the group "myGroup2", the table "myschema2"."mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" of the table "myschema2"."mytbl8" that does not belong to any group.
 Warning: Some E-Maj event triggers exist but are disabled. You may enable them using the emaj_enable_protection_by_event_triggers() function.
(4 rows)

select emaj.emaj_remove_table('phil''s schema3','mytbl4','remove_the_damaged_table');
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('phil''s schema3', 'mytbl4', 'phil''s group#3",', null, 're_add_the_table');
NOTICE:  table "mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select * from emaj.emaj_relation where rel_schema = 'phil''s schema3' and rel_tblseq = 'mytbl4' order by rel_time_range;
   rel_schema   | rel_tblseq | rel_time_range |    rel_group     | rel_kind | rel_priority |   rel_log_schema    | rel_log_table | rel_log_dat_tsp |  rel_log_index   | rel_log_idx_tsp | rel_log_sequence | rel_log_function | rel_ignored_triggers | rel_emaj_verb_attnum | rel_has_always_ident_col |               rel_sql_rlbk_columns                | rel_sql_rlbk_pk_columns | rel_sql_rlbk_pk_conditions | rel_sql_gen_ins_col |                                                                                        rel_sql_gen_ins_val                                                                                         |                                                                                                              rel_sql_gen_upd_set                                                                                                              | rel_sql_gen_pk_conditions | rel_log_seq_last_value 
----------------+------------+----------------+------------------+----------+--------------+---------------------+---------------+-----------------+------------------+-----------------+------------------+------------------+----------------------+----------------------+--------------------------+---------------------------------------------------+-------------------------+----------------------------+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------------------
 phil's schema3 | mytbl4     | [17401,17405)  | phil's group#3", | r        |              | emaj_phil's schema3 | mytbl4_log_1  |                 | mytbl4_log_idx_1 |                 | mytbl4_log_seq   |                  |                      |                    6 | f                        |                                                   |                         |                            |                     | ' || coalesce(o.col41::TEXT,'NULL') || ', ' || quote_nullable(o.col42) || ', ' || coalesce(o.col43::TEXT,'NULL') || ', ' || coalesce(o.col44::TEXT,'NULL') || ', ' || quote_nullable(o.col45) || ' | col41 = ' || coalesce(n.col41 ::TEXT,'NULL') || ', col42 = ' || quote_nullable(n.col42) || ', col43 = ' || coalesce(n.col43 ::TEXT,'NULL') || ', col44 = ' || coalesce(n.col44 ::TEXT,'NULL') || ', col45 = ' || quote_nullable(n.col45) || ' | col41 = ' || o.col41 || ' |                      0
 phil's schema3 | mytbl4     | [17406,)       | phil's group#3", | r        |              | emaj_phil's schema3 | mytbl4_log    |                 | mytbl4_log_idx   |                 | mytbl4_log_seq   | mytbl4_log_fnct  |                      |                    6 | f                        | tbl.col41,tbl.col42,tbl.col43,tbl.col44,tbl.col45 | col41                   | tbl.col41 = keys.col41     |                     | ' || coalesce(o.col41::TEXT,'NULL') || ', ' || quote_nullable(o.col42) || ', ' || coalesce(o.col43::TEXT,'NULL') || ', ' || coalesce(o.col44::TEXT,'NULL') || ', ' || quote_nullable(o.col45) || ' | col41 = ' || coalesce(n.col41 ::TEXT,'NULL') || ', col42 = ' || quote_nullable(n.col42) || ', col43 = ' || coalesce(n.col43 ::TEXT,'NULL') || ', col44 = ' || coalesce(n.col44 ::TEXT,'NULL') || ', col45 = ' || quote_nullable(n.col45) || ' | col41 = ' || o.col41 || ' |                       
(2 rows)

-----------------------------
-- test a remove operation to fix the case of a deleted log table, log sequence or log function
-----------------------------
reset role;
drop table "emaj_phil's schema3".mytbl4_log;
set role emaj_regression_tests_adm_user1;
select * from emaj.emaj_verify_all();
                                                                                      emaj_verify_all                                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Error: In the group "phil's group#3",", the log table "emaj_phil's schema3"."mytbl4_log" is not found.
 Warning: In the group "myGroup2", the foreign key "mytbl6_col61_fkey" on the table "myschema2"."mytbl6" references the table "myschema2"."mytbl7" that does not belong to any group.
 Warning: In the group "myGroup2", the table "myschema2"."mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" of the table "myschema2"."mytbl8" that does not belong to any group.
 Warning: Some E-Maj event triggers exist but are disabled. You may enable them using the emaj_enable_protection_by_event_triggers() function.
(4 rows)

select emaj.emaj_remove_table('phil''s schema3','mytbl4','remove_the_damaged_table_2');
NOTICE:  relation "mytbl4_log" does not exist, skipping
NOTICE:  relation "mytbl4_log_idx" does not exist, skipping
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('phil''s schema3', 'mytbl4', 'phil''s group#3",', null, 're_add_the_table_2');
NOTICE:  table "mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select rel_schema, rel_tblseq, rel_time_range, rel_group, rel_kind
  from emaj.emaj_relation where rel_schema = 'phil''s schema3' and rel_tblseq = 'mytbl4' order by rel_time_range;
   rel_schema   | rel_tblseq | rel_time_range |    rel_group     | rel_kind 
----------------+------------+----------------+------------------+----------
 phil's schema3 | mytbl4     | [17401,17405)  | phil's group#3", | r
 phil's schema3 | mytbl4     | [17406,17407)  | phil's group#3", | r
 phil's schema3 | mytbl4     | [17408,)       | phil's group#3", | r
(3 rows)

-----------------------------
-- test a remove operation to fix the case of a deleted application table or sequence
-----------------------------
-- in fact just rename the table and the sequence
reset role;
alter table "phil's schema3".mytbl4 rename to mytbl4_sav;
alter sequence "phil's schema3"."phil's seq\1" rename to "phil's seq\1_sav";
set role emaj_regression_tests_adm_user2;
-- try to set a mark
begin;
  select emaj.emaj_set_mark_group('phil''s group#3",','should fails');
ERROR:  _verify_groups (1): In group "phil's group#3",", the table "phil's schema3"."mytbl4" does not exist any more. You may use "SELECT * FROM emaj.emaj_verify_all()" to look for other issues.
CONTEXT:  PL/pgSQL function emaj._verify_groups(text[],boolean) line 39 at RAISE
SQL statement "SELECT 0
      FROM emaj._verify_groups(array[p_groupName], TRUE)"
PL/pgSQL function emaj.emaj_set_mark_group(text,text) line 18 at PERFORM
rollback;
select emaj.emaj_remove_table('phil''s schema3','mytbl4','remove_the_dropped_table');
NOTICE:  drop cascades to trigger emaj_log_trg on table "phil's schema3".mytbl4_sav
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_remove_sequence('phil''s schema3','phil''s seq\1','remove_the_dropped_seq');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

-- check that the log table does not exist anymore
select count(*) from "emaj_phil's schema3".mytbl4_log;
ERROR:  relation "emaj_phil's schema3.mytbl4_log" does not exist
LINE 1: select count(*) from "emaj_phil's schema3".mytbl4_log;
                             ^
-- revert the changes
reset role;
alter table "phil's schema3".mytbl4_sav rename to mytbl4;
alter table "phil's schema3".mytbl4 alter column col45 type char(10);
alter sequence "phil's schema3"."phil's seq\1_sav" rename to "phil's seq\1";
select emaj.emaj_assign_table('phil''s schema3','mytbl4','phil''s group#3",',null,'revert_last_changes_tbl');
NOTICE:  table "mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_sequence('phil''s schema3','phil''s seq\1','phil''s group#3",','revert_last_changes_seq');
 emaj_assign_sequence 
----------------------
                    1
(1 row)

-- ree-nable the event triggers and drop the group
set role emaj_regression_tests_adm_user1;
select emaj.emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

select emaj.emaj_stop_group('phil''s group#3",');
 emaj_stop_group 
-----------------
               7
(1 row)

select emaj.emaj_drop_group('phil''s group#3",');
NOTICE:  table "mytbl4_log_2" does not exist, skipping
 emaj_drop_group 
-----------------
               7
(1 row)

-----------------------------
-- Checking step 18
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17400 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17400 |           17400000 | C
   17401 |           17400000 | A
   17402 |           17400000 | A
   17403 |           17400000 | A
   17404 |           17400000 | M
   17405 |           17400010 | A
   17406 |           17400010 | A
   17407 |           17400010 | A
   17408 |           17400010 | A
   17409 |           17400010 | A
   17410 |           17400010 | A
   17411 |           17400010 | A
   17412 |           17400010 | A
   17413 |           17400010 | M
   17414 |           17400010 | D
(15 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17400 order by hist_id;
   hist_function    |       hist_event        |             hist_object              |                         regexp_replace                         | hist_user 
--------------------+-------------------------+--------------------------------------+----------------------------------------------------------------+-----------
 CREATE_GROUP       | BEGIN                   | phil's group#3",                     | audit_only                                                     | postgres
 CREATE_GROUP       | END                     | phil's group#3",                     |                                                                | postgres
 ASSIGN_TABLES      | BEGIN                   |                                      |                                                                | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED      | "emaj_phil's schema3"                |                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED             | "phil's schema3"."myTbl2\"           | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | TABLE ADDED             | "phil's schema3".mytbl4              | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | TABLE ADDED             | "phil's schema3"."phil's tbl1"       | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | END                     |                                      | 3 tables assigned to the group phil's group#3",                | postgres
 ASSIGN_SEQUENCES   | BEGIN                   |                                      |                                                                | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED          | "phil's schema3"."myTbl2\_col21_seq" | To the idle group phil's group#3",                             | postgres
 ASSIGN_SEQUENCES   | SEQUENCE ADDED          | "phil's schema3"."phil's seq\1"      | To the idle group phil's group#3",                             | postgres
 ASSIGN_SEQUENCES   | END                     |                                      | 2 sequences assigned to the group phil's group#3",             | postgres
 ASSIGN_TABLES      | BEGIN                   |                                      |                                                                | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED      | emaj_myschema5                       |                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED             | myschema5.myoidstbl                  | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | TABLE ADDED             | myschema5.myunloggedtbl              | To the idle group phil's group#3",                             | postgres
 ASSIGN_TABLES      | END                     |                                      | 2 tables assigned to the group phil's group#3",                | postgres
 START_GROUP        | BEGIN                   | phil's group#3",                     | With log reset                                                 | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 5 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | start                                                          | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | start                                                          | postgres
 START_GROUP        | END                     | phil's group#3",                     | 7 tables/sequences processed                                   | postgres
 DISABLE_PROTECTION | EVENT TRIGGERS DISABLED |                                      | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg | postgres
 REMOVE_TABLE       | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 5 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | remove_the_damaged_table                                       | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | remove_the_damaged_table                                       | postgres
 REMOVE_TABLE       | TABLE REMOVED           | "phil's schema3".mytbl4              | From the logging group phil's group#3",                        | postgres
 REMOVE_TABLE       | END                     |                                      | 1 tables removed from their groups                             | postgres
 ASSIGN_TABLE       | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | re_add_the_table                                               | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | re_add_the_table                                               | postgres
 ASSIGN_TABLE       | TABLE ADDED             | "phil's schema3".mytbl4              | To the logging group phil's group#3",                          | postgres
 ASSIGN_TABLE       | END                     |                                      | 1 tables assigned to the group phil's group#3",                | postgres
 REMOVE_TABLE       | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 5 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | remove_the_damaged_table_2                                     | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | remove_the_damaged_table_2                                     | postgres
 REMOVE_TABLE       | TABLE REMOVED           | "phil's schema3".mytbl4              | From the logging group phil's group#3",                        | postgres
 REMOVE_TABLE       | END                     |                                      | 1 tables removed from their groups                             | postgres
 ASSIGN_TABLE       | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | re_add_the_table_2                                             | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | re_add_the_table_2                                             | postgres
 ASSIGN_TABLE       | TABLE ADDED             | "phil's schema3".mytbl4              | To the logging group phil's group#3",                          | postgres
 ASSIGN_TABLE       | END                     |                                      | 1 tables assigned to the group phil's group#3",                | postgres
 REMOVE_TABLE       | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | remove_the_dropped_table                                       | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | remove_the_dropped_table                                       | postgres
 REMOVE_TABLE       | TABLE REMOVED           | "phil's schema3".mytbl4              | From the logging group phil's group#3",                        | postgres
 REMOVE_TABLE       | END                     |                                      | 1 tables removed from their groups                             | postgres
 REMOVE_SEQUENCE    | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | remove_the_dropped_seq                                         | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | remove_the_dropped_seq                                         | postgres
 REMOVE_SEQUENCE    | SEQUENCE REMOVED        | "phil's schema3"."phil's seq\1"      | From the logging group phil's group#3",                        | postgres
 REMOVE_SEQUENCE    | END                     |                                      | 1 sequences removed from their groups                          | postgres
 ASSIGN_TABLE       | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 4 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | revert_last_changes_tbl                                        | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | revert_last_changes_tbl                                        | postgres
 ASSIGN_TABLE       | TABLE ADDED             | "phil's schema3".mytbl4              | To the logging group phil's group#3",                          | postgres
 ASSIGN_TABLE       | END                     |                                      | 1 tables assigned to the group phil's group#3",                | postgres
 ASSIGN_SEQUENCE    | BEGIN                   |                                      |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 5 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | revert_last_changes_seq                                        | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | revert_last_changes_seq                                        | postgres
 ASSIGN_SEQUENCE    | SEQUENCE ADDED          | "phil's schema3"."phil's seq\1"      | To the logging group phil's group#3",                          | postgres
 ASSIGN_SEQUENCE    | END                     |                                      | 1 sequences assigned to the group phil's group#3",             | postgres
 ENABLE_PROTECTION  | EVENT TRIGGERS ENABLED  |                                      | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg | postgres
 STOP_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 LOCK_GROUP         | END                     | phil's group#3",                     | 5 tables locked, 0 deadlock(s)                                 | postgres
 SET_MARK_GROUP     | BEGIN                   | phil's group#3",                     | STOP_%                                                         | postgres
 SET_MARK_GROUP     | END                     | phil's group#3",                     | STOP_%                                                         | postgres
 STOP_GROUP         | END                     | phil's group#3",                     | 7 tables/sequences processed                                   | postgres
 DROP_GROUP         | BEGIN                   | phil's group#3",                     |                                                                | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED      | emaj_myschema5                       |                                                                | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED      | "emaj_phil's schema3"                |                                                                | postgres
 DROP_GROUP         | END                     | phil's group#3",                     | 7 tables/sequences processed                                   | postgres
(91 rows)

-- set sequence restart value
select public.handle_emaj_sequences(17600);
 handle_emaj_sequences 
-----------------------
 
(1 row)

-----------------------------
-- Step 19 : test use of dynamic tables group management (assign, move, remove, change)
-----------------------------
-- create, start and populate groups
-- grp_tmp is empty, grp_tmp_3 and grp_tmp_4 contains tables and sequences frop respectively phil''s schema3 and myschema4
-- grp_tmp_4 is started before being populated
select emaj.emaj_create_group('grp_tmp');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj.emaj_create_group('grp_tmp_3');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj.emaj_create_group('grp_tmp_4');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj.emaj_start_groups('{"grp_tmp","grp_tmp_4"}','Start');
 emaj_start_groups 
-------------------
                 0
(1 row)

begin;
  select emaj.emaj_assign_tables('phil''s schema3','.*','','grp_tmp_3');
NOTICE:  table "myTbl2\_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.myTbl2\" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.myTbl2\" does not exist, skipping
NOTICE:  table "mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  table "phil's tbl1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.phil's tbl1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.phil's tbl1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  3
(1 row)

  select emaj.emaj_assign_sequences('phil''s schema3','.*','','grp_tmp_3');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

  select emaj.emaj_assign_tables('myschema4','.*','','grp_tmp_4');
WARNING:  _assign_tables: Some partitionned tables (mytblp) are not selected.
NOTICE:  table "mypartp3_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp3" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp3" does not exist, skipping
NOTICE:  table "mytblr_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblr" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblr" does not exist, skipping
NOTICE:  table "mytblm_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblm" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblm" does not exist, skipping
WARNING:  _create_tbl: The table "myschema4.mytblm" has triggers that will be automatically disabled during E-Maj rollback operations (mytblm_insert_trigger). Use the emaj_modify_table() function to change this behaviour.
NOTICE:  table "mytblc2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc2" does not exist, skipping
NOTICE:  table "mypartp2_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mypartp2" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mypartp2" does not exist, skipping
NOTICE:  table "mytblc1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc1" does not exist, skipping
 emaj_assign_tables 
--------------------
                  6
(1 row)

  select emaj.emaj_assign_sequences('myschema4','.*','','grp_tmp_4');
 emaj_assign_sequences 
-----------------------
                     2
(1 row)

  select emaj.emaj_modify_table('myschema4','mytblm','{"ignored_triggers": "mytblm_insert_trigger"}'::jsonb);
 emaj_modify_table 
-------------------
                 1
(1 row)

commit;
select emaj.emaj_start_group('grp_tmp_3','Start');
 emaj_start_group 
------------------
                5
(1 row)

select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1');
 emaj_set_mark_groups 
----------------------
                   13
(1 row)

-- export the initial groups configuration
select emaj.emaj_export_groups_configuration(:'EMAJTESTTMPDIR' || '/groups_config.json', array['grp_tmp','grp_tmp_3','grp_tmp_4']);
 emaj_export_groups_configuration 
----------------------------------
                                3
(1 row)

-- perform some changes and set marks
insert into "phil's schema3".mytbl4 (col41)
  select i from generate_series(3,8) i;
delete from "phil's schema3"."myTbl2\";
insert into "phil's schema3"."myTbl2\" (col22,col23)
  select 'After Mk1','12-31-2020' from generate_series(1,3);
select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk2');
 emaj_set_mark_groups 
----------------------
                   13
(1 row)

insert into "phil's schema3"."myTbl2\" (col22,col23)
  select 'After Mk2','12-31-2030' from generate_series(1,3);
select nextval(E'"phil''s schema3"."phil''s seq\\1"');
 nextval 
---------
    1002
(1 row)

insert into myschema4.mytblm
  select '2006-06-30'::date + ('1 year'::interval) * i, i, 'After Mk2'
    from generate_series(0,9) i;
select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3');
 emaj_set_mark_groups 
----------------------
                   13
(1 row)

delete from myschema4.mytblm
  where col1 = '2006-06-30';
update myschema4.mytblm set col3 = 'After Mk2 and updated after Mk3'
  where col1 > '2013-01-01';
-- rollback to the previous mark
select * from emaj.emaj_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3');
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 2 / 9 tables effectively processed.
 Notice        | 4 sequences processed.
(2 rows)

-- change some priority and log tablespaces
select emaj.emaj_modify_tables('phil''s schema3','.*tbl1','','{"priority":-1,"log_data_tablespace":"tsp log''2"}'::jsonb,'Modify 1 table');
 emaj_modify_tables 
--------------------
                  1
(1 row)

-- move all tables and sequences into grp_tmp and set a common mark
select emaj.emaj_move_tables('phil''s schema3','.*','','grp_tmp','Move_tbl_3_to_tmp');
 emaj_move_tables 
------------------
                3
(1 row)

select * from emaj.emaj_verify_all();
                                                                                         emaj_verify_all                                                                                          
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Warning: In the group "grp_tmp_4", the sequence "myschema4"."mytblp_col3_seq" is linked to the table "myschema4"."mytblp" but this table does not belong to any tables group.
 Warning: In the group "grp_tmp_3", the sequence "phil's schema3"."myTbl2\_col21_seq" is linked to the table "phil's schema3"."myTbl2\" but this table belongs to another tables group (grp_tmp).
 Warning: In the group "myGroup2", the foreign key "mytbl6_col61_fkey" on the table "myschema2"."mytbl6" references the table "myschema2"."mytbl7" that does not belong to any group.
 Warning: In the group "myGroup2", the table "myschema2"."mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" of the table "myschema2"."mytbl8" that does not belong to any group.
 No error detected
(5 rows)

select emaj.emaj_move_sequences('phil''s schema3','.*','','grp_tmp','Move_seq_3_to_tmp');
 emaj_move_sequences 
---------------------
                   2
(1 row)

select emaj.emaj_move_tables('myschema4','.*','','grp_tmp','Move_tbl_4_to_tmp');
 emaj_move_tables 
------------------
                6
(1 row)

select emaj.emaj_move_sequences('myschema4','.*','','grp_tmp','Move_seq_4_to_tmp');
 emaj_move_sequences 
---------------------
                   2
(1 row)

select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk4');
 emaj_set_mark_groups 
----------------------
                   13
(1 row)

-- perform some other changes and set marks
update "phil's schema3".mytbl4 set col42 = 'Updated after Mk4'
  where col41 > 5;
delete from "phil's schema3"."myTbl2\"
  where col21 = 4;
delete from "phil's schema3".mytbl4
  where col41 = 4;
select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk5');
 emaj_set_mark_groups 
----------------------
                   13
(1 row)

insert into myschema4.mytblm
  select '2017-06-30'::date + ('1 year'::interval) * i, 5, 'After Mk5'
    from generate_series(0,3) i;
select nextval(E'"phil''s schema3"."phil''s seq\\1"');
 nextval 
---------
    1003
(1 row)

select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk6');
 emaj_set_mark_groups 
----------------------
                   13
(1 row)

update myschema4.mytblm set col3 = 'After Mk5 and updated after Mk6'
  where col1 > '2017-01-01';
-- remove the table mytblm and the sequence phil's seq\1
select emaj.emaj_remove_table('myschema4','mytblc1','Remove_mytblc1');
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_remove_sequence('phil''s schema3','phil''s seq\1','Remove_myseq1');
 emaj_remove_sequence 
----------------------
                    1
(1 row)

-- logged rollback to Mk5
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_logged_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk5', true);
 rlbk_severity |                                                regexp_replace                                                 
---------------+---------------------------------------------------------------------------------------------------------------
 Notice        | 2 / 8 tables effectively processed.
 Notice        | 3 sequences processed.
 Warning       | The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)
 Warning       | The sequence "phil's schema3"."phil's seq\1" has been left unchanged (not in group anymore since <timestamp>)
(4 rows)

select emaj.emaj_rename_mark_group(group_name,'EMAJ_LAST_MARK','End_logged_rollback')
  from (values ('grp_tmp_3'),('grp_tmp_4'),('grp_tmp')) as t(group_name);
 emaj_rename_mark_group 
------------------------
 
 
 
(3 rows)

-- perform some other changes and set marks
delete from myschema4.mytblm
  where col1 = '2018-06-30';
select emaj.emaj_set_mark_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk7');
 emaj_set_mark_groups 
----------------------
                   11
(1 row)

delete from mySchema4.mytblm;
-- consolidate the logged rollback
select * from emaj.emaj_get_consolidable_rollbacks() order by 1,2;
 cons_group | cons_target_rlbk_mark_name | cons_target_rlbk_mark_time_id | cons_end_rlbk_mark_name | cons_end_rlbk_mark_time_id | cons_rows | cons_marks 
------------+----------------------------+-------------------------------+-------------------------+----------------------------+-----------+------------
 grp_tmp    | Mk5                        |                         17620 | End_logged_rollback     |                      17625 |        12 |          4
 grp_tmp_3  | Mk5                        |                         17620 | End_logged_rollback     |                      17625 |         0 |          2
 grp_tmp_4  | Mk5                        |                         17620 | End_logged_rollback     |                      17625 |         0 |          2
(3 rows)

select emaj.emaj_consolidate_rollback_group('grp_tmp','End_logged_rollback');
 emaj_consolidate_rollback_group 
---------------------------------
                               5
(1 row)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj.emaj_log_stat_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1',null)
  order by stat_first_mark_datetime, stat_schema, stat_table;
 stat_group |  stat_schema   | stat_table  |  stat_first_mark  |  stat_last_mark   | stat_rows 
------------+----------------+-------------+-------------------+-------------------+-----------
 grp_tmp_4  | myschema4      | mypartp2    | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4      | mypartp3    | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4      | mytblc1     | Mk1               | Move_tbl_4_to_tmp |         4
 grp_tmp_4  | myschema4      | mytblc2     | Mk1               | Move_tbl_4_to_tmp |         6
 grp_tmp_4  | myschema4      | mytblm      | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_4  | myschema4      | mytblr      | Mk1               | Move_tbl_4_to_tmp |         0
 grp_tmp_3  | phil's schema3 | myTbl2\     | Mk1               | Move_tbl_3_to_tmp |         8
 grp_tmp_3  | phil's schema3 | mytbl4      | Mk1               | Move_tbl_3_to_tmp |         6
 grp_tmp_3  | phil's schema3 | phil's tbl1 | Mk1               | Move_tbl_3_to_tmp |         0
 grp_tmp    | phil's schema3 | myTbl2\     | Move_tbl_3_to_tmp |                   |         1
 grp_tmp    | phil's schema3 | mytbl4      | Move_tbl_3_to_tmp |                   |         4
 grp_tmp    | phil's schema3 | phil's tbl1 | Move_tbl_3_to_tmp |                   |         0
 grp_tmp    | myschema4      | mypartp2    | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4      | mypartp3    | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4      | mytblc1     | Move_tbl_4_to_tmp | [deleted mark]    |         0
 grp_tmp    | myschema4      | mytblc2     | Move_tbl_4_to_tmp |                   |         6
 grp_tmp    | myschema4      | mytblm      | Move_tbl_4_to_tmp |                   |         0
 grp_tmp    | myschema4      | mytblr      | Move_tbl_4_to_tmp |                   |         0
(18 rows)

select mark_time_id, regexp_replace(mark_name,E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'), mark_group,
       mark_is_deleted, mark_log_rows_before_next
  from emaj.emaj_mark where mark_group in ('grp_tmp_3','grp_tmp_4','grp_tmp')
  order by 1,2,3;
 mark_time_id |   regexp_replace    | mark_group | mark_is_deleted | mark_log_rows_before_next 
--------------+---------------------+------------+-----------------+---------------------------
        17603 | Start               | grp_tmp    | f               |                         0
        17603 | Start               | grp_tmp_4  | f               |                         0
        17606 | ASSIGN_%            | grp_tmp_4  | f               |                         0
        17607 | ASSIGN_%            | grp_tmp_4  | f               |                         0
        17608 | MODIFY_%            | grp_tmp_4  | f               |                         0
        17609 | Start               | grp_tmp_3  | f               |                         0
        17610 | Mk1                 | grp_tmp    | f               |                         0
        17610 | Mk1                 | grp_tmp_3  | f               |                        11
        17610 | Mk1                 | grp_tmp_4  | f               |                         0
        17611 | Mk2                 | grp_tmp    | f               |                         0
        17611 | Mk2                 | grp_tmp_3  | f               |                         3
        17611 | Mk2                 | grp_tmp_4  | f               |                        10
        17612 | Mk3                 | grp_tmp    | f               |                         0
        17612 | Mk3                 | grp_tmp_3  | f               |                         0
        17612 | Mk3                 | grp_tmp_4  | f               |                         0
        17614 | Modify 1 table      | grp_tmp_3  | f               |                         0
        17615 | Move_tbl_3_to_tmp   | grp_tmp    | f               |                         0
        17615 | Move_tbl_3_to_tmp   | grp_tmp_3  | f               |                         0
        17616 | Move_seq_3_to_tmp   | grp_tmp    | f               |                         0
        17616 | Move_seq_3_to_tmp   | grp_tmp_3  | f               |                         0
        17617 | Move_tbl_4_to_tmp   | grp_tmp    | f               |                         0
        17617 | Move_tbl_4_to_tmp   | grp_tmp_4  | f               |                         0
        17618 | Move_seq_4_to_tmp   | grp_tmp    | f               |                         0
        17618 | Move_seq_4_to_tmp   | grp_tmp_4  | f               |                         0
        17619 | Mk4                 | grp_tmp    | f               |                         5
        17619 | Mk4                 | grp_tmp_3  | f               |                         0
        17619 | Mk4                 | grp_tmp_4  | f               |                         0
        17620 | Mk5                 | grp_tmp    | f               |                         0
        17620 | Mk5                 | grp_tmp_3  | f               |                         0
        17620 | Mk5                 | grp_tmp_4  | f               |                         0
        17621 | Mk6                 | grp_tmp_3  | f               |                         0
        17621 | Mk6                 | grp_tmp_4  | f               |                         0
        17624 | RLBK_Mk5_%_START    | grp_tmp_3  | f               |                         0
        17624 | RLBK_Mk5_%_START    | grp_tmp_4  | f               |                         0
        17625 | End_logged_rollback | grp_tmp    | f               |                         0
        17625 | End_logged_rollback | grp_tmp_3  | f               |                         0
        17625 | End_logged_rollback | grp_tmp_4  | f               |                         0
        17626 | Mk7                 | grp_tmp    | f               |                          
        17626 | Mk7                 | grp_tmp_3  | f               |                          
        17626 | Mk7                 | grp_tmp_4  | f               |                          
(40 rows)

-- generate sql script
select emaj.emaj_gen_sql_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1',null,:'EMAJTESTTMPDIR' || '/allGroups.sql');
NOTICE:  table "emaj_temp_script" does not exist, skipping
 emaj_gen_sql_groups 
---------------------
                  26
(1 row)

--  \! grep -iP '(insert|update|delete|alter)' $EMAJTESTTMPDIR/allGroups.sql
-- revert the priority and log tablespaces changes
select emaj.emaj_modify_tables('phil''s schema3','.*tbl1','','{"priority":null,"log_data_tablespace":null}'::jsonb,'revert changes for 1 table');
 emaj_modify_tables 
--------------------
                  1
(1 row)

-- rollback to a mark set before the tables and sequences move
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3', false);
ERROR:  _rlbk_check: This rollback operation would cross some previous structure group change operations, which is not allowed by the current function parameters.
CONTEXT:  PL/pgSQL function emaj._rlbk_check(text[],text,boolean,boolean) line 60 at RAISE
SQL statement "SELECT emaj._rlbk_check(p_groupNames, p_mark, p_isAlterGroupAllowed, FALSE)"
PL/pgSQL function emaj._rlbk_init(text[],text,boolean,integer,boolean,boolean) line 23 at SQL statement
SQL statement "SELECT emaj._rlbk_init(p_groupNames, p_mark, p_isLoggedRlbk, 1, p_multiGroup, p_isAlterGroupAllowed)"
PL/pgSQL function emaj._rlbk_groups(text[],text,boolean,boolean,boolean) line 26 at SQL statement
SQL statement "SELECT *
        FROM emaj._rlbk_groups(p_groupNames, p_mark, FALSE, TRUE, coalesce(p_isAlterGroupAllowed, FALSE))"
PL/pgSQL function emaj.emaj_rollback_groups(text[],text,boolean) line 8 at RETURN QUERY
select rlbk_severity, regexp_replace(rlbk_message,E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rollback_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk3',true);
 rlbk_severity |                                                         regexp_replace                                                         
---------------+--------------------------------------------------------------------------------------------------------------------------------
 Notice        | 3 / 8 tables effectively processed.
 Notice        | 3 sequences processed.
 Warning       | The table "phil's schema3"."myTbl2\" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table "phil's schema3".mytbl4 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table "phil's schema3"."phil's tbl1" has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The sequence "phil's schema3"."myTbl2\_col21_seq" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The sequence "phil's schema3"."phil's seq\1" has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The table myschema4.mypartp2 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblc1 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblc2 has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblm has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The table myschema4.mytblr has only been rolled back to its latest group attachment (<timestamp>)
 Warning       | The sequence myschema4.mytblp_col3_seq has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | The sequence myschema4.mytblr_col1_seq has only been rolled back to its latest group attachment state (<timestamp>)
 Warning       | Tables group change not rolled back: log data tablespace for "phil's schema3"."phil's tbl1"
 Warning       | Tables group change not rolled back: E-Maj priority for "phil's schema3"."phil's tbl1"
(17 rows)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj.emaj_log_stat_groups('{"grp_tmp_3","grp_tmp_4","grp_tmp"}','Mk1',null)
  order by stat_first_mark_datetime, stat_schema, stat_table;
 stat_group |  stat_schema   | stat_table  | stat_first_mark | stat_last_mark | stat_rows 
------------+----------------+-------------+-----------------+----------------+-----------
 grp_tmp_4  | myschema4      | mypartp2    | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4      | mypartp3    | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4      | mytblc1     | Mk1             | [deleted mark] |         4
 grp_tmp_4  | myschema4      | mytblc2     | Mk1             | [deleted mark] |         6
 grp_tmp_4  | myschema4      | mytblm      | Mk1             | [deleted mark] |         0
 grp_tmp_4  | myschema4      | mytblr      | Mk1             | [deleted mark] |         0
 grp_tmp_3  | phil's schema3 | myTbl2\     | Mk1             | [deleted mark] |         8
 grp_tmp_3  | phil's schema3 | mytbl4      | Mk1             | [deleted mark] |         6
 grp_tmp_3  | phil's schema3 | phil's tbl1 | Mk1             | [deleted mark] |         0
 grp_tmp    | phil's schema3 | myTbl2\     | [deleted mark]  |                |         0
 grp_tmp    | phil's schema3 | mytbl4      | [deleted mark]  |                |         0
 grp_tmp    | phil's schema3 | phil's tbl1 | [deleted mark]  |                |         0
 grp_tmp    | myschema4      | mypartp2    | [deleted mark]  |                |         0
 grp_tmp    | myschema4      | mypartp3    | [deleted mark]  |                |         0
 grp_tmp    | myschema4      | mytblc1     | [deleted mark]  | [deleted mark] |         0
 grp_tmp    | myschema4      | mytblc2     | [deleted mark]  |                |         0
 grp_tmp    | myschema4      | mytblm      | [deleted mark]  |                |         0
 grp_tmp    | myschema4      | mytblr      | [deleted mark]  |                |         0
(18 rows)

-- delete all marks before Mk3
select emaj.emaj_delete_before_mark_group(group_name,'Mk3')
  from (values ('grp_tmp_3'),('grp_tmp_4'),('grp_tmp')) as t(group_name);
 emaj_delete_before_mark_group 
-------------------------------
                             3
                             6
                             3
(3 rows)

-- test a remove_table following log sequence deletion
select emaj.emaj_disable_protection_by_event_triggers();
 emaj_disable_protection_by_event_triggers 
-------------------------------------------
                                         3
(1 row)

reset role;
drop sequence "emaj_phil's schema3".mytbl4_log_seq;
set role emaj_regression_tests_adm_user2;
select emaj.emaj_enable_protection_by_event_triggers();
 emaj_enable_protection_by_event_triggers 
------------------------------------------
                                        3
(1 row)

-- note that the warning about the mytblp_col3_seq sequence is normal
select * from emaj.emaj_verify_all();
                                                                                      emaj_verify_all                                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Error: In the group "grp_tmp", the log sequence "emaj_phil's schema3"."mytbl4_log_seq" is not found.
 Warning: In the group "grp_tmp", the sequence "myschema4"."mytblp_col3_seq" is linked to the table "myschema4"."mytblp" but this table does not belong to any tables group.
 Warning: In the group "myGroup2", the foreign key "mytbl6_col61_fkey" on the table "myschema2"."mytbl6" references the table "myschema2"."mytbl7" that does not belong to any group.
 Warning: In the group "myGroup2", the table "myschema2"."mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" of the table "myschema2"."mytbl8" that does not belong to any group.
(4 rows)

--     a removal while the group is LOGGING fails
select emaj.emaj_remove_table('phil''s schema3','mytbl4');
ERROR:  relation "emaj_phil's schema3.mytbl4_log_seq" does not exist
LINE 1: ...lled THEN last_value ELSE last_value - 1 END FROM "emaj_phil...
                                                             ^
QUERY:  SELECT CASE WHEN is_called THEN last_value ELSE last_value - 1 END FROM "emaj_phil's schema3".mytbl4_log_seq
CONTEXT:  PL/pgSQL function emaj._log_stat_tbl(emaj.emaj_relation,bigint,bigint) line 22 at EXECUTE
SQL statement "WITH stat_group1 AS                               -- for each group, time id of the last active mark
      (SELECT mark_group, max(mark_time_id) AS last_mark_time_id
         FROM emaj.emaj_mark
         WHERE NOT mark_is_deleted
         GROUP BY mark_group
      ),
         stat_group2 AS                               -- compute the number of log rows for all tables currently belonging to these groups
      (SELECT mark_group, last_mark_time_id, coalesce(
                (SELECT sum(emaj._log_stat_tbl(emaj_relation, greatest(last_mark_time_id, lower(rel_time_range)),NULL))
                   FROM emaj.emaj_relation
                   WHERE rel_group = mark_group
                     AND rel_kind = 'r'
                     AND upper_inf(rel_time_range)
                ), 0) AS mark_stat
        FROM stat_group1
      )
    UPDATE emaj.emaj_mark m
      SET mark_log_rows_before_next = mark_stat
      FROM stat_group2 s
      WHERE s.mark_group = m.mark_group
        AND s.last_mark_time_id = m.mark_time_id"
PL/pgSQL function emaj._set_mark_groups(text[],text,boolean,boolean,text,bigint,text) line 49 at SQL statement
SQL statement "SELECT emaj._set_mark_groups(v_loggingGroups, v_markName, FALSE, TRUE, NULL, v_timeId)"
PL/pgSQL function emaj._remove_tables(text,text[],text,boolean,boolean) line 85 at PERFORM
PL/pgSQL function emaj.emaj_remove_table(text,text,text) line 6 at RETURN
select emaj.emaj_force_stop_group('grp_tmp');
 emaj_force_stop_group 
-----------------------
                    11
(1 row)

select emaj.emaj_remove_table('phil''s schema3','mytbl4');
NOTICE:  sequence "mytbl4_log_seq" does not exist, skipping
 emaj_remove_table 
-------------------
                 1
(1 row)

select emaj.emaj_assign_table('phil''s schema3','mytbl4','grp_tmp');
NOTICE:  table "mytbl4_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "phil's schema3.mytbl4" does not exist, skipping
 emaj_assign_table 
-------------------
                 1
(1 row)

select * from emaj.emaj_verify_all();
                                                                                      emaj_verify_all                                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Warning: In the group "grp_tmp", the sequence "myschema4"."mytblp_col3_seq" is linked to the table "myschema4"."mytblp" but this table does not belong to any tables group.
 Warning: In the group "myGroup2", the foreign key "mytbl6_col61_fkey" on the table "myschema2"."mytbl6" references the table "myschema2"."mytbl7" that does not belong to any group.
 Warning: In the group "myGroup2", the table "myschema2"."mytbl6" is referenced by the foreign key "mytbl8_col81_fkey" of the table "myschema2"."mytbl8" that does not belong to any group.
 No error detected
(4 rows)

select emaj.emaj_start_group('grp_tmp','Group restart');
 emaj_start_group 
------------------
               11
(1 row)

-- import the groups configuration
select emaj.emaj_import_groups_configuration(:'EMAJTESTTMPDIR' || '/groups_config.json', null, true, 'REVERT_CHANGES');
NOTICE:  table "tmp_app_table" does not exist, skipping
NOTICE:  table "tmp_app_sequence" does not exist, skipping
NOTICE:  table "mytblc1_log" does not exist, skipping
NOTICE:  trigger "emaj_log_trg" for relation "myschema4.mytblc1" does not exist, skipping
NOTICE:  trigger "emaj_trunc_trg" for relation "myschema4.mytblc1" does not exist, skipping
 emaj_import_groups_configuration 
----------------------------------
                                3
(1 row)

-- reset groups at their initial state
select emaj.emaj_stop_group('grp_tmp_3');
 emaj_stop_group 
-----------------
               5
(1 row)

select emaj.emaj_drop_group('grp_tmp_3');
 emaj_drop_group 
-----------------
               5
(1 row)

select emaj.emaj_set_mark_group('grp_tmp_4','Last_mark');
 emaj_set_mark_group 
---------------------
                   8
(1 row)

select emaj.emaj_force_drop_group('grp_tmp_4');
 emaj_force_drop_group 
-----------------------
                     8
(1 row)

select emaj.emaj_stop_group('grp_tmp');
 emaj_stop_group 
-----------------
               0
(1 row)

select emaj.emaj_drop_group('grp_tmp');
 emaj_drop_group 
-----------------
               0
(1 row)

select * from emaj.emaj_rel_hist order by 1,2,3;
  relh_schema   |                           relh_tblseq                           | relh_time_range |    relh_group    | relh_kind 
----------------+-----------------------------------------------------------------+-----------------+------------------+-----------
 myschema4      | mypartp1                                                        | [17101,17204)   | myGroup4         | r
 myschema4      | mypartp2                                                        | [17101,17211)   | myGroup4         | r
 myschema4      | mypartp2                                                        | [17606,17617)   | grp_tmp_4        | r
 myschema4      | mypartp2                                                        | [17617,17633)   | grp_tmp          | r
 myschema4      | mypartp2                                                        | [17633,17637)   | grp_tmp_4        | r
 myschema4      | mypartp3                                                        | [17202,17211)   | myGroup4         | r
 myschema4      | mypartp3                                                        | [17606,17617)   | grp_tmp_4        | r
 myschema4      | mypartp3                                                        | [17617,17633)   | grp_tmp          | r
 myschema4      | mypartp3                                                        | [17633,17637)   | grp_tmp_4        | r
 myschema4      | mytblc1                                                         | [17101,17211)   | myGroup4         | r
 myschema4      | mytblc1                                                         | [17606,17617)   | grp_tmp_4        | r
 myschema4      | mytblc1                                                         | [17617,17622)   | grp_tmp          | r
 myschema4      | mytblc1                                                         | [17633,17637)   | grp_tmp_4        | r
 myschema4      | mytblc2                                                         | [17101,17211)   | myGroup4         | r
 myschema4      | mytblc2                                                         | [17606,17617)   | grp_tmp_4        | r
 myschema4      | mytblc2                                                         | [17617,17633)   | grp_tmp          | r
 myschema4      | mytblc2                                                         | [17633,17637)   | grp_tmp_4        | r
 myschema4      | mytblm                                                          | [17101,17211)   | myGroup4         | r
 myschema4      | mytblm                                                          | [17606,17617)   | grp_tmp_4        | r
 myschema4      | mytblm                                                          | [17617,17633)   | grp_tmp          | r
 myschema4      | mytblm                                                          | [17633,17637)   | grp_tmp_4        | r
 myschema4      | mytblp_col3_seq                                                 | [17203,17205)   | myGroup4         | S
 myschema4      | mytblp_col3_seq                                                 | [17607,17618)   | grp_tmp_4        | S
 myschema4      | mytblp_col3_seq                                                 | [17618,17633)   | grp_tmp          | S
 myschema4      | mytblp_col3_seq                                                 | [17633,17637)   | grp_tmp_4        | S
 myschema4      | mytblr                                                          | [17101,17211)   | myGroup4         | r
 myschema4      | mytblr                                                          | [17606,17617)   | grp_tmp_4        | r
 myschema4      | mytblr                                                          | [17617,17633)   | grp_tmp          | r
 myschema4      | mytblr                                                          | [17633,17637)   | grp_tmp_4        | r
 myschema4      | mytblr_col1_seq                                                 | [17607,17618)   | grp_tmp_4        | S
 myschema4      | mytblr_col1_seq                                                 | [17618,17633)   | grp_tmp          | S
 myschema4      | mytblr_col1_seq                                                 | [17633,17637)   | grp_tmp_4        | S
 myschema5      | myoidstbl                                                       | [17403,17414)   | phil's group#3", | r
 myschema5      | myunloggedtbl                                                   | [17403,17414)   | phil's group#3", | r
 phil's schema3 | myTbl2\                                                         | [14201,14507)   | phil's group#3", | r
 phil's schema3 | myTbl2\                                                         | [17401,17414)   | phil's group#3", | r
 phil's schema3 | myTbl2\                                                         | [17604,17615)   | grp_tmp_3        | r
 phil's schema3 | myTbl2\                                                         | [17615,17633)   | grp_tmp          | r
 phil's schema3 | myTbl2\                                                         | [17633,17635)   | grp_tmp_3        | r
 phil's schema3 | myTbl2\_col21_seq                                               | [14202,14507)   | phil's group#3", | S
 phil's schema3 | myTbl2\_col21_seq                                               | [17402,17414)   | phil's group#3", | S
 phil's schema3 | myTbl2\_col21_seq                                               | [17605,17616)   | grp_tmp_3        | S
 phil's schema3 | myTbl2\_col21_seq                                               | [17616,17633)   | grp_tmp          | S
 phil's schema3 | myTbl2\_col21_seq                                               | [17633,17635)   | grp_tmp_3        | S
 phil's schema3 | mytbl4                                                          | [17401,17405)   | phil's group#3", | r
 phil's schema3 | mytbl4                                                          | [17406,17407)   | phil's group#3", | r
 phil's schema3 | mytbl4                                                          | [17408,17409)   | phil's group#3", | r
 phil's schema3 | mytbl4                                                          | [17411,17414)   | phil's group#3", | r
 phil's schema3 | mytbl4                                                          | [17604,17615)   | grp_tmp_3        | r
 phil's schema3 | mytbl4                                                          | [17615,17630)   | grp_tmp          | r
 phil's schema3 | mytbl4                                                          | [17631,17633)   | grp_tmp          | r
 phil's schema3 | mytbl4                                                          | [17633,17635)   | grp_tmp_3        | r
 phil's schema3 | phil's seq\1                                                    | [14202,14507)   | phil's group#3", | S
 phil's schema3 | phil's seq\1                                                    | [17402,17410)   | phil's group#3", | S
 phil's schema3 | phil's seq\1                                                    | [17412,17414)   | phil's group#3", | S
 phil's schema3 | phil's seq\1                                                    | [17605,17616)   | grp_tmp_3        | S
 phil's schema3 | phil's seq\1                                                    | [17616,17623)   | grp_tmp          | S
 phil's schema3 | phil's seq\1                                                    | [17633,17635)   | grp_tmp_3        | S
 phil's schema3 | phil's tbl1                                                     | [14201,14501)   | phil's group#3", | r
 phil's schema3 | phil's tbl1                                                     | [17401,17414)   | phil's group#3", | r
 phil's schema3 | phil's tbl1                                                     | [17604,17615)   | grp_tmp_3        | r
 phil's schema3 | phil's tbl1                                                     | [17615,17633)   | grp_tmp          | r
 phil's schema3 | phil's tbl1                                                     | [17633,17635)   | grp_tmp_3        | r
 phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name | [14502,14507)   | phil's group#3", | r
(64 rows)

select count(*) from emaj.emaj_relation where rel_schema in ('phil''s schema3','myschema4');
 count 
-------
     0
(1 row)

-----------------------------
-- Checking step 19
-----------------------------
-- emaj tables
select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 17600 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   17600 |           17600000 | C
   17601 |           17600000 | C
   17602 |           17600000 | C
   17603 |           17600000 | M
   17604 |           17600000 | A
   17605 |           17600000 | A
   17606 |           17600000 | A
   17607 |           17600000 | A
   17608 |           17600000 | A
   17609 |           17600000 | M
   17610 |           17600000 | M
   17611 |           17600011 | M
   17612 |           17600024 | M
   17613 |           17600028 | R
   17614 |           17600028 | A
   17615 |           17600028 | A
   17616 |           17600028 | A
   17617 |           17600028 | A
   17618 |           17600028 | A
   17619 |           17600028 | M
   17620 |           17600033 | M
   17621 |           17600037 | M
   17622 |           17600041 | A
   17623 |           17600041 | A
   17624 |           17600041 | R
   17625 |           17600045 | M
   17626 |           17600045 | M
   17627 |           17600051 | A
   17628 |           17600051 | R
   17630 |           17600051 | A
   17631 |           17600051 | A
   17632 |           17600051 | M
   17633 |           17600051 | I
   17634 |           17600051 | M
   17635 |           17600051 | D
   17636 |           17600051 | M
   17637 |           17600051 | D
   17638 |           17600051 | M
   17639 |           17600051 | D
(39 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 17600 order by hist_id;
      hist_function       |         hist_event          |             hist_object              |                                                         regexp_replace                                                         | hist_user 
--------------------------+-----------------------------+--------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+-----------
 CREATE_GROUP             | BEGIN                       | grp_tmp                              | rollbackable                                                                                                                   | postgres
 CREATE_GROUP             | END                         | grp_tmp                              |                                                                                                                                | postgres
 CREATE_GROUP             | BEGIN                       | grp_tmp_3                            | rollbackable                                                                                                                   | postgres
 CREATE_GROUP             | END                         | grp_tmp_3                            |                                                                                                                                | postgres
 CREATE_GROUP             | BEGIN                       | grp_tmp_4                            | rollbackable                                                                                                                   | postgres
 CREATE_GROUP             | END                         | grp_tmp_4                            |                                                                                                                                | postgres
 START_GROUPS             | BEGIN                       | grp_tmp,grp_tmp_4                    | With log reset                                                                                                                 | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_4                    |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_4                    | 0 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_4                    | Start                                                                                                                          | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_4                    | Start                                                                                                                          | postgres
 START_GROUPS             | END                         | grp_tmp,grp_tmp_4                    | 0 tables/sequences processed                                                                                                   | postgres
 ASSIGN_TABLES            | BEGIN                       |                                      |                                                                                                                                | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED          | "emaj_phil's schema3"                |                                                                                                                                | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | "phil's schema3"."myTbl2\"           | To the idle group grp_tmp_3                                                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | "phil's schema3".mytbl4              | To the idle group grp_tmp_3                                                                                                    | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | "phil's schema3"."phil's tbl1"       | To the idle group grp_tmp_3                                                                                                    | postgres
 ASSIGN_TABLES            | END                         |                                      | 3 tables assigned to the group grp_tmp_3                                                                                       | postgres
 ASSIGN_SEQUENCES         | BEGIN                       |                                      |                                                                                                                                | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | "phil's schema3"."myTbl2\_col21_seq" | To the idle group grp_tmp_3                                                                                                    | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | "phil's schema3"."phil's seq\1"      | To the idle group grp_tmp_3                                                                                                    | postgres
 ASSIGN_SEQUENCES         | END                         |                                      | 2 sequences assigned to the group grp_tmp_3                                                                                    | postgres
 ASSIGN_TABLES            | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                            | 0 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_4                            | ASSIGN_%                                                                                                                       | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_4                            | ASSIGN_%                                                                                                                       | postgres
 ASSIGN_TABLES            | LOG_SCHEMA CREATED          | emaj_myschema4                       |                                                                                                                                | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mypartp3                   | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblr                     | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblm                     | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblc2                    | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mypartp2                   | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_TABLES            | TABLE ADDED                 | myschema4.mytblc1                    | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_TABLES            | END                         |                                      | 6 tables assigned to the group grp_tmp_4                                                                                       | postgres
 ASSIGN_SEQUENCES         | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                            | 6 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_4                            | ASSIGN_%                                                                                                                       | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_4                            | ASSIGN_%                                                                                                                       | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | myschema4.mytblp_col3_seq            | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_SEQUENCES         | SEQUENCE ADDED              | myschema4.mytblr_col1_seq            | To the logging group grp_tmp_4                                                                                                 | postgres
 ASSIGN_SEQUENCES         | END                         |                                      | 2 sequences assigned to the group grp_tmp_4                                                                                    | postgres
 MODIFY_TABLE             | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                            | 6 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_4                            | MODIFY_%                                                                                                                       | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp_4                            | MODIFY_%                                                                                                                       | postgres
 MODIFY_TABLE             | TRIGGERS TO IGNORE CHANGED  | myschema4.mytblm                     | none => {mytblm_insert_trigger}                                                                                                | postgres
 MODIFY_TABLE             | END                         |                                      | 1 tables effectively modified                                                                                                  | postgres
 START_GROUP              | BEGIN                       | grp_tmp_3                            | With log reset                                                                                                                 | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_3                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_3                            | 3 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_3                            | Start                                                                                                                          | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_3                            | Start                                                                                                                          | postgres
 START_GROUP              | END                         | grp_tmp_3                            | 5 tables/sequences processed                                                                                                   | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk1                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk1                                                                                                                            | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk2                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk2                                                                                                                            | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk3                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk3                                                                                                                            | postgres
 ROLLBACK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | Unlogged rollback to mark Mk3 (timestamp)                                                                                      | postgres
 DBLINK_OPEN_CNX          |                             | rlbk#1                               | Status = 1                                                                                                                     | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback session #1                                                                                                            | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback session #1: 9 tables locked, 0 deadlock(s)                                                                            | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc2                    | All log rows where emaj_gid > 17600024 and <= 17600028                                                                         | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc2                    | 3 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc1                    | All log rows where emaj_gid > 17600024 and <= 17600028                                                                         | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc1                    | 1 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_SEQUENCE        |                             | myschema4.mytblp_col3_seq            |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | myschema4.mytblr_col1_seq            |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | "phil's schema3"."myTbl2\_col21_seq" |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | "phil's schema3"."phil's seq\1"      |                                                                                                                                | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17600                    | 2 / 9 tables effectively processed.                                                                                            | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17600                    | 4 sequences processed.                                                                                                         | postgres
 DBLINK_CLOSE_CNX         |                             | rlbk#1                               |                                                                                                                                | postgres
 ROLLBACK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback_id 17600, 2 tables and 4 sequences effectively processed                                                              | postgres
 MODIFY_TABLES            | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_3                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_3                            | 3 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3                            | Modify 1 table                                                                                                                 | postgres
 CLEANUP_RLBK_STATE       |                             | Rollback id 17600                    | set to COMMITTED                                                                                                               | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp_3                            | Modify 1 table                                                                                                                 | postgres
 MODIFY_TABLES            | PRIORITY CHANGED            | "phil's schema3"."phil's tbl1"       | NULL => -1                                                                                                                     | postgres
 MODIFY_TABLES            | LOG DATA TABLESPACE CHANGED | "phil's schema3"."phil's tbl1"       | Default tablespace => tsp log'2                                                                                                | postgres
 MODIFY_TABLES            | END                         |                                      | 1 tables effectively modified                                                                                                  | postgres
 MOVE_TABLES              | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3                    |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3                    | 3 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3                    | Move_tbl_3_to_tmp                                                                                                              | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3                    | Move_tbl_3_to_tmp                                                                                                              | postgres
 MOVE_TABLES              | TABLE MOVED                 | "phil's schema3"."myTbl2\"           | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | "phil's schema3".mytbl4              | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | "phil's schema3"."phil's tbl1"       | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | END                         |                                      | 3 tables moved to the tables group grp_tmp                                                                                     | postgres
 MOVE_SEQUENCES           | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3                    |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3                    | 3 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3                    | Move_seq_3_to_tmp                                                                                                              | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3                    | Move_seq_3_to_tmp                                                                                                              | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | "phil's schema3"."myTbl2\_col21_seq" | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                  | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | "phil's schema3"."phil's seq\1"      | From the logging group grp_tmp_3 to the logging group grp_tmp                                                                  | postgres
 MOVE_SEQUENCES           | END                         |                                      | 2 sequences moved to the tables group grp_tmp                                                                                  | postgres
 MOVE_TABLES              | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_4                    |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_4                    | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_4                    | Move_tbl_4_to_tmp                                                                                                              | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_4                    | Move_tbl_4_to_tmp                                                                                                              | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mypartp2                   | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mypartp3                   | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblc1                    | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblc2                    | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblm                     | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | TABLE MOVED                 | myschema4.mytblr                     | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_TABLES              | END                         |                                      | 6 tables moved to the tables group grp_tmp                                                                                     | postgres
 MOVE_SEQUENCES           | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_4                    |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_4                    | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_4                    | Move_seq_4_to_tmp                                                                                                              | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_4                    | Move_seq_4_to_tmp                                                                                                              | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | myschema4.mytblp_col3_seq            | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_SEQUENCES           | SEQUENCE MOVED              | myschema4.mytblr_col1_seq            | From the logging group grp_tmp_4 to the logging group grp_tmp                                                                  | postgres
 MOVE_SEQUENCES           | END                         |                                      | 2 sequences moved to the tables group grp_tmp                                                                                  | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk4                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk4                                                                                                                            | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk5                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk5                                                                                                                            | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk6                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk6                                                                                                                            | postgres
 REMOVE_TABLE             | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp                              | 9 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                              | Remove_mytblc1                                                                                                                 | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                              | Remove_mytblc1                                                                                                                 | postgres
 REMOVE_TABLE             | TABLE REMOVED               | myschema4.mytblc1                    | From the logging group grp_tmp                                                                                                 | postgres
 REMOVE_TABLE             | END                         |                                      | 1 tables removed from their groups                                                                                             | postgres
 REMOVE_SEQUENCE          | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp                              | 8 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                              | Remove_myseq1                                                                                                                  | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                              | Remove_myseq1                                                                                                                  | postgres
 REMOVE_SEQUENCE          | SEQUENCE REMOVED            | "phil's schema3"."phil's seq\1"      | From the logging group grp_tmp                                                                                                 | postgres
 REMOVE_SEQUENCE          | END                         |                                      | 1 sequences removed from their groups                                                                                          | postgres
 ROLLBACK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | Logged rollback to mark Mk5 (timestamp)                                                                                        | postgres
 DBLINK_OPEN_CNX          |                             | rlbk#1                               | Status = 1                                                                                                                     | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback session #1                                                                                                            | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback session #1: 8 tables locked, 0 deadlock(s)                                                                            | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | RLBK_Mk5_%_START                                                                                                               | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | RLBK_Mk5_%_START                                                                                                               | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc2                    | All log rows where emaj_gid > 17600033 and <= 17600041                                                                         | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc2                    | 3 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblm                     | All log rows where emaj_gid > 17600033 and <= 17600041                                                                         | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblm                     | 1 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_SEQUENCE        |                             | myschema4.mytblp_col3_seq            |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | myschema4.mytblr_col1_seq            |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | "phil's schema3"."myTbl2\_col21_seq" |                                                                                                                                | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | RLBK_Mk5_%_DONE                                                                                                                | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | RLBK_Mk5_%_DONE                                                                                                                | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17601                    | 2 / 8 tables effectively processed.                                                                                            | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17601                    | 3 sequences processed.                                                                                                         | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17601                    | The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)                                   | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17601                    | The sequence "phil's schema3"."phil's seq\1" has been left unchanged (not in group anymore since <timestamp>)                  | postgres
 DBLINK_CLOSE_CNX         |                             | rlbk#1                               |                                                                                                                                | postgres
 ROLLBACK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback_id 17601, 2 tables and 3 sequences effectively processed                                                              | postgres
 RENAME_MARK_GROUP        | BEGIN                       | grp_tmp_3                            | EMAJ_LAST_MARK                                                                                                                 | postgres
 RENAME_MARK_GROUP        | END                         | grp_tmp_3                            | RLBK_Mk5_%_DONE renamed End_logged_rollback                                                                                    | postgres
 RENAME_MARK_GROUP        | BEGIN                       | grp_tmp_4                            | EMAJ_LAST_MARK                                                                                                                 | postgres
 RENAME_MARK_GROUP        | END                         | grp_tmp_4                            | RLBK_Mk5_%_DONE renamed End_logged_rollback                                                                                    | postgres
 RENAME_MARK_GROUP        | BEGIN                       | grp_tmp                              | EMAJ_LAST_MARK                                                                                                                 | postgres
 RENAME_MARK_GROUP        | END                         | grp_tmp                              | RLBK_Mk5_%_DONE renamed End_logged_rollback                                                                                    | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | Mk7                                                                                                                            | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 8 tables locked, 0 deadlock(s)                                                                                                 | postgres
 CLEANUP_RLBK_STATE       |                             | Rollback id 17601                    | set to COMMITTED                                                                                                               | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Mk7                                                                                                                            | postgres
 CONSOLIDATE_RLBK_GROUP   | BEGIN                       | grp_tmp                              | Erase all between marks Mk5 and End_logged_rollback                                                                            | postgres
 CONSOLIDATE_RLBK_GROUP   | END                         | grp_tmp                              | 2 tables and 3 sequences processed ; 4 marks deleted                                                                           | postgres
 GEN_SQL_GROUPS           | BEGIN                       | grp_tmp_3,grp_tmp_4,grp_tmp          | From mark Mk1 to current situation                                                                                             | postgres
 GEN_SQL_GROUPS           | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 26 generated statements - script exported into /tmp/emaj_15/adm3/allGroups.sql                                                 | postgres
 MODIFY_TABLES            | BEGIN                       |                                      |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp                              | 8 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp                              | revert changes for 1 table                                                                                                     | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp                              | revert changes for 1 table                                                                                                     | postgres
 MODIFY_TABLES            | PRIORITY CHANGED            | "phil's schema3"."phil's tbl1"       | -1 => NULL                                                                                                                     | postgres
 MODIFY_TABLES            | LOG DATA TABLESPACE CHANGED | "phil's schema3"."phil's tbl1"       | tsp log'2 => Default tablespace                                                                                                | postgres
 MODIFY_TABLES            | END                         |                                      | 1 tables effectively modified                                                                                                  | postgres
 ROLLBACK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | Unlogged rollback to mark Mk3 (timestamp)                                                                                      | postgres
 DBLINK_OPEN_CNX          |                             | rlbk#1                               | Status = 1                                                                                                                     | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback session #1                                                                                                            | postgres
 LOCK_GROUP               | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback session #1: 8 tables locked, 0 deadlock(s)                                                                            | postgres
 ROLLBACK_TABLE           | BEGIN                       | myschema4.mytblc2                    | All log rows where emaj_gid > 17600028 and <= 17600051                                                                         | postgres
 ROLLBACK_TABLE           | END                         | myschema4.mytblc2                    | 6 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_TABLE           | BEGIN                       | "phil's schema3".mytbl4              | All log rows where emaj_gid > 17600028 and <= 17600051, in session_replication_role = replica mode                             | postgres
 ROLLBACK_TABLE           | END                         | "phil's schema3".mytbl4              | 4 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_TABLE           | BEGIN                       | "phil's schema3"."myTbl2\"           | All log rows where emaj_gid > 17600028 and <= 17600051, in session_replication_role = replica mode                             | postgres
 ROLLBACK_TABLE           | END                         | "phil's schema3"."myTbl2\"           | 1 rolled back primary keys                                                                                                     | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Modify 1 table is deleted                                                                                                 | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Move_tbl_3_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Move_tbl_3_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Move_seq_3_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Move_seq_3_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Move_tbl_4_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark Move_tbl_4_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Move_seq_4_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark Move_seq_4_to_tmp is deleted                                                                                              | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Mk4 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Mk4 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark Mk4 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Mk5 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Mk5 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark Mk5 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Mk6 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark Mk6 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark RLBK_Mk5_%_START is deleted                                                                                               | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark RLBK_Mk5_%_START is deleted                                                                                               | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark End_logged_rollback is deleted                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark End_logged_rollback is deleted                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark End_logged_rollback is deleted                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark Mk7 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_3                            | mark Mk7 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp_4                            | mark Mk7 is deleted                                                                                                            | postgres
 ROLLBACK_GROUPS          | MARK DELETED                | grp_tmp                              | mark revert changes for 1 table is deleted                                                                                     | postgres
 ROLLBACK_SEQUENCE        |                             | myschema4.mytblp_col3_seq            |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | myschema4.mytblr_col1_seq            |                                                                                                                                | postgres
 ROLLBACK_SEQUENCE        |                             | "phil's schema3"."myTbl2\_col21_seq" |                                                                                                                                | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17602                    | 3 / 8 tables effectively processed.                                                                                            | postgres
 ROLLBACK_GROUPS          | NOTICE                      | Rollback id 17602                    | 3 sequences processed.                                                                                                         | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table "phil's schema3"."myTbl2\" has only been rolled back to its latest group attachment (<timestamp>)                    | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table "phil's schema3".mytbl4 has only been rolled back to its latest group attachment (<timestamp>)                       | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table "phil's schema3"."phil's tbl1" has only been rolled back to its latest group attachment (<timestamp>)                | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The sequence "phil's schema3"."myTbl2\_col21_seq" has only been rolled back to its latest group attachment state (<timestamp>) | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The sequence "phil's schema3"."phil's seq\1" has only been rolled back to its latest group attachment state (<timestamp>)      | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table myschema4.mypartp2 has only been rolled back to its latest group attachment (<timestamp>)                            | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)                            | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table myschema4.mytblc1 has only been rolled back to its latest group attachment (<timestamp>)                             | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table myschema4.mytblc2 has only been rolled back to its latest group attachment (<timestamp>)                             | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table myschema4.mytblm has only been rolled back to its latest group attachment (<timestamp>)                              | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The table myschema4.mytblr has only been rolled back to its latest group attachment (<timestamp>)                              | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The sequence myschema4.mytblp_col3_seq has only been rolled back to its latest group attachment state (<timestamp>)            | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | The sequence myschema4.mytblr_col1_seq has only been rolled back to its latest group attachment state (<timestamp>)            | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | Tables group change not rolled back: log data tablespace for "phil's schema3"."phil's tbl1"                                    | postgres
 ROLLBACK_GROUPS          | WARNING                     | Rollback id 17602                    | Tables group change not rolled back: E-Maj priority for "phil's schema3"."phil's tbl1"                                         | postgres
 DBLINK_CLOSE_CNX         |                             | rlbk#1                               |                                                                                                                                | postgres
 ROLLBACK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | Rollback_id 17602, 3 tables and 3 sequences effectively processed                                                              | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN                       | grp_tmp_3                            | Mk3                                                                                                                            | postgres
 DELETE_BEFORE_MARK_GROUP | END                         | grp_tmp_3                            | 3 marks deleted ; Mk3 is now the initial mark                                                                                  | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN                       | grp_tmp_4                            | Mk3                                                                                                                            | postgres
 DELETE_BEFORE_MARK_GROUP | END                         | grp_tmp_4                            | 6 marks deleted ; Mk3 is now the initial mark                                                                                  | postgres
 DELETE_BEFORE_MARK_GROUP | BEGIN                       | grp_tmp                              | Mk3                                                                                                                            | postgres
 DELETE_BEFORE_MARK_GROUP | END                         | grp_tmp                              | 3 marks deleted ; Mk3 is now the initial mark                                                                                  | postgres
 DISABLE_PROTECTION       | EVENT TRIGGERS DISABLED     |                                      | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                                                 | postgres
 ENABLE_PROTECTION        | EVENT TRIGGERS ENABLED      |                                      | emaj_protection_trg, emaj_sql_drop_trg, emaj_table_rewrite_trg                                                                 | postgres
 FORCE_STOP_GROUP         | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp                              | 8 tables locked, 0 deadlock(s)                                                                                                 | postgres
 FORCE_STOP_GROUP         | END                         | grp_tmp                              | 11 tables/sequences processed                                                                                                  | postgres
 REMOVE_TABLE             | BEGIN                       |                                      |                                                                                                                                | postgres
 REMOVE_TABLE             | TABLE REMOVED               | "phil's schema3".mytbl4              | From the idle group grp_tmp                                                                                                    | postgres
 REMOVE_TABLE             | END                         |                                      | 1 tables removed from their groups                                                                                             | postgres
 ASSIGN_TABLE             | BEGIN                       |                                      |                                                                                                                                | postgres
 ASSIGN_TABLE             | TABLE ADDED                 | "phil's schema3".mytbl4              | To the idle group grp_tmp                                                                                                      | postgres
 ASSIGN_TABLE             | END                         |                                      | 1 tables assigned to the group grp_tmp                                                                                         | postgres
 START_GROUP              | BEGIN                       | grp_tmp                              | With log reset                                                                                                                 | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp                              | 8 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                              | Group restart                                                                                                                  | postgres
 CLEANUP_RLBK_STATE       |                             | Rollback id 17602                    | set to COMMITTED                                                                                                               | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                              | Group restart                                                                                                                  | postgres
 START_GROUP              | END                         | grp_tmp                              | 11 tables/sequences processed                                                                                                  | postgres
 IMPORT_GROUPS            | BEGIN                       | grp_tmp, grp_tmp_3, grp_tmp_4        | Input file: '/tmp/emaj_15/adm3/groups_config.json'                                                                             | postgres
 LOCK_GROUPS              | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          |                                                                                                                                | postgres
 LOCK_GROUPS              | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | 8 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUPS          | BEGIN                       | grp_tmp,grp_tmp_3,grp_tmp_4          | REVERT_CHANGES                                                                                                                 | postgres
 SET_MARK_GROUPS          | END                         | grp_tmp,grp_tmp_3,grp_tmp_4          | REVERT_CHANGES                                                                                                                 | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mypartp2                   | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mypartp3                   | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblc2                    | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblm                     | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | myschema4.mytblr                     | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | "phil's schema3"."myTbl2\"           | From the logging group grp_tmp to the logging group grp_tmp_3                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | "phil's schema3".mytbl4              | From the logging group grp_tmp to the logging group grp_tmp_3                                                                  | postgres
 IMPORT_GROUPS            | TABLE MOVED                 | "phil's schema3"."phil's tbl1"       | From the logging group grp_tmp to the logging group grp_tmp_3                                                                  | postgres
 IMPORT_GROUPS            | SEQUENCE MOVED              | myschema4.mytblp_col3_seq            | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | SEQUENCE MOVED              | myschema4.mytblr_col1_seq            | From the logging group grp_tmp to the logging group grp_tmp_4                                                                  | postgres
 IMPORT_GROUPS            | SEQUENCE MOVED              | "phil's schema3"."myTbl2\_col21_seq" | From the logging group grp_tmp to the logging group grp_tmp_3                                                                  | postgres
 IMPORT_GROUPS            | TABLE ADDED                 | myschema4.mytblc1                    | To the logging group grp_tmp_4                                                                                                 | postgres
 IMPORT_GROUPS            | SEQUENCE ADDED              | "phil's schema3"."phil's seq\1"      | To the logging group grp_tmp_3                                                                                                 | postgres
 IMPORT_GROUPS            | END                         |                                      | 3 created or altered tables groups                                                                                             | postgres
 STOP_GROUP               | BEGIN                       | grp_tmp_3                            |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_3                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_3                            | 3 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_3                            | STOP_%                                                                                                                         | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_3                            | STOP_%                                                                                                                         | postgres
 STOP_GROUP               | END                         | grp_tmp_3                            | 5 tables/sequences processed                                                                                                   | postgres
 DROP_GROUP               | BEGIN                       | grp_tmp_3                            |                                                                                                                                | postgres
 DROP_GROUP               | END                         | grp_tmp_3                            | 5 tables/sequences processed                                                                                                   | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp_4                            |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp_4                            |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp_4                            | 6 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | END                         | grp_tmp_4                            | Last_mark                                                                                                                      | postgres
 FORCE_DROP_GROUP         | BEGIN                       | grp_tmp_4                            |                                                                                                                                | postgres
 FORCE_DROP_GROUP         | END                         | grp_tmp_4                            | 8 tables/sequences processed                                                                                                   | postgres
 STOP_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 LOCK_GROUP               | END                         | grp_tmp                              | 0 tables locked, 0 deadlock(s)                                                                                                 | postgres
 SET_MARK_GROUP           | BEGIN                       | grp_tmp                              | STOP_%                                                                                                                         | postgres
 SET_MARK_GROUP           | END                         | grp_tmp                              | STOP_%                                                                                                                         | postgres
 STOP_GROUP               | END                         | grp_tmp                              | 0 tables/sequences processed                                                                                                   | postgres
 DROP_GROUP               | BEGIN                       | grp_tmp                              |                                                                                                                                | postgres
 DROP_GROUP               | LOG_SCHEMA DROPPED          | emaj_myschema4                       |                                                                                                                                | postgres
 DROP_GROUP               | LOG_SCHEMA DROPPED          | "emaj_phil's schema3"                |                                                                                                                                | postgres
 DROP_GROUP               | END                         | grp_tmp                              | 0 tables/sequences processed                                                                                                   | postgres
(326 rows)

-- set sequence restart value
select public.handle_emaj_sequences(18000);
 handle_emaj_sequences 
-----------------------
 
(1 row)

\! rm $EMAJTESTTMPDIR/*
-----------------------------
-- Step 20 : test TRUNCATE (log, statistics, rollback, sql generation and replay)
-----------------------------
SET client_min_messages TO WARNING;
select emaj.emaj_create_group('truncateTestGroup');
 emaj_create_group 
-------------------
                 1
(1 row)

select emaj.emaj_assign_tables('phil''s schema3','.*','','truncateTestGroup');
 emaj_assign_tables 
--------------------
                  3
(1 row)

select emaj.emaj_assign_tables('myschema4','.*','','truncateTestGroup');
WARNING:  _assign_tables: Some partitionned tables (mytblp) are not selected.
WARNING:  _create_tbl: The table "myschema4.mytblm" has triggers that will be automatically disabled during E-Maj rollback operations (mytblm_insert_trigger). Use the emaj_modify_table() function to change this behaviour.
 emaj_assign_tables 
--------------------
                  6
(1 row)

RESET client_min_messages;
select emaj.emaj_start_group('truncateTestGroup','M1');
 emaj_start_group 
------------------
                9
(1 row)

truncate "phil's schema3"."phil's tbl1" cascade;
NOTICE:  truncate cascades to table "mytbl4"
NOTICE:  truncate cascades to table "myTbl2\"
truncate myschema4.myTblC2;
truncate myschema4.myPartP3;
select count(*) from "phil's schema3"."phil's tbl1";
 count 
-------
     0
(1 row)

select count(*) from "emaj_phil's schema3"."phil's tbl1_log";
 count 
-------
    20
(1 row)

select is_called, last_value from "emaj_phil's schema3"."phil's tbl1_log_seq";
 is_called | last_value 
-----------+------------
 t         |         19
(1 row)

select emaj.emaj_set_mark_group('truncateTestGroup','M2');
 emaj_set_mark_group 
---------------------
                   9
(1 row)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj.emaj_log_stat_group('truncateTestGroup','M1',null) where stat_rows > 0 order by 1,2,3,4;
    stat_group     |  stat_schema   | stat_table  | stat_first_mark | stat_last_mark | stat_rows 
-------------------+----------------+-------------+-----------------+----------------+-----------
 truncateTestGroup | myschema4      | mypartp3    | M1              |                |         1
 truncateTestGroup | myschema4      | mytblc2     | M1              |                |         6
 truncateTestGroup | phil's schema3 | myTbl2\     | M1              |                |         6
 truncateTestGroup | phil's schema3 | mytbl4      | M1              |                |         8
 truncateTestGroup | phil's schema3 | phil's tbl1 | M1              |                |        19
(5 rows)

select * from emaj.emaj_logged_rollback_group('truncateTestGroup','M1', false);
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 5 / 9 tables effectively processed.
(1 row)

select stat_group, stat_schema, stat_table, stat_first_mark, stat_last_mark, stat_rows
  from emaj.emaj_log_stat_group('truncateTestGroup','M1',null) where stat_rows > 0 order by 1,2,3,4;
    stat_group     |  stat_schema   | stat_table  | stat_first_mark | stat_last_mark | stat_rows 
-------------------+----------------+-------------+-----------------+----------------+-----------
 truncateTestGroup | myschema4      | mypartp3    | M1              |                |         2
 truncateTestGroup | myschema4      | mytblc2     | M1              |                |        12
 truncateTestGroup | phil's schema3 | myTbl2\     | M1              |                |        12
 truncateTestGroup | phil's schema3 | mytbl4      | M1              |                |        16
 truncateTestGroup | phil's schema3 | phil's tbl1 | M1              |                |        38
(5 rows)

select emaj.emaj_gen_sql_group('truncateTestGroup','M1','M2',:'EMAJTESTTMPDIR' || '/gensql.sql');
NOTICE:  table "emaj_temp_script" does not exist, skipping
 emaj_gen_sql_group 
--------------------
                  5
(1 row)

-- TODO: replace the previous statement by the next one, once the issue with the emaj_logged_rollback_group() and emaj_gen_sql_groups() functions will be fixed
--select emaj.emaj_gen_sql_group('truncateTestGroup','M1',null,:'EMAJTESTTMPDIR' || '/gensql.sql');
select * from emaj.emaj_rollback_group('truncateTestGroup','M1', false);
 rlbk_severity |            rlbk_message             
---------------+-------------------------------------
 Notice        | 5 / 9 tables effectively processed.
(1 row)

\! sed -i -s 's/at .*$/at [ts]$/' $EMAJTESTTMPDIR/gensql.sql
\! sed -i -s 's/\\\\/\\/g' $EMAJTESTTMPDIR/gensql.sql
\! sed -i -s 's/^COMMIT/ROLLBACK/' $EMAJTESTTMPDIR/gensql.sql
\set FILE1 :EMAJTESTTMPDIR '/gensql.sql'
\i :FILE1
-- SQL script generated by E-Maj at [ts]$
--    for tables group(s): truncateTestGroup
--    processing logs between mark M1 and mark M2
SET standard_conforming_strings = OFF;
SET escape_string_warning = OFF;
SET datestyle = 'ISO, YMD';
BEGIN TRANSACTION;
TRUNCATE ONLY "phil's schema3"."phil's tbl1" CASCADE;
psql:/tmp/emaj_15/adm3/gensql.sql:8: NOTICE:  truncate cascades to table "mytbl4"
psql:/tmp/emaj_15/adm3/gensql.sql:8: NOTICE:  truncate cascades to table "myTbl2\"
TRUNCATE ONLY "phil's schema3".mytbl4 CASCADE;
psql:/tmp/emaj_15/adm3/gensql.sql:9: NOTICE:  truncate cascades to table "myTbl2\"
TRUNCATE ONLY "phil's schema3"."myTbl2\" CASCADE;
TRUNCATE ONLY myschema4.mytblc2 CASCADE;
TRUNCATE ONLY myschema4.mypartp3 CASCADE;
ROLLBACK;
RESET standard_conforming_strings;
RESET escape_string_warning;
RESET datestyle;
\! rm $EMAJTESTTMPDIR/*
select emaj.emaj_stop_group('truncateTestGroup');
 emaj_stop_group 
-----------------
               9
(1 row)

select emaj.emaj_drop_group('truncateTestGroup');
 emaj_drop_group 
-----------------
               9
(1 row)

-- first set all rollback events state
select emaj.emaj_cleanup_rollback_state();
 emaj_cleanup_rollback_state 
-----------------------------
                           0
(1 row)

-----------------------------
-- Checking step 20
-----------------------------
-- emaj tables
select rlbk_id, rlbk_groups, rlbk_mark, rlbk_time_id, rlbk_is_logged, rlbk_is_alter_group_allowed, rlbk_nb_session, rlbk_nb_table,
       rlbk_nb_sequence, rlbk_eff_nb_table, rlbk_status, rlbk_begin_hist_id, rlbk_dblink_schema, rlbk_is_dblink_used,
       case when rlbk_end_datetime is null then 'null' else '[ts]' end as "end_datetime",
       regexp_replace(array_to_string(rlbk_messages,'#'),E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g')
  from emaj.emaj_rlbk where rlbk_id >= 10000 order by rlbk_id;
 rlbk_id |          rlbk_groups          |       rlbk_mark       | rlbk_time_id | rlbk_is_logged | rlbk_is_alter_group_allowed | rlbk_nb_session | rlbk_nb_table | rlbk_nb_sequence | rlbk_eff_nb_table | rlbk_status | rlbk_begin_hist_id | rlbk_dblink_schema | rlbk_is_dblink_used | end_datetime |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        regexp_replace                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
---------+-------------------------------+-----------------------+--------------+----------------+-----------------------------+-----------------+---------------+------------------+-------------------+-------------+--------------------+--------------------+---------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   10000 | {myGroup1,myGroup2}           | after move            |        10009 | t              | f                           |               1 |            11 |                4 |                 1 | COMMITTED   |              10065 | public             | t                   | [ts]         | Notice: 1 / 11 tables effectively processed.#Notice: 4 sequences processed.
   10001 | {myGroup1,myGroup2}           | before move           |        10011 | f              | t                           |               1 |            11 |                4 |                 1 | COMMITTED   |              10083 | public             | t                   | [ts]         | Notice: 1 / 11 tables effectively processed.#Notice: 4 sequences processed.#Warning: The table myschema2."myTbl3" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence myschema2."myTbl3_col31_seq" has only been rolled back to its latest group attachment state (<timestamp>)#Warning: Tables group change not rolled back: log data tablespace for myschema2."myTbl3"#Warning: Tables group change not rolled back: log index tablespace for myschema2."myTbl3"#Warning: Tables group change not rolled back: E-Maj priority for myschema2."myTbl3"
   12300 | {myGroup2}                    | M2                    |        12300 | t              | f                           |               1 |             6 |                2 |                 3 | COMMITTED   |              12300 |                    | f                   | [ts]         | Notice: 3 / 6 tables effectively processed.#Notice: 2 sequences processed.
   12301 | {myGroup2}                    | M3                    |        12302 | t              | f                           |               1 |             6 |                2 |                 3 | COMMITTED   |              12319 |                    | f                   | [ts]         | Notice: 3 / 6 tables effectively processed.#Notice: 2 sequences processed.
   12400 | {myGroup1}                    | M2                    |        12400 | f              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |              12400 | public             | t                   | [ts]         | Notice: 2 / 5 tables effectively processed.#Notice: 2 sequences processed.
   12500 | {myGroup2}                    | M2                    |        12500 | t              | f                           |               1 |             6 |                2 |                 3 | COMMITTED   |              12500 | public             | t                   | [ts]         | Notice: 3 / 6 tables effectively processed.#Notice: 2 sequences processed.
   12501 | {myGroup2}                    | M3                    |        12502 | f              | f                           |               1 |             6 |                2 |                 3 | COMMITTED   |              12520 | public             | t                   | [ts]         | Notice: 3 / 6 tables effectively processed.#Notice: 2 sequences processed.
   12600 | {myGroup1}                    | M5                    |        12600 | f              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |              12600 | public             | t                   | [ts]         | Notice: 2 / 5 tables effectively processed.#Notice: 2 sequences processed.
   12601 | {myGroup1}                    | M4                    |        12601 | t              | t                           |               1 |             5 |                2 |                 3 | COMMITTED   |              12615 | public             | t                   | [ts]         | Notice: 3 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14000 | {myGroup1,myGroup2}           | Multi-1               |        14003 | t              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |              14021 | public             | t                   | [ts]         | Notice: 0 / 11 tables effectively processed.#Notice: 4 sequences processed.
   14001 | {myGroup1,myGroup2}           | Multi-2               |        14005 | f              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |              14037 | public             | t                   | [ts]         | Notice: 0 / 11 tables effectively processed.#Notice: 4 sequences processed.
   14002 | {myGroup1,myGroup2}           | Multi-1               |        14006 | f              | f                           |               1 |            11 |                4 |                 0 | COMMITTED   |              14053 | public             | t                   | [ts]         | Notice: 0 / 11 tables effectively processed.#Notice: 4 sequences processed.
   14003 | {myGroup2}                    | Multi-2               |        14010 | f              | f                           |               1 |             6 |                2 |                 0 | COMMITTED   |              14089 | public             | t                   | [ts]         | Notice: 0 / 6 tables effectively processed.#Notice: 2 sequences processed.
   14200 | {"phil's group#3\","}         | phil's mark #3        |        14207 | t              | f                           |               1 |             2 |                2 |                 0 | COMMITTED   |              14235 | public             | t                   | [ts]         | Notice: 0 / 2 tables effectively processed.#Notice: 2 sequences processed.
   14201 | {"phil's group#3\","}         | phil's mark #3        |        14209 | f              | f                           |               1 |             2 |                2 |                 0 | COMMITTED   |              14249 | public             | t                   | [ts]         | Notice: 0 / 2 tables effectively processed.#Notice: 2 sequences processed.
   14300 | {myGroup1}                    | Multi-1               |        14300 | f              | f                           |               1 |             5 |                2 |                 1 | COMMITTED   |              14300 | public             | t                   | [ts]         | Notice: 1 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14400 | {myGroup1}                    | Multi-1               |        14400 | f              | f                           |               1 |             5 |                2 |                 1 | ABORTED     |              14414 | public             | t                   | [ts]         | Notice: 1 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14401 | {myGroup2}                    | Multi-1               |        14401 | f              | f                           |               1 |             6 |                2 |                 4 | ABORTED     |              14426 | public             | t                   | [ts]         | Notice: 4 / 6 tables effectively processed.#Notice: 2 sequences processed.
   14402 | {"phil's group#3\","}         | M1_rollbackable       |        14402 | f              | f                           |               1 |             2 |                2 |                 2 | ABORTED     |              14444 | public             | t                   | [ts]         | Notice: 2 / 2 tables effectively processed.#Notice: 2 sequences processed.
   14500 | {"phil's group#3\","}         | M1_after_table_rename |        14505 | f              | f                           |               1 |             2 |                2 |                 1 | COMMITTED   |              14528 | public             | t                   | [ts]         | Notice: 1 / 2 tables effectively processed.#Notice: 2 sequences processed.
   14700 | {myGroup1}                    | MC1                   |        14703 | t              | f                           |               1 |             5 |                2 |                 3 | COMMITTED   |              14715 | public             | t                   | [ts]         | Notice: 3 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14701 | {myGroup1}                    | MC3                   |        14708 | t              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |              14750 | public             | t                   | [ts]         | Notice: 2 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14702 | {myGroup1}                    | MC8                   |        14713 | t              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |              14785 | public             | t                   | [ts]         | Notice: 2 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14703 | {myGroup1}                    | MC6                   |        14716 | t              | f                           |               1 |             5 |                2 |                 5 | COMMITTED   |              14810 | public             | t                   | [ts]         | Notice: 5 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14704 | {myGroup1}                    | MC10                  |        14719 | t              | f                           |               1 |             5 |                2 |                 1 | COMMITTED   |              14841 | public             | t                   | [ts]         | Notice: 1 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14705 | {myGroup1}                    | MC10                  |        14722 | t              | f                           |               1 |             5 |                2 |                 2 | COMMITTED   |              14862 | public             | t                   | [ts]         | Notice: 2 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14706 | {myGroup1}                    | MC15                  |        14726 | t              | f                           |               1 |             5 |                2 |                 3 | COMMITTED   |              14891 | public             | t                   | [ts]         | Notice: 3 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14707 | {myGroup1}                    | MC16                  |        14729 | t              | f                           |               1 |             5 |                2 |                 3 | COMMITTED   |              14918 | public             | t                   | [ts]         | Notice: 3 / 5 tables effectively processed.#Notice: 2 sequences processed.
   14708 | {myGroup1}                    | Multi-1               |        14731 | f              | t                           |               1 |             5 |                2 |                 3 | COMMITTED   |              14940 | public             | t                   | [ts]         | Notice: 3 / 5 tables effectively processed.#Notice: 2 sequences processed.#Warning: Tables group change not rolled back: ignored triggers list for myschema1.mytbl2
   17200 | {myGroup4}                    | Start                 |        17206 | f              | t                           |               1 |             6 |                0 |                 2 | COMMITTED   |              17240 | public             | t                   | [ts]         | Notice: 2 / 6 tables effectively processed.#Warning: The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mypartp1 has been left unchanged (not in group anymore since <timestamp>)#Warning: The sequence myschema4.mytblp_col3_seq has been left unchanged (not in group anymore since <timestamp>)
   17201 | {myGroup4}                    | Before update         |        17208 | t              | f                           |               1 |             6 |                0 |                 2 | COMMITTED   |              17264 | public             | t                   | [ts]         | Notice: 2 / 6 tables effectively processed.
   17600 | {grp_tmp,grp_tmp_3,grp_tmp_4} | Mk3                   |        17613 | f              | f                           |               1 |             9 |                4 |                 2 | COMMITTED   |              17668 | public             | t                   | [ts]         | Notice: 2 / 9 tables effectively processed.#Notice: 4 sequences processed.
   17601 | {grp_tmp,grp_tmp_3,grp_tmp_4} | Mk5                   |        17624 | t              | t                           |               1 |             8 |                3 |                 2 | COMMITTED   |              17756 | public             | t                   | [ts]         | Notice: 2 / 8 tables effectively processed.#Notice: 3 sequences processed.#Warning: The table myschema4.mytblc1 has been left unchanged (not in group anymore since <timestamp>)#Warning: The sequence "phil's schema3"."phil's seq\1" has been left unchanged (not in group anymore since <timestamp>)
   17602 | {grp_tmp,grp_tmp_3,grp_tmp_4} | Mk3                   |        17628 | f              | t                           |               1 |             8 |                3 |                 3 | COMMITTED   |              17800 | public             | t                   | [ts]         | Notice: 3 / 8 tables effectively processed.#Notice: 3 sequences processed.#Warning: The table "phil's schema3"."myTbl2\" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table "phil's schema3".mytbl4 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table "phil's schema3"."phil's tbl1" has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence "phil's schema3"."myTbl2\_col21_seq" has only been rolled back to its latest group attachment state (<timestamp>)#Warning: The sequence "phil's schema3"."phil's seq\1" has only been rolled back to its latest group attachment state (<timestamp>)#Warning: The table myschema4.mypartp2 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mypartp3 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblc1 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblc2 has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblm has only been rolled back to its latest group attachment (<timestamp>)#Warning: The table myschema4.mytblr has only been rolled back to its latest group attachment (<timestamp>)#Warning: The sequence myschema4.mytblp_col3_seq has only been rolled back to its latest group attachment state (<timestamp>)#Warning: The sequence myschema4.mytblr_col1_seq has only been rolled back to its latest group attachment state (<timestamp>)#Warning: Tables group change not rolled back: log data tablespace for "phil's schema3"."phil's tbl1"#Warning: Tables group change not rolled back: E-Maj priority for "phil's schema3"."phil's tbl1"
   18000 | {truncateTestGroup}           | M1                    |        18005 | t              | f                           |               1 |             9 |                0 |                 5 | COMMITTED   |              18027 | public             | t                   | [ts]         | Notice: 5 / 9 tables effectively processed.
   18001 | {truncateTestGroup}           | M1                    |        18007 | f              | f                           |               1 |             9 |                0 |                 5 | COMMITTED   |              18050 | public             | t                   | [ts]         | Notice: 5 / 9 tables effectively processed.
(36 rows)

select rlbs_rlbk_id, rlbs_session, 
       case when rlbs_end_datetime is null then 'null' else '[ts]' end as "end_datetime"
  from emaj.emaj_rlbk_session where rlbs_rlbk_id >= 10000  order by rlbs_rlbk_id, rlbs_session;
 rlbs_rlbk_id | rlbs_session | end_datetime 
--------------+--------------+--------------
        12300 |            1 | [ts]
        12301 |            1 | [ts]
        12400 |            1 | [ts]
        12500 |            1 | [ts]
        12501 |            1 | [ts]
        12600 |            1 | [ts]
        12601 |            1 | [ts]
        14000 |            1 | [ts]
        14001 |            1 | [ts]
        14002 |            1 | [ts]
        14003 |            1 | [ts]
        14200 |            1 | [ts]
        14201 |            1 | [ts]
        14300 |            1 | [ts]
        14400 |            1 | [ts]
        14401 |            1 | [ts]
        14402 |            1 | [ts]
        14500 |            1 | [ts]
        14700 |            1 | [ts]
        14701 |            1 | [ts]
        14702 |            1 | [ts]
        14703 |            1 | [ts]
        14704 |            1 | [ts]
        14705 |            1 | [ts]
        14706 |            1 | [ts]
        14707 |            1 | [ts]
        14708 |            1 | [ts]
        17200 |            1 | [ts]
        17201 |            1 | [ts]
        17600 |            1 | [ts]
        17601 |            1 | [ts]
        17602 |            1 | [ts]
        18000 |            1 | [ts]
        18001 |            1 | [ts]
(34 rows)

select rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object, rlbp_target_time_id, rlbp_batch_number, rlbp_session,
       rlbp_object_def, rlbp_app_trg_type, rlbp_is_repl_role_replica, rlbp_estimated_quantity, rlbp_estimate_method, rlbp_quantity
  from emaj.emaj_rlbk_plan where rlbp_rlbk_id >= 10000  order by rlbp_rlbk_id, rlbp_step, rlbp_schema, rlbp_table, rlbp_object;
 rlbp_rlbk_id |     rlbp_step      |  rlbp_schema   |                           rlbp_table                            |    rlbp_object    | rlbp_target_time_id | rlbp_batch_number | rlbp_session |                                                                                       rlbp_object_def                                                                                       | rlbp_app_trg_type | rlbp_is_repl_role_replica | rlbp_estimated_quantity | rlbp_estimate_method | rlbp_quantity 
--------------+--------------------+----------------+-----------------------------------------------------------------+-------------------+---------------------+-------------------+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------+---------------------------+-------------------------+----------------------+---------------
        12300 | SET_FK_DEF         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        12300 | SET_FK_DEF         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        12300 | RLBK_TABLE         | myschema2      | mytbl4                                                          |                   |               12200 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                       4 |                    3 |             2
        12300 | RLBK_TABLE         | myschema2      | mytbl5                                                          |                   |               12200 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    3 |             1
        12300 | RLBK_TABLE         | myschema2      | mytbl6                                                          |                   |               12200 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       3 |                    3 |             3
        12300 | SET_FK_IMM         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |              
        12300 | SET_FK_IMM         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |              
        12300 | CTRL-DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       7 |                    3 |              
        12301 | SET_FK_DEF         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12301 | SET_FK_DEF         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12301 | RLBK_TABLE         | myschema2      | mytbl4                                                          |                   |               12201 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             2
        12301 | RLBK_TABLE         | myschema2      | mytbl5                                                          |                   |               12201 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    1 |             1
        12301 | RLBK_TABLE         | myschema2      | mytbl6                                                          |                   |               12201 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       3 |                    1 |             3
        12301 | SET_FK_IMM         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |              
        12301 | SET_FK_IMM         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |              
        12301 | CTRL-DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       7 |                    2 |              
        12400 | DIS_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12400 | DIS_LOG_TRG        | myschema1      | mytbl4                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12400 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               12100 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       3 |                    3 |             5
        12400 | RLBK_TABLE         | myschema1      | mytbl4                                                          |                   |               12100 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                       8 |                    3 |             3
        12400 | DELETE_LOG         | myschema1      | mytbl1                                                          |                   |               12100 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |             5
        12400 | DELETE_LOG         | myschema1      | mytbl4                                                          |                   |               12100 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       8 |                    3 |            12
        12400 | ENA_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12400 | ENA_LOG_TRG        | myschema1      | mytbl4                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12400 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       8 |                    2 |              
        12500 | SET_FK_DEF         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12500 | SET_FK_DEF         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12500 | RLBK_TABLE         | myschema2      | mytbl4                                                          |                   |               12200 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       8 |                    1 |             2
        12500 | RLBK_TABLE         | myschema2      | mytbl5                                                          |                   |               12200 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       3 |                    1 |             1
        12500 | RLBK_TABLE         | myschema2      | mytbl6                                                          |                   |               12200 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       9 |                    1 |             3
        12500 | SET_FK_IMM         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       9 |                    3 |              
        12500 | SET_FK_IMM         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       9 |                    3 |              
        12500 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       7 |                    2 |              
        12501 | DIS_LOG_TRG        | myschema2      | mytbl4                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | DIS_LOG_TRG        | myschema2      | mytbl5                                                          |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | DIS_LOG_TRG        | myschema2      | mytbl6                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | SET_FK_DEF         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | SET_FK_DEF         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | RLBK_TABLE         | myschema2      | mytbl4                                                          |                   |               12201 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       6 |                    1 |             2
        12501 | RLBK_TABLE         | myschema2      | mytbl5                                                          |                   |               12201 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       3 |                    1 |             1
        12501 | RLBK_TABLE         | myschema2      | mytbl6                                                          |                   |               12201 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       9 |                    1 |             3
        12501 | DELETE_LOG         | myschema2      | mytbl4                                                          |                   |               12201 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       6 |                    3 |             6
        12501 | DELETE_LOG         | myschema2      | mytbl5                                                          |                   |               12201 |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |             3
        12501 | DELETE_LOG         | myschema2      | mytbl6                                                          |                   |               12201 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       9 |                    3 |             9
        12501 | SET_FK_IMM         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       9 |                    2 |              
        12501 | SET_FK_IMM         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       9 |                    3 |              
        12501 | ENA_LOG_TRG        | myschema2      | mytbl4                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | ENA_LOG_TRG        | myschema2      | mytbl5                                                          |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | ENA_LOG_TRG        | myschema2      | mytbl6                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12501 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                      16 |                    2 |              
        12600 | DIS_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12600 | DIS_LOG_TRG        | myschema1      | mytbl4                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12600 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               12402 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       1 |                    1 |             1
        12600 | RLBK_TABLE         | myschema1      | mytbl4                                                          |                   |               12402 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             2
        12600 | DELETE_LOG         | myschema1      | mytbl1                                                          |                   |               12402 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       1 |                    1 |             1
        12600 | DELETE_LOG         | myschema1      | mytbl4                                                          |                   |               12402 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       2 |                    1 |             2
        12600 | ENA_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12600 | ENA_LOG_TRG        | myschema1      | mytbl4                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        12600 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       8 |                    2 |              
        12601 | RLBK_TABLE         | myschema1      | myTbl3                                                          |                   |               12401 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                      10 |                    3 |            10
        12601 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               12401 |                 3 |            1 |                                                                                                                                                                                             |                   | t                         |                       1 |                    1 |             1
        12601 | RLBK_TABLE         | myschema1      | mytbl4                                                          |                   |               12401 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             2
        12601 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       3 |                    2 |              
        14300 | DIS_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14300 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      20 |                    1 |             0
        14300 | DELETE_LOG         | myschema1      | mytbl1                                                          |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      20 |                    1 |             0
        14300 | ENA_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14300 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       4 |                    2 |              
        14400 | DIS_LOG_TRG        | myschema1      | mytbl2b                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14400 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       5 |                    3 |             2
        14400 | DELETE_LOG         | myschema1      | mytbl2b                                                         |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       5 |                    3 |             6
        14400 | ENA_LOG_TRG        | myschema1      | mytbl2b                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14400 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       4 |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2      | mytbl2                                                          |                   |                     |                 4 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2      | mytbl5                                                          |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | DIS_LOG_TRG        | myschema2      | mytbl6                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | SET_FK_DEF         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | SET_FK_DEF         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | RLBK_TABLE         | myschema2      | mytbl1                                                          |                   |               14008 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       3 |                    3 |             2
        14401 | RLBK_TABLE         | myschema2      | mytbl2                                                          |                   |               14008 |                 4 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    3 |             2
        14401 | RLBK_TABLE         | myschema2      | mytbl5                                                          |                   |               14008 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       3 |                    1 |             2
        14401 | RLBK_TABLE         | myschema2      | mytbl6                                                          |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                      17 |                    1 |            14
        14401 | DELETE_LOG         | myschema2      | mytbl1                                                          |                   |               14008 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |             4
        14401 | DELETE_LOG         | myschema2      | mytbl2                                                          |                   |               14008 |                 4 |            1 |                                                                                                                                                                                             |                   |                           |                       2 |                    3 |             2
        14401 | DELETE_LOG         | myschema2      | mytbl5                                                          |                   |               14008 |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    1 |             4
        14401 | DELETE_LOG         | myschema2      | mytbl6                                                          |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      17 |                    1 |            26
        14401 | SET_FK_IMM         | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      17 |                    2 |              
        14401 | SET_FK_IMM         | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      17 |                    3 |              
        14401 | ENA_LOG_TRG        | myschema2      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | ENA_LOG_TRG        | myschema2      | mytbl2                                                          |                   |                     |                 4 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | ENA_LOG_TRG        | myschema2      | mytbl5                                                          |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | ENA_LOG_TRG        | myschema2      | mytbl6                                                          |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14401 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                      20 |                    2 |              
        14402 | DIS_LOG_TRG        | phil's schema3 | myTbl2\                                                         |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14402 | DIS_LOG_TRG        | phil's schema3 | phil's tbl1                                                     |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14402 | DROP_FK            | phil's schema3 | myTbl2\                                                         | mytbl2_col21_fkey |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14402 | DROP_FK            | phil's schema3 | mytbl4                                                          | mytbl4_col44_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14402 | RLBK_TABLE         | phil's schema3 | myTbl2\                                                         |                   |               14203 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    3 |             2
        14402 | RLBK_TABLE         | phil's schema3 | phil's tbl1                                                     |                   |               14203 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                      53 |                    3 |            33
        14402 | DELETE_LOG         | phil's schema3 | myTbl2\                                                         |                   |               14203 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       2 |                    3 |             2
        14402 | DELETE_LOG         | phil's schema3 | phil's tbl1                                                     |                   |               14203 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      53 |                    3 |            63
        14402 | ADD_FK             | phil's schema3 | myTbl2\                                                         | mytbl2_col21_fkey |                     |                 2 |            1 | FOREIGN KEY (col21) REFERENCES "phil's schema3".mytbl4(col41)                                                                                                                               |                   |                           |                       0 |                    3 |              
        14402 | ADD_FK             | phil's schema3 | mytbl4                                                          | mytbl4_col44_fkey |                     |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES "phil's schema3"."phil's tbl1"("phil's col11", "phil's col12") ON UPDATE SET NULL ON DELETE CASCADE                                                   |                   |                           |                       0 |                    3 |              
        14402 | ENA_LOG_TRG        | phil's schema3 | myTbl2\                                                         |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14402 | ENA_LOG_TRG        | phil's schema3 | phil's tbl1                                                     |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14402 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                      12 |                    2 |              
        14500 | DIS_LOG_TRG        | phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14500 | DROP_FK            | phil's schema3 | mytbl4                                                          | mytbl4_col44_fkey |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14500 | RLBK_TABLE         | phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                   |               14503 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       6 |                    3 |            10
        14500 | DELETE_LOG         | phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                   |               14503 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       6 |                    3 |            10
        14500 | ADD_FK             | phil's schema3 | mytbl4                                                          | mytbl4_col44_fkey |                     |                 1 |            1 | FOREIGN KEY (col44, col45) REFERENCES "phil's schema3".table_with_very_looooooooooooooooooooooooooooooooooooooong_name("phil's col11", "phil's col12") ON UPDATE SET NULL ON DELETE CASCADE |                   |                           |                       0 |                    3 |              
        14500 | ENA_LOG_TRG        | phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14500 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       6 |                    2 |              
        14700 | SET_ALWAYS_APP_TRG | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14700 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14701 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      15 |                    1 |            13
        14700 | RLBK_TABLE         | myschema1      | mytbl2                                                          |                   |               14701 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    3 |             1
        14700 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14701 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    1 |             2
        14700 | SET_LOCAL_APP_TRG  | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14700 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       5 |                    2 |              
        14701 | RLBK_TABLE         | myschema1      | myTbl3                                                          |                   |               14705 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                      10 |                    1 |            10
        14701 | RLBK_TABLE         | myschema1      | mytbl4                                                          |                   |               14705 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             1
        14701 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       2 |                    2 |              
        14702 | SET_ALWAYS_APP_TRG | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14702 | RLBK_TABLE         | myschema1      | mytbl2                                                          |                   |               14712 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                       1 |                    1 |             1
        14702 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14712 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    1 |             1
        14702 | SET_LOCAL_APP_TRG  | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14702 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       4 |                    2 |              
        14703 | SET_ALWAYS_APP_TRG | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14703 | RLBK_TABLE         | myschema1      | myTbl3                                                          |                   |               14710 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                      10 |                    1 |            10
        14703 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14710 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      15 |                    1 |            13
        14703 | RLBK_TABLE         | myschema1      | mytbl2                                                          |                   |               14710 |                 3 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             1
        14703 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14710 |                 4 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    1 |             2
        14703 | RLBK_TABLE         | myschema1      | mytbl4                                                          |                   |               14710 |                 5 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             1
        14703 | SET_LOCAL_APP_TRG  | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14703 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       7 |                    2 |              
        14704 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14718 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      16 |                    1 |            11
        14704 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       1 |                    2 |              
        14705 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14718 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      22 |                    1 |            11
        14705 | RLBK_TABLE         | myschema1      | mytbl4                                                          |                   |               14718 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             1
        14705 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       2 |                    2 |              
        14706 | SET_ALWAYS_APP_TRG | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14706 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14724 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      15 |                    1 |            13
        14706 | RLBK_TABLE         | myschema1      | mytbl2                                                          |                   |               14724 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       2 |                    1 |             1
        14706 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14724 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    1 |             2
        14706 | SET_LOCAL_APP_TRG  | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14706 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       5 |                    2 |              
        14707 | SET_ALWAYS_APP_TRG | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14707 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14725 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      11 |                    1 |            11
        14707 | RLBK_TABLE         | myschema1      | mytbl2                                                          |                   |               14725 |                 3 |            1 |                                                                                                                                                                                             |                   | t                         |                       3 |                    1 |             2
        14707 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14725 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       4 |                    1 |             2
        14707 | SET_LOCAL_APP_TRG  | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14707 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       5 |                    2 |              
        14708 | SET_ALWAYS_APP_TRG | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14708 | DIS_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14708 | DIS_LOG_TRG        | myschema1      | mytbl2                                                          |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14708 | DIS_LOG_TRG        | myschema1      | mytbl2b                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14708 | RLBK_TABLE         | myschema1      | mytbl1                                                          |                   |               14008 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                      11 |                    1 |            11
        14708 | RLBK_TABLE         | myschema1      | mytbl2                                                          |                   |               14008 |                 3 |            1 |                                                                                                                                                                                             |                   | t                         |                       4 |                    1 |             3
        14708 | RLBK_TABLE         | myschema1      | mytbl2b                                                         |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                      14 |                    1 |             4
        14708 | DELETE_LOG         | myschema1      | mytbl1                                                          |                   |               14008 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                      11 |                    1 |            11
        14708 | DELETE_LOG         | myschema1      | mytbl2                                                          |                   |               14008 |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                       4 |                    3 |             4
        14708 | DELETE_LOG         | myschema1      | mytbl2b                                                         |                   |               14008 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      14 |                    1 |            10
        14708 | SET_LOCAL_APP_TRG  | myschema1      | mytbl2                                                          | mytbl2trg2        |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    3 |              
        14708 | ENA_LOG_TRG        | myschema1      | mytbl1                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14708 | ENA_LOG_TRG        | myschema1      | mytbl2                                                          |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14708 | ENA_LOG_TRG        | myschema1      | mytbl2b                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        14708 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                      14 |                    2 |              
        17200 | DIS_LOG_TRG        | myschema4      | mypartp2                                                        |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17200 | DIS_LOG_TRG        | myschema4      | mypartp3                                                        |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17200 | RLBK_TABLE         | myschema4      | mypartp2                                                        |                   |               17200 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    3 |             2
        17200 | RLBK_TABLE         | myschema4      | mypartp3                                                        |                   |               17202 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    3 |             1
        17200 | DELETE_LOG         | myschema4      | mypartp2                                                        |                   |               17200 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       2 |                    3 |             3
        17200 | DELETE_LOG         | myschema4      | mypartp3                                                        |                   |               17202 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       1 |                    3 |             1
        17200 | ENA_LOG_TRG        | myschema4      | mypartp2                                                        |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17200 | ENA_LOG_TRG        | myschema4      | mypartp3                                                        |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17200 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       8 |                    2 |              
        17201 | RLBK_TABLE         | myschema4      | mypartp2                                                        |                   |               17207 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    1 |             1
        17201 | RLBK_TABLE         | myschema4      | mypartp3                                                        |                   |               17207 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    1 |             1
        17201 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       2 |                    2 |              
        17600 | DIS_LOG_TRG        | myschema4      | mytblc1                                                         |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17600 | DIS_LOG_TRG        | myschema4      | mytblc2                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17600 | RLBK_TABLE         | myschema4      | mytblc1                                                         |                   |               17612 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    3 |             1
        17600 | RLBK_TABLE         | myschema4      | mytblc2                                                         |                   |               17612 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       3 |                    3 |             3
        17600 | DELETE_LOG         | myschema4      | mytblc1                                                         |                   |               17612 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       1 |                    3 |             1
        17600 | DELETE_LOG         | myschema4      | mytblc2                                                         |                   |               17612 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       3 |                    3 |             6
        17600 | ENA_LOG_TRG        | myschema4      | mytblc1                                                         |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17600 | ENA_LOG_TRG        | myschema4      | mytblc2                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17600 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       8 |                    2 |              
        17601 | RLBK_TABLE         | myschema4      | mytblc2                                                         |                   |               17620 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       6 |                    1 |             3
        17601 | RLBK_TABLE         | myschema4      | mytblm                                                          |                   |               17620 |                 2 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    3 |             1
        17601 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       2 |                    2 |              
        17602 | DIS_LOG_TRG        | myschema4      | mytblc2                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17602 | DIS_LOG_TRG        | phil's schema3 | myTbl2\                                                         |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17602 | DIS_LOG_TRG        | phil's schema3 | mytbl4                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17602 | RLBK_TABLE         | myschema4      | mytblc2                                                         |                   |               17617 |                 1 |            1 |                                                                                                                                                                                             |                   | f                         |                       6 |                    1 |             6
        17602 | RLBK_TABLE         | phil's schema3 | myTbl2\                                                         |                   |               17615 |                 3 |            1 |                                                                                                                                                                                             |                   | t                         |                       1 |                    1 |             1
        17602 | RLBK_TABLE         | phil's schema3 | mytbl4                                                          |                   |               17615 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       4 |                    3 |             4
        17602 | DELETE_LOG         | myschema4      | mytblc2                                                         |                   |               17617 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                       6 |                    1 |             6
        17602 | DELETE_LOG         | phil's schema3 | myTbl2\                                                         |                   |               17615 |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                       1 |                    1 |             1
        17602 | DELETE_LOG         | phil's schema3 | mytbl4                                                          |                   |               17615 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                       4 |                    3 |             7
        17602 | ENA_LOG_TRG        | myschema4      | mytblc2                                                         |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17602 | ENA_LOG_TRG        | phil's schema3 | myTbl2\                                                         |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17602 | ENA_LOG_TRG        | phil's schema3 | mytbl4                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        17602 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                      12 |                    2 |              
        18000 | RLBK_TABLE         | myschema4      | mypartp3                                                        |                   |               18003 |                 5 |            1 |                                                                                                                                                                                             |                   | f                         |                       1 |                    1 |             2
        18000 | RLBK_TABLE         | myschema4      | mytblc2                                                         |                   |               18003 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                       6 |                    1 |             7
        18000 | RLBK_TABLE         | phil's schema3 | myTbl2\                                                         |                   |               18003 |                 4 |            1 |                                                                                                                                                                                             |                   | t                         |                       6 |                    1 |             7
        18000 | RLBK_TABLE         | phil's schema3 | mytbl4                                                          |                   |               18003 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                       8 |                    1 |             9
        18000 | RLBK_TABLE         | phil's schema3 | phil's tbl1                                                     |                   |               18003 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      19 |                    1 |            20
        18000 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                       5 |                    2 |              
        18001 | DIS_LOG_TRG        | myschema4      | mypartp3                                                        |                   |                     |                 5 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | myschema4      | mytblc2                                                         |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | phil's schema3 | myTbl2\                                                         |                   |                     |                 4 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | phil's schema3 | mytbl4                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | DIS_LOG_TRG        | phil's schema3 | phil's tbl1                                                     |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | RLBK_TABLE         | myschema4      | mypartp3                                                        |                   |               18003 |                 5 |            1 |                                                                                                                                                                                             |                   | f                         |                       2 |                    1 |             2
        18001 | RLBK_TABLE         | myschema4      | mytblc2                                                         |                   |               18003 |                 3 |            1 |                                                                                                                                                                                             |                   | f                         |                      12 |                    1 |             7
        18001 | RLBK_TABLE         | phil's schema3 | myTbl2\                                                         |                   |               18003 |                 4 |            1 |                                                                                                                                                                                             |                   | t                         |                      12 |                    1 |             7
        18001 | RLBK_TABLE         | phil's schema3 | mytbl4                                                          |                   |               18003 |                 2 |            1 |                                                                                                                                                                                             |                   | t                         |                      16 |                    1 |             9
        18001 | RLBK_TABLE         | phil's schema3 | phil's tbl1                                                     |                   |               18003 |                 1 |            1 |                                                                                                                                                                                             |                   | t                         |                      38 |                    1 |            20
        18001 | DELETE_LOG         | myschema4      | mypartp3                                                        |                   |               18003 |                 5 |            1 |                                                                                                                                                                                             |                   |                           |                       2 |                    1 |             3
        18001 | DELETE_LOG         | myschema4      | mytblc2                                                         |                   |               18003 |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                      12 |                    1 |            13
        18001 | DELETE_LOG         | phil's schema3 | myTbl2\                                                         |                   |               18003 |                 4 |            1 |                                                                                                                                                                                             |                   |                           |                      12 |                    1 |            13
        18001 | DELETE_LOG         | phil's schema3 | mytbl4                                                          |                   |               18003 |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                      16 |                    1 |            17
        18001 | DELETE_LOG         | phil's schema3 | phil's tbl1                                                     |                   |               18003 |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                      38 |                    1 |            39
        18001 | ENA_LOG_TRG        | myschema4      | mypartp3                                                        |                   |                     |                 5 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | myschema4      | mytblc2                                                         |                   |                     |                 3 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | phil's schema3 | myTbl2\                                                         |                   |                     |                 4 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | phil's schema3 | mytbl4                                                          |                   |                     |                 2 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | ENA_LOG_TRG        | phil's schema3 | phil's tbl1                                                     |                   |                     |                 1 |            1 |                                                                                                                                                                                             |                   |                           |                         |                    2 |              
        18001 | CTRL+DBLINK        |                |                                                                 |                   |                     |                   |              |                                                                                                                                                                                             |                   |                           |                      20 |                    2 |              
(232 rows)

select rlbt_step, rlbt_schema, rlbt_table, rlbt_object, rlbt_rlbk_id, rlbt_quantity
  from emaj.emaj_rlbk_stat where rlbt_rlbk_id >= 10000 order by rlbt_rlbk_id, rlbt_step, rlbt_schema, rlbt_table, rlbt_object;
  rlbt_step  |  rlbt_schema   |                           rlbt_table                            |    rlbt_object    | rlbt_rlbk_id | rlbt_quantity 
-------------+----------------+-----------------------------------------------------------------+-------------------+--------------+---------------
 RLBK_TABLE  | myschema2      | myTbl3                                                          |                   |        10000 |             2
 CTRL+DBLINK |                |                                                                 |                   |        10000 |             1
 DIS_LOG_TRG |                |                                                                 |                   |        10001 |             1
 RLBK_TABLE  | myschema2      | myTbl3                                                          |                   |        10001 |             6
 DELETE_LOG  | myschema2      | myTbl3                                                          |                   |        10001 |             6
 ENA_LOG_TRG |                |                                                                 |                   |        10001 |             1
 CTRL+DBLINK |                |                                                                 |                   |        10001 |             4
 SET_FK_DEF  |                |                                                                 |                   |        12300 |             2
 RLBK_TABLE  | myschema2      | mytbl4                                                          |                   |        12300 |             4
 RLBK_TABLE  | myschema2      | mytbl5                                                          |                   |        12300 |             1
 RLBK_TABLE  | myschema2      | mytbl6                                                          |                   |        12300 |             3
 SET_FK_IMM  | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |        12300 |             3
 SET_FK_IMM  | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |        12300 |             3
 CTRL-DBLINK |                |                                                                 |                   |        12300 |             7
 SET_FK_DEF  |                |                                                                 |                   |        12301 |             2
 RLBK_TABLE  | myschema2      | mytbl4                                                          |                   |        12301 |             2
 RLBK_TABLE  | myschema2      | mytbl5                                                          |                   |        12301 |             1
 RLBK_TABLE  | myschema2      | mytbl6                                                          |                   |        12301 |             3
 SET_FK_IMM  | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |        12301 |             3
 SET_FK_IMM  | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |        12301 |             3
 CTRL-DBLINK |                |                                                                 |                   |        12301 |             7
 DIS_LOG_TRG |                |                                                                 |                   |        12400 |             2
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        12400 |             3
 RLBK_TABLE  | myschema1      | mytbl4                                                          |                   |        12400 |             8
 DELETE_LOG  | myschema1      | mytbl1                                                          |                   |        12400 |             3
 DELETE_LOG  | myschema1      | mytbl4                                                          |                   |        12400 |             8
 ENA_LOG_TRG |                |                                                                 |                   |        12400 |             2
 CTRL+DBLINK |                |                                                                 |                   |        12400 |             8
 SET_FK_DEF  |                |                                                                 |                   |        12500 |             2
 RLBK_TABLE  | myschema2      | mytbl4                                                          |                   |        12500 |             8
 RLBK_TABLE  | myschema2      | mytbl5                                                          |                   |        12500 |             3
 RLBK_TABLE  | myschema2      | mytbl6                                                          |                   |        12500 |             9
 SET_FK_IMM  | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |        12500 |             9
 SET_FK_IMM  | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |        12500 |             9
 CTRL+DBLINK |                |                                                                 |                   |        12500 |             7
 DIS_LOG_TRG |                |                                                                 |                   |        12501 |             3
 SET_FK_DEF  |                |                                                                 |                   |        12501 |             2
 RLBK_TABLE  | myschema2      | mytbl4                                                          |                   |        12501 |             6
 RLBK_TABLE  | myschema2      | mytbl5                                                          |                   |        12501 |             3
 RLBK_TABLE  | myschema2      | mytbl6                                                          |                   |        12501 |             9
 DELETE_LOG  | myschema2      | mytbl4                                                          |                   |        12501 |             6
 DELETE_LOG  | myschema2      | mytbl5                                                          |                   |        12501 |             3
 DELETE_LOG  | myschema2      | mytbl6                                                          |                   |        12501 |             9
 SET_FK_IMM  | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |        12501 |             9
 SET_FK_IMM  | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |        12501 |             9
 ENA_LOG_TRG |                |                                                                 |                   |        12501 |             3
 CTRL+DBLINK |                |                                                                 |                   |        12501 |            16
 DIS_LOG_TRG |                |                                                                 |                   |        12600 |             2
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        12600 |             1
 RLBK_TABLE  | myschema1      | mytbl4                                                          |                   |        12600 |             2
 DELETE_LOG  | myschema1      | mytbl1                                                          |                   |        12600 |             1
 DELETE_LOG  | myschema1      | mytbl4                                                          |                   |        12600 |             2
 ENA_LOG_TRG |                |                                                                 |                   |        12600 |             2
 CTRL+DBLINK |                |                                                                 |                   |        12600 |             8
 RLBK_TABLE  | myschema1      | myTbl3                                                          |                   |        12601 |            10
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        12601 |             1
 RLBK_TABLE  | myschema1      | mytbl4                                                          |                   |        12601 |             2
 CTRL+DBLINK |                |                                                                 |                   |        12601 |             3
 DIS_LOG_TRG |                |                                                                 |                   |        14300 |             1
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14300 |            20
 DELETE_LOG  | myschema1      | mytbl1                                                          |                   |        14300 |            20
 ENA_LOG_TRG |                |                                                                 |                   |        14300 |             1
 CTRL+DBLINK |                |                                                                 |                   |        14300 |             4
 DIS_LOG_TRG |                |                                                                 |                   |        14400 |             1
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14400 |             5
 DELETE_LOG  | myschema1      | mytbl2b                                                         |                   |        14400 |             5
 ENA_LOG_TRG |                |                                                                 |                   |        14400 |             1
 CTRL+DBLINK |                |                                                                 |                   |        14400 |             4
 DIS_LOG_TRG |                |                                                                 |                   |        14401 |             4
 SET_FK_DEF  |                |                                                                 |                   |        14401 |             2
 RLBK_TABLE  | myschema2      | mytbl1                                                          |                   |        14401 |             3
 RLBK_TABLE  | myschema2      | mytbl2                                                          |                   |        14401 |             2
 RLBK_TABLE  | myschema2      | mytbl5                                                          |                   |        14401 |             3
 RLBK_TABLE  | myschema2      | mytbl6                                                          |                   |        14401 |            17
 DELETE_LOG  | myschema2      | mytbl1                                                          |                   |        14401 |             3
 DELETE_LOG  | myschema2      | mytbl2                                                          |                   |        14401 |             2
 DELETE_LOG  | myschema2      | mytbl5                                                          |                   |        14401 |             3
 DELETE_LOG  | myschema2      | mytbl6                                                          |                   |        14401 |            17
 SET_FK_IMM  | myschema2      | mytbl6                                                          | mytbl6_col61_fkey |        14401 |            17
 SET_FK_IMM  | myschema2      | mytbl8                                                          | mytbl8_col81_fkey |        14401 |            17
 ENA_LOG_TRG |                |                                                                 |                   |        14401 |             4
 CTRL+DBLINK |                |                                                                 |                   |        14401 |            20
 DIS_LOG_TRG |                |                                                                 |                   |        14402 |             2
 DROP_FK     |                |                                                                 |                   |        14402 |             2
 RLBK_TABLE  | phil's schema3 | myTbl2\                                                         |                   |        14402 |             2
 RLBK_TABLE  | phil's schema3 | phil's tbl1                                                     |                   |        14402 |            53
 DELETE_LOG  | phil's schema3 | myTbl2\                                                         |                   |        14402 |             2
 DELETE_LOG  | phil's schema3 | phil's tbl1                                                     |                   |        14402 |            53
 ADD_FK      | phil's schema3 | myTbl2\                                                         | mytbl2_col21_fkey |        14402 |             0
 ADD_FK      | phil's schema3 | mytbl4                                                          | mytbl4_col44_fkey |        14402 |             0
 ENA_LOG_TRG |                |                                                                 |                   |        14402 |             2
 CTRL+DBLINK |                |                                                                 |                   |        14402 |            12
 DIS_LOG_TRG |                |                                                                 |                   |        14500 |             1
 DROP_FK     |                |                                                                 |                   |        14500 |             1
 RLBK_TABLE  | phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                   |        14500 |             6
 DELETE_LOG  | phil's schema3 | table_with_very_looooooooooooooooooooooooooooooooooooooong_name |                   |        14500 |             6
 ADD_FK      | phil's schema3 | mytbl4                                                          | mytbl4_col44_fkey |        14500 |             0
 ENA_LOG_TRG |                |                                                                 |                   |        14500 |             1
 CTRL+DBLINK |                |                                                                 |                   |        14500 |             6
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14700 |            15
 RLBK_TABLE  | myschema1      | mytbl2                                                          |                   |        14700 |             2
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14700 |             2
 CTRL+DBLINK |                |                                                                 |                   |        14700 |             5
 RLBK_TABLE  | myschema1      | myTbl3                                                          |                   |        14701 |            10
 RLBK_TABLE  | myschema1      | mytbl4                                                          |                   |        14701 |             2
 CTRL+DBLINK |                |                                                                 |                   |        14701 |             2
 RLBK_TABLE  | myschema1      | mytbl2                                                          |                   |        14702 |             1
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14702 |             1
 CTRL+DBLINK |                |                                                                 |                   |        14702 |             4
 RLBK_TABLE  | myschema1      | myTbl3                                                          |                   |        14703 |            10
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14703 |            15
 RLBK_TABLE  | myschema1      | mytbl2                                                          |                   |        14703 |             2
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14703 |             2
 RLBK_TABLE  | myschema1      | mytbl4                                                          |                   |        14703 |             2
 CTRL+DBLINK |                |                                                                 |                   |        14703 |             7
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14704 |            16
 CTRL+DBLINK |                |                                                                 |                   |        14704 |             1
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14705 |            22
 RLBK_TABLE  | myschema1      | mytbl4                                                          |                   |        14705 |             2
 CTRL+DBLINK |                |                                                                 |                   |        14705 |             2
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14706 |            15
 RLBK_TABLE  | myschema1      | mytbl2                                                          |                   |        14706 |             2
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14706 |             2
 CTRL+DBLINK |                |                                                                 |                   |        14706 |             5
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14707 |            11
 RLBK_TABLE  | myschema1      | mytbl2                                                          |                   |        14707 |             3
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14707 |             4
 CTRL+DBLINK |                |                                                                 |                   |        14707 |             5
 DIS_LOG_TRG |                |                                                                 |                   |        14708 |             3
 RLBK_TABLE  | myschema1      | mytbl1                                                          |                   |        14708 |            11
 RLBK_TABLE  | myschema1      | mytbl2                                                          |                   |        14708 |             4
 RLBK_TABLE  | myschema1      | mytbl2b                                                         |                   |        14708 |            14
 DELETE_LOG  | myschema1      | mytbl1                                                          |                   |        14708 |            11
 DELETE_LOG  | myschema1      | mytbl2                                                          |                   |        14708 |             4
 DELETE_LOG  | myschema1      | mytbl2b                                                         |                   |        14708 |            14
 ENA_LOG_TRG |                |                                                                 |                   |        14708 |             3
 CTRL+DBLINK |                |                                                                 |                   |        14708 |            14
 DIS_LOG_TRG |                |                                                                 |                   |        17200 |             2
 RLBK_TABLE  | myschema4      | mypartp2                                                        |                   |        17200 |             2
 RLBK_TABLE  | myschema4      | mypartp3                                                        |                   |        17200 |             1
 DELETE_LOG  | myschema4      | mypartp2                                                        |                   |        17200 |             2
 DELETE_LOG  | myschema4      | mypartp3                                                        |                   |        17200 |             1
 ENA_LOG_TRG |                |                                                                 |                   |        17200 |             2
 CTRL+DBLINK |                |                                                                 |                   |        17200 |             8
 RLBK_TABLE  | myschema4      | mypartp2                                                        |                   |        17201 |             1
 RLBK_TABLE  | myschema4      | mypartp3                                                        |                   |        17201 |             1
 CTRL+DBLINK |                |                                                                 |                   |        17201 |             2
 DIS_LOG_TRG |                |                                                                 |                   |        17600 |             2
 RLBK_TABLE  | myschema4      | mytblc1                                                         |                   |        17600 |             1
 RLBK_TABLE  | myschema4      | mytblc2                                                         |                   |        17600 |             3
 DELETE_LOG  | myschema4      | mytblc1                                                         |                   |        17600 |             1
 DELETE_LOG  | myschema4      | mytblc2                                                         |                   |        17600 |             3
 ENA_LOG_TRG |                |                                                                 |                   |        17600 |             2
 CTRL+DBLINK |                |                                                                 |                   |        17600 |             8
 RLBK_TABLE  | myschema4      | mytblc2                                                         |                   |        17601 |             6
 RLBK_TABLE  | myschema4      | mytblm                                                          |                   |        17601 |             2
 CTRL+DBLINK |                |                                                                 |                   |        17601 |             2
 DIS_LOG_TRG |                |                                                                 |                   |        17602 |             3
 RLBK_TABLE  | myschema4      | mytblc2                                                         |                   |        17602 |             6
 RLBK_TABLE  | phil's schema3 | myTbl2\                                                         |                   |        17602 |             1
 RLBK_TABLE  | phil's schema3 | mytbl4                                                          |                   |        17602 |             4
 DELETE_LOG  | myschema4      | mytblc2                                                         |                   |        17602 |             6
 DELETE_LOG  | phil's schema3 | myTbl2\                                                         |                   |        17602 |             1
 DELETE_LOG  | phil's schema3 | mytbl4                                                          |                   |        17602 |             4
 ENA_LOG_TRG |                |                                                                 |                   |        17602 |             3
 CTRL+DBLINK |                |                                                                 |                   |        17602 |            12
 RLBK_TABLE  | myschema4      | mypartp3                                                        |                   |        18000 |             1
 RLBK_TABLE  | myschema4      | mytblc2                                                         |                   |        18000 |             6
 RLBK_TABLE  | phil's schema3 | myTbl2\                                                         |                   |        18000 |             6
 RLBK_TABLE  | phil's schema3 | mytbl4                                                          |                   |        18000 |             8
 RLBK_TABLE  | phil's schema3 | phil's tbl1                                                     |                   |        18000 |            19
 CTRL+DBLINK |                |                                                                 |                   |        18000 |             5
 DIS_LOG_TRG |                |                                                                 |                   |        18001 |             5
 RLBK_TABLE  | myschema4      | mypartp3                                                        |                   |        18001 |             2
 RLBK_TABLE  | myschema4      | mytblc2                                                         |                   |        18001 |            12
 RLBK_TABLE  | phil's schema3 | myTbl2\                                                         |                   |        18001 |            12
 RLBK_TABLE  | phil's schema3 | mytbl4                                                          |                   |        18001 |            16
 RLBK_TABLE  | phil's schema3 | phil's tbl1                                                     |                   |        18001 |            38
 DELETE_LOG  | myschema4      | mypartp3                                                        |                   |        18001 |             2
 DELETE_LOG  | myschema4      | mytblc2                                                         |                   |        18001 |            12
 DELETE_LOG  | phil's schema3 | myTbl2\                                                         |                   |        18001 |            12
 DELETE_LOG  | phil's schema3 | mytbl4                                                          |                   |        18001 |            16
 DELETE_LOG  | phil's schema3 | phil's tbl1                                                     |                   |        18001 |            38
 ENA_LOG_TRG |                |                                                                 |                   |        18001 |             5
 CTRL+DBLINK |                |                                                                 |                   |        18001 |            20
(185 rows)

select time_id, time_last_emaj_gid, time_event from emaj.emaj_time_stamp where time_id >= 18000 order by time_id;
 time_id | time_last_emaj_gid | time_event 
---------+--------------------+------------
   18000 |           18000000 | C
   18001 |           18000000 | A
   18002 |           18000000 | A
   18003 |           18000000 | M
   18004 |           18000045 | M
   18005 |           18000045 | R
   18006 |           18000085 | M
   18007 |           18000085 | R
   18008 |           18000133 | M
   18009 |           18000133 | D
(10 rows)

select hist_function, hist_event, hist_object,
       regexp_replace(regexp_replace(regexp_replace(hist_wording,
            E'\\d\\d\.\\d\\d\\.\\d\\d\\.\\d\\d\\d\\d','%','g'),
            E'\\d\\d\\d\\d/\\d\\d\\/\\d\\d\\ \\d\\d\\:\\d\\d:\\d\\d .*?\\)','<timestamp>)','g'),
            E'\\[.+\\]','(timestamp)','g'), 
       hist_user
  from emaj.emaj_hist where hist_id >= 18000 order by hist_id;
   hist_function    |     hist_event     |          hist_object           |                                           regexp_replace                                           | hist_user 
--------------------+--------------------+--------------------------------+----------------------------------------------------------------------------------------------------+-----------
 CREATE_GROUP       | BEGIN              | truncateTestGroup              | rollbackable                                                                                       | postgres
 CREATE_GROUP       | END                | truncateTestGroup              |                                                                                                    | postgres
 ASSIGN_TABLES      | BEGIN              |                                |                                                                                                    | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED | "emaj_phil's schema3"          |                                                                                                    | postgres
 ASSIGN_TABLES      | TABLE ADDED        | "phil's schema3"."myTbl2\"     | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | "phil's schema3".mytbl4        | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | "phil's schema3"."phil's tbl1" | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | END                |                                | 3 tables assigned to the group truncateTestGroup                                                   | postgres
 ASSIGN_TABLES      | BEGIN              |                                |                                                                                                    | postgres
 ASSIGN_TABLES      | LOG_SCHEMA CREATED | emaj_myschema4                 |                                                                                                    | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp3             | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblr               | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblm               | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblc2              | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mypartp2             | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | TABLE ADDED        | myschema4.mytblc1              | To the idle group truncateTestGroup                                                                | postgres
 ASSIGN_TABLES      | END                |                                | 6 tables assigned to the group truncateTestGroup                                                   | postgres
 START_GROUP        | BEGIN              | truncateTestGroup              | With log reset                                                                                     | postgres
 LOCK_GROUP         | BEGIN              | truncateTestGroup              |                                                                                                    | postgres
 LOCK_GROUP         | END                | truncateTestGroup              | 9 tables locked, 0 deadlock(s)                                                                     | postgres
 SET_MARK_GROUP     | BEGIN              | truncateTestGroup              | M1                                                                                                 | postgres
 SET_MARK_GROUP     | END                | truncateTestGroup              | M1                                                                                                 | postgres
 START_GROUP        | END                | truncateTestGroup              | 9 tables/sequences processed                                                                       | postgres
 SET_MARK_GROUP     | BEGIN              | truncateTestGroup              |                                                                                                    | postgres
 LOCK_GROUP         | BEGIN              | truncateTestGroup              |                                                                                                    | postgres
 LOCK_GROUP         | END                | truncateTestGroup              | 9 tables locked, 0 deadlock(s)                                                                     | postgres
 SET_MARK_GROUP     | END                | truncateTestGroup              | M2                                                                                                 | postgres
 ROLLBACK_GROUP     | BEGIN              | truncateTestGroup              | Logged rollback to mark M1 (timestamp)                                                             | postgres
 DBLINK_OPEN_CNX    |                    | rlbk#1                         | Status = 1                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | truncateTestGroup              | Rollback session #1                                                                                | postgres
 LOCK_GROUP         | END                | truncateTestGroup              | Rollback session #1: 9 tables locked, 0 deadlock(s)                                                | postgres
 SET_MARK_GROUP     | BEGIN              | truncateTestGroup              | RLBK_M1_%_START                                                                                    | postgres
 SET_MARK_GROUP     | END                | truncateTestGroup              | RLBK_M1_%_START                                                                                    | postgres
 ROLLBACK_TABLE     | BEGIN              | "phil's schema3"."phil's tbl1" | All log rows where emaj_gid > 18000000 and <= 18000045, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE     | END                | "phil's schema3"."phil's tbl1" | 20 rolled back primary keys                                                                        | postgres
 ROLLBACK_TABLE     | BEGIN              | "phil's schema3".mytbl4        | All log rows where emaj_gid > 18000000 and <= 18000045, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE     | END                | "phil's schema3".mytbl4        | 9 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mytblc2              | All log rows where emaj_gid > 18000000 and <= 18000045                                             | postgres
 ROLLBACK_TABLE     | END                | myschema4.mytblc2              | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | "phil's schema3"."myTbl2\"     | All log rows where emaj_gid > 18000000 and <= 18000045, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE     | END                | "phil's schema3"."myTbl2\"     | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp3             | All log rows where emaj_gid > 18000000 and <= 18000045                                             | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp3             | 2 rolled back primary keys                                                                         | postgres
 SET_MARK_GROUP     | BEGIN              | truncateTestGroup              | RLBK_M1_%_DONE                                                                                     | postgres
 SET_MARK_GROUP     | END                | truncateTestGroup              | RLBK_M1_%_DONE                                                                                     | postgres
 ROLLBACK_GROUP     | NOTICE             | Rollback id 18000              | 5 / 9 tables effectively processed.                                                                | postgres
 DBLINK_CLOSE_CNX   |                    | rlbk#1                         |                                                                                                    | postgres
 ROLLBACK_GROUP     | END                | truncateTestGroup              | Rollback_id 18000, 5 tables and 0 sequences effectively processed                                  | postgres
 GEN_SQL_GROUP      | BEGIN              | truncateTestGroup              | From mark M1 to mark M2                                                                            | postgres
 GEN_SQL_GROUP      | END                | truncateTestGroup              | 5 generated statements - script exported into /tmp/emaj_15/adm3/gensql.sql                         | postgres
 ROLLBACK_GROUP     | BEGIN              | truncateTestGroup              | Unlogged rollback to mark M1 (timestamp)                                                           | postgres
 DBLINK_OPEN_CNX    |                    | rlbk#1                         | Status = 1                                                                                         | postgres
 LOCK_GROUP         | BEGIN              | truncateTestGroup              | Rollback session #1                                                                                | postgres
 LOCK_GROUP         | END                | truncateTestGroup              | Rollback session #1: 9 tables locked, 0 deadlock(s)                                                | postgres
 ROLLBACK_TABLE     | BEGIN              | "phil's schema3"."phil's tbl1" | All log rows where emaj_gid > 18000000 and <= 18000085, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE     | END                | "phil's schema3"."phil's tbl1" | 20 rolled back primary keys                                                                        | postgres
 ROLLBACK_TABLE     | BEGIN              | "phil's schema3".mytbl4        | All log rows where emaj_gid > 18000000 and <= 18000085, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE     | END                | "phil's schema3".mytbl4        | 9 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mytblc2              | All log rows where emaj_gid > 18000000 and <= 18000085                                             | postgres
 ROLLBACK_TABLE     | END                | myschema4.mytblc2              | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | "phil's schema3"."myTbl2\"     | All log rows where emaj_gid > 18000000 and <= 18000085, in session_replication_role = replica mode | postgres
 ROLLBACK_TABLE     | END                | "phil's schema3"."myTbl2\"     | 7 rolled back primary keys                                                                         | postgres
 ROLLBACK_TABLE     | BEGIN              | myschema4.mypartp3             | All log rows where emaj_gid > 18000000 and <= 18000085                                             | postgres
 ROLLBACK_TABLE     | END                | myschema4.mypartp3             | 2 rolled back primary keys                                                                         | postgres
 ROLLBACK_GROUP     | MARK DELETED       | truncateTestGroup              | mark M2 is deleted                                                                                 | postgres
 ROLLBACK_GROUP     | MARK DELETED       | truncateTestGroup              | mark RLBK_M1_%_START is deleted                                                                    | postgres
 ROLLBACK_GROUP     | MARK DELETED       | truncateTestGroup              | mark RLBK_M1_%_DONE is deleted                                                                     | postgres
 ROLLBACK_GROUP     | NOTICE             | Rollback id 18001              | 5 / 9 tables effectively processed.                                                                | postgres
 DBLINK_CLOSE_CNX   |                    | rlbk#1                         |                                                                                                    | postgres
 ROLLBACK_GROUP     | END                | truncateTestGroup              | Rollback_id 18001, 5 tables and 0 sequences effectively processed                                  | postgres
 STOP_GROUP         | BEGIN              | truncateTestGroup              |                                                                                                    | postgres
 LOCK_GROUP         | BEGIN              | truncateTestGroup              |                                                                                                    | postgres
 LOCK_GROUP         | END                | truncateTestGroup              | 9 tables locked, 0 deadlock(s)                                                                     | postgres
 SET_MARK_GROUP     | BEGIN              | truncateTestGroup              | STOP_%                                                                                             | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 18000              | set to COMMITTED                                                                                   | postgres
 CLEANUP_RLBK_STATE |                    | Rollback id 18001              | set to COMMITTED                                                                                   | postgres
 SET_MARK_GROUP     | END                | truncateTestGroup              | STOP_%                                                                                             | postgres
 STOP_GROUP         | END                | truncateTestGroup              | 9 tables/sequences processed                                                                       | postgres
 DROP_GROUP         | BEGIN              | truncateTestGroup              |                                                                                                    | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED | emaj_myschema4                 |                                                                                                    | postgres
 DROP_GROUP         | LOG_SCHEMA DROPPED | "emaj_phil's schema3"          |                                                                                                    | postgres
 DROP_GROUP         | END                | truncateTestGroup              | 9 tables/sequences processed                                                                       | postgres
(82 rows)

--
reset role;
-- the groups are left in their current state for the parallel rollback test.
select count(*) from mySchema1.myTbl4;
 count 
-------
     0
(1 row)

select count(*) from mySchema1.myTbl1;
 count 
-------
    20
(1 row)

select count(*) from mySchema1.myTbl2; 
 count 
-------
     3
(1 row)

select count(*) from mySchema1."myTbl3";
 count 
-------
     5
(1 row)

select count(*) from mySchema1.myTbl2b;
 count 
-------
     3
(1 row)

select count(*) from mySchema2.myTbl4;
 count 
-------
     2
(1 row)

select count(*) from mySchema2.myTbl1;
 count 
-------
    10
(1 row)

select count(*) from mySchema2.myTbl2; 
 count 
-------
     4
(1 row)

select count(*) from mySchema2."myTbl3";
 count 
-------
    10
(1 row)

select count(*) from mySchema2.myTbl5;
 count 
-------
     3
(1 row)

select count(*) from mySchema2.myTbl6;
 count 
-------
    14
(1 row)

-- remove the temp directory
\! rm -R $EMAJTESTTMPDIR
